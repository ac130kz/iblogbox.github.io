var g_errmsg=function(f){proc_g_errmsg&&proc_g_errmsg(f)},webodf_version="0.5.4";function Runtime(){}Runtime.prototype.getVariable=function(f){};Runtime.prototype.toJson=function(f){};Runtime.prototype.fromJson=function(f){};Runtime.prototype.byteArrayFromString=function(f,k){};Runtime.prototype.byteArrayToString=function(f,k){};Runtime.prototype.read=function(f,k,a,d){};Runtime.prototype.readFile=function(f,k,a){};Runtime.prototype.readFileSync=function(f,k){};
Runtime.prototype.loadXML=function(f,k){};Runtime.prototype.writeFile=function(f,k,a){};Runtime.prototype.deleteFile=function(f,k){};Runtime.prototype.log=function(f,k){};Runtime.prototype.setTimeout=function(f,k){};Runtime.prototype.clearTimeout=function(f){};Runtime.prototype.libraryPaths=function(){};Runtime.prototype.currentDirectory=function(){};Runtime.prototype.setCurrentDirectory=function(f){};Runtime.prototype.type=function(){};Runtime.prototype.getDOMImplementation=function(){};
Runtime.prototype.parseXML=function(f){};Runtime.prototype.exit=function(f){};Runtime.prototype.getWindow=function(){};Runtime.prototype.requestAnimationFrame=function(f){};Runtime.prototype.cancelAnimationFrame=function(f){};Runtime.prototype.assert=function(f,k){};var IS_COMPILED_CODE=!0;
Runtime.byteArrayToString=function(f,k){function a(d){var a="",l,c=d.length;for(l=0;l<c;l+=1)a+=String.fromCharCode(d[l]&255);return a}function d(d){var a="",l,c=d.length,m=[],p,b,e,r;for(l=0;l<c;l+=1)p=d[l],128>p?m.push(p):(l+=1,b=d[l],194<=p&&224>p?m.push((p&31)<<6|b&63):(l+=1,e=d[l],224<=p&&240>p?m.push((p&15)<<12|(b&63)<<6|e&63):(l+=1,r=d[l],240<=p&&245>p&&(p=(p&7)<<18|(b&63)<<12|(e&63)<<6|r&63,p-=65536,m.push((p>>10)+55296,(p&1023)+56320))))),1E3<=m.length&&(a+=String.fromCharCode.apply(null,
m),m.length=0);return a+String.fromCharCode.apply(null,m)}var c;"utf8"===k?c=d(f):("binary"!==k&&this.log("Unsupported encoding: "+k),c=a(f));return c};Runtime.getVariable=function(f){try{return eval(f)}catch(k){}};Runtime.toJson=function(f){return JSON.stringify(f)};Runtime.fromJson=function(f){return JSON.parse(f)};Runtime.getFunctionName=function(f){return void 0===f.name?(f=/function\s+(\w+)/.exec(f))&&f[1]:f.name};
Runtime.assert=function(f,k){if(!f)throw this.log("alert","ASSERTION FAILED:\n"+k),Error(k);};
function BrowserRuntime(f){function k(d){var a=d.length,b,e,r=0;for(b=0;b<a;b+=1)e=d.charCodeAt(b),r+=1+(128<e)+(2048<e),55040<e&&57344>e&&(r+=1,b+=1);return r}function a(d,a,b){var e=d.length,r,h;a=new Uint8Array(new ArrayBuffer(a));b?(a[0]=239,a[1]=187,a[2]=191,h=3):h=0;for(b=0;b<e;b+=1)r=d.charCodeAt(b),128>r?(a[h]=r,h+=1):2048>r?(a[h]=192|r>>>6,a[h+1]=128|r&63,h+=2):55040>=r||57344<=r?(a[h]=224|r>>>12&15,a[h+1]=128|r>>>6&63,a[h+2]=128|r&63,h+=3):(b+=1,r=(r-55296<<10|d.charCodeAt(b)-56320)+65536,
a[h]=240|r>>>18&7,a[h+1]=128|r>>>12&63,a[h+2]=128|r>>>6&63,a[h+3]=128|r&63,h+=4);return a}function d(d){var a=d.length,b=new Uint8Array(new ArrayBuffer(a)),e;for(e=0;e<a;e+=1)b[e]=d.charCodeAt(e)&255;return b}function c(d,a){var b,e,r;void 0!==a?r=d:a=d;f?(e=f.ownerDocument,r&&(b=e.createElement("span"),b.className=r,b.appendChild(e.createTextNode(r)),f.appendChild(b),f.appendChild(e.createTextNode(" "))),b=e.createElement("span"),0<a.length&&"<"===a[0]?b.innerHTML=a:b.appendChild(e.createTextNode(a)),
f.appendChild(b),f.appendChild(e.createElement("br"))):console&&console.log(a);q.enableAlerts&&"alert"===r&&alert(a)}function g(m,l,b){if(0!==b.status||b.responseText)if(200===b.status||0===b.status){if(b.response&&"string"!==typeof b.response)"binary"===l?(b=b.response,b=new Uint8Array(b)):b=String(b.response);else if("binary"===l)if(null!==b.responseBody&&"undefined"!==String(typeof VBArray)){b=(new VBArray(b.responseBody)).toArray();var e=b.length;l=new Uint8Array(new ArrayBuffer(e));for(m=0;m<
e;m+=1)l[m]=b[m];b=l}else{(m=b.getResponseHeader("Content-Length"))&&(m=parseInt(m,10));if(m&&m!==b.responseText.length)a:{e=b.responseText;l=!1;var r=k(e);if("number"===typeof m){if(m!==r&&m!==r+3){e=void 0;break a}l=r+3===m;r=m}e=a(e,r,l)}void 0===e&&(e=d(b.responseText));b=e}else b=b.responseText;b={err:null,data:b}}else b={err:b.responseText||b.statusText,data:null};else b={err:"File "+m+" is empty.",data:null};return b}function n(d,a,b){var e=new XMLHttpRequest;e.open("GET",d,b);e.overrideMimeType&&
("binary"!==a?e.overrideMimeType("text/plain; charset="+a):e.overrideMimeType("text/plain; charset=x-user-defined"));return e}function l(d,a,b){function e(h){var b=document.getElementById("canvas");b&&(b.innerHTML='<div style="font-size:14px;padding:5px">'+h+'<span id="inner_progress"></span></div>')}var r=n(d,a,!0);r.onreadystatechange=function(){var h;4===r.readyState&&(e("Loading..."),h=g(d,a,r),b(h.err,h.data))};if(d)if(0==d.toLowerCase().indexOf("blob"))e("Reading the file... Please wait...");
else{e("Downloading the file... Please wait...");var h=(new Date).getTime();r.onprogress=function(b){if(h){var e=new Date;if(300>e.getTime()-h)return;h=e.getTime()}e=b.totalSize||b.total||0;0==e&&"undefined"!==typeof g_docsize&&(e=g_docsize||0);1.8446744073709552E19<=e&&(e=0);b=b.position||b.loaded||0;var r=document.getElementById("inner_progress");r&&(r.innerHTML=" ("+number_format(b)+"/"+number_format(e)+")")}}try{r.send(null)}catch(l){e("Loading..."),b(l.message,null)}}var q=this;this.byteArrayFromString=
function(l,c){var b;"utf8"===c?b=a(l,k(l),!1):("binary"!==c&&q.log("unknown encoding: "+c),b=d(l));return b};this.byteArrayToString=Runtime.byteArrayToString;this.getVariable=Runtime.getVariable;this.fromJson=Runtime.fromJson;this.toJson=Runtime.toJson;this.readFile=l;this.read=function(d,a,b,e){l(d,"binary",function(r,h){var d=null;if(h){if("string"===typeof h)throw"This should not happen.";d=h.subarray(a,a+b)}e(r,d)})};this.readFileSync=function(d,a){var b=n(d,a,!1),e;try{b.send(null);e=g(d,a,b);
if(e.err)throw e.err;if(null===e.data)throw"No data read from "+d+".";}catch(r){throw r;}return e.data};this.writeFile=function(d,a,b){var e=new XMLHttpRequest,r;e.open("PUT",d,!0);e.onreadystatechange=function(){4===e.readyState&&(0!==e.status||e.responseText?200<=e.status&&300>e.status||0===e.status?b(null):b("Status "+String(e.status)+": "+e.responseText||e.statusText):b("File "+d+" is empty."))};r=a.buffer&&!e.sendAsBinary?a.buffer:q.byteArrayToString(a,"binary");try{e.sendAsBinary?e.sendAsBinary(r):
e.send(r)}catch(h){q.log("HUH? "+h+" "+a),b(h.message)}};this.deleteFile=function(d,a){var b=new XMLHttpRequest;b.open("DELETE",d,!0);b.onreadystatechange=function(){4===b.readyState&&(200>b.status&&300<=b.status?a(b.responseText):a(null))};b.send(null)};this.loadXML=function(d,a){var b=new XMLHttpRequest;b.open("GET",d,!0);b.overrideMimeType&&b.overrideMimeType("text/xml");b.onreadystatechange=function(){4===b.readyState&&(0!==b.status||b.responseText?200===b.status||0===b.status?a(null,b.responseXML):
a(b.responseText,null):a("File "+d+" is empty.",null))};try{b.send(null)}catch(e){a(e.message,null)}};this.log=c;this.enableAlerts=!0;this.assert=Runtime.assert;this.setTimeout=function(d,a){return setTimeout(function(){d()},a)};this.clearTimeout=function(d){clearTimeout(d)};this.libraryPaths=function(){return["lib"]};this.setCurrentDirectory=function(){};this.currentDirectory=function(){return""};this.type=function(){return"BrowserRuntime"};this.getDOMImplementation=function(){return window.document.implementation};
this.parseXML=function(d){var a=new DOMParser;d&&(d=d.trim());return a.parseFromString(d,"text/xml")};this.exit=function(d){c("Calling exit with code "+String(d)+", but exit() is not implemented.")};this.getWindow=function(){return window};this.requestAnimationFrame=function(d){var a=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame,b=0;if(a)a.bind(window),b=a(d);else return setTimeout(d,15);return b};this.cancelAnimationFrame=
function(d){var a=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.msCancelAnimationFrame;a?(a.bind(window),a(d)):clearTimeout(d)}}
function NodeJSRuntime(){function f(d){var a=d.length,l,b=new Uint8Array(new ArrayBuffer(a));for(l=0;l<a;l+=1)b[l]=d[l];return b}function k(a,l,n){function b(b,r){if(b)return n(b,null);if(!r)return n("No data for "+a+".",null);if("string"===typeof r)return n(b,r);n(b,f(r))}a=c.resolve(g,a);"binary"!==l?d.readFile(a,l,b):d.readFile(a,null,b)}var a=this,d=require("fs"),c=require("path"),g="",n,l;this.byteArrayFromString=function(a,d){var l=new Buffer(a,d),b,e=l.length,r=new Uint8Array(new ArrayBuffer(e));
for(b=0;b<e;b+=1)r[b]=l[b];return r};this.byteArrayToString=Runtime.byteArrayToString;this.getVariable=Runtime.getVariable;this.fromJson=Runtime.fromJson;this.toJson=Runtime.toJson;this.readFile=k;this.loadXML=function(d,l){k(d,"utf-8",function(c,b){if(c)return l(c,null);if(!b)return l("No data for "+d+".",null);l(null,a.parseXML(b))})};this.writeFile=function(a,l,n){l=new Buffer(l);a=c.resolve(g,a);d.writeFile(a,l,"binary",function(b){n(b||null)})};this.deleteFile=function(a,l){a=c.resolve(g,a);
d.unlink(a,l)};this.read=function(a,l,n,b){a=c.resolve(g,a);d.open(a,"r+",666,function(e,r){if(e)b(e,null);else{var h=new Buffer(n);d.read(r,h,0,n,l,function(e){d.close(r);b(e,f(h))})}})};this.readFileSync=function(a,l){var c;c=d.readFileSync(a,"binary"===l?null:l);if(null===c)throw"File "+a+" could not be read.";"binary"===l&&(c=f(c));return c};this.log=function(a,d){var l;void 0!==d?l=a:d=a;"alert"===l&&process.stderr.write("\n!!!!! ALERT !!!!!\n");process.stderr.write(d+"\n");"alert"===l&&process.stderr.write("!!!!! ALERT !!!!!\n")};
this.assert=Runtime.assert;this.setTimeout=function(a,d){return setTimeout(function(){a()},d)};this.clearTimeout=function(a){clearTimeout(a)};this.libraryPaths=function(){return[__dirname]};this.setCurrentDirectory=function(a){g=a};this.currentDirectory=function(){return g};this.type=function(){return"NodeJSRuntime"};this.getDOMImplementation=function(){return l};this.parseXML=function(a){a&&(a=a.trim());return n.parseFromString(a,"text/xml")};this.exit=process.exit;this.getWindow=function(){return null};
this.requestAnimationFrame=function(a){return setTimeout(a,15)};this.cancelAnimationFrame=function(a){clearTimeout(a)};n=new (require("xmldom").DOMParser);l=a.parseXML("<a/>").implementation}
function RhinoRuntime(){var f=this,k={},a=k.javax.xml.parsers.DocumentBuilderFactory.newInstance(),d,c,g="";a.setValidating(!1);a.setNamespaceAware(!0);a.setExpandEntityReferences(!1);a.setSchema(null);c=k.org.xml.sax.EntityResolver({resolveEntity:function(a,d){var c=new k.java.io.FileReader(d);return new k.org.xml.sax.InputSource(c)}});d=a.newDocumentBuilder();d.setEntityResolver(c);this.byteArrayFromString=function(a,d){var c,g=a.length,f=new Uint8Array(new ArrayBuffer(g));for(c=0;c<g;c+=1)f[c]=
a.charCodeAt(c)&255;return f};this.byteArrayToString=Runtime.byteArrayToString;this.getVariable=Runtime.getVariable;this.fromJson=Runtime.fromJson;this.toJson=Runtime.toJson;this.loadXML=function(a,l){var c=new k.java.io.File(a),g=null;try{g=d.parse(c)}catch(f){return print(f),l(f,null)}l(null,g)};this.readFile=function(a,d,c){g&&(a=g+"/"+a);var m=new k.java.io.File(a),p="binary"===d?"latin1":d;m.isFile()?((a=readFile(a,p))&&"binary"===d&&(a=f.byteArrayFromString(a,"binary")),c(null,a)):c(a+" is not a file.",
null)};this.writeFile=function(a,d,c){g&&(a=g+"/"+a);a=new k.java.io.FileOutputStream(a);var m,f=d.length;for(m=0;m<f;m+=1)a.write(d[m]);a.close();c(null)};this.deleteFile=function(a,d){g&&(a=g+"/"+a);var c=new k.java.io.File(a),f=a+Math.random(),f=new k.java.io.File(f);c.rename(f)?(f.deleteOnExit(),d(null)):d("Could not delete "+a)};this.read=function(a,d,c,f){g&&(a=g+"/"+a);var p;p=a;var b="binary";(new k.java.io.File(p)).isFile()?("binary"===b&&(b="latin1"),p=readFile(p,b)):p=null;p?f(null,this.byteArrayFromString(p.substring(d,
d+c),"binary")):f("Cannot read "+a,null)};this.readFileSync=function(a,d){if(!d)return"";var c=readFile(a,d);if(null===c)throw"File could not be read.";return c};this.log=function(a,d){var c;void 0!==d?c=a:d=a;"alert"===c&&print("\n!!!!! ALERT !!!!!");print(d);"alert"===c&&print("!!!!! ALERT !!!!!")};this.assert=Runtime.assert;this.setTimeout=function(a){a();return 0};this.clearTimeout=function(){};this.libraryPaths=function(){return["lib"]};this.setCurrentDirectory=function(a){g=a};this.currentDirectory=
function(){return g};this.type=function(){return"RhinoRuntime"};this.getDOMImplementation=function(){return d.getDOMImplementation()};this.parseXML=function(a){a=new k.java.io.StringReader(a);a=new k.org.xml.sax.InputSource(a);return d.parse(a)};this.exit=quit;this.getWindow=function(){return null};this.requestAnimationFrame=function(a){a();return 0};this.cancelAnimationFrame=function(){}}
Runtime.create=function(){return"undefined"!==String(typeof window)?new BrowserRuntime(window.document.getElementById("logoutput")):"undefined"!==String(typeof require)?new NodeJSRuntime:new RhinoRuntime};var runtime=Runtime.create(),core={},gui={},xmldom={},odf={},ops={},webodf={};(function(){webodf.Version="undefined"!==String(typeof webodf_version)?webodf_version:"From Source"})();
(function(){function f(a,d,c){var g=a+"/manifest.json",b,e;runtime.log("Loading manifest: "+g);try{b=runtime.readFileSync(g,"utf-8")}catch(r){if(c)runtime.log("No loadable manifest found.");else throw console.log(String(r)),r;return}c=JSON.parse(b);for(e in c)c.hasOwnProperty(e)&&(d[e]={dir:a,deps:c[e]})}function k(a,d,c){function g(h){if(!r[h]&&!c(h)){if(e[h])throw"Circular dependency detected for "+h+".";e[h]=!0;if(!d[h])throw"Missing dependency information for class "+h+".";var a=d[h],l=a.deps,
f,n=l.length;for(f=0;f<n;f+=1)g(l[f]);e[h]=!1;r[h]=!0;b.push(a.dir+"/"+h.replace(".","/")+".js")}}var b=[],e={},r={};a.forEach(g);return b}function a(a,d){return d+("\n//# sourceURL="+a)}function d(d){var c,g;for(c=0;c<d.length;c+=1)g=runtime.readFileSync(d[c],"utf-8"),g=a(d[c],g),eval(g)}function c(a){a=a.split(".");var d,c=n,g=a.length;for(d=0;d<g;d+=1){if(!c.hasOwnProperty(a[d]))return!1;c=c[a[d]]}return!0}var g,n={core:core,gui:gui,xmldom:xmldom,odf:odf,ops:ops};runtime.loadClasses=function(a,
n){if(IS_COMPILED_CODE||0===a.length)return n&&n();var m;if(!(m=g)){m=[];var p=runtime.libraryPaths(),b;runtime.currentDirectory()&&-1===p.indexOf(runtime.currentDirectory())&&f(runtime.currentDirectory(),m,!0);for(b=0;b<p.length;b+=1)f(p[b],m)}g=m;a=k(a,g,c);if(0===a.length)return n&&n();if("BrowserRuntime"===runtime.type()&&n){m=a;p=document.currentScript||document.documentElement.lastChild;b=document.createDocumentFragment();var e,r;for(r=0;r<m.length;r+=1)e=document.createElement("script"),e.type=
"text/javascript",e.charset="utf-8",e.async=!1,e.setAttribute("src",m[r]),b.appendChild(e);n&&(e.onload=n);p.parentNode.insertBefore(b,p)}else d(a),n&&n()};runtime.loadClass=function(a,d){runtime.loadClasses([a],d)}})();(function(){var f=function(f){return f};runtime.getTranslator=function(){return f};runtime.setTranslator=function(k){f=k};runtime.tr=function(k){var a=f(k);return a&&"string"===String(typeof a)?a:k}})();
(function(f){function k(a){if(a.length){var d=a[0];runtime.readFile(d,"utf8",function(c,g){function f(){var a;(a=eval(k))&&runtime.exit(a)}var l="",l=d.lastIndexOf("/"),k=g,l=-1!==l?d.substring(0,l):".";runtime.setCurrentDirectory(l);c?(runtime.log(c),runtime.exit(1)):null===k?(runtime.log("No code found for "+d),runtime.exit(1)):f.apply(null,a)})}}f=f?Array.prototype.slice.call(f):[];"NodeJSRuntime"===runtime.type()?k(process.argv.slice(2)):"RhinoRuntime"===runtime.type()?k(f):k(f.slice(1))})("undefined"!==
String(typeof arguments)&&arguments);(function(){core.Async=function(){return{forEach:function(f,k,a){function d(d){n!==g&&(d?(n=g,a(d)):(n+=1,n===g&&a(null)))}var c,g=f.length,n=0;for(c=0;c<g;c+=1)k(f[c],d)},destroyAll:function(f,k){function a(d,c){if(c)k(c);else if(d<f.length)f[d](function(c){a(d+1,c)});else k()}a(0,void 0)}}}()})();
function makeBase64(){function f(b){var h,e=b.length,r=new Uint8Array(new ArrayBuffer(e));for(h=0;h<e;h+=1)r[h]=b.charCodeAt(h)&255;return r}function k(h){var b,e="",r,a=h.length-2;for(r=0;r<a;r+=3)b=h[r]<<16|h[r+1]<<8|h[r+2],e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[b>>>18],e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[b>>>12&63],e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[b>>>6&63],e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[b&
63];r===a+1?(b=h[r]<<4,e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[b>>>6],e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[b&63],e+="=="):r===a&&(b=h[r]<<10|h[r+1]<<2,e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[b>>>12],e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[b>>>6&63],e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[b&63],e+="=");return e}function a(b){b=b.replace(/[^A-Za-z0-9+\/]+/g,
"");var e=b.length,r=new Uint8Array(new ArrayBuffer(3*e)),a=b.length%4,d=0,c,l;for(c=0;c<e;c+=4)l=(h[b.charAt(c)]||0)<<18|(h[b.charAt(c+1)]||0)<<12|(h[b.charAt(c+2)]||0)<<6|(h[b.charAt(c+3)]||0),r[d]=l>>16,r[d+1]=l>>8&255,r[d+2]=l&255,d+=3;e=3*e-[0,0,2,1][a];return r.subarray(0,e)}function d(b){var h,e,r=b.length,a=0,d=new Uint8Array(new ArrayBuffer(3*r));for(h=0;h<r;h+=1)e=b[h],128>e?d[a++]=e:(2048>e?d[a++]=192|e>>>6:(d[a++]=224|e>>>12&15,d[a++]=128|e>>>6&63),d[a++]=128|e&63);return d.subarray(0,
a)}function c(b){var h,e,r,a,d=b.length,c=new Uint8Array(new ArrayBuffer(d)),l=0;for(h=0;h<d;h+=1)e=b[h],128>e?c[l++]=e:(h+=1,r=b[h],224>e?c[l++]=(e&31)<<6|r&63:(h+=1,a=b[h],c[l++]=(e&15)<<12|(r&63)<<6|a&63));return c.subarray(0,l)}function g(b){return k(f(b))}function n(b){return String.fromCharCode.apply(String,a(b))}function l(b){return c(f(b))}function q(b){b=c(b);for(var h="",e=0;e<b.length;)h+=String.fromCharCode.apply(String,b.subarray(e,e+45E3)),e+=45E3;return h}function m(b,h,e){var r,a,
d,c="";for(d=h;d<e;d+=1)h=b.charCodeAt(d)&255,128>h?c+=String.fromCharCode(h):(d+=1,r=b.charCodeAt(d)&255,224>h?c+=String.fromCharCode((h&31)<<6|r&63):(d+=1,a=b.charCodeAt(d)&255,c+=String.fromCharCode((h&15)<<12|(r&63)<<6|a&63)));return c}function p(b,h){function e(){var d=a+1E5;d>b.length&&(d=b.length);r+=m(b,a,d);a=d;d=a===b.length;h(r,d)&&!d&&runtime.setTimeout(e,0)}var r="",a=0;1E5>b.length?h(m(b,0,b.length),!0):("string"!==typeof b&&(b=b.slice()),e())}function b(b){return d(f(b))}function e(b){return String.fromCharCode.apply(String,
d(b))}function r(b){return String.fromCharCode.apply(String,d(f(b)))}var h=function(b){var h={},e,r;e=0;for(r=b.length;e<r;e+=1)h[b.charAt(e)]=e;return h}("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),u,x,z=runtime.getWindow(),v,s;z&&z.btoa?(v=z.btoa,u=function(b){return v(r(b))}):(v=g,u=function(h){return k(b(h))});z&&z.atob?(s=z.atob,x=function(b){b=s(b);return m(b,0,b.length)}):(s=n,x=function(b){return q(a(b))});core.Base64=function(){this.convertByteArrayToBase64=this.convertUTF8ArrayToBase64=
k;this.convertBase64ToByteArray=this.convertBase64ToUTF8Array=a;this.convertUTF16ArrayToByteArray=this.convertUTF16ArrayToUTF8Array=d;this.convertByteArrayToUTF16Array=this.convertUTF8ArrayToUTF16Array=c;this.convertUTF8StringToBase64=g;this.convertBase64ToUTF8String=n;this.convertUTF8StringToUTF16Array=l;this.convertByteArrayToUTF16String=this.convertUTF8ArrayToUTF16String=q;this.convertUTF8StringToUTF16String=p;this.convertUTF16StringToByteArray=this.convertUTF16StringToUTF8Array=b;this.convertUTF16ArrayToUTF8String=
e;this.convertUTF16StringToUTF8String=r;this.convertUTF16StringToBase64=u;this.convertBase64ToUTF16String=x;this.fromBase64=n;this.toBase64=g;this.atob=s;this.btoa=v;this.utob=r;this.btou=p;this.encode=u;this.encodeURI=function(b){return u(b).replace(/[+\/]/g,function(b){return"+"===b?"-":"_"}).replace(/\\=+$/,"")};this.decode=function(b){return x(b.replace(/[\-_]/g,function(b){return"-"===b?"+":"/"}))};return this};return core.Base64}core.Base64=makeBase64();
core.ByteArray=function(f){this.pos=0;this.data=f;this.readUInt32LE=function(){this.pos+=4;var f=this.data,a=this.pos;return f[--a]<<24|f[--a]<<16|f[--a]<<8|f[--a]};this.readUInt16LE=function(){this.pos+=2;var f=this.data,a=this.pos;return f[--a]<<8|f[--a]}};
core.ByteArrayWriter=function(f){function k(a){a>c-d&&(c=Math.max(2*c,d+a),a=new Uint8Array(new ArrayBuffer(c)),a.set(g),g=a)}var a=this,d=0,c=1024,g=new Uint8Array(new ArrayBuffer(c));this.appendByteArrayWriter=function(d){a.appendByteArray(d.getByteArray())};this.appendByteArray=function(a){var c=a.length;k(c);g.set(a,d);d+=c};this.appendArray=function(a){var c=a.length;k(c);g.set(a,d);d+=c};this.appendUInt16LE=function(d){a.appendArray([d&255,d>>8&255])};this.appendUInt32LE=function(d){a.appendArray([d&
255,d>>8&255,d>>16&255,d>>24&255])};this.appendString=function(d){a.appendByteArray(runtime.byteArrayFromString(d,f))};this.getLength=function(){return d};this.getByteArray=function(){var a=new Uint8Array(new ArrayBuffer(d));a.set(g.subarray(0,d));return a}};
core.CSSUnits=function(){var f=this,k={"in":1,cm:2.54,mm:25.4,pt:72,pc:12,px:96};this.convert=function(a,d,c){return a*k[c]/k[d]};this.convertMeasure=function(a,d){var c,g;a&&d&&(c=parseFloat(a),g=a.replace(c.toString(),""),c=f.convert(c,g,d));return c};this.getUnits=function(a){return a.substr(a.length-2,a.length)}};
(function(){function f(){var d,c,g,f,l,k,m,p,b;void 0===a&&(c=(d=runtime.getWindow())&&d.document,k=c.documentElement,m=c.body,a={rangeBCRIgnoresElementBCR:!1,unscaledRangeClientRects:!1,elementBCRIgnoresBodyScroll:!1},c&&(f=c.createElement("div"),f.style.position="absolute",f.style.left="-99999px",f.style.transform="scale(2)",f.style["-webkit-transform"]="scale(2)",l=c.createElement("div"),f.appendChild(l),m.appendChild(f),d=c.createRange(),d.selectNode(l),a.rangeBCRIgnoresElementBCR=0===d.getClientRects().length,
l.appendChild(c.createTextNode("Rect transform test")),c=l.getBoundingClientRect(),g=d.getBoundingClientRect(),a.unscaledRangeClientRects=2<Math.abs(c.height-g.height),f.style.transform="",f.style["-webkit-transform"]="",c=k.style.overflow,g=m.style.overflow,p=m.style.height,b=m.scrollTop,k.style.overflow="visible",m.style.overflow="visible",m.style.height="200%",m.scrollTop=m.scrollHeight,a.elementBCRIgnoresBodyScroll=d.getBoundingClientRect().top!==l.getBoundingClientRect().top,m.scrollTop=b,m.style.height=
p,m.style.overflow=g,k.style.overflow=c,d.detach(),m.removeChild(f),d=Object.keys(a).map(function(b){return b+":"+String(a[b])}).join(", "),runtime.log("Detected browser quirks - "+d)));return a}function k(a,c,g){for(a=a?a.firstElementChild:null;a;){if(a.localName===g&&a.namespaceURI===c)return a;a=a.nextElementSibling}return null}var a;core.DomUtilsImpl=function(){function a(b,h){for(var e=0,d;b.parentNode!==h;)runtime.assert(null!==b.parentNode,"parent is null"),b=b.parentNode;for(d=h.firstChild;d!==
b;)e+=1,d=d.nextSibling;return e}function c(b,h){return 0>=b.compareBoundaryPoints(Range.START_TO_START,h)&&0<=b.compareBoundaryPoints(Range.END_TO_END,h)}function g(b,h){return 0>=b.compareBoundaryPoints(Range.END_TO_START,h)&&0<=b.compareBoundaryPoints(Range.START_TO_END,h)}function n(b,h){var e=null;b.nodeType===Node.TEXT_NODE&&(0===b.length?(b.parentNode.removeChild(b),h.nodeType===Node.TEXT_NODE&&(e=h)):(h.nodeType===Node.TEXT_NODE&&(b.appendData(h.data),h.parentNode.removeChild(h)),e=b));return e}
function l(b){for(var h=b.parentNode;b.firstChild;)h.insertBefore(b.firstChild,b);h.removeChild(b);return h}function q(b,h){for(var e=b.parentNode,a=b.firstChild,d;a;)d=a.nextSibling,q(a,h),a=d;e&&h(b)&&l(b);return e}function m(b,h){return b===h||Boolean(b.compareDocumentPosition(h)&Node.DOCUMENT_POSITION_CONTAINED_BY)}function p(b,h){return f().unscaledRangeClientRects?b:b/h}function b(e,h,a){Object.keys(h).forEach(function(d){var c=d.split(":"),l=c[1],g=a(c[0]),c=h[d],f=typeof c;"object"===f?Object.keys(c).length&&
(d=g?e.getElementsByTagNameNS(g,l)[0]||e.ownerDocument.createElementNS(g,d):e.getElementsByTagName(l)[0]||e.ownerDocument.createElement(d),e.appendChild(d),b(d,c,a)):g&&(runtime.assert("number"===f||"string"===f,"attempting to map unsupported type '"+f+"' (key: "+d+")"),e.setAttributeNS(g,d,String(c)))})}var e=null;this.splitBoundaries=function(b){var h,e=[],c,l,g;if(b.startContainer.nodeType===Node.TEXT_NODE||b.endContainer.nodeType===Node.TEXT_NODE){c=b.endContainer;l=b.endContainer.nodeType!==
Node.TEXT_NODE?b.endOffset===b.endContainer.childNodes.length:!1;g=b.endOffset;h=b.endContainer;if(g<h.childNodes.length)for(h=h.childNodes.item(g),g=0;h.firstChild;)h=h.firstChild;else for(;h.lastChild;)h=h.lastChild,g=h.nodeType===Node.TEXT_NODE?h.textContent.length:h.childNodes.length;h===c&&(c=null);b.setEnd(h,g);g=b.endContainer;0!==b.endOffset&&g.nodeType===Node.TEXT_NODE&&(h=g,b.endOffset!==h.length&&(e.push(h.splitText(b.endOffset)),e.push(h)));g=b.startContainer;0!==b.startOffset&&g.nodeType===
Node.TEXT_NODE&&(h=g,b.startOffset!==h.length&&(g=h.splitText(b.startOffset),e.push(h),e.push(g),b.setStart(g,0)));if(null!==c){for(g=b.endContainer;g.parentNode&&g.parentNode!==c;)g=g.parentNode;l=l?c.childNodes.length:a(g,c);b.setEnd(c,l)}}return e};this.containsRange=c;this.rangesIntersect=g;this.rangeIntersection=function(b,h){var e;g(b,h)&&(e=b.cloneRange(),-1===b.compareBoundaryPoints(Range.START_TO_START,h)&&e.setStart(h.startContainer,h.startOffset),1===b.compareBoundaryPoints(Range.END_TO_END,
h)&&e.setEnd(h.endContainer,h.endOffset));return e};this.getNodesInRange=function(b,h,e){var a=[],d=b.commonAncestorContainer,d=d.nodeType===Node.TEXT_NODE?d.parentNode:d;e=b.startContainer.ownerDocument.createTreeWalker(d,e,h,!1);var c,g;b.endContainer.childNodes[b.endOffset-1]?(c=b.endContainer.childNodes[b.endOffset-1],g=Node.DOCUMENT_POSITION_PRECEDING|Node.DOCUMENT_POSITION_CONTAINED_BY):(c=b.endContainer,g=Node.DOCUMENT_POSITION_PRECEDING);if(b.startContainer.childNodes[b.startOffset])b=b.startContainer.childNodes[b.startOffset],
e.currentNode=b;else{var l=b.startContainer;b.startOffset===(l.nodeType===Node.TEXT_NODE?l.length:l.childNodes.length)?(b=b.startContainer,e.currentNode=b,e.lastChild(),b=e.nextNode()):(b=b.startContainer,e.currentNode=b)}if(b){b=e.currentNode;if(b!==d)for(b=b.parentNode;b&&b!==d;)h(b)===NodeFilter.FILTER_REJECT&&(e.currentNode=b),b=b.parentNode;b=e.currentNode;switch(h(b)){case NodeFilter.FILTER_REJECT:for(b=e.nextSibling();!b&&e.parentNode();)b=e.nextSibling();break;case NodeFilter.FILTER_SKIP:b=
e.nextNode()}for(;b;){h=c.compareDocumentPosition(b);if(0!==h&&0===(h&g))break;a.push(b);b=e.nextNode()}}return a};this.normalizeTextNodes=function(b){b&&b.nextSibling&&(b=n(b,b.nextSibling));b&&b.previousSibling&&n(b.previousSibling,b)};this.rangeContainsNode=function(b,e){var a=e.ownerDocument.createRange(),d=e.ownerDocument.createRange(),g;a.setStart(b.startContainer,b.startOffset);a.setEnd(b.endContainer,b.endOffset);d.selectNodeContents(e);g=c(a,d);a.detach();d.detach();return g};this.mergeIntoParent=
l;this.removeUnwantedNodes=q;this.getElementsByTagNameNS=function(b,e,a){var d=[];b=b.getElementsByTagNameNS(e,a);d.length=a=b.length;for(e=0;e<a;e+=1)d[e]=b.item(e);return d};this.getElementsByTagName=function(b,e){var a=[],d,c,g;d=b.getElementsByTagName(e);a.length=g=d.length;for(c=0;c<g;c+=1)a[c]=d.item(c);return a};this.containsNode=function(b,e){return b===e||b.contains(e)};this.comparePoints=function(b,e,c,g){if(b===c)return g-e;var l=b.compareDocumentPosition(c);2===l?l=-1:4===l?l=1:10===l?
(e=a(b,c),l=e<g?1:-1):(g=a(c,b),l=g<e?-1:1);return l};this.adaptRangeDifferenceToZoomLevel=p;this.translateRect=function(b,e,a){return{top:p(b.top-e.top,a),left:p(b.left-e.left,a),bottom:p(b.bottom-e.top,a),right:p(b.right-e.left,a),width:p(b.width,a),height:p(b.height,a)}};this.getBoundingClientRect=function(b){var h=b.ownerDocument,a=f(),d=h.body;if((!1===a.unscaledRangeClientRects||a.rangeBCRIgnoresElementBCR)&&b.nodeType===Node.ELEMENT_NODE)return b=b.getBoundingClientRect(),a.elementBCRIgnoresBodyScroll?
{left:b.left+d.scrollLeft,right:b.right+d.scrollLeft,top:b.top+d.scrollTop,bottom:b.bottom+d.scrollTop,width:b.width,height:b.height}:b;var c;e?c=e:e=c=h.createRange();a=c;a.selectNode(b);return a.getBoundingClientRect()};this.mapKeyValObjOntoNode=function(b,e,a){Object.keys(e).forEach(function(d){var c=d.split(":"),g=c[1],c=a(c[0]),l=e[d];c?(g=b.getElementsByTagNameNS(c,g)[0],g||(g=b.ownerDocument.createElementNS(c,d),b.appendChild(g)),g.textContent=l):runtime.log("Key ignored: "+d)})};this.removeKeyElementsFromNode=
function(b,e,a){e.forEach(function(e){var h=e.split(":"),d=h[1];(h=a(h[0]))?(d=b.getElementsByTagNameNS(h,d)[0])?d.parentNode.removeChild(d):runtime.log("Element for "+e+" not found."):runtime.log("Property Name ignored: "+e)})};this.getKeyValRepresentationOfNode=function(b,e){for(var a={},d=b.firstElementChild,c;d;){if(c=e(d.namespaceURI))a[c+":"+d.localName]=d.textContent;d=d.nextElementSibling}return a};this.mapObjOntoNode=b;this.cloneEvent=function(b){var e=Object.create(null);Object.keys(b).forEach(function(a){e[a]=
b[a]});e.prototype=b.constructor.prototype;return e};this.getDirectChild=k;(function(b){var e,a;a=runtime.getWindow();null!==a&&(e=a.navigator.appVersion.toLowerCase(),a=-1===e.indexOf("chrome")&&(-1!==e.indexOf("applewebkit")||-1!==e.indexOf("safari")),e=-1!==e.indexOf("msie")||-1!==e.indexOf("trident"),a||e)&&(b.containsNode=m)})(this)};core.DomUtils=new core.DomUtilsImpl})();
core.Cursor=function(f,k){function a(b){b.parentNode&&(l.push(b.previousSibling),l.push(b.nextSibling),b.parentNode.removeChild(b))}function d(b,e,a){if(e.nodeType===Node.TEXT_NODE){runtime.assert(Boolean(e),"putCursorIntoTextNode: invalid container");var h=e.parentNode;runtime.assert(Boolean(h),"putCursorIntoTextNode: container without parent");runtime.assert(0<=a&&a<=e.length,"putCursorIntoTextNode: offset is out of bounds");0===a?h.insertBefore(b,e):(a!==e.length&&e.splitText(a),h.insertBefore(b,
e.nextSibling))}else e.nodeType===Node.ELEMENT_NODE&&e.insertBefore(b,e.childNodes.item(a));l.push(b.previousSibling);l.push(b.nextSibling)}var c=f.createElementNS("urn:webodf:names:cursor","cursor"),g=f.createElementNS("urn:webodf:names:cursor","anchor"),n,l=[],q=f.createRange(),m,p=core.DomUtils;this.getNode=function(){return c};this.getAnchorNode=function(){return g.parentNode?g:c};this.getSelectedRange=function(){m?(q.setStartBefore(c),q.collapse(!0)):(q.setStartAfter(n?g:c),q.setEndBefore(n?
c:g));return q};this.setSelectedRange=function(b,e){q&&q!==b&&q.detach();q=b;n=!1!==e;(m=b.collapsed)?(a(g),a(c),d(c,b.startContainer,b.startOffset)):(a(g),a(c),d(n?c:g,b.endContainer,b.endOffset),d(n?g:c,b.startContainer,b.startOffset));l.forEach(p.normalizeTextNodes);l.length=0};this.hasForwardSelection=function(){return n};this.remove=function(){a(c);l.forEach(p.normalizeTextNodes);l.length=0};c.setAttributeNS("urn:webodf:names:cursor","memberId",k);g.setAttributeNS("urn:webodf:names:cursor","memberId",
k)};core.Destroyable=function(){};core.Destroyable.prototype.destroy=function(f){};core.EventSource=function(){};core.EventSource.prototype.subscribe=function(f,k){};core.EventSource.prototype.unsubscribe=function(f,k){};
core.EventNotifier=function(f){function k(d){runtime.assert(!a.hasOwnProperty(d),'Duplicated event ids: "'+d+'" registered more than once.');a[d]=[]}var a={};this.emit=function(d,c){var g,f;runtime.assert(a.hasOwnProperty(d),'unknown event fired "'+d+'"');f=a[d];for(g=0;g<f.length;g+=1)f[g](c)};this.subscribe=function(d,c){runtime.assert(a.hasOwnProperty(d),'tried to subscribe to unknown event "'+d+'"');a[d].push(c)};this.unsubscribe=function(d,c){var g;runtime.assert(a.hasOwnProperty(d),'tried to unsubscribe from unknown event "'+
d+'"');g=a[d].indexOf(c);runtime.assert(-1!==g,'tried to unsubscribe unknown callback from event "'+d+'"');-1!==g&&a[d].splice(g,1)};this.register=k;f&&f.forEach(k)};
core.ScheduledTask=function(f,k,a){function d(){n&&(a(g),n=!1)}function c(){d();f.apply(void 0,l);l=null}var g,n=!1,l=[],q=!1;this.trigger=function(){runtime.assert(!1===q,"Can't trigger destroyed ScheduledTask instance");l=Array.prototype.slice.call(arguments);n||(n=!0,g=k(c))};this.triggerImmediate=function(){runtime.assert(!1===q,"Can't trigger destroyed ScheduledTask instance");l=Array.prototype.slice.call(arguments);c()};this.processRequests=function(){n&&c()};this.cancel=d;this.restart=function(){runtime.assert(!1===
q,"Can't trigger destroyed ScheduledTask instance");d();n=!0;g=k(c)};this.destroy=function(a){d();q=!0;a()}};
(function(){var f;core.Task={};core.Task.SUPPRESS_MANUAL_PROCESSING=!1;core.Task.processTasks=function(){core.Task.SUPPRESS_MANUAL_PROCESSING||f.performRedraw()};core.Task.createRedrawTask=function(k){return new core.ScheduledTask(k,f.requestRedrawTask,f.cancelRedrawTask)};core.Task.createTimeoutTask=function(f,a){return new core.ScheduledTask(f,function(d){return runtime.setTimeout(d,a)},runtime.clearTimeout)};f=new function(){var f={};this.requestRedrawTask=function(a){var d=runtime.requestAnimationFrame(function(){a();
delete f[d]});f[d]=a;return d};this.performRedraw=function(){Object.keys(f).forEach(function(a){f[a]();runtime.cancelAnimationFrame(parseInt(a,10))});f={}};this.cancelRedrawTask=function(a){runtime.cancelAnimationFrame(a);delete f[a]}}})();
core.EventSubscriptions=function(){function f(d,c,g){d.subscribe(c,g);a.push({eventSource:d,eventid:c,callback:g})}function k(){var g=[];a.forEach(function(a){a.eventSource.unsubscribe(a.eventid,a.callback)});a.length=0;Object.keys(c).forEach(function(a){c[a].forEach(function(a){g.push(a.task.destroy)});delete c[a]});core.Async.destroyAll(g,function(){});d=new core.EventNotifier}var a=[],d=new core.EventNotifier,c={},g=0;this.addSubscription=f;this.addFrameSubscription=function(a,l,k){var m,p,b,e;
c.hasOwnProperty(l)||(c[l]=[]);b=c[l];for(e=0;e<b.length;e+=1)if(b[e].eventSource===a){m=b[e];break}m||(p="s"+g,g+=1,d.register(p),m={frameEventId:p,eventSource:a,task:core.Task.createRedrawTask(function(){d.emit(p,void 0)})},b.push(m),f(a,l,m.task.trigger));d.subscribe(m.frameEventId,k)};this.unsubscribeAll=k;this.destroy=function(a){k();a()}};core.LazyProperty=function(f){var k,a=!1;this.value=function(){a||(k=f(),a=!0);return k};this.reset=function(){a=!1}};
core.LoopWatchDog=function(f,k){var a=Date.now(),d=0;this.check=function(){var c;if(f&&(c=Date.now(),c-a>f))throw runtime.log("alert","watchdog timeout"),"timeout!";if(0<k&&(d+=1,d>k))throw runtime.log("alert","watchdog loop overflow"),"loop overflow";}};core.NodeFilterChain=function(f){var k=NodeFilter.FILTER_REJECT,a=NodeFilter.FILTER_ACCEPT;this.acceptNode=function(d){var c;for(c=0;c<f.length;c+=1)if(f[c].acceptNode(d)===k)return k;return a}};
core.PositionIterator=function(f,k,a,d){function c(){this.acceptNode=function(b){return!b||b.nodeType===r&&0===b.length?x:u}}function g(b){this.acceptNode=function(e){return!e||e.nodeType===r&&0===e.length?x:b.acceptNode(e)}}function n(){var e=p.currentNode,a=e.nodeType;b=a===r?e.length-1:a===h?1:0}function l(){if(null===p.previousSibling()){if(!p.parentNode()||p.currentNode===f)return p.firstChild(),!1;b=0}else n();return!0}function q(){var h=p.currentNode,a;a=e(h);if(h!==f)for(h=h.parentNode;h&&
h!==f;)e(h)===x&&(p.currentNode=h,a=x),h=h.parentNode;a===x?(b=p.currentNode.nodeType===r?h.length:1,h=m.nextPosition()):h=a===u?!0:m.nextPosition();h&&runtime.assert(e(p.currentNode)===u,"moveToAcceptedNode did not result in walker being on an accepted node");return h}var m=this,p,b,e,r=Node.TEXT_NODE,h=Node.ELEMENT_NODE,u=NodeFilter.FILTER_ACCEPT,x=NodeFilter.FILTER_REJECT;this.nextPosition=function(){var e=p.currentNode,a=e.nodeType;if(e===f)return!1;if(0===b&&a===h)null===p.firstChild()&&(b=1);
else if(a===r&&b+1<e.length)b+=1;else if(null!==p.nextSibling())b=0;else if(p.parentNode())b=1;else return!1;return!0};this.previousPosition=function(){var e=!0,h=p.currentNode;0===b?e=l():h.nodeType===r?b-=1:null!==p.lastChild()?n():h===f?e=!1:b=0;return e};this.previousNode=l;this.container=function(){var e=p.currentNode,h=e.nodeType;0===b&&h!==r&&(e=e.parentNode);return e};this.rightNode=function(){var a=p.currentNode,d=a.nodeType;if(d===r&&b===a.length)for(a=a.nextSibling;a&&e(a)!==u;)a=a.nextSibling;
else d===h&&1===b&&(a=null);return a};this.leftNode=function(){var a=p.currentNode;if(0===b)for(a=a.previousSibling;a&&e(a)!==u;)a=a.previousSibling;else if(a.nodeType===h)for(a=a.lastChild;a&&e(a)!==u;)a=a.previousSibling;return a};this.getCurrentNode=function(){return p.currentNode};this.unfilteredDomOffset=function(){if(p.currentNode.nodeType===r)return b;for(var e=0,a=p.currentNode,a=1===b?a.lastChild:a.previousSibling;a;)e+=1,a=a.previousSibling;return e};this.getPreviousSibling=function(){var b=
p.currentNode,e=p.previousSibling();p.currentNode=b;return e};this.getNextSibling=function(){var b=p.currentNode,e=p.nextSibling();p.currentNode=b;return e};this.setPositionBeforeElement=function(e){runtime.assert(Boolean(e),"setPositionBeforeElement called without element");p.currentNode=e;b=0;return q()};this.setUnfilteredPosition=function(e,a){runtime.assert(Boolean(e),"PositionIterator.setUnfilteredPosition called without container");p.currentNode=e;e.nodeType===r?(b=a,runtime.assert(a<=e.length,
"Error in setPosition: "+a+" > "+e.length),runtime.assert(0<=a,"Error in setPosition: "+a+" < 0"),a===e.length&&(p.nextSibling()?b=0:p.parentNode()?b=1:runtime.assert(!1,"Error in setUnfilteredPosition: position not valid."))):a<e.childNodes.length?(p.currentNode=e.childNodes.item(a),b=0):b=1;return q()};this.moveToEnd=function(){p.currentNode=f;b=1};this.moveToEndOfNode=function(e){e.nodeType===r?m.setUnfilteredPosition(e,e.length):(p.currentNode=e,b=1)};this.isBeforeNode=function(){return 0===b};
this.getNodeFilter=function(){return e};e=(a?new g(a):new c).acceptNode;e.acceptNode=e;k=k||NodeFilter.SHOW_ALL;runtime.assert(f.nodeType!==Node.TEXT_NODE,"Internet Explorer doesn't allow tree walker roots to be text nodes");p=f.ownerDocument.createTreeWalker(f,k,e,d);b=0;null===p.firstChild()&&(b=1)};core.PositionFilter=function(){};core.PositionFilter.FilterResult={FILTER_ACCEPT:1,FILTER_REJECT:2,FILTER_SKIP:3};core.PositionFilter.prototype.acceptPosition=function(f){};
core.PositionFilterChain=function(){var f=[],k=core.PositionFilter.FilterResult.FILTER_ACCEPT,a=core.PositionFilter.FilterResult.FILTER_REJECT;this.acceptPosition=function(d){var c;for(c=0;c<f.length;c+=1)if(f[c].acceptPosition(d)===a)return a;return k};this.addFilter=function(a){f.push(a)}};
(function(){core.RawInflate=function(){var f;(function(k){f=k()})(function(){return function a(d,c,g){function f(l,m){if(!c[l]){if(!d[l])throw Error("Cannot find module '"+l+"'");var p=c[l]={exports:{}};d[l][0].call(p.exports,function(b){var e=d[l][1][b];return f(e?e:b)},p,p.exports,a,d,c,g)}return c[l].exports}for(var l=0;l<g.length;l++)f(g[l]);return f}({1:[function(a,d,c){function g(b,e){var a=new r(e);a.push(b,!0);if(a.err)throw a.msg;return a.result}var f=a("./zlib/inflate.js"),l=a("./utils/common"),
q=a("./utils/strings"),m=a("./zlib/constants"),p=a("./zlib/messages"),b=a("./zlib/zstream"),e=a("./zlib/gzheader"),r=function(a){var d=this.options=l.assign({chunkSize:16384,windowBits:0,to:""},a||{});d.raw&&0<=d.windowBits&&16>d.windowBits&&(d.windowBits=-d.windowBits,0===d.windowBits&&(d.windowBits=-15));!(0<=d.windowBits&&16>d.windowBits)||a&&a.windowBits||(d.windowBits+=32);15<d.windowBits&&48>d.windowBits&&0===(d.windowBits&15)&&(d.windowBits|=15);this.err=0;this.msg="";this.ended=!1;this.chunks=
[];this.strm=new b;this.strm.avail_out=0;a=f.inflateInit2(this.strm,d.windowBits);if(a!==m.Z_OK)throw Error(p[a]);this.header=new e;f.inflateGetHeader(this.strm,this.header)};r.prototype.push=function(b,e){var a=this.strm,d=this.options.chunkSize,r,c,g,w,p;if(this.ended)return!1;c=e===~~e?e:!0===e?m.Z_FINISH:m.Z_NO_FLUSH;a.input="string"===typeof b?q.binstring2buf(b):b;a.next_in=0;a.avail_in=a.input.length;do{0===a.avail_out&&(a.output=new l.Buf8(d),a.next_out=0,a.avail_out=d);r=f.inflate(a,m.Z_NO_FLUSH);
if(r!==m.Z_STREAM_END&&r!==m.Z_OK)return this.onEnd(r),this.ended=!0,!1;if(a.next_out&&(0===a.avail_out||r===m.Z_STREAM_END||0===a.avail_in&&c===m.Z_FINISH))if("string"===this.options.to)g=q.utf8border(a.output,a.next_out),w=a.next_out-g,p=q.buf2string(a.output,g),a.next_out=w,a.avail_out=d-w,w&&l.arraySet(a.output,a.output,g,w,0),this.onData(p);else this.onData(l.shrinkBuf(a.output,a.next_out))}while((0<a.avail_in||0===a.avail_out)&&r!==m.Z_STREAM_END);r===m.Z_STREAM_END&&(c=m.Z_FINISH);return c===
m.Z_FINISH?(r=f.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===m.Z_OK):!0};r.prototype.onData=function(b){this.chunks.push(b)};r.prototype.onEnd=function(b){b===m.Z_OK&&(this.result="string"===this.options.to?this.chunks.join(""):l.flattenChunks(this.chunks));this.chunks=[];this.err=b;this.msg=this.strm.msg};c.Inflate=r;c.inflate=g;c.inflateRaw=function(b,e){e=e||{};e.raw=!0;return g(b,e)};c.ungzip=g},{"./utils/common":2,"./utils/strings":3,"./zlib/constants":5,"./zlib/gzheader":7,"./zlib/inflate.js":9,
"./zlib/messages":11,"./zlib/zstream":12}],2:[function(a,d,c){a="undefined"!==typeof Uint8Array&&"undefined"!==typeof Uint16Array&&"undefined"!==typeof Int32Array;c.assign=function(a){for(var d=Array.prototype.slice.call(arguments,1);d.length;){var c=d.shift();if(c){if("object"!==typeof c)throw new TypeError(c+"must be non-object");for(var g in c)c.hasOwnProperty(g)&&(a[g]=c[g])}}return a};c.shrinkBuf=function(a,d){if(a.length===d)return a;if(a.subarray)return a.subarray(0,d);a.length=d;return a};
var g={arraySet:function(a,d,c,g,b){if(d.subarray&&a.subarray)a.set(d.subarray(c,c+g),b);else for(var e=0;e<g;e++)a[b+e]=d[c+e]},flattenChunks:function(a){var d,c,g,b,e;d=g=0;for(c=a.length;d<c;d++)g+=a[d].length;e=new Uint8Array(g);d=g=0;for(c=a.length;d<c;d++)b=a[d],e.set(b,g),g+=b.length;return e}},f={arraySet:function(a,d,c,g,b){for(var e=0;e<g;e++)a[b+e]=d[c+e]},flattenChunks:function(a){return[].concat.apply([],a)}};c.setTyped=function(a){a?(c.Buf8=Uint8Array,c.Buf16=Uint16Array,c.Buf32=Int32Array,
c.assign(c,g)):(c.Buf8=Array,c.Buf16=Array,c.Buf32=Array,c.assign(c,f))};c.setTyped(a)},{}],3:[function(a,d,c){function g(b,a){if(65537>a&&(b.subarray&&q||!b.subarray&&l))return String.fromCharCode.apply(null,f.shrinkBuf(b,a));for(var h="",d=0;d<a;d++)h+=String.fromCharCode(b[d]);return h}var f=a("./common"),l=!0,q=!0;try{String.fromCharCode.apply(null,[0])}catch(m){l=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(p){q=!1}var b=new f.Buf8(256);for(a=0;256>a;a++)b[a]=252<=a?6:248<=
a?5:240<=a?4:224<=a?3:192<=a?2:1;b[254]=b[254]=1;c.string2buf=function(b){var a,h,d,c,g,l=b.length,m=0;for(c=0;c<l;c++)h=b.charCodeAt(c),55296===(h&64512)&&c+1<l&&(d=b.charCodeAt(c+1),56320===(d&64512)&&(h=65536+(h-55296<<10)+(d-56320),c++)),m+=128>h?1:2048>h?2:65536>h?3:4;a=new f.Buf8(m);for(c=g=0;g<m;c++)h=b.charCodeAt(c),55296===(h&64512)&&c+1<l&&(d=b.charCodeAt(c+1),56320===(d&64512)&&(h=65536+(h-55296<<10)+(d-56320),c++)),128>h?a[g++]=h:(2048>h?a[g++]=192|h>>>6:(65536>h?a[g++]=224|h>>>12:(a[g++]=
240|h>>>18,a[g++]=128|h>>>12&63),a[g++]=128|h>>>6&63),a[g++]=128|h&63);return a};c.buf2binstring=function(b){return g(b,b.length)};c.binstring2buf=function(b){for(var a=new f.Buf8(b.length),h=0,d=a.length;h<d;h++)a[h]=b.charCodeAt(h);return a};c.buf2string=function(e,a){var h,d,c,l,f=a||e.length,m=Array(2*f);for(h=d=0;h<f;)if(c=e[h++],128>c)m[d++]=c;else if(l=b[c],4<l)m[d++]=65533,h+=l-1;else{for(c&=2===l?31:3===l?15:7;1<l&&h<f;)c=c<<6|e[h++]&63,l--;1<l?m[d++]=65533:65536>c?m[d++]=c:(c-=65536,m[d++]=
55296|c>>10&1023,m[d++]=56320|c&1023)}return g(m,d)};c.utf8border=function(e,a){var h;a=a||e.length;a>e.length&&(a=e.length);for(h=a-1;0<=h&&128===(e[h]&192);)h--;return 0>h||0===h?a:h+b[e[h]]>a?h:a}},{"./common":2}],4:[function(a,d,c){d.exports=function(a,d,c,f){var m=a&65535|0;a=a>>>16&65535|0;for(var p=0;0!==c;){p=2E3<c?2E3:c;c-=p;do m=m+d[f++]|0,a=a+m|0;while(--p);m%=65521;a%=65521}return m|a<<16|0}},{}],5:[function(a,d,c){d.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,
Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],6:[function(a,d,c){var g=function(){for(var a,d=[],c=0;256>c;c++){a=c;for(var g=0;8>g;g++)a=a&1?3988292384^a>>>1:a>>>1;d[c]=a}return d}();d.exports=function(a,d,c,f){c=f+c;for(a^=
-1;f<c;f++)a=a>>>8^g[(a^d[f])&255];return a^-1}},{}],7:[function(a,d,c){d.exports=function(){this.os=this.xflags=this.time=this.text=0;this.extra=null;this.extra_len=0;this.comment=this.name="";this.hcrc=0;this.done=!1}},{}],8:[function(a,d,c){d.exports=function(a,d){var c,f,m,p,b,e,r,h,u,x,z,v,s,A,w,E,N,I,G,F,K,t,y,D;c=a.state;f=a.next_in;y=a.input;m=f+(a.avail_in-5);p=a.next_out;D=a.output;b=p-(d-a.avail_out);e=p+(a.avail_out-257);r=c.dmax;h=c.wsize;u=c.whave;x=c.wnext;z=c.window;v=c.hold;s=c.bits;
A=c.lencode;w=c.distcode;E=(1<<c.lenbits)-1;N=(1<<c.distbits)-1;a:do b:for(15>s&&(v+=y[f++]<<s,s+=8,v+=y[f++]<<s,s+=8),I=A[v&E];;){G=I>>>24;v>>>=G;s-=G;G=I>>>16&255;if(0===G)D[p++]=I&65535;else if(G&16){F=I&65535;if(G&=15)s<G&&(v+=y[f++]<<s,s+=8),F+=v&(1<<G)-1,v>>>=G,s-=G;15>s&&(v+=y[f++]<<s,s+=8,v+=y[f++]<<s,s+=8);I=w[v&N];c:for(;;){G=I>>>24;v>>>=G;s-=G;G=I>>>16&255;if(G&16){I&=65535;G&=15;s<G&&(v+=y[f++]<<s,s+=8,s<G&&(v+=y[f++]<<s,s+=8));I+=v&(1<<G)-1;if(I>r){a.msg="invalid distance too far back";
c.mode=30;break a}v>>>=G;s-=G;G=p-b;if(I>G){G=I-G;if(G>u&&c.sane){a.msg="invalid distance too far back";c.mode=30;break a}K=0;t=z;if(0===x){if(K+=h-G,G<F){F-=G;do D[p++]=z[K++];while(--G);K=p-I;t=D}}else if(x<G){if(K+=h+x-G,G-=x,G<F){F-=G;do D[p++]=z[K++];while(--G);K=0;if(x<F){G=x;F-=G;do D[p++]=z[K++];while(--G);K=p-I;t=D}}}else if(K+=x-G,G<F){F-=G;do D[p++]=z[K++];while(--G);K=p-I;t=D}for(;2<F;)D[p++]=t[K++],D[p++]=t[K++],D[p++]=t[K++],F-=3;F&&(D[p++]=t[K++],1<F&&(D[p++]=t[K++]))}else{K=p-I;do D[p++]=
D[K++],D[p++]=D[K++],D[p++]=D[K++],F-=3;while(2<F);F&&(D[p++]=D[K++],1<F&&(D[p++]=D[K++]))}}else if(0===(G&64)){I=w[(I&65535)+(v&(1<<G)-1)];continue c}else{a.msg="invalid distance code";c.mode=30;break a}break}}else if(0===(G&64)){I=A[(I&65535)+(v&(1<<G)-1)];continue b}else{G&32?c.mode=12:(a.msg="invalid literal/length code",c.mode=30);break a}break}while(f<m&&p<e);F=s>>3;f-=F;s-=F<<3;a.next_in=f;a.next_out=p;a.avail_in=f<m?5+(m-f):5-(f-m);a.avail_out=p<e?257+(e-p):257-(p-e);c.hold=v&(1<<s)-1;c.bits=
s}},{}],9:[function(a,d,c){function g(b){return(b>>>24&255)+(b>>>8&65280)+((b&65280)<<8)+((b&255)<<24)}function f(){this.mode=0;this.last=!1;this.wrap=0;this.havedict=!1;this.total=this.check=this.dmax=this.flags=0;this.head=null;this.wnext=this.whave=this.wsize=this.wbits=0;this.window=null;this.extra=this.offset=this.length=this.bits=this.hold=0;this.distcode=this.lencode=null;this.have=this.ndist=this.nlen=this.ncode=this.distbits=this.lenbits=0;this.next=null;this.lens=new b.Buf16(320);this.work=
new b.Buf16(288);this.distdyn=this.lendyn=null;this.was=this.back=this.sane=0}function l(a){var e;if(!a||!a.state)return-2;e=a.state;a.total_in=a.total_out=e.total=0;a.msg="";e.wrap&&(a.adler=e.wrap&1);e.mode=1;e.last=0;e.havedict=0;e.dmax=32768;e.head=null;e.hold=0;e.bits=0;e.lencode=e.lendyn=new b.Buf32(852);e.distcode=e.distdyn=new b.Buf32(592);e.sane=1;e.back=-1;return 0}function q(b){var a;if(!b||!b.state)return-2;a=b.state;a.wsize=0;a.whave=0;a.wnext=0;return l(b)}function m(b,a){var e,h;if(!b||
!b.state)return-2;h=b.state;0>a?(e=0,a=-a):(e=(a>>4)+1,48>a&&(a&=15));if(a&&(8>a||15<a))return-2;null!==h.window&&h.wbits!==a&&(h.window=null);h.wrap=e;h.wbits=a;return q(b)}function p(b,a){var e;if(!b)return-2;e=new f;b.state=e;e.window=null;e=m(b,a);0!==e&&(b.state=null);return e}var b=a("../utils/common"),e=a("./adler32"),r=a("./crc32"),h=a("./inffast"),u=a("./inftrees"),x=!0,z,v;c.inflateReset=q;c.inflateReset2=m;c.inflateResetKeep=l;c.inflateInit=function(b){return p(b,15)};c.inflateInit2=p;
c.inflate=function(a,d){var c,f,l,m,p,n,q,t,y,D,U,B,C,O,P=0,ca,ba,da,W=new b.Buf8(4),H=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!a||!a.state||!a.output||!a.input&&0!==a.avail_in)return-2;c=a.state;12===c.mode&&(c.mode=13);p=a.next_out;l=a.output;q=a.avail_out;m=a.next_in;f=a.input;n=a.avail_in;t=c.hold;y=c.bits;D=n;U=q;da=0;a:for(;;)switch(c.mode){case 1:if(0===c.wrap){c.mode=13;break}for(;16>y;){if(0===n)break a;n--;t+=f[m++]<<y;y+=8}if(c.wrap&2&&35615===t){c.check=0;W[0]=t&255;W[1]=t>>>
8&255;c.check=r(c.check,W,2,0);y=t=0;c.mode=2;break}c.flags=0;c.head&&(c.head.done=!1);if(!(c.wrap&1)||(((t&255)<<8)+(t>>8))%31){a.msg="incorrect header check";c.mode=30;break}if(8!==(t&15)){a.msg="unknown compression method";c.mode=30;break}t>>>=4;y-=4;C=(t&15)+8;if(0===c.wbits)c.wbits=C;else if(C>c.wbits){a.msg="invalid window size";c.mode=30;break}c.dmax=1<<C;a.adler=c.check=1;c.mode=t&512?10:12;y=t=0;break;case 2:for(;16>y;){if(0===n)break a;n--;t+=f[m++]<<y;y+=8}c.flags=t;if(8!==(c.flags&255)){a.msg=
"unknown compression method";c.mode=30;break}if(c.flags&57344){a.msg="unknown header flags set";c.mode=30;break}c.head&&(c.head.text=t>>8&1);c.flags&512&&(W[0]=t&255,W[1]=t>>>8&255,c.check=r(c.check,W,2,0));y=t=0;c.mode=3;case 3:for(;32>y;){if(0===n)break a;n--;t+=f[m++]<<y;y+=8}c.head&&(c.head.time=t);c.flags&512&&(W[0]=t&255,W[1]=t>>>8&255,W[2]=t>>>16&255,W[3]=t>>>24&255,c.check=r(c.check,W,4,0));y=t=0;c.mode=4;case 4:for(;16>y;){if(0===n)break a;n--;t+=f[m++]<<y;y+=8}c.head&&(c.head.xflags=t&255,
c.head.os=t>>8);c.flags&512&&(W[0]=t&255,W[1]=t>>>8&255,c.check=r(c.check,W,2,0));y=t=0;c.mode=5;case 5:if(c.flags&1024){for(;16>y;){if(0===n)break a;n--;t+=f[m++]<<y;y+=8}c.length=t;c.head&&(c.head.extra_len=t);c.flags&512&&(W[0]=t&255,W[1]=t>>>8&255,c.check=r(c.check,W,2,0));y=t=0}else c.head&&(c.head.extra=null);c.mode=6;case 6:if(c.flags&1024&&(B=c.length,B>n&&(B=n),B&&(c.head&&(C=c.head.extra_len-c.length,c.head.extra||(c.head.extra=Array(c.head.extra_len)),b.arraySet(c.head.extra,f,m,B,C)),
c.flags&512&&(c.check=r(c.check,f,B,m)),n-=B,m+=B,c.length-=B),c.length))break a;c.length=0;c.mode=7;case 7:if(c.flags&2048){if(0===n)break a;B=0;do C=f[m+B++],c.head&&C&&65536>c.length&&(c.head.name+=String.fromCharCode(C));while(C&&B<n);c.flags&512&&(c.check=r(c.check,f,B,m));n-=B;m+=B;if(C)break a}else c.head&&(c.head.name=null);c.length=0;c.mode=8;case 8:if(c.flags&4096){if(0===n)break a;B=0;do C=f[m+B++],c.head&&C&&65536>c.length&&(c.head.comment+=String.fromCharCode(C));while(C&&B<n);c.flags&
512&&(c.check=r(c.check,f,B,m));n-=B;m+=B;if(C)break a}else c.head&&(c.head.comment=null);c.mode=9;case 9:if(c.flags&512){for(;16>y;){if(0===n)break a;n--;t+=f[m++]<<y;y+=8}if(t!==(c.check&65535)){a.msg="header crc mismatch";c.mode=30;break}y=t=0}c.head&&(c.head.hcrc=c.flags>>9&1,c.head.done=!0);a.adler=c.check=0;c.mode=12;break;case 10:for(;32>y;){if(0===n)break a;n--;t+=f[m++]<<y;y+=8}a.adler=c.check=g(t);y=t=0;c.mode=11;case 11:if(0===c.havedict)return a.next_out=p,a.avail_out=q,a.next_in=m,a.avail_in=
n,c.hold=t,c.bits=y,2;a.adler=c.check=1;c.mode=12;case 12:if(5===d||6===d)break a;case 13:if(c.last){t>>>=y&7;y-=y&7;c.mode=27;break}for(;3>y;){if(0===n)break a;n--;t+=f[m++]<<y;y+=8}c.last=t&1;t>>>=1;y-=1;switch(t&3){case 0:c.mode=14;break;case 1:B=c;if(x){C=void 0;z=new b.Buf32(512);v=new b.Buf32(32);for(C=0;144>C;)B.lens[C++]=8;for(;256>C;)B.lens[C++]=9;for(;280>C;)B.lens[C++]=7;for(;288>C;)B.lens[C++]=8;u(1,B.lens,0,288,z,0,B.work,{bits:9});for(C=0;32>C;)B.lens[C++]=5;u(2,B.lens,0,32,v,0,B.work,
{bits:5});x=!1}B.lencode=z;B.lenbits=9;B.distcode=v;B.distbits=5;c.mode=20;if(6===d){t>>>=2;y-=2;break a}break;case 2:c.mode=17;break;case 3:a.msg="invalid block type",c.mode=30}t>>>=2;y-=2;break;case 14:t>>>=y&7;for(y-=y&7;32>y;){if(0===n)break a;n--;t+=f[m++]<<y;y+=8}if((t&65535)!==(t>>>16^65535)){a.msg="invalid stored block lengths";c.mode=30;break}c.length=t&65535;y=t=0;c.mode=15;if(6===d)break a;case 15:c.mode=16;case 16:if(B=c.length){B>n&&(B=n);B>q&&(B=q);if(0===B)break a;b.arraySet(l,f,m,
B,p);n-=B;m+=B;q-=B;p+=B;c.length-=B;break}c.mode=12;break;case 17:for(;14>y;){if(0===n)break a;n--;t+=f[m++]<<y;y+=8}c.nlen=(t&31)+257;t>>>=5;y-=5;c.ndist=(t&31)+1;t>>>=5;y-=5;c.ncode=(t&15)+4;t>>>=4;y-=4;if(286<c.nlen||30<c.ndist){a.msg="too many length or distance symbols";c.mode=30;break}c.have=0;c.mode=18;case 18:for(;c.have<c.ncode;){for(;3>y;){if(0===n)break a;n--;t+=f[m++]<<y;y+=8}c.lens[H[c.have++]]=t&7;t>>>=3;y-=3}for(;19>c.have;)c.lens[H[c.have++]]=0;c.lencode=c.lendyn;c.lenbits=7;B={bits:c.lenbits};
da=u(0,c.lens,0,19,c.lencode,0,c.work,B);c.lenbits=B.bits;if(da){a.msg="invalid code lengths set";c.mode=30;break}c.have=0;c.mode=19;case 19:for(;c.have<c.nlen+c.ndist;){for(;;){P=c.lencode[t&(1<<c.lenbits)-1];B=P>>>24;P&=65535;if(B<=y)break;if(0===n)break a;n--;t+=f[m++]<<y;y+=8}if(16>P)t>>>=B,y-=B,c.lens[c.have++]=P;else{if(16===P){for(C=B+2;y<C;){if(0===n)break a;n--;t+=f[m++]<<y;y+=8}t>>>=B;y-=B;if(0===c.have){a.msg="invalid bit length repeat";c.mode=30;break}C=c.lens[c.have-1];B=3+(t&3);t>>>=
2;y-=2}else if(17===P){for(C=B+3;y<C;){if(0===n)break a;n--;t+=f[m++]<<y;y+=8}t>>>=B;y-=B;C=0;B=3+(t&7);t>>>=3;y-=3}else{for(C=B+7;y<C;){if(0===n)break a;n--;t+=f[m++]<<y;y+=8}t>>>=B;y-=B;C=0;B=11+(t&127);t>>>=7;y-=7}if(c.have+B>c.nlen+c.ndist){a.msg="invalid bit length repeat";c.mode=30;break}for(;B--;)c.lens[c.have++]=C}}if(30===c.mode)break;if(0===c.lens[256]){a.msg="invalid code -- missing end-of-block";c.mode=30;break}c.lenbits=9;B={bits:c.lenbits};da=u(1,c.lens,0,c.nlen,c.lencode,0,c.work,B);
c.lenbits=B.bits;if(da){a.msg="invalid literal/lengths set";c.mode=30;break}c.distbits=6;c.distcode=c.distdyn;B={bits:c.distbits};da=u(2,c.lens,c.nlen,c.ndist,c.distcode,0,c.work,B);c.distbits=B.bits;if(da){a.msg="invalid distances set";c.mode=30;break}c.mode=20;if(6===d)break a;case 20:c.mode=21;case 21:if(6<=n&&258<=q){a.next_out=p;a.avail_out=q;a.next_in=m;a.avail_in=n;c.hold=t;c.bits=y;h(a,U);p=a.next_out;l=a.output;q=a.avail_out;m=a.next_in;f=a.input;n=a.avail_in;t=c.hold;y=c.bits;12===c.mode&&
(c.back=-1);break}for(c.back=0;;){P=c.lencode[t&(1<<c.lenbits)-1];B=P>>>24;C=P>>>16&255;P&=65535;if(B<=y)break;if(0===n)break a;n--;t+=f[m++]<<y;y+=8}if(C&&0===(C&240)){O=B;ca=C;for(ba=P;;){P=c.lencode[ba+((t&(1<<O+ca)-1)>>O)];B=P>>>24;C=P>>>16&255;P&=65535;if(O+B<=y)break;if(0===n)break a;n--;t+=f[m++]<<y;y+=8}t>>>=O;y-=O;c.back+=O}t>>>=B;y-=B;c.back+=B;c.length=P;if(0===C){c.mode=26;break}if(C&32){c.back=-1;c.mode=12;break}if(C&64){a.msg="invalid literal/length code";c.mode=30;break}c.extra=C&15;
c.mode=22;case 22:if(c.extra){for(C=c.extra;y<C;){if(0===n)break a;n--;t+=f[m++]<<y;y+=8}c.length+=t&(1<<c.extra)-1;t>>>=c.extra;y-=c.extra;c.back+=c.extra}c.was=c.length;c.mode=23;case 23:for(;;){P=c.distcode[t&(1<<c.distbits)-1];B=P>>>24;C=P>>>16&255;P&=65535;if(B<=y)break;if(0===n)break a;n--;t+=f[m++]<<y;y+=8}if(0===(C&240)){O=B;ca=C;for(ba=P;;){P=c.distcode[ba+((t&(1<<O+ca)-1)>>O)];B=P>>>24;C=P>>>16&255;P&=65535;if(O+B<=y)break;if(0===n)break a;n--;t+=f[m++]<<y;y+=8}t>>>=O;y-=O;c.back+=O}t>>>=
B;y-=B;c.back+=B;if(C&64){a.msg="invalid distance code";c.mode=30;break}c.offset=P;c.extra=C&15;c.mode=24;case 24:if(c.extra){for(C=c.extra;y<C;){if(0===n)break a;n--;t+=f[m++]<<y;y+=8}c.offset+=t&(1<<c.extra)-1;t>>>=c.extra;y-=c.extra;c.back+=c.extra}if(c.offset>c.dmax){a.msg="invalid distance too far back";c.mode=30;break}c.mode=25;case 25:if(0===q)break a;B=U-q;if(c.offset>B){B=c.offset-B;if(B>c.whave&&c.sane){a.msg="invalid distance too far back";c.mode=30;break}B>c.wnext?(B-=c.wnext,C=c.wsize-
B):C=c.wnext-B;B>c.length&&(B=c.length);O=c.window}else O=l,C=p-c.offset,B=c.length;B>q&&(B=q);q-=B;c.length-=B;do l[p++]=O[C++];while(--B);0===c.length&&(c.mode=21);break;case 26:if(0===q)break a;l[p++]=c.length;q--;c.mode=21;break;case 27:if(c.wrap){for(;32>y;){if(0===n)break a;n--;t|=f[m++]<<y;y+=8}U-=q;a.total_out+=U;c.total+=U;U&&(a.adler=c.check=c.flags?r(c.check,l,U,p-U):e(c.check,l,U,p-U));U=q;if((c.flags?t:g(t))!==c.check){a.msg="incorrect data check";c.mode=30;break}y=t=0}c.mode=28;case 28:if(c.wrap&&
c.flags){for(;32>y;){if(0===n)break a;n--;t+=f[m++]<<y;y+=8}if(t!==(c.total&4294967295)){a.msg="incorrect length check";c.mode=30;break}y=t=0}c.mode=29;case 29:da=1;break a;case 30:da=-3;break a;case 31:return-4;default:return-2}a.next_out=p;a.avail_out=q;a.next_in=m;a.avail_in=n;c.hold=t;c.bits=y;if(c.wsize||U!==a.avail_out&&30>c.mode&&(27>c.mode||4!==d))f=a.output,m=a.next_out,p=U-a.avail_out,q=a.state,null===q.window&&(q.wsize=1<<q.wbits,q.wnext=0,q.whave=0,q.window=new b.Buf8(q.wsize)),p>=q.wsize?
(b.arraySet(q.window,f,m-q.wsize,q.wsize,0),q.wnext=0,q.whave=q.wsize):(n=q.wsize-q.wnext,n>p&&(n=p),b.arraySet(q.window,f,m-p,n,q.wnext),(p-=n)?(b.arraySet(q.window,f,m-p,p,0),q.wnext=p,q.whave=q.wsize):(q.wnext+=n,q.wnext===q.wsize&&(q.wnext=0),q.whave<q.wsize&&(q.whave+=n)));D-=a.avail_in;U-=a.avail_out;a.total_in+=D;a.total_out+=U;c.total+=U;c.wrap&&U&&(a.adler=c.check=c.flags?r(c.check,l,U,a.next_out-U):e(c.check,l,U,a.next_out-U));a.data_type=c.bits+(c.last?64:0)+(12===c.mode?128:0)+(20===c.mode||
15===c.mode?256:0);(0===D&&0===U||4===d)&&0===da&&(da=-5);return da};c.inflateEnd=function(b){if(!b||!b.state)return-2;var a=b.state;a.window&&(a.window=null);b.state=null;return 0};c.inflateGetHeader=function(b,a){var c;if(!b||!b.state)return-2;c=b.state;if(0===(c.wrap&2))return-2;c.head=a;a.done=!1;return 0};c.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":2,"./adler32":4,"./crc32":6,"./inffast":8,"./inftrees":10}],10:[function(a,d,c){var f=a("../utils/common"),n=[3,4,5,6,
7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],l=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],q=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],m=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];d.exports=function(a,b,c,d,h,u,x,z){for(var v=z.bits,s=0,A=0,w=0,E=0,N=0,I=0,G=0,F=0,K=0,t=0,y,D,U=null,
B=0,C,O=new f.Buf16(16),I=new f.Buf16(16),P=null,ca=0,ba,da,W,s=0;15>=s;s++)O[s]=0;for(A=0;A<d;A++)O[b[c+A]]++;N=v;for(E=15;1<=E&&0===O[E];E--);N>E&&(N=E);if(0===E)return h[u++]=20971520,h[u++]=20971520,z.bits=1,0;for(w=1;w<E&&0===O[w];w++);N<w&&(N=w);for(s=F=1;15>=s;s++)if(F<<=1,F-=O[s],0>F)return-1;if(0<F&&(0===a||1!==E))return-1;I[1]=0;for(s=1;15>s;s++)I[s+1]=I[s]+O[s];for(A=0;A<d;A++)0!==b[c+A]&&(x[I[b[c+A]]++]=A);switch(a){case 0:U=P=x;C=19;break;case 1:U=n;B-=257;P=l;ca-=257;C=256;break;default:U=
q,P=m,C=-1}A=t=0;s=w;v=u;I=N;G=0;D=-1;K=1<<N;d=K-1;if(1===a&&852<K||2===a&&592<K)return 1;for(var H=0;;){H++;ba=s-G;x[A]<C?(da=0,W=x[A]):x[A]>C?(da=P[ca+x[A]],W=U[B+x[A]]):(da=96,W=0);F=1<<s-G;w=y=1<<I;do y-=F,h[v+(t>>G)+y]=ba<<24|da<<16|W|0;while(0!==y);for(F=1<<s-1;t&F;)F>>=1;0!==F?(t&=F-1,t+=F):t=0;A++;if(0===--O[s]){if(s===E)break;s=b[c+x[A]]}if(s>N&&(t&d)!==D){0===G&&(G=N);v+=w;I=s-G;for(F=1<<I;I+G<E;){F-=O[I+G];if(0>=F)break;I++;F<<=1}K+=1<<I;if(1===a&&852<K||2===a&&592<K)return 1;D=t&d;h[D]=
N<<24|I<<16|v-u|0}}0!==t&&(h[v+t]=s-G<<24|4194304);z.bits=N;return 0}},{"../utils/common":2}],11:[function(a,d,c){d.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],12:[function(a,d,c){d.exports=function(){this.input=null;this.total_in=this.avail_in=this.next_in=0;this.output=null;this.total_out=this.avail_out=this.next_out=0;this.msg="";this.state=null;this.data_type=
2;this.adler=0}},{}]},{},[1])(1)});return{inflate:function(k,a){return f.inflateRaw(k)}}}()})();core.StepDirection={PREVIOUS:1,NEXT:2};
core.StepIterator=function(f,k){function a(){b=null;r=e=void 0}function d(){void 0===r&&(r=f.acceptPosition(k)===m);return r}function c(b,c){a();return k.setUnfilteredPosition(b,c)}function g(){b||(b=k.container());return b}function n(){void 0===e&&(e=k.unfilteredDomOffset());return e}function l(){for(a();k.nextPosition();)if(a(),d())return!0;return!1}function q(){for(a();k.previousPosition();)if(a(),d())return!0;return!1}var m=core.PositionFilter.FilterResult.FILTER_ACCEPT,p=core.StepDirection.NEXT,
b,e,r;this.isStep=d;this.setPosition=c;this.container=g;this.offset=n;this.nextStep=l;this.previousStep=q;this.advanceStep=function(b){return b===p?l():q()};this.roundToClosestStep=function(){var b,a,e=d();e||(b=g(),a=n(),e=q(),e||(c(b,a),e=l()));return e};this.roundToPreviousStep=function(){var b=d();b||(b=q());return b};this.roundToNextStep=function(){var b=d();b||(b=l());return b};this.leftNode=function(){return k.leftNode()};this.snapshot=function(){return new core.StepIterator.StepSnapshot(g(),
n())};this.restore=function(b){c(b.container,b.offset)}};core.StepIterator.StepSnapshot=function(f,k){this.container=f;this.offset=k};core.TestData;core.AsyncTestData;core.UnitTest=function(){};core.UnitTest.prototype.setUp=function(){};core.UnitTest.prototype.tearDown=function(){};core.UnitTest.prototype.description=function(){};core.UnitTest.prototype.tests=function(){};core.UnitTest.prototype.asyncTests=function(){};
core.UnitTest.provideTestAreaDiv=function(){var f=runtime.getWindow().document,k=f.getElementById("testarea");runtime.assert(!k,'Unclean test environment, found a div with id "testarea".');k=f.createElement("div");k.setAttribute("id","testarea");f.body.appendChild(k);return k};
core.UnitTest.cleanupTestAreaDiv=function(){var f=runtime.getWindow().document,k=f.getElementById("testarea");runtime.assert(!!k&&k.parentNode===f.body,'Test environment broken, found no div with id "testarea" below body.');f.body.removeChild(k)};core.UnitTest.createXmlDocument=function(f,k,a){var d="<?xml version='1.0' encoding='UTF-8'?>",d=d+("<"+f);Object.keys(a).forEach(function(c){d+=" xmlns:"+c+'="'+a[c]+'"'});d+=">";d+=k;d+="</"+f+">";return runtime.parseXML(d)};
core.UnitTest.createOdtDocument=function(f,k){return core.UnitTest.createXmlDocument("office:document",f,k)};
core.UnitTestLogger=function(){var f=[],k=0,a=0,d="",c="";this.startTest=function(g,n){f=[];k=0;d=g;c=n;a=Date.now()};this.endTest=function(){var g=Date.now();return{description:c,suite:[d,c],success:0===k,log:f,time:g-a}};this.debug=function(a){f.push({category:"debug",message:a})};this.fail=function(a){k+=1;f.push({category:"fail",message:a})};this.pass=function(a){f.push({category:"pass",message:a})}};
core.UnitTestRunner=function(f,k){function a(b){m+=1;e?k.debug(b):k.fail(b)}function d(b,c){var e;try{if(b.length!==c.length)return a("array of length "+b.length+" should be "+c.length+" long"),!1;for(e=0;e<b.length;e+=1)if(b[e]!==c[e])return a(b[e]+" should be "+c[e]+" at array index "+e),!1}catch(d){return!1}return!0}function c(b,e,d){var f=b.attributes,g=f.length,l,m,n;for(l=0;l<g;l+=1)if(m=f.item(l),"xmlns"!==m.prefix&&"urn:webodf:names:steps"!==m.namespaceURI){n=e.getAttributeNS(m.namespaceURI,
m.localName);if(!e.hasAttributeNS(m.namespaceURI,m.localName))return a("Attribute "+m.localName+" with value "+m.value+" was not present"),!1;if(n!==m.value)return a("Attribute "+m.localName+" was "+n+" should be "+m.value),!1}return d?!0:c(e,b,!0)}function g(b,e){var d,f;d=b.nodeType;f=e.nodeType;if(d!==f)return a("Nodetype '"+d+"' should be '"+f+"'"),!1;if(d===Node.TEXT_NODE){if(b.data===e.data)return!0;a("Textnode data '"+b.data+"' should be '"+e.data+"'");return!1}runtime.assert(d===Node.ELEMENT_NODE,
"Only textnodes and elements supported.");if(b.namespaceURI!==e.namespaceURI)return a("namespace '"+b.namespaceURI+"' should be '"+e.namespaceURI+"'"),!1;if(b.localName!==e.localName)return a("localName '"+b.localName+"' should be '"+e.localName+"'"),!1;if(!c(b,e,!1))return!1;d=b.firstChild;for(f=e.firstChild;d;){if(!f)return a("Nodetype '"+d.nodeType+"' is unexpected here."),!1;if(!g(d,f))return!1;d=d.nextSibling;f=f.nextSibling}return f?(a("Nodetype '"+f.nodeType+"' is missing here."),!1):!0}function n(a,
e,c){if(0===e)return a===e&&1/a===1/e;if(a===e)return!0;if(null===a||null===e)return!1;if("number"===typeof e&&isNaN(e))return"number"===typeof a&&isNaN(a);if("number"===typeof e&&"number"===typeof a){if(a===e)return!0;void 0===c&&(c=1E-4);runtime.assert("number"===typeof c,"Absolute tolerance not given as number.");runtime.assert(0<=c,"Absolute tolerance should be given as positive number, was "+c);a=Math.abs(a-e);return a<=c}return Object.prototype.toString.call(e)===Object.prototype.toString.call([])?
d(a,e):"object"===typeof e&&"object"===typeof a?e.constructor===Element||e.constructor===Node?g(a,e):b(a,e):!1}function l(b){if(0===b&&0>1/b)return"-0";if("object"===typeof b)try{return JSON.stringify(b)}catch(a){}return String(b)}function q(b,e,c,d){"string"===typeof e&&"string"===typeof c||k.debug("WARN: shouldBe() expects string arguments");var f,g;try{g=eval(e)}catch(m){f=m}b=eval(c);f?a(e+" should be "+b+". Threw exception "+f):n(g,b,d)?k.pass(e+" is "+c):String(typeof g)===String(typeof b)?
a(e+" should be "+l(b)+". Was "+l(g)+"."):a(e+" should be "+b+" (of type "+typeof b+"). Was "+g+" (of type "+typeof g+").")}var m=0,p,b,e=!1;this.resourcePrefix=function(){return f};this.beginExpectFail=function(){p=m;e=!0};this.endExpectFail=function(){var b=p===m;e=!1;m=p;b&&(m+=1,k.fail("Expected at least one failed test, but none registered."))};b=function(b,e){var c=Object.keys(b),f=Object.keys(e);c.sort();f.sort();return d(c,f)&&Object.keys(b).every(function(c){var d=b[c],f=e[c];return n(d,
f)?!0:(a(d+" should be "+f+" for key "+c),!1)})};this.areNodesEqual=g;this.shouldBeNull=function(b,a){q(b,a,"null")};this.shouldBeNonNull=function(b,e){var c,d;try{d=eval(e)}catch(f){c=f}c?a(e+" should be non-null. Threw exception "+c):null!==d?k.pass(e+" is non-null."):a(e+" should be non-null. Was "+d)};this.shouldBe=q;this.testFailed=a;this.countFailedTests=function(){return m};this.name=function(b){var a,e,c=[],d=b.length;c.length=d;for(a=0;a<d;a+=1){e=Runtime.getFunctionName(b[a])||"";if(""===
e)throw"Found a function without a name.";c[a]={f:b[a],name:e}}return c}};
core.UnitTester=function(){function f(a,c){return"<span style='color:blue;cursor:pointer' onclick='"+c+"'>"+a+"</span>"}function k(c){a.reporter&&a.reporter(c)}var a=this,d=0,c=new core.UnitTestLogger,g={},n="BrowserRuntime"===runtime.type();this.resourcePrefix="";this.reporter=function(a){var c,d;n?runtime.log("<span>Running "+f(a.description,'runTest("'+a.suite[0]+'","'+a.description+'")')+"</span>"):runtime.log("Running "+a.description);if(!a.success)for(c=0;c<a.log.length;c+=1)d=a.log[c],runtime.log(d.category,
d.message)};this.runTests=function(l,q,m){function p(a){function f(){n&&e.endExpectFail();k(c.endTest());r.tearDown();h[l]=s===e.countFailedTests();p(a.slice(1))}var l,n;if(0===a.length)g[b]=h,d+=e.countFailedTests(),q();else if(x=a[0].f,l=a[0].name,n=!0===a[0].expectFail,s=e.countFailedTests(),m.length&&-1===m.indexOf(l))p(a.slice(1));else{r.setUp();c.startTest(b,l);n&&e.beginExpectFail();try{x(f)}catch(u){e.testFailed("Unexpected exception encountered: "+u.toString()+"\n"+u.stack),f()}}}var b=Runtime.getFunctionName(l)||
"",e=new core.UnitTestRunner(a.resourcePrefix,c),r=new l(e),h={},u,x,z,v,s;if(g.hasOwnProperty(b))runtime.log("Test "+b+" has already run.");else{n?runtime.log("<span>Running "+f(b,'runSuite("'+b+'");')+": "+r.description()+"</span>"):runtime.log("Running "+b+": "+r.description);z=r.tests();for(u=0;u<z.length;u+=1)if(x=z[u].f,l=z[u].name,v=!0===z[u].expectFail,!m.length||-1!==m.indexOf(l)){s=e.countFailedTests();r.setUp();c.startTest(b,l);v&&e.beginExpectFail();try{x()}catch(A){e.testFailed("Unexpected exception encountered: "+
A.toString()+"\n"+A.stack)}v&&e.endExpectFail();k(c.endTest());r.tearDown();h[l]=s===e.countFailedTests()}p(r.asyncTests())}};this.failedTestsCount=function(){return d};this.results=function(){return g}};
core.Utils=function(){function f(k,a){if(a&&Array.isArray(a)){k=k||[];if(!Array.isArray(k))throw"Destination is not an array.";k=k.concat(a.map(function(a){return f(null,a)}))}else if(a&&"object"===typeof a){k=k||{};if("object"!==typeof k)throw"Destination is not an object.";Object.keys(a).forEach(function(d){k[d]=f(k[d],a[d])})}else k=a;return k}this.hashString=function(f){var a=0,d,c;d=0;for(c=f.length;d<c;d+=1)a=(a<<5)-a+f.charCodeAt(d),a|=0;return a};this.mergeObjects=function(k,a){Object.keys(a).forEach(function(d){k[d]=
f(k[d],a[d])});return k}};
core.Zip=function(f,k){function a(b,a,e){u?e(null,u.subarray(b,b+a)):e("File data not loaded",null)}function d(b){var a=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,
1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,
1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,
1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,
628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,
3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918E3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117],e,c,d=b.length,h=0,h=0;e=-1;for(c=0;c<d;c+=1)h=(e^b[c])&255,h=a[h],e=e>>>8^h;return e^-1}function c(b){return new Date((b>>25&127)+1980,(b>>21&15)-1,b>>16&31,b>>11&15,
b>>5&63,(b&31)<<1)}function g(b){var a=b.getFullYear();return 1980>a?0:a-1980<<25|b.getMonth()+1<<21|b.getDate()<<16|b.getHours()<<11|b.getMinutes()<<5|b.getSeconds()>>1}function n(b,e){var d,h,f,r,g,t,y,l=this;this.load=function(e){if(null!==l.data)e(null,l.data);else{var c=g+34+h+f+256;c+y>x&&(c=x-y);a(y,c,function(a,c){if(a||null===c)e(a,c);else a:{var d=c,h=new core.ByteArray(d),f=h.readUInt32LE(),y;if(67324752!==f)e("File entry signature is wrong."+f.toString()+" "+d.length.toString(),null);
else{h.pos+=22;f=h.readUInt16LE();y=h.readUInt16LE();h.pos+=f+y;if(r){d=d.subarray(h.pos,h.pos+g);if(g!==d.length){e("The amount of compressed bytes read was "+d.length.toString()+" instead of "+g.toString()+" for "+l.filename+" in "+b+".",null);break a}d=v(d,t)}else d=d.subarray(h.pos,h.pos+t);t!==d.length?e("The amount of bytes read was "+d.length.toString()+" instead of "+t.toString()+" for "+l.filename+" in "+b+".",null):(l.data=d,e(null,d))}}})}};this.set=function(b,a,e,c){l.filename=b;l.data=
a;l.compressed=e;l.date=c};this.error=null;e&&(d=e.readUInt32LE(),33639248!==d?this.error="Central directory entry has wrong signature at position "+(e.pos-4).toString()+' for file "'+b+'": '+e.data.length.toString():(e.pos+=6,r=e.readUInt16LE(),this.date=c(e.readUInt32LE()),e.readUInt32LE(),g=e.readUInt32LE(),t=e.readUInt32LE(),h=e.readUInt16LE(),f=e.readUInt16LE(),d=e.readUInt16LE(),e.pos+=8,y=e.readUInt32LE(),this.filename=runtime.byteArrayToString(e.data.subarray(e.pos,e.pos+h),"utf8"),this.data=
null,e.pos+=h+f+d))}function l(b,e){if(22!==b.length)e("Central directory length should be 22.",s);else{var c=new core.ByteArray(b),d;d=c.readUInt32LE();101010256!==d?e("Central directory signature is wrong: "+d.toString(),s):(d=c.readUInt16LE(),0!==d?e("Zip files with non-zero disk numbers are not supported.",s):(d=c.readUInt16LE(),0!==d?e("Zip files with non-zero disk numbers are not supported.",s):(d=c.readUInt16LE(),z=c.readUInt16LE(),d!==z?e("Number of entries is inconsistent.",s):(d=c.readUInt32LE(),
c=c.readUInt16LE(),c=x-22-d,a(c,x-c,function(b,a){if(b||null===a)e(b,s);else a:{var c=new core.ByteArray(a),d,r;h=[];for(d=0;d<z;d+=1){r=new n(f,c);if(r.error){e(r.error,s);break a}h[h.length]=r}e(null,s)}})))))}}function q(b,a){var e=null,c,d;for(d=0;d<h.length;d+=1)if(c=h[d],c.filename===b){e=c;break}e?e.data?a(null,e.data):e.load(a):a(b+" not found.",null)}function m(b){var a=new core.ByteArrayWriter("utf8"),e=0;a.appendArray([80,75,3,4,20,0,0,0,0,0]);b.data&&(e=b.data.length);a.appendUInt32LE(g(b.date));
a.appendUInt32LE(b.data?d(b.data):0);a.appendUInt32LE(e);a.appendUInt32LE(e);a.appendUInt16LE(b.filename.length);a.appendUInt16LE(0);a.appendString(b.filename);b.data&&a.appendByteArray(b.data);return a}function p(b,a){var e=new core.ByteArrayWriter("utf8"),c=0;e.appendArray([80,75,1,2,20,0,20,0,0,0,0,0]);b.data&&(c=b.data.length);e.appendUInt32LE(g(b.date));e.appendUInt32LE(b.data?d(b.data):0);e.appendUInt32LE(c);e.appendUInt32LE(c);e.appendUInt16LE(b.filename.length);e.appendArray([0,0,0,0,0,0,
0,0,0,0,0,0]);e.appendUInt32LE(a);e.appendString(b.filename);return e}function b(a,e){if(a===h.length)e(null);else{var c=h[a];null!==c.data?b(a+1,e):c.load(function(c){c?e(c):b(a+1,e)})}}function e(a,e){b(0,function(b){if(b)e(b);else{var c,d,f=new core.ByteArrayWriter("utf8"),r=[0];for(c=0;c<h.length;c+=1)f.appendByteArrayWriter(m(h[c])),r.push(f.getLength());b=f.getLength();for(c=0;c<h.length;c+=1)d=h[c],f.appendByteArrayWriter(p(d,r[c]));c=f.getLength()-b;f.appendArray([80,75,5,6,0,0,0,0]);f.appendUInt16LE(h.length);
f.appendUInt16LE(h.length);f.appendUInt32LE(c);f.appendUInt32LE(b);f.appendArray([0,0]);a(f.getByteArray())}})}function r(b,a){e(function(e){runtime.writeFile(b,e,function(b){b||(u=e,x=u.length);a(b)})},a)}var h,u,x,z,v=core.RawInflate.inflate,s=this,A=new core.Base64;this.load=q;this.save=function(b,a,e,c){var d,r;for(d=0;d<h.length;d+=1)if(r=h[d],r.filename===b){r.set(b,a,e,c);return}r=new n(f);r.set(b,a,e,c);h.push(r)};this.remove=function(b){var a,e;for(a=0;a<h.length;a+=1)if(e=h[a],e.filename===
b)return h.splice(a,1),!0;return!1};this.write=function(b){r(f,b)};this.writeAs=r;this.createByteArray=e;this.loadContentXmlAsFragments=function(b,a){s.loadAsString(b,function(b,e){if(b)return a.rootElementReady(b);a.rootElementReady(null,e,!0)})};this.loadAsString=function(b,a){q(b,function(b,e){if(b||null===e)return a(b,null);var c=runtime.byteArrayToString(e,"utf8");a(null,c)})};this.loadAsDOM=function(b,a){s.loadAsString(b,function(b,e){if(b||null===e)a(b,null);else if(6291456<e.length)g_errmsg("Sorry, It takes too much time to run.");
else{var c=(new DOMParser).parseFromString(e.trim(),"text/xml");a(null,c)}})};this.loadAsDataURL=function(b,a,e){if(b&&1E3>b.length){var c=(b||"").toLowerCase().trim();if(0==c.indexOf("http://")||0==c.indexOf("https://")){e(null,b);return}}q(b,function(b,c){if(b||!c)return e(b,null);var d=0,h;a||(a=80===c[1]&&78===c[2]&&71===c[3]?"image/png":255===c[0]&&216===c[1]&&255===c[2]?"image/jpeg":71===c[0]&&73===c[1]&&70===c[2]?"image/gif":"");for(h="data:"+a+";base64,";d<c.length;)h+=A.convertUTF8ArrayToBase64(c.subarray(d,
Math.min(d+45E3,c.length))),d+=45E3;e(null,h)})};this.getEntries=function(){return h.slice()};x=-1;null===k?h=[]:runtime.readFile(f,"binary",function(b,e){"string"===typeof e&&(b="file was read as a string. Should be Uint8Array.");b||!e||0===e.length?k("File '"+f+"' cannot be read. Err: "+(b||"[none]"),s):(u=e,x=u.length,a(x-22,22,function(b,a){b||null===a?k(b,s):l(a,k)}))})};core.SimpleClientRect=null;gui.CommonConstraints={EDIT:{ANNOTATIONS:{ONLY_DELETE_OWN:"onlyDeleteOwn"},REVIEW_MODE:"reviewMode"}};
gui.SessionConstraints=function(){function f(d){k.hasOwnProperty(d)||(k[d]=!1,a.register(d))}var k={},a=new core.EventNotifier;this.registerConstraint=f;this.subscribe=function(d,c){f(d);a.subscribe(d,c)};this.unsubscribe=function(d,c){a.unsubscribe(d,c)};this.setState=function(d,c){runtime.assert(!0===k.hasOwnProperty(d),"No such constraint");k[d]!==c&&(k[d]=c,a.emit(d,c))};this.getState=function(a){runtime.assert(!0===k.hasOwnProperty(a),"No such constraint");return k[a]}};
gui.BlacklistNamespaceNodeFilter=function(f){var k={},a=NodeFilter.FILTER_REJECT,d=NodeFilter.FILTER_ACCEPT;this.acceptNode=function(c){return!c||k.hasOwnProperty(c.namespaceURI)?a:d};(function(){f.forEach(function(a){k[a]=!0})})()};
odf.Namespaces={namespaceMap:{config:"urn:oasis:names:tc:opendocument:xmlns:config:1.0",db:"urn:oasis:names:tc:opendocument:xmlns:database:1.0",dc:"http://purl.org/dc/elements/1.1/",dr3d:"urn:oasis:names:tc:opendocument:xmlns:dr3d:1.0",draw:"urn:oasis:names:tc:opendocument:xmlns:drawing:1.0",chart:"urn:oasis:names:tc:opendocument:xmlns:chart:1.0",fo:"urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0",form:"urn:oasis:names:tc:opendocument:xmlns:form:1.0",math:"http://www.w3.org/1998/Math/MathML",
meta:"urn:oasis:names:tc:opendocument:xmlns:meta:1.0",number:"urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0",office:"urn:oasis:names:tc:opendocument:xmlns:office:1.0",presentation:"urn:oasis:names:tc:opendocument:xmlns:presentation:1.0",style:"urn:oasis:names:tc:opendocument:xmlns:style:1.0",svg:"urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0",table:"urn:oasis:names:tc:opendocument:xmlns:table:1.0",text:"urn:oasis:names:tc:opendocument:xmlns:text:1.0",xforms:"http://www.w3.org/2002/xforms",
xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace"},prefixMap:{},configns:"urn:oasis:names:tc:opendocument:xmlns:config:1.0",dbns:"urn:oasis:names:tc:opendocument:xmlns:database:1.0",dcns:"http://purl.org/dc/elements/1.1/",dr3dns:"urn:oasis:names:tc:opendocument:xmlns:dr3d:1.0",drawns:"urn:oasis:names:tc:opendocument:xmlns:drawing:1.0",chartns:"urn:oasis:names:tc:opendocument:xmlns:chart:1.0",fons:"urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0",formns:"urn:oasis:names:tc:opendocument:xmlns:form:1.0",
mathns:"http://www.w3.org/1998/Math/MathML",metans:"urn:oasis:names:tc:opendocument:xmlns:meta:1.0",numberns:"urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0",officens:"urn:oasis:names:tc:opendocument:xmlns:office:1.0",presentationns:"urn:oasis:names:tc:opendocument:xmlns:presentation:1.0",stylens:"urn:oasis:names:tc:opendocument:xmlns:style:1.0",svgns:"urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0",tablens:"urn:oasis:names:tc:opendocument:xmlns:table:1.0",textns:"urn:oasis:names:tc:opendocument:xmlns:text:1.0",
xformsns:"http://www.w3.org/2002/xforms",xlinkns:"http://www.w3.org/1999/xlink",xmlns:"http://www.w3.org/XML/1998/namespace"};(function(){var f=odf.Namespaces.namespaceMap,k=odf.Namespaces.prefixMap,a;for(a in f)f.hasOwnProperty(a)&&(k[f[a]]=a)})();odf.Namespaces.forEachPrefix=function(f){var k=odf.Namespaces.namespaceMap,a;for(a in k)k.hasOwnProperty(a)&&f(a,k[a])};
odf.Namespaces.lookupNamespaceURI=function(f){var k=null;odf.Namespaces.namespaceMap.hasOwnProperty(f)&&(k=odf.Namespaces.namespaceMap[f]);return k};odf.Namespaces.lookupPrefix=function(f){var k=odf.Namespaces.prefixMap;return k.hasOwnProperty(f)?k[f]:null};odf.Namespaces.lookupNamespaceURI.lookupNamespaceURI=odf.Namespaces.lookupNamespaceURI;
(function(){odf.OdfSchemaImpl=function(){var f=[["config:config-item","uncategorized"],["form:item","object"],["form:option","uncategorized"],["math:math","field"],["meta:user-defined","uncategorized"],["number:currency-symbol","uncategorized"],["number:embedded-text","uncategorized"],["number:text","uncategorized"],["presentation:date-time-decl","uncategorized"],["presentation:footer-decl","uncategorized"],["presentation:header-decl","uncategorized"],["svg:desc","text"],["svg:title","text"],["table:desc",
"uncategorized"],["table:title","uncategorized"],["text:a","text"],["text:author-initials","field"],["text:author-name","field"],["text:bibliography-mark","field"],["text:bookmark-ref","field"],["text:chapter","field"],["text:character-count","field"],["text:conditional-text","field"],["text:creation-date","field"],["text:creation-time","field"],["text:creator","field"],["text:database-display","field"],["text:database-name","field"],["text:database-row-number","field"],["text:date","field"],["text:dde-connection",
"field"],["text:description","field"],["text:editing-cycles","field"],["text:editing-duration","field"],["text:execute-macro","uncategorized"],["text:expression","uncategorized"],["text:file-name","field"],["text:h","text"],["text:hidden-paragraph","text"],["text:hidden-text","text"],["text:image-count","field"],["text:index-entry-span","uncategorized"],["text:index-title-template","uncategorized"],["text:initial-creator","field"],["text:keywords","field"],["text:linenumbering-separator","style"],
["text:measure","uncategorized"],["text:meta","uncategorized"],["text:meta-field","uncategorized"],["text:modification-date","field"],["text:modification-time","field"],["text:note-citation","field"],["text:note-continuation-notice-backward","style"],["text:note-continuation-notice-forward","style"],["text:note-ref","field"],["text:object-count","field"],["text:p","text"],["text:page-continuation","uncategorized"],["text:page-count","field"],["text:page-number","field"],["text:page-variable-get",
"field"],["text:page-variable-set","field"],["text:paragraph-count","field"],["text:placeholder","field"],["text:print-date","field"],["text:print-time","field"],["text:printed-by","field"],["text:reference-ref","field"],["text:ruby-base","text"],["text:ruby-text","text"],["text:script","text"],["text:sender-city","field"],["text:sender-company","field"],["text:sender-country","field"],["text:sender-email","field"],["text:sender-fax","field"],["text:sender-firstname","field"],["text:sender-initials",
"field"],["text:sender-lastname","field"],["text:sender-phone-private","field"],["text:sender-phone-work","field"],["text:sender-position","field"],["text:sender-postal-code","field"],["text:sender-state-or-province","field"],["text:sender-street","field"],["text:sender-title","field"],["text:sequence","uncategorized"],["text:sequence-ref","uncategorized"],["text:sheet-name","uncategorized"],["text:span","text"],["text:subject","field"],["text:table-count","field"],["text:table-formula","deprecated"],
["text:template-name","uncategorized"],["text:text-input","field"],["text:time","field"],["text:title","field"],["text:user-defined","field"],["text:user-field-get","field"],["text:user-field-input","field"],["text:variable-get","field"],["text:variable-input","field"],["text:variable-set","field"],["text:word-count","field"],["xforms:model","uncategorized"]],k={};this.isTextContainer=function(a,d){return"text"===k[a+":"+d]};this.isField=function(a,d){return"field"===k[a+":"+d]};this.getFields=function(){return f.filter(function(a){return"field"===
a[1]}).map(function(a){return a[0]})};(function(){f.forEach(function(a){var d=a[1],c=a[0].split(":");a=c[0];var c=c[1],f=odf.Namespaces.lookupNamespaceURI(a);f?k[f+":"+c]=d:runtime.log("DEBUG: OdfSchema - unknown prefix '"+a+"'")})})()};odf.OdfSchema=new odf.OdfSchemaImpl})();
odf.OdfUtilsImpl=function(){function f(b){return"image"===(b&&b.localName)&&b.namespaceURI===C}function k(b){return null!==b&&b.nodeType===Node.ELEMENT_NODE&&"frame"===b.localName&&b.namespaceURI===C&&"as-char"===b.getAttributeNS(B,"anchor-type")}function a(b){var a;(a="annotation"===(b&&b.localName)&&b.namespaceURI===odf.Namespaces.officens)||(a="div"===(b&&b.localName)&&"annotationWrapper"===b.className);return a}function d(b){return"a"===(b&&b.localName)&&b.namespaceURI===B}function c(b){var a=
b&&b.localName;return("p"===a||"h"===a)&&b.namespaceURI===B}function g(b,a){for(b&&void 0!==a&&!c(b)&&b.childNodes.item(a)&&(b=b.childNodes.item(a));b&&!c(b);)b=b.parentNode;return b}function n(b,a){for(;b&&b!==a;){if(b.namespaceURI===odf.Namespaces.officens&&"annotation"===b.localName)return b;b=b.parentNode}return null}function l(b){return/^[ \t\r\n]+$/.test(b)}function q(b){if(null===b||b.nodeType!==Node.ELEMENT_NODE)return!1;var a=b.localName;return ba.isTextContainer(b.namespaceURI,a)||"span"===
a&&"webodf-annotationHighlight"===b.className}function m(b){return null===b||b.nodeType!==Node.ELEMENT_NODE?!1:ba.isField(b.namespaceURI,b.localName)}function p(b){var a=b&&b.localName,e=!1;a&&(b=b.namespaceURI,b===B&&(e="s"===a||"tab"===a||"line-break"===a));return e}function b(b){return p(b)||m(b)||k(b)||a(b)}function e(b){var a=b&&b.localName,e=!1;a&&(b=b.namespaceURI,b===B&&(e="s"===a));return e}function r(b){return-1!==ca.indexOf(b.namespaceURI)}function h(b){if(p(b)||m(b))return!1;if(q(b.parentNode)&&
b.nodeType===Node.TEXT_NODE)return 0===b.textContent.length;for(b=b.firstChild;b;){if(r(b)||!h(b))return!1;b=b.nextSibling}return!0}function u(b){for(;null!==b.firstChild&&q(b);)b=b.firstChild;return b}function x(b){for(;null!==b.lastChild&&q(b);)b=b.lastChild;return b}function z(b){for(;!c(b)&&null===b.previousSibling;)b=b.parentNode;return c(b)?null:x(b.previousSibling)}function v(b){for(;!c(b)&&null===b.nextSibling;)b=b.parentNode;return c(b)?null:u(b.nextSibling)}function s(a){for(var c=!1;a;)if(a.nodeType===
Node.TEXT_NODE)if(0===a.length)a=z(a);else return!l(a.data.substr(a.length-1,1));else b(a)?(c=!1===e(a),a=null):a=z(a);return c}function A(a){var e=!1,c;for(a=a&&u(a);a;){c=a.nodeType===Node.TEXT_NODE?a.length:0;if(0<c&&!l(a.data)){e=!0;break}if(b(a)){e=!0;break}a=v(a)}return e}function w(b,a){return l(b.data.substr(a))?!A(v(b)):!1}function E(a,e){var c=a.data,d;if(!l(c[e])||b(a.parentNode))return!1;0<e?l(c[e-1])||(d=!0):s(z(a))&&(d=!0);return!0===d?w(a,e)?!1:!0:!1}function N(b){return(b=/(-?[0-9]*[0-9][0-9]*(\.[0-9]*)?|0+\.[0-9]*[1-9][0-9]*|\.[0-9]*[1-9][0-9]*)((cm)|(mm)|(in)|(pt)|(pc)|(px)|(%))/.exec(b))?
{value:parseFloat(b[1]),unit:b[3]}:null}function I(b){return(b=N(b))&&(0>b.value||"%"===b.unit)?null:b}function G(b){return(b=N(b))&&"%"!==b.unit?null:b}function F(b){switch(b.namespaceURI){case odf.Namespaces.drawns:case odf.Namespaces.svgns:case odf.Namespaces.dr3dns:return!1;case odf.Namespaces.textns:switch(b.localName){case "note-body":case "ruby-text":return!1}break;case odf.Namespaces.officens:switch(b.localName){case "annotation":case "binary-data":case "event-listeners":return!1}break;default:switch(b.localName){case "cursor":case "editinfo":return!1}}return!0}
function K(b){return Boolean(g(b)&&(!l(b.textContent)||E(b,0)))}function t(b,a){for(;0<a.length&&!P.rangeContainsNode(b,a[0]);)a.shift();for(;0<a.length&&!P.rangeContainsNode(b,a[a.length-1]);)a.pop()}function y(e,c,d){var h;h=P.getNodesInRange(e,function(e){var c=NodeFilter.FILTER_REJECT;if(p(e.parentNode)||m(e.parentNode)||a(e))c=NodeFilter.FILTER_REJECT;else if(e.nodeType===Node.TEXT_NODE){if(d||K(e))c=NodeFilter.FILTER_ACCEPT}else if(b(e))c=NodeFilter.FILTER_ACCEPT;else if(F(e)||q(e))c=NodeFilter.FILTER_SKIP;
return c},NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_TEXT);c||t(e,h);return h}function D(b,e,c){for(;b;){if(c(b)){e[0]!==b&&e.unshift(b);break}if(a(b))break;b=b.parentNode}}function U(b,a){var e=b;if(a<e.childNodes.length-1)e=e.childNodes[a+1];else{for(;!e.nextSibling;)e=e.parentNode;e=e.nextSibling}for(;e.firstChild;)e=e.firstChild;return e}var B=odf.Namespaces.textns,C=odf.Namespaces.drawns,O=odf.Namespaces.xlinkns,P=core.DomUtils,ca=[odf.Namespaces.dbns,odf.Namespaces.dcns,odf.Namespaces.dr3dns,odf.Namespaces.drawns,
odf.Namespaces.chartns,odf.Namespaces.formns,odf.Namespaces.numberns,odf.Namespaces.officens,odf.Namespaces.presentationns,odf.Namespaces.stylens,odf.Namespaces.svgns,odf.Namespaces.tablens,odf.Namespaces.textns],ba=odf.OdfSchema;this.isImage=f;this.isCharacterFrame=k;this.isInlineRoot=a;this.isTextSpan=function(b){return"span"===(b&&b.localName)&&b.namespaceURI===B};this.isHyperlink=d;this.getHyperlinkTarget=function(b){return b.getAttributeNS(O,"href")||""};this.isParagraph=c;this.getParagraphElement=
g;this.getParentAnnotation=n;this.isWithinAnnotation=function(b,a){return Boolean(n(b,a))};this.getAnnotationCreator=function(b){return b.getElementsByTagNameNS(odf.Namespaces.dcns,"creator")[0].textContent};this.isListItem=function(b){return"list-item"===(b&&b.localName)&&b.namespaceURI===B};this.isLineBreak=function(b){return"line-break"===(b&&b.localName)&&b.namespaceURI===B};this.isODFWhitespace=l;this.isGroupingElement=q;this.isFieldElement=m;this.isCharacterElement=p;this.isAnchoredAsCharacterElement=
b;this.isSpaceElement=e;this.isODFNode=r;this.hasNoODFContent=h;this.firstChild=u;this.lastChild=x;this.previousNode=z;this.nextNode=v;this.scanLeftForNonSpace=s;this.lookLeftForCharacter=function(a){var e,c=e=0;a.nodeType===Node.TEXT_NODE&&(c=a.length);0<c?(e=a.data,e=l(e.substr(c-1,1))?1===c?s(z(a))?2:0:l(e.substr(c-2,1))?0:2:1):b(a)&&(e=1);return e};this.lookRightForCharacter=function(a){var e=!1,c=0;a&&a.nodeType===Node.TEXT_NODE&&(c=a.length);0<c?e=!l(a.data.substr(0,1)):b(a)&&(e=!0);return e};
this.scanLeftForAnyCharacter=function(a){var e=!1,c;for(a=a&&x(a);a;){c=a.nodeType===Node.TEXT_NODE?a.length:0;if(0<c&&!l(a.data)){e=!0;break}if(b(a)){e=!0;break}a=z(a)}return e};this.scanRightForAnyCharacter=A;this.isTrailingWhitespace=w;this.isSignificantWhitespace=E;this.isDowngradableSpaceElement=function(b){return e(b)?s(z(b))&&A(v(b)):!1};this.parseLength=N;this.parseNonNegativeLength=I;this.parseFoFontSize=function(b){var a;a=(a=N(b))&&(0>=a.value||"%"===a.unit)?null:a;return a||G(b)};this.parseFoLineHeight=
function(b){return I(b)||G(b)};this.isTextContentContainingNode=F;this.getTextNodes=function(b,a){var e;e=P.getNodesInRange(b,function(b){var a=NodeFilter.FILTER_REJECT;b.nodeType===Node.TEXT_NODE?K(b)&&(a=NodeFilter.FILTER_ACCEPT):F(b)&&(a=NodeFilter.FILTER_SKIP);return a},NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_TEXT);a||t(b,e);return e};this.getTextElements=y;this.getParagraphElements=function(b){var a;a=P.getNodesInRange(b,function(b){var a=NodeFilter.FILTER_REJECT;if(c(b))a=NodeFilter.FILTER_ACCEPT;
else if(F(b)||q(b))a=NodeFilter.FILTER_SKIP;return a},NodeFilter.SHOW_ELEMENT);D(b.startContainer,a,c);return a};this.getImageElements=function(b){var a;a=P.getNodesInRange(b,function(b){var a=NodeFilter.FILTER_SKIP;f(b)&&(a=NodeFilter.FILTER_ACCEPT);return a},NodeFilter.SHOW_ELEMENT);D(b.startContainer,a,f);return a};this.getHyperlinkElements=function(b){var a=[],e=b.cloneRange();b.collapsed&&b.endContainer.nodeType===Node.ELEMENT_NODE&&(b=U(b.endContainer,b.endOffset),b.nodeType===Node.TEXT_NODE&&
e.setEnd(b,1));y(e,!0,!1).forEach(function(b){for(b=b.parentNode;!c(b);){if(d(b)&&-1===a.indexOf(b)){a.push(b);break}b=b.parentNode}});e.detach();return a};this.getNormalizedFontFamilyName=function(b){/^(["'])(?:.|[\n\r])*?\1$/.test(b)||(b=b.replace(/^[ \t\r\n\f]*((?:.|[\n\r])*?)[ \t\r\n\f]*$/,"$1"),/[ \t\r\n\f]/.test(b)&&(b="'"+b.replace(/[ \t\r\n\f]+/g," ")+"'"));return b}};odf.OdfUtils=new odf.OdfUtilsImpl;
gui.OdfTextBodyNodeFilter=function(){var f=odf.OdfUtils,k=Node.TEXT_NODE,a=NodeFilter.FILTER_REJECT,d=NodeFilter.FILTER_ACCEPT,c=odf.Namespaces.textns;this.acceptNode=function(g){if(g.nodeType===k){if(!f.isGroupingElement(g.parentNode))return a}else if(g.namespaceURI===c&&"tracked-changes"===g.localName)return a;return d}};xmldom.LSSerializerFilter=function(){};xmldom.LSSerializerFilter.prototype.acceptNode=function(f){};
odf.OdfNodeFilter=function(){this.acceptNode=function(f){return"http://www.w3.org/1999/xhtml"===f.namespaceURI?NodeFilter.FILTER_SKIP:f.namespaceURI&&f.namespaceURI.match(/^urn:webodf:/)?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT}};xmldom.XPathIterator=function(){};xmldom.XPathIterator.prototype.next=function(){};xmldom.XPathIterator.prototype.reset=function(){};xmldom.XPathAtom;
function createXPathSingleton(){function f(a,b,e){return-1!==a&&(a<b||-1===b)&&(a<e||-1===e)}function k(a){for(var b=[],e=0,c=a.length,d;e<c;){var g=a,l=c,n=b,k="",q=[],A=g.indexOf("[",e),w=g.indexOf("/",e),E=g.indexOf("=",e);f(w,A,E)?(k=g.substring(e,w),e=w+1):f(A,w,E)?(k=g.substring(e,A),e=m(g,A,q)):f(E,w,A)?(k=g.substring(e,E),e=E):(k=g.substring(e,l),e=l);n.push({location:k,predicates:q});if(e<c&&"="===a[e]){d=a.substring(e+1,c);if(2<d.length&&("'"===d[0]||'"'===d[0]))d=d.slice(1,d.length-1);
else try{d=parseInt(d,10)}catch(N){}e=c}}return{steps:b,value:d}}function a(){var a=null,b=!1;this.setNode=function(b){a=b};this.reset=function(){b=!1};this.next=function(){var e=b?null:a;b=!0;return e}}function d(a,b,e){this.reset=function(){a.reset()};this.next=function(){for(var c=a.next();c;){c.nodeType===Node.ELEMENT_NODE&&(c=c.getAttributeNodeNS(b,e));if(c)break;c=a.next()}return c}}function c(a,b){var e=a.next(),c=null;this.reset=function(){a.reset();e=a.next();c=null};this.next=function(){for(;e;){if(c)if(b&&
c.firstChild)c=c.firstChild;else{for(;!c.nextSibling&&c!==e;)c=c.parentNode;c===e?e=a.next():c=c.nextSibling}else{do(c=e.firstChild)||(e=a.next());while(e&&!c)}if(c&&c.nodeType===Node.ELEMENT_NODE)return c}return null}}function g(a,b){this.reset=function(){a.reset()};this.next=function(){for(var e=a.next();e&&!b(e);)e=a.next();return e}}function n(a,b,e){b=b.split(":",2);var c=e(b[0]),d=b[1];return new g(a,function(b){return b.localName===d&&b.namespaceURI===c})}function l(c,b,e){var d=new a,h=q(d,
b,e),f=b.value;return void 0===f?new g(c,function(b){d.setNode(b);h.reset();return null!==h.next()}):new g(c,function(b){d.setNode(b);h.reset();return(b=h.next())?b.nodeValue===f:!1})}var q,m;m=function(a,b,e){for(var c=b,d=a.length,f=0;c<d;)"]"===a[c]?(f-=1,0>=f&&e.push(k(a.substring(b,c)))):"["===a[c]&&(0>=f&&(b=c+1),f+=1),c+=1;return c};q=function(a,b,e){var f,h,g,m;for(f=0;f<b.steps.length;f+=1){g=b.steps[f];h=g.location;if(""===h)a=new c(a,!1);else if("@"===h[0]){h=h.substr(1).split(":",2);m=
e(h[0]);if(!m)throw"No namespace associated with the prefix "+h[0];a=new d(a,m,h[1])}else"."!==h&&(a=new c(a,!1),-1!==h.indexOf(":")&&(a=n(a,h,e)));for(h=0;h<g.predicates.length;h+=1)m=g.predicates[h],a=l(a,m,e)}return a};return{getODFElementsWithXPath:function(c,b,e){var d=c.ownerDocument,h=[],f=null;if(d&&"function"===typeof d.evaluate)for(e=d.evaluate(b,c,e,XPathResult.UNORDERED_NODE_ITERATOR_TYPE,null),f=e.iterateNext();null!==f;)f.nodeType===Node.ELEMENT_NODE&&h.push(f),f=e.iterateNext();else{h=
new a;h.setNode(c);c=k(b);h=q(h,c,e);c=[];for(e=h.next();e;)c.push(e),e=h.next();h=c}return h}}}xmldom.XPath=createXPathSingleton();
odf.StyleInfo=function(){function f(b,a){var e,c,d,h,g,r=0;if(e=I[b.localName])if(d=e[b.namespaceURI])r=d.length;for(e=0;e<r;e+=1)c=d[e],h=c.ns,g=c.localname,(c=b.getAttributeNS(h,g))&&b.setAttributeNS(h,E[h]+g,a+c);for(d=b.firstElementChild;d;)f(d,a),d=d.nextElementSibling}function k(b,a){var e,c,d,h,f,g=0;if(e=I[b.localName])if(d=e[b.namespaceURI])g=d.length;for(e=0;e<g;e+=1)if(c=d[e],h=c.ns,f=c.localname,c=b.getAttributeNS(h,f))c=c.replace(a,""),b.setAttributeNS(h,E[h]+f,c);for(d=b.firstElementChild;d;)k(d,
a),d=d.nextElementSibling}function a(b,a){var e,c,d,h,f,g=0;if(e=I[b.localName])if(d=e[b.namespaceURI])g=d.length;for(e=0;e<g;e+=1)if(h=d[e],c=h.ns,f=h.localname,c=b.getAttributeNS(c,f))a=a||{},h=h.keyname,a.hasOwnProperty(h)?a[h][c]=1:(f={},f[c]=1,a[h]=f);return a}function d(b,e){var c,h;a(b,e);for(c=b.firstChild;c;)c.nodeType===Node.ELEMENT_NODE&&(h=c,d(h,e)),c=c.nextSibling}function c(b,a,e){this.key=b;this.name=a;this.family=e;this.requires={}}function g(b,a,e){var d=b+'"'+a,h=e[d];h||(h=e[d]=
new c(d,b,a));return h}function n(b,a,e){var c,d,h,f,r,l=0;c=b.getAttributeNS(s,"name");f=b.getAttributeNS(s,"family");c&&f&&(a=g(c,f,e));if(a){if(c=I[b.localName])if(h=c[b.namespaceURI])l=h.length;for(c=0;c<l;c+=1)if(f=h[c],d=f.ns,r=f.localname,d=b.getAttributeNS(d,r))f=f.keyname,f=g(d,f,e),a.requires[f.key]=f}for(b=b.firstElementChild;b;)n(b,a,e),b=b.nextElementSibling;return e}function l(b,a){var e=a[b.family];e||(e=a[b.family]={});e[b.name]=1;Object.keys(b.requires).forEach(function(e){l(b.requires[e],
a)})}function q(b,a){var e=n(b,null,{});Object.keys(e).forEach(function(b){b=e[b];var c=a[b.family];c&&c.hasOwnProperty(b.name)&&l(b,a)})}function m(b,a){function e(a){(a=h.getAttributeNS(s,a))&&(b[a]=!0)}var c=["font-name","font-name-asian","font-name-complex"],d,h;for(d=a&&a.firstElementChild;d;)h=d,c.forEach(e),m(b,h),d=d.nextElementSibling}function p(b,a){function e(b){var c=h.getAttributeNS(s,b);c&&a.hasOwnProperty(c)&&h.setAttributeNS(s,"style:"+b,a[c])}var c=["font-name","font-name-asian",
"font-name-complex"],d,h;for(d=b&&b.firstElementChild;d;)h=d,c.forEach(e),p(h,a),d=d.nextElementSibling}var b=odf.Namespaces.chartns,e=odf.Namespaces.dbns,r=odf.Namespaces.dr3dns,h=odf.Namespaces.drawns,u=odf.Namespaces.formns,x=odf.Namespaces.numberns,z=odf.Namespaces.officens,v=odf.Namespaces.presentationns,s=odf.Namespaces.stylens,A=odf.Namespaces.tablens,w=odf.Namespaces.textns,E={"urn:oasis:names:tc:opendocument:xmlns:chart:1.0":"chart:","urn:oasis:names:tc:opendocument:xmlns:database:1.0":"db:",
"urn:oasis:names:tc:opendocument:xmlns:dr3d:1.0":"dr3d:","urn:oasis:names:tc:opendocument:xmlns:drawing:1.0":"draw:","urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0":"fo:","urn:oasis:names:tc:opendocument:xmlns:form:1.0":"form:","urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0":"number:","urn:oasis:names:tc:opendocument:xmlns:office:1.0":"office:","urn:oasis:names:tc:opendocument:xmlns:presentation:1.0":"presentation:","urn:oasis:names:tc:opendocument:xmlns:style:1.0":"style:","urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0":"svg:",
"urn:oasis:names:tc:opendocument:xmlns:table:1.0":"table:","urn:oasis:names:tc:opendocument:xmlns:text:1.0":"chart:","http://www.w3.org/XML/1998/namespace":"xml:"},N={text:[{ens:s,en:"tab-stop",ans:s,a:"leader-text-style"},{ens:s,en:"drop-cap",ans:s,a:"style-name"},{ens:w,en:"notes-configuration",ans:w,a:"citation-body-style-name"},{ens:w,en:"notes-configuration",ans:w,a:"citation-style-name"},{ens:w,en:"a",ans:w,a:"style-name"},{ens:w,en:"alphabetical-index",ans:w,a:"style-name"},{ens:w,en:"linenumbering-configuration",
ans:w,a:"style-name"},{ens:w,en:"list-level-style-number",ans:w,a:"style-name"},{ens:w,en:"ruby-text",ans:w,a:"style-name"},{ens:w,en:"span",ans:w,a:"style-name"},{ens:w,en:"a",ans:w,a:"visited-style-name"},{ens:s,en:"text-properties",ans:s,a:"text-line-through-text-style"},{ens:w,en:"alphabetical-index-source",ans:w,a:"main-entry-style-name"},{ens:w,en:"index-entry-bibliography",ans:w,a:"style-name"},{ens:w,en:"index-entry-chapter",ans:w,a:"style-name"},{ens:w,en:"index-entry-link-end",ans:w,a:"style-name"},
{ens:w,en:"index-entry-link-start",ans:w,a:"style-name"},{ens:w,en:"index-entry-page-number",ans:w,a:"style-name"},{ens:w,en:"index-entry-span",ans:w,a:"style-name"},{ens:w,en:"index-entry-tab-stop",ans:w,a:"style-name"},{ens:w,en:"index-entry-text",ans:w,a:"style-name"},{ens:w,en:"index-title-template",ans:w,a:"style-name"},{ens:w,en:"list-level-style-bullet",ans:w,a:"style-name"},{ens:w,en:"outline-level-style",ans:w,a:"style-name"}],paragraph:[{ens:h,en:"caption",ans:h,a:"text-style-name"},{ens:h,
en:"circle",ans:h,a:"text-style-name"},{ens:h,en:"connector",ans:h,a:"text-style-name"},{ens:h,en:"control",ans:h,a:"text-style-name"},{ens:h,en:"custom-shape",ans:h,a:"text-style-name"},{ens:h,en:"ellipse",ans:h,a:"text-style-name"},{ens:h,en:"frame",ans:h,a:"text-style-name"},{ens:h,en:"line",ans:h,a:"text-style-name"},{ens:h,en:"measure",ans:h,a:"text-style-name"},{ens:h,en:"path",ans:h,a:"text-style-name"},{ens:h,en:"polygon",ans:h,a:"text-style-name"},{ens:h,en:"polyline",ans:h,a:"text-style-name"},
{ens:h,en:"rect",ans:h,a:"text-style-name"},{ens:h,en:"regular-polygon",ans:h,a:"text-style-name"},{ens:z,en:"annotation",ans:h,a:"text-style-name"},{ens:u,en:"column",ans:u,a:"text-style-name"},{ens:s,en:"style",ans:s,a:"next-style-name"},{ens:A,en:"body",ans:A,a:"paragraph-style-name"},{ens:A,en:"even-columns",ans:A,a:"paragraph-style-name"},{ens:A,en:"even-rows",ans:A,a:"paragraph-style-name"},{ens:A,en:"first-column",ans:A,a:"paragraph-style-name"},{ens:A,en:"first-row",ans:A,a:"paragraph-style-name"},
{ens:A,en:"last-column",ans:A,a:"paragraph-style-name"},{ens:A,en:"last-row",ans:A,a:"paragraph-style-name"},{ens:A,en:"odd-columns",ans:A,a:"paragraph-style-name"},{ens:A,en:"odd-rows",ans:A,a:"paragraph-style-name"},{ens:w,en:"notes-configuration",ans:w,a:"default-style-name"},{ens:w,en:"alphabetical-index-entry-template",ans:w,a:"style-name"},{ens:w,en:"bibliography-entry-template",ans:w,a:"style-name"},{ens:w,en:"h",ans:w,a:"style-name"},{ens:w,en:"illustration-index-entry-template",ans:w,a:"style-name"},
{ens:w,en:"index-source-style",ans:w,a:"style-name"},{ens:w,en:"object-index-entry-template",ans:w,a:"style-name"},{ens:w,en:"p",ans:w,a:"style-name"},{ens:w,en:"table-index-entry-template",ans:w,a:"style-name"},{ens:w,en:"table-of-content-entry-template",ans:w,a:"style-name"},{ens:w,en:"table-index-entry-template",ans:w,a:"style-name"},{ens:w,en:"user-index-entry-template",ans:w,a:"style-name"},{ens:s,en:"page-layout-properties",ans:s,a:"register-truth-ref-style-name"}],chart:[{ens:b,en:"axis",ans:b,
a:"style-name"},{ens:b,en:"chart",ans:b,a:"style-name"},{ens:b,en:"data-label",ans:b,a:"style-name"},{ens:b,en:"data-point",ans:b,a:"style-name"},{ens:b,en:"equation",ans:b,a:"style-name"},{ens:b,en:"error-indicator",ans:b,a:"style-name"},{ens:b,en:"floor",ans:b,a:"style-name"},{ens:b,en:"footer",ans:b,a:"style-name"},{ens:b,en:"grid",ans:b,a:"style-name"},{ens:b,en:"legend",ans:b,a:"style-name"},{ens:b,en:"mean-value",ans:b,a:"style-name"},{ens:b,en:"plot-area",ans:b,a:"style-name"},{ens:b,en:"regression-curve",
ans:b,a:"style-name"},{ens:b,en:"series",ans:b,a:"style-name"},{ens:b,en:"stock-gain-marker",ans:b,a:"style-name"},{ens:b,en:"stock-loss-marker",ans:b,a:"style-name"},{ens:b,en:"stock-range-line",ans:b,a:"style-name"},{ens:b,en:"subtitle",ans:b,a:"style-name"},{ens:b,en:"title",ans:b,a:"style-name"},{ens:b,en:"wall",ans:b,a:"style-name"}],section:[{ens:w,en:"alphabetical-index",ans:w,a:"style-name"},{ens:w,en:"bibliography",ans:w,a:"style-name"},{ens:w,en:"illustration-index",ans:w,a:"style-name"},
{ens:w,en:"index-title",ans:w,a:"style-name"},{ens:w,en:"object-index",ans:w,a:"style-name"},{ens:w,en:"section",ans:w,a:"style-name"},{ens:w,en:"table-of-content",ans:w,a:"style-name"},{ens:w,en:"table-index",ans:w,a:"style-name"},{ens:w,en:"user-index",ans:w,a:"style-name"}],ruby:[{ens:w,en:"ruby",ans:w,a:"style-name"}],table:[{ens:e,en:"query",ans:e,a:"style-name"},{ens:e,en:"table-representation",ans:e,a:"style-name"},{ens:A,en:"background",ans:A,a:"style-name"},{ens:A,en:"table",ans:A,a:"style-name"}],
"table-column":[{ens:e,en:"column",ans:e,a:"style-name"},{ens:A,en:"table-column",ans:A,a:"style-name"}],"table-row":[{ens:e,en:"query",ans:e,a:"default-row-style-name"},{ens:e,en:"table-representation",ans:e,a:"default-row-style-name"},{ens:A,en:"table-row",ans:A,a:"style-name"}],"table-cell":[{ens:e,en:"column",ans:e,a:"default-cell-style-name"},{ens:A,en:"table-column",ans:A,a:"default-cell-style-name"},{ens:A,en:"table-row",ans:A,a:"default-cell-style-name"},{ens:A,en:"body",ans:A,a:"style-name"},
{ens:A,en:"covered-table-cell",ans:A,a:"style-name"},{ens:A,en:"even-columns",ans:A,a:"style-name"},{ens:A,en:"covered-table-cell",ans:A,a:"style-name"},{ens:A,en:"even-columns",ans:A,a:"style-name"},{ens:A,en:"even-rows",ans:A,a:"style-name"},{ens:A,en:"first-column",ans:A,a:"style-name"},{ens:A,en:"first-row",ans:A,a:"style-name"},{ens:A,en:"last-column",ans:A,a:"style-name"},{ens:A,en:"last-row",ans:A,a:"style-name"},{ens:A,en:"odd-columns",ans:A,a:"style-name"},{ens:A,en:"odd-rows",ans:A,a:"style-name"},
{ens:A,en:"table-cell",ans:A,a:"style-name"}],graphic:[{ens:r,en:"cube",ans:h,a:"style-name"},{ens:r,en:"extrude",ans:h,a:"style-name"},{ens:r,en:"rotate",ans:h,a:"style-name"},{ens:r,en:"scene",ans:h,a:"style-name"},{ens:r,en:"sphere",ans:h,a:"style-name"},{ens:h,en:"caption",ans:h,a:"style-name"},{ens:h,en:"circle",ans:h,a:"style-name"},{ens:h,en:"connector",ans:h,a:"style-name"},{ens:h,en:"control",ans:h,a:"style-name"},{ens:h,en:"custom-shape",ans:h,a:"style-name"},{ens:h,en:"ellipse",ans:h,a:"style-name"},
{ens:h,en:"frame",ans:h,a:"style-name"},{ens:h,en:"g",ans:h,a:"style-name"},{ens:h,en:"line",ans:h,a:"style-name"},{ens:h,en:"measure",ans:h,a:"style-name"},{ens:h,en:"page-thumbnail",ans:h,a:"style-name"},{ens:h,en:"path",ans:h,a:"style-name"},{ens:h,en:"polygon",ans:h,a:"style-name"},{ens:h,en:"polyline",ans:h,a:"style-name"},{ens:h,en:"rect",ans:h,a:"style-name"},{ens:h,en:"regular-polygon",ans:h,a:"style-name"},{ens:z,en:"annotation",ans:h,a:"style-name"}],presentation:[{ens:r,en:"cube",ans:v,
a:"style-name"},{ens:r,en:"extrude",ans:v,a:"style-name"},{ens:r,en:"rotate",ans:v,a:"style-name"},{ens:r,en:"scene",ans:v,a:"style-name"},{ens:r,en:"sphere",ans:v,a:"style-name"},{ens:h,en:"caption",ans:v,a:"style-name"},{ens:h,en:"circle",ans:v,a:"style-name"},{ens:h,en:"connector",ans:v,a:"style-name"},{ens:h,en:"control",ans:v,a:"style-name"},{ens:h,en:"custom-shape",ans:v,a:"style-name"},{ens:h,en:"ellipse",ans:v,a:"style-name"},{ens:h,en:"frame",ans:v,a:"style-name"},{ens:h,en:"g",ans:v,a:"style-name"},
{ens:h,en:"line",ans:v,a:"style-name"},{ens:h,en:"measure",ans:v,a:"style-name"},{ens:h,en:"page-thumbnail",ans:v,a:"style-name"},{ens:h,en:"path",ans:v,a:"style-name"},{ens:h,en:"polygon",ans:v,a:"style-name"},{ens:h,en:"polyline",ans:v,a:"style-name"},{ens:h,en:"rect",ans:v,a:"style-name"},{ens:h,en:"regular-polygon",ans:v,a:"style-name"},{ens:z,en:"annotation",ans:v,a:"style-name"}],"drawing-page":[{ens:h,en:"page",ans:h,a:"style-name"},{ens:v,en:"notes",ans:h,a:"style-name"},{ens:s,en:"handout-master",
ans:h,a:"style-name"},{ens:s,en:"master-page",ans:h,a:"style-name"}],"list-style":[{ens:w,en:"list",ans:w,a:"style-name"},{ens:w,en:"numbered-paragraph",ans:w,a:"style-name"},{ens:w,en:"list-item",ans:w,a:"style-override"},{ens:s,en:"style",ans:s,a:"list-style-name"}],data:[{ens:s,en:"style",ans:s,a:"data-style-name"},{ens:s,en:"style",ans:s,a:"percentage-data-style-name"},{ens:v,en:"date-time-decl",ans:s,a:"data-style-name"},{ens:w,en:"creation-date",ans:s,a:"data-style-name"},{ens:w,en:"creation-time",
ans:s,a:"data-style-name"},{ens:w,en:"database-display",ans:s,a:"data-style-name"},{ens:w,en:"date",ans:s,a:"data-style-name"},{ens:w,en:"editing-duration",ans:s,a:"data-style-name"},{ens:w,en:"expression",ans:s,a:"data-style-name"},{ens:w,en:"meta-field",ans:s,a:"data-style-name"},{ens:w,en:"modification-date",ans:s,a:"data-style-name"},{ens:w,en:"modification-time",ans:s,a:"data-style-name"},{ens:w,en:"print-date",ans:s,a:"data-style-name"},{ens:w,en:"print-time",ans:s,a:"data-style-name"},{ens:w,
en:"table-formula",ans:s,a:"data-style-name"},{ens:w,en:"time",ans:s,a:"data-style-name"},{ens:w,en:"user-defined",ans:s,a:"data-style-name"},{ens:w,en:"user-field-get",ans:s,a:"data-style-name"},{ens:w,en:"user-field-input",ans:s,a:"data-style-name"},{ens:w,en:"variable-get",ans:s,a:"data-style-name"},{ens:w,en:"variable-input",ans:s,a:"data-style-name"},{ens:w,en:"variable-set",ans:s,a:"data-style-name"}],"page-layout":[{ens:v,en:"notes",ans:s,a:"page-layout-name"},{ens:s,en:"handout-master",ans:s,
a:"page-layout-name"},{ens:s,en:"master-page",ans:s,a:"page-layout-name"}]},I,G=xmldom.XPath;this.collectUsedFontFaces=m;this.changeFontFaceNames=p;this.UsedStyleList=function(b,a){var e={};this.uses=function(b){var a=b.localName,c=b.getAttributeNS(h,"name")||b.getAttributeNS(s,"name");b="style"===a?b.getAttributeNS(s,"family"):b.namespaceURI===x?"data":a;return(b=e[b])?0<b[c]:!1};d(b,e);a&&q(a,e)};this.getStyleName=function(b,a){var e,c,d=I[a.localName];if(d&&(d=d[a.namespaceURI]))for(c=0;c<d.length;c+=
1)if(d[c].keyname===b&&(d=d[c],a.hasAttributeNS(d.ns,d.localname))){e=a.getAttributeNS(d.ns,d.localname);break}return e};this.hasDerivedStyles=function(b,a,e){var c=e.getAttributeNS(s,"name");e=e.getAttributeNS(s,"family");return G.getODFElementsWithXPath(b,"//style:*[@style:parent-style-name='"+c+"'][@style:family='"+e+"']",a).length?!0:!1};this.prefixStyleNames=function(b,a,e){var c;if(b){for(c=b.firstChild;c;){if(c.nodeType===Node.ELEMENT_NODE){var d=c,g=a,r=d.getAttributeNS(h,"name"),l=void 0;
r?l=h:(r=d.getAttributeNS(s,"name"))&&(l=s);l&&d.setAttributeNS(l,E[l]+"name",g+r)}c=c.nextSibling}f(b,a);e&&f(e,a)}};this.removePrefixFromStyleNames=function(b,a,e){var c=new RegExp("^"+a);if(b){for(a=b.firstChild;a;){if(a.nodeType===Node.ELEMENT_NODE){var d=a,f=c,g=d.getAttributeNS(h,"name"),r=void 0;g?r=h:(g=d.getAttributeNS(s,"name"))&&(r=s);r&&(g=g.replace(f,""),d.setAttributeNS(r,E[r]+"name",g))}a=a.nextSibling}k(b,c);e&&k(e,c)}};this.determineStylesForNode=a;I=function(){var b,a,e,c,d,h={},
f,g,r,l;for(e in N)if(N.hasOwnProperty(e))for(c=N[e],a=c.length,b=0;b<a;b+=1)d=c[b],r=d.en,l=d.ens,h.hasOwnProperty(r)?f=h[r]:h[r]=f={},f.hasOwnProperty(l)?g=f[l]:f[l]=g=[],g.push({ns:d.ans,localname:d.a,keyname:e});return h}()};"function"!==typeof Object.create&&(Object.create=function(f){var k=function(){};k.prototype=f;return new k});
xmldom.LSSerializer=function(){function f(a){var d=a||{},f=function(a){var b={},e;for(e in a)a.hasOwnProperty(e)&&(b[a[e]]=e);return b}(a),l=[d],k=[f],m=0;this.push=function(){m+=1;d=l[m]=Object.create(d);f=k[m]=Object.create(f)};this.pop=function(){l.pop();k.pop();m-=1;d=l[m];f=k[m]};this.getLocalNamespaceDefinitions=function(){return f};this.getQName=function(a){var b=a.namespaceURI,e=0,c;if(!b)return a.localName;if(c=f[b])return c+":"+a.localName;do{c||!a.prefix?(c="ns"+e,e+=1):c=a.prefix;if(d[c]===
b)break;if(!d[c]){d[c]=b;f[b]=c;break}c=null}while(null===c);return c+":"+a.localName}}function k(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&apos;").replace(/"/g,"&quot;")}function a(c,f){var n="",l=d.filter?d.filter.acceptNode(f):NodeFilter.FILTER_ACCEPT,q;if(l===NodeFilter.FILTER_ACCEPT&&f.nodeType===Node.ELEMENT_NODE){c.push();q=c.getQName(f);var m,p=f.attributes,b,e,r,h="",u;m="<"+q;b=p.length;for(e=0;e<b;e+=1)r=p.item(e),"http://www.w3.org/2000/xmlns/"!==
r.namespaceURI&&(u=d.filter?d.filter.acceptNode(r):NodeFilter.FILTER_ACCEPT,u===NodeFilter.FILTER_ACCEPT&&(u=c.getQName(r),r="string"===typeof r.value?k(r.value):r.value,h+=" "+(u+'="'+r+'"')));b=c.getLocalNamespaceDefinitions();for(e in b)b.hasOwnProperty(e)&&((p=b[e])?"xmlns"!==p&&(m+=" xmlns:"+b[e]+'="'+e+'"'):m+=' xmlns="'+e+'"');n+=m+(h+">")}if(l===NodeFilter.FILTER_ACCEPT||l===NodeFilter.FILTER_SKIP){for(l=f.firstChild;l;)n+=a(c,l),l=l.nextSibling;f.nodeValue&&(n+=k(f.nodeValue))}q&&(n+="</"+
q+">",c.pop());return n}var d=this;this.filter=null;this.writeToString=function(c,d){if(!c)return"";var n=new f(d);return a(n,c)}};
(function(){function f(a){var b,e=l.length;for(b=0;b<e;b+=1)if("urn:oasis:names:tc:opendocument:xmlns:office:1.0"===a.namespaceURI&&a.localName===l[b])return b;return-1}function k(a,b){var e=new c.UsedStyleList(a,b),d=new odf.OdfNodeFilter;this.acceptNode=function(a){var c=d.acceptNode(a);c===NodeFilter.FILTER_ACCEPT&&a.parentNode===b&&a.nodeType===Node.ELEMENT_NODE&&(c=e.uses(a)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT);return c}}function a(a,b){var c=new k(a,b);this.acceptNode=function(b){var a=
c.acceptNode(b);a!==NodeFilter.FILTER_ACCEPT||!b.parentNode||b.parentNode.namespaceURI!==odf.Namespaces.textns||"s"!==b.parentNode.localName&&"tab"!==b.parentNode.localName||(a=NodeFilter.FILTER_REJECT);return a}}function d(a,b){if(b){var c=f(b),d,h=a.firstChild;if(-1!==c){for(;h;){d=f(h);if(-1!==d&&d>c)break;h=h.nextSibling}a.insertBefore(b,h)}}}var c=new odf.StyleInfo,g=core.DomUtils,n=odf.Namespaces.stylens,l="meta settings scripts font-face-decls styles automatic-styles master-styles body".split(" "),
q=Date.now()+"_webodf_",m=new core.Base64;odf.ODFElement=function(){};odf.ODFDocumentElement=function(){};odf.ODFDocumentElement.prototype=new odf.ODFElement;odf.ODFDocumentElement.prototype.constructor=odf.ODFDocumentElement;odf.ODFDocumentElement.prototype.automaticStyles;odf.ODFDocumentElement.prototype.body;odf.ODFDocumentElement.prototype.fontFaceDecls=null;odf.ODFDocumentElement.prototype.manifest=null;odf.ODFDocumentElement.prototype.masterStyles;odf.ODFDocumentElement.prototype.meta;odf.ODFDocumentElement.prototype.settings=
null;odf.ODFDocumentElement.prototype.styles;odf.ODFDocumentElement.namespaceURI="urn:oasis:names:tc:opendocument:xmlns:office:1.0";odf.ODFDocumentElement.localName="document";odf.AnnotationElement=function(){};odf.AnnotationElement.prototype.annotationEndElement;odf.OdfPart=function(a,b,c,d){var h=this;this.size=0;this.type=null;this.name=a;this.container=c;this.url=null;this.mimetype=b;this.onstatereadychange=this.document=null;this.onchange;this.EMPTY=0;this.LOADING=1;this.DONE=2;this.state=this.EMPTY;
this.data="";this.load=function(){null!==d&&(this.mimetype=b,d.loadAsDataURL(a,b,function(b,a){b&&runtime.log(b);h.url=a;if(h.onchange)h.onchange(h);if(h.onstatereadychange)h.onstatereadychange(h)}))}};odf.OdfPart.prototype.load=function(){};odf.OdfPart.prototype.getUrl=function(){return this.data?"data:;base64,"+m.toBase64(this.data):null};odf.OdfContainer=function b(e,f){function h(b){for(var a=b.firstChild,c;a;)c=a.nextSibling,a.nodeType===Node.ELEMENT_NODE?h(a):a.nodeType===Node.PROCESSING_INSTRUCTION_NODE&&
b.removeChild(a),a=c}function l(b){var a={},c,e,d=b.ownerDocument.createNodeIterator(b,NodeFilter.SHOW_ELEMENT,null,!1);for(b=d.nextNode();b;)"urn:oasis:names:tc:opendocument:xmlns:office:1.0"===b.namespaceURI&&("annotation"===b.localName?(c=b.getAttributeNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0","name"))&&(a.hasOwnProperty(c)?runtime.log("Warning: annotation name used more than once with <office:annotation/>: '"+c+"'"):a[c]=b):"annotation-end"===b.localName&&((c=b.getAttributeNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0",
"name"))?a.hasOwnProperty(c)?(e=a[c],e.annotationEndElement?runtime.log("Warning: annotation name used more than once with <office:annotation-end/>: '"+c+"'"):e.annotationEndElement=b):runtime.log("Warning: annotation end without an annotation start, name: '"+c+"'"):runtime.log("Warning: annotation end without a name found"))),b=d.nextNode()}function x(b,a){for(var c=b&&b.firstChild;c;)c.nodeType===Node.ELEMENT_NODE&&c.setAttributeNS("urn:webodf:names:scope","scope",a),c=c.nextSibling}function z(b,
a){for(var c=J.rootElement.meta,c=c&&c.firstChild;c&&(c.namespaceURI!==b||c.localName!==a);)c=c.nextSibling;for(c=c&&c.firstChild;c&&c.nodeType!==Node.TEXT_NODE;)c=c.nextSibling;return c?c.data:null}function v(b){var a={},c;for(b=b.firstChild;b;)b.nodeType===Node.ELEMENT_NODE&&b.namespaceURI===n&&"font-face"===b.localName&&(c=b.getAttributeNS(n,"name"),a[c]=b),b=b.nextSibling;return a}function s(b,a){var c=null,e,d,h;if(b)for(c=b.cloneNode(!0),e=c.firstElementChild;e;)d=e.nextElementSibling,(h=e.getAttributeNS("urn:webodf:names:scope",
"scope"))&&h!==a&&c.removeChild(e),e=d;return c}function A(b,a){var e,d,h,f=null,g={};if(b)for(a.forEach(function(b){c.collectUsedFontFaces(g,b)}),f=b.cloneNode(!0),e=f.firstElementChild;e;)d=e.nextElementSibling,h=e.getAttributeNS(n,"name"),g[h]||f.removeChild(e),e=d;return f}function w(b){var a=J.rootElement.ownerDocument,c;if(b){h(b.documentElement);try{c=a.importNode(b.documentElement,!0)}catch(e){}}return c}function E(b){J.state=b;if(J.onchange)J.onchange(J);if(J.onstatereadychange)J.onstatereadychange(J)}
function N(b){Q=null;J.rootElement=b;b.fontFaceDecls=g.getDirectChild(b,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","font-face-decls");b.styles=g.getDirectChild(b,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","styles");b.automaticStyles=g.getDirectChild(b,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","automatic-styles");b.masterStyles=g.getDirectChild(b,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","master-styles");b.body=g.getDirectChild(b,"urn:oasis:names:tc:opendocument:xmlns:office:1.0",
"body");b.meta=g.getDirectChild(b,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","meta");b.settings=g.getDirectChild(b,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","settings");b.scripts=g.getDirectChild(b,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","scripts");l(b)}function I(a){var e=w(a),h=J.rootElement,f;e&&"document-styles"===e.localName&&"urn:oasis:names:tc:opendocument:xmlns:office:1.0"===e.namespaceURI?(h.fontFaceDecls=g.getDirectChild(e,"urn:oasis:names:tc:opendocument:xmlns:office:1.0",
"font-face-decls"),d(h,h.fontFaceDecls),f=g.getDirectChild(e,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","styles"),h.styles=f||a.createElementNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0","styles"),d(h,h.styles),f=g.getDirectChild(e,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","automatic-styles"),h.automaticStyles=f||a.createElementNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0","automatic-styles"),x(h.automaticStyles,"document-styles"),d(h,h.automaticStyles),e=g.getDirectChild(e,
"urn:oasis:names:tc:opendocument:xmlns:office:1.0","master-styles"),h.masterStyles=e||a.createElementNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0","master-styles"),d(h,h.masterStyles),c.prefixStyleNames(h.automaticStyles,q,h.masterStyles)):E(b.INVALID)}function G(a){a=w(a);var e,h,f,l;if(a&&"document-content"===a.localName&&"urn:oasis:names:tc:opendocument:xmlns:office:1.0"===a.namespaceURI){e=J.rootElement;f=g.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","font-face-decls");
if(e.fontFaceDecls&&f){l=e.fontFaceDecls;var r,m,y,t,k={};h=v(l);t=v(f);for(f=f.firstElementChild;f;){r=f.nextElementSibling;if(f.namespaceURI===n&&"font-face"===f.localName)if(m=f.getAttributeNS(n,"name"),h.hasOwnProperty(m)){if(!f.isEqualNode(h[m])){y=m;for(var q=h,B=t,u=0,D=void 0,D=y=y.replace(/\d+$/,"");q.hasOwnProperty(D)||B.hasOwnProperty(D);)u+=1,D=y+u;y=D;f.setAttributeNS(n,"style:name",y);l.appendChild(f);h[y]=f;delete t[m];k[m]=y}}else l.appendChild(f),h[m]=f,delete t[m];f=r}l=k}else f&&
(e.fontFaceDecls=f,d(e,f));h=g.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","automatic-styles");x(h,"document-content");l&&c.changeFontFaceNames(h,l);if(e.automaticStyles&&h)for(l=h.firstChild;l;)e.automaticStyles.appendChild(l),l=h.firstChild;else h&&(e.automaticStyles=h,d(e,h));a=g.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","body");if(null===a)throw"<office:body/> tag is mising.";e.body=a;d(e,e.body)}else E(b.INVALID)}function F(b){b=w(b);var a;b&&
"document-meta"===b.localName&&"urn:oasis:names:tc:opendocument:xmlns:office:1.0"===b.namespaceURI&&(a=J.rootElement,a.meta=g.getDirectChild(b,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","meta"),d(a,a.meta))}function K(b){b=w(b);var a;b&&"document-settings"===b.localName&&"urn:oasis:names:tc:opendocument:xmlns:office:1.0"===b.namespaceURI&&(a=J.rootElement,a.settings=g.getDirectChild(b,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","settings"),d(a,a.settings))}function t(b){b=w(b);var a;
if(b&&"manifest"===b.localName&&"urn:oasis:names:tc:opendocument:xmlns:manifest:1.0"===b.namespaceURI)for(a=J.rootElement,a.manifest=b,b=a.manifest.firstElementChild;b;)"file-entry"===b.localName&&"urn:oasis:names:tc:opendocument:xmlns:manifest:1.0"===b.namespaceURI&&(T[b.getAttributeNS("urn:oasis:names:tc:opendocument:xmlns:manifest:1.0","full-path")]=b.getAttributeNS("urn:oasis:names:tc:opendocument:xmlns:manifest:1.0","media-type")),b=b.nextElementSibling}function y(b,a,c){b=g.getElementsByTagName(b,
a);var e;for(e=0;e<b.length;e+=1)a=b[e],c.hasOwnProperty(a.namespaceURI)||a.parentNode.removeChild(a)}function D(b){y(b,"script",{"urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0":!0,"urn:oasis:names:tc:opendocument:xmlns:office:1.0":!0,"urn:oasis:names:tc:opendocument:xmlns:table:1.0":!0,"urn:oasis:names:tc:opendocument:xmlns:text:1.0":!0,"urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0":!0});y(b,"style",{"urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0":!0,"urn:oasis:names:tc:opendocument:xmlns:drawing:1.0":!0,
"urn:oasis:names:tc:opendocument:xmlns:style:1.0":!0})}function U(b){var a=b.firstElementChild,c=[],e,d,h,f=b.attributes,g=f.length;for(e=0;e<g;e+=1)h=f.item(e),d=h.localName.substr(0,2).toLowerCase(),null===h.namespaceURI&&"on"===d&&c.push(h);g=c.length;for(e=0;e<g;e+=1)b.removeAttributeNode(c[e]);for(;a;)U(a),a=a.nextElementSibling}function B(a){var c=a.shift();if(c){var e=(new Date).getTime();aa.loadAsDOM(c.path,function(d,h){h&&(D(h),U(h.documentElement));c.handler(h);if(5E3<(new Date).getTime()-
e)g_errmsg("Sorry, It takes too much time to run.");else{if(J.state===b.INVALID){d?runtime.log("ERROR: Unable to load "+c.path+" - "+d):runtime.log("ERROR: Unable to load "+c.path);if("content.xml"==c.path)return;B(a)}d&&runtime.log("DEBUG: Unable to load "+c.path+" - "+d);B(a)}})}else l(J.rootElement),E(b.DONE)}function C(b){var a="";odf.Namespaces.forEachPrefix(function(b,c){a+=" xmlns:"+b+'="'+c+'"'});return'<?xml version="1.0" encoding="UTF-8"?><office:'+b+" "+a+' office:version="1.2">'}function O(){var b=
new xmldom.LSSerializer,a=C("document-meta");b.filter=new odf.OdfNodeFilter;a+=b.writeToString(J.rootElement.meta,odf.Namespaces.namespaceMap);return a+"</office:document-meta>"}function P(b,a){var c=document.createElementNS("urn:oasis:names:tc:opendocument:xmlns:manifest:1.0","manifest:file-entry");c.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:manifest:1.0","manifest:full-path",b);c.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:manifest:1.0","manifest:media-type",a);return c}function ca(){var b=
runtime.parseXML('<manifest:manifest xmlns:manifest="urn:oasis:names:tc:opendocument:xmlns:manifest:1.0" manifest:version="1.2"></manifest:manifest>'),a=b.documentElement,c=new xmldom.LSSerializer,e;for(e in T)T.hasOwnProperty(e)&&a.appendChild(P(e,T[e]));c.filter=new odf.OdfNodeFilter;return'<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\n'+c.writeToString(b,odf.Namespaces.namespaceMap)}function ba(){var b,a,e,d=odf.Namespaces.namespaceMap,h=new xmldom.LSSerializer,f=C("document-styles");
a=s(J.rootElement.automaticStyles,"document-styles");e=J.rootElement.masterStyles.cloneNode(!0);b=A(J.rootElement.fontFaceDecls,[e,J.rootElement.styles,a]);c.removePrefixFromStyleNames(a,q,e);h.filter=new k(e,a);f+=h.writeToString(b,d);f+=h.writeToString(J.rootElement.styles,d);f+=h.writeToString(a,d);f+=h.writeToString(e,d);return f+"</office:document-styles>"}function da(){var b,c,e=odf.Namespaces.namespaceMap,d=new xmldom.LSSerializer,h=C("document-content");c=s(J.rootElement.automaticStyles,"document-content");
b=A(J.rootElement.fontFaceDecls,[c]);d.filter=new a(J.rootElement.body,c);h+=d.writeToString(b,e);h+=d.writeToString(c,e);h+=d.writeToString(J.rootElement.body,e);return h+"</office:document-content>"}function W(a,c){runtime.loadXML(a,function(a,e){if(a)c(a);else if(e){D(e);U(e.documentElement);var d=w(e);d&&"document"===d.localName&&"urn:oasis:names:tc:opendocument:xmlns:office:1.0"===d.namespaceURI?(N(d),E(b.DONE)):E(b.INVALID)}else c("No DOM was loaded.")})}function H(b,a){var c;c=J.rootElement;
var e=c.meta;e||(c.meta=e=document.createElementNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0","meta"),d(c,e));c=e;b&&g.mapKeyValObjOntoNode(c,b,odf.Namespaces.lookupNamespaceURI);a&&g.removeKeyElementsFromNode(c,a,odf.Namespaces.lookupNamespaceURI)}function Y(a,c){function e(b,a){var c;a||(a=b);c=document.createElementNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0",a);g[b]=c;g.appendChild(c)}var d=new core.Zip("",null),h="application/vnd.oasis.opendocument."+a+(!0===c?"-template":""),
f=runtime.byteArrayFromString(h,"utf8"),g=J.rootElement,l=document.createElementNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0",a);d.save("mimetype",f,!1,new Date);e("meta");e("settings");e("scripts");e("fontFaceDecls","font-face-decls");e("styles");e("automaticStyles","automatic-styles");e("masterStyles","master-styles");e("body");g.body.appendChild(l);T["/"]=h;T["settings.xml"]="text/xml";T["meta.xml"]="text/xml";T["styles.xml"]="text/xml";T["content.xml"]="text/xml";E(b.DONE);return d}function ga(){var b,
a=new Date,c="";J.rootElement.settings&&J.rootElement.settings.firstElementChild&&(b=new xmldom.LSSerializer,c=C("document-settings"),b.filter=new odf.OdfNodeFilter,c+=b.writeToString(J.rootElement.settings,odf.Namespaces.namespaceMap),c+="</office:document-settings>");(b=c)?(b=runtime.byteArrayFromString(b,"utf8"),aa.save("settings.xml",b,!0,a)):aa.remove("settings.xml");c=runtime.getWindow();b="WebODF/"+webodf.Version;c&&(b=b+" "+c.navigator.userAgent);H({"meta:generator":b},null);b=runtime.byteArrayFromString(O(),
"utf8");aa.save("meta.xml",b,!0,a);b=runtime.byteArrayFromString(ba(),"utf8");aa.save("styles.xml",b,!0,a);b=runtime.byteArrayFromString(da(),"utf8");aa.save("content.xml",b,!0,a);b=runtime.byteArrayFromString(ca(),"utf8");aa.save("META-INF/manifest.xml",b,!0,a)}function Z(b,a){ga();aa.writeAs(b,function(b){a(b)})}var J=this,aa,T={},Q,S="";this.onstatereadychange=f;this.state=this.onchange=null;this.rootElement;this.getMetadata=z;this.setRootElement=N;this.getContentElement=function(){var b;Q||(b=
J.rootElement.body,Q=g.getDirectChild(b,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","text")||g.getDirectChild(b,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","presentation")||g.getDirectChild(b,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","spreadsheet"));if(!Q)throw g_errmsg('<div style="margin:0px 30px">An error has occurred. Please check whether the file format supports. or Reopen a file.</div>'),"Could not find content element in <office:body/>.";return Q};this.getDocumentType=
function(){var b=J.getContentElement();return b&&b.localName};this.isTemplate=function(){return"-template"===T["/"].substr(-9)};this.setIsTemplate=function(b){var a=T["/"],c="-template"===a.substr(-9);b!==c&&(a=b?a+"-template":a.substr(0,a.length-9),T["/"]=a,b=runtime.byteArrayFromString(a,"utf8"),aa.save("mimetype",b,!1,new Date))};this.getPart=function(b){return new odf.OdfPart(b,T[b],J,aa)};this.getPartData=function(b,a){aa.load(b,a)};this.setMetadata=H;this.incrementEditingCycles=function(){var b=
z(odf.Namespaces.metans,"editing-cycles"),b=b?parseInt(b,10):0;isNaN(b)&&(b=0);H({"meta:editing-cycles":b+1},null);return b+1};this.createByteArray=function(b,a){ga();aa.createByteArray(b,a)};this.saveAs=Z;this.save=function(b){Z(S,b)};this.getUrl=function(){return S};this.setBlob=function(b,a,c){c=m.convertBase64ToByteArray(c);aa.save(b,c,!1,new Date);T.hasOwnProperty(b)&&runtime.log(b+" has been overwritten.");T[b]=a};this.removeBlob=function(b){var a=aa.remove(b);runtime.assert(a,"file is not found: "+
b);delete T[b]};this.state=b.LOADING;this.rootElement=function(b){var a=document.createElementNS(b.namespaceURI,b.localName),c;b=new b.Type;for(c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a}({Type:odf.ODFDocumentElement,namespaceURI:odf.ODFDocumentElement.namespaceURI,localName:odf.ODFDocumentElement.localName});e===odf.OdfContainer.DocumentType.TEXT?aa=Y("text"):e===odf.OdfContainer.DocumentType.TEXT_TEMPLATE?aa=Y("text",!0):e===odf.OdfContainer.DocumentType.PRESENTATION?aa=Y("presentation"):
e===odf.OdfContainer.DocumentType.PRESENTATION_TEMPLATE?aa=Y("presentation",!0):e===odf.OdfContainer.DocumentType.SPREADSHEET?aa=Y("spreadsheet"):e===odf.OdfContainer.DocumentType.SPREADSHEET_TEMPLATE?aa=Y("spreadsheet",!0):(S=e,aa=new core.Zip(S,function(a,c){aa=c;a?W(S,function(c){a&&(aa.error=a+"\n"+c,E(b.INVALID))}):B([{path:"styles.xml",handler:I},{path:"content.xml",handler:G},{path:"meta.xml",handler:F},{path:"settings.xml",handler:K},{path:"META-INF/manifest.xml",handler:t}])}))};odf.OdfContainer.EMPTY=
0;odf.OdfContainer.LOADING=1;odf.OdfContainer.DONE=2;odf.OdfContainer.INVALID=3;odf.OdfContainer.SAVING=4;odf.OdfContainer.MODIFIED=5;odf.OdfContainer.getContainer=function(b){return new odf.OdfContainer(b,null)}})();odf.OdfContainer.DocumentType={TEXT:1,TEXT_TEMPLATE:2,PRESENTATION:3,PRESENTATION_TEMPLATE:4,SPREADSHEET:5,SPREADSHEET_TEMPLATE:6};gui.AnnotatableCanvas=function(){};gui.AnnotatableCanvas.prototype.refreshSize=function(){};gui.AnnotatableCanvas.prototype.getZoomLevel=function(){};
gui.AnnotatableCanvas.prototype.getSizer=function(){};
gui.AnnotationViewManager=function(f,k,a,d){function c(b){var a=b.annotationEndElement,c=m.createRange(),d=b.getAttributeNS(odf.Namespaces.officens,"name");a&&(c.setStart(b,b.childNodes.length),c.setEnd(a,0),b=p.getTextNodes(c,!1),b.forEach(function(b){var a;a:{for(a=b.parentNode;a.namespaceURI!==odf.Namespaces.officens||"body"!==a.localName;){if("http://www.w3.org/1999/xhtml"===a.namespaceURI&&"webodf-annotationHighlight"===a.className&&a.getAttribute("annotation")===d){a=!0;break a}a=a.parentNode}a=
!1}a||(a=m.createElement("span"),a.className="webodf-annotationHighlight",a.setAttribute("annotation",d),b.parentNode.replaceChild(a,b),a.appendChild(b))}));c.detach()}function g(c){var d=f.getSizer();c?(a.style.display="inline-block",d.style.paddingRight=b.getComputedStyle(a).width):(a.style.display="none",d.style.paddingRight=0);f.refreshSize()}function n(){q.sort(function(b,a){return 0!==(b.compareDocumentPosition(a)&Node.DOCUMENT_POSITION_FOLLOWING)?-1:1})}function l(){var b;for(b=0;b<q.length;b+=
1){var c=q[b],d=c.parentNode,g=d.nextElementSibling,l=g.nextElementSibling,m=d.parentNode,n=0,n=q[q.indexOf(c)-1],k=void 0,c=f.getZoomLevel();d.style.left=(a.getBoundingClientRect().left-m.getBoundingClientRect().left)/c+"px";d.style.width=a.getBoundingClientRect().width/c+"px";g.style.width=parseFloat(d.style.left)-30+"px";n&&(k=n.parentNode.getBoundingClientRect(),20>=(m.getBoundingClientRect().top-k.bottom)/c?d.style.top=Math.abs(m.getBoundingClientRect().top-k.bottom)/c+20+"px":d.style.top="0px");
l.style.left=g.getBoundingClientRect().width/c+"px";var g=l.style,m=l.getBoundingClientRect().left/c,n=l.getBoundingClientRect().top/c,k=d.getBoundingClientRect().left/c,p=d.getBoundingClientRect().top/c,w=0,E=0,w=k-m,w=w*w,E=p-n,E=E*E,m=Math.sqrt(w+E);g.width=m+"px";n=Math.asin((d.getBoundingClientRect().top-l.getBoundingClientRect().top)/(c*parseFloat(l.style.width)));l.style.transform="rotate("+n+"rad)";l.style.MozTransform="rotate("+n+"rad)";l.style.WebkitTransform="rotate("+n+"rad)";l.style.msTransform=
"rotate("+n+"rad)"}}var q=[],m=k.ownerDocument,p=odf.OdfUtils,b=runtime.getWindow();runtime.assert(Boolean(b),"Expected to be run in an environment which has a global window, like a browser.");this.rerenderAnnotations=l;this.rehighlightAnnotations=function(){q.forEach(function(b){c(b)})};this.getMinimumHeightForAnnotationPane=function(){return"none"!==a.style.display&&0<q.length?(q[q.length-1].parentNode.getBoundingClientRect().bottom-a.getBoundingClientRect().top)/f.getZoomLevel()+"px":null};this.addAnnotation=
function(b){g(!0);q.push(b);n();var a=m.createElement("div"),h=m.createElement("div"),f=m.createElement("div"),k=m.createElement("div"),z;a.className="annotationWrapper";a.setAttribute("creator",p.getAnnotationCreator(b));b.parentNode.insertBefore(a,b);h.className="annotationNote";h.appendChild(b);d&&(z=m.createElement("div"),z.className="annotationRemoveButton",h.appendChild(z));f.className="annotationConnector horizontal";k.className="annotationConnector angular";a.appendChild(h);a.appendChild(f);
a.appendChild(k);b.annotationEndElement&&c(b);l()};this.forgetAnnotations=function(){for(;q.length;){var b=q[0],a=q.indexOf(b),c=b.parentNode.parentNode;"div"===c.localName&&(c.parentNode.insertBefore(b,c),c.parentNode.removeChild(c));for(var b=b.getAttributeNS(odf.Namespaces.officens,"name"),b=m.querySelectorAll('span.webodf-annotationHighlight[annotation="'+b+'"]'),d=c=void 0,c=0;c<b.length;c+=1){for(d=b.item(c);d.firstChild;)d.parentNode.insertBefore(d.firstChild,d);d.parentNode.removeChild(d)}-1!==
a&&q.splice(a,1);0===q.length&&g(!1)}}};gui.Viewport=function(){};gui.Viewport.prototype.scrollIntoView=function(f,k){};
gui.SingleScrollViewport=function(f){this.scrollIntoView=function(k,a){var d,c,g,n;n=f.offsetHeight-f.clientHeight;g=f.offsetWidth-f.clientWidth;var l=f.getBoundingClientRect();if(k&&l){d=l.left+5;c=l.top+5;g=l.right-(g+5);n=l.bottom-(n+5);if(a||k.top<c)f.scrollTop-=c-k.top;else if(k.top>n||k.bottom>n)f.scrollTop=k.bottom-k.top<=n-c?f.scrollTop+(k.bottom-n):f.scrollTop+(k.top-c);k.left<d?f.scrollLeft-=d-k.left:k.right>g&&(f.scrollLeft=k.right-k.left<=g-d?f.scrollLeft+(k.right-g):f.scrollLeft-(d-k.left))}}};
(function(){function f(a,g,n,l,k){var m,p=0,b;for(b in a)if(a.hasOwnProperty(b)){if(p===n){m=b;break}p+=1}m?g.getPartData(a[m].href,function(b,r){if(b)runtime.log(b);else if(r){var h="@font-face { font-family: "+(a[m].family||m)+"; src: url(data:application/x-font-ttf;charset=binary;base64,"+d.convertUTF8ArrayToBase64(r)+') format("truetype"); }';try{l.insertRule(h,l.cssRules.length)}catch(p){runtime.log("Problem inserting rule in CSS: "+runtime.toJson(p)+"\nRule: "+h)}}else runtime.log("missing font data for "+
a[m].href);f(a,g,n+1,l,k)}):k&&k()}var k=xmldom.XPath,a=odf.OdfUtils,d=new core.Base64;odf.FontLoader=function(){this.loadFonts=function(c,d){for(var n=c.rootElement.fontFaceDecls;d.cssRules.length;)d.deleteRule(d.cssRules.length-1);if(n){var l={},q,m,p,b;if(n)for(n=k.getODFElementsWithXPath(n,"style:font-face[svg:font-face-src]",odf.Namespaces.lookupNamespaceURI),q=0;q<n.length;q+=1)m=n[q],p=m.getAttributeNS(odf.Namespaces.stylens,"name"),b=a.getNormalizedFontFamilyName(m.getAttributeNS(odf.Namespaces.svgns,
"font-family")),m=k.getODFElementsWithXPath(m,"svg:font-face-src/svg:font-face-uri",odf.Namespaces.lookupNamespaceURI),0<m.length&&(m=m[0].getAttributeNS(odf.Namespaces.xlinkns,"href"),l[p]={href:m,family:b});f(l,c,0,d)}}}})();
odf.Formatting=function(){function f(b){return(b=E[b])?A.mergeObjects({},b):{}}function k(){for(var a=b.rootElement.fontFaceDecls,c={},e,d,a=a&&a.firstElementChild;a;){if(e=a.getAttributeNS(h,"name"))if((d=a.getAttributeNS(r,"font-family"))||0<a.getElementsByTagNameNS(r,"font-face-uri").length)c[e]=d;a=a.nextElementSibling}return c}function a(a){for(var c=b.rootElement.styles.firstElementChild;c;){if(c.namespaceURI===h&&"default-style"===c.localName&&c.getAttributeNS(h,"family")===a)return c;c=c.nextElementSibling}return null}
function d(a,c,e){var d,f,g;e=e||[b.rootElement.automaticStyles,b.rootElement.styles];for(g=0;g<e.length;g+=1)for(d=e[g],d=d.firstElementChild;d;){f=d.getAttributeNS(h,"name");if(d.namespaceURI===h&&"style"===d.localName&&d.getAttributeNS(h,"family")===c&&f===a||"list-style"===c&&d.namespaceURI===u&&"list-style"===d.localName&&f===a||"data"===c&&d.namespaceURI===x&&f===a)return d;d=d.nextElementSibling}return null}function c(b){for(var a,c,e,d,f={},g=b.firstElementChild;g;){if(g.namespaceURI===h)for(e=
f[g.nodeName]={},c=g.attributes,a=0;a<c.length;a+=1)d=c.item(a),e[d.name]=d.value;g=g.nextElementSibling}c=b.attributes;for(a=0;a<c.length;a+=1)d=c.item(a),f[d.name]=d.value;return f}function g(e,g){for(var l=b.rootElement.styles,r,m={},t=e.getAttributeNS(h,"family"),y=e;y;)r=c(y),m=A.mergeObjects(r,m),y=(r=y.getAttributeNS(h,"parent-style-name"))?d(r,t,[l]):null;if(y=a(t))r=c(y),m=A.mergeObjects(r,m);!1!==g&&(r=f(t),m=A.mergeObjects(r,m));return m}function n(b,a){function c(b){Object.keys(b).forEach(function(a){Object.keys(b[a]).forEach(function(b){g+=
"|"+a+":"+b+"|"})})}for(var d=b.nodeType===Node.TEXT_NODE?b.parentNode:b,h,f=[],g="",l=!1;d;)!l&&v.isGroupingElement(d)&&(l=!0),(h=e.determineStylesForNode(d))&&f.push(h),d=d.parentNode;l&&(f.forEach(c),a&&(a[g]=f));return l?f:void 0}function l(a){var c={orderedStyles:[],styleProperties:{}};a.forEach(function(a){Object.keys(a).forEach(function(e){var f=Object.keys(a[e])[0],l={name:f,family:e,displayName:void 0,isCommonStyle:!1},r;(r=d(f,e))?(e=g(r),c.styleProperties=A.mergeObjects(e,c.styleProperties),
l.displayName=r.getAttributeNS(h,"display-name")||void 0,l.isCommonStyle=r.parentNode===b.rootElement.styles):runtime.log("No style element found for '"+f+"' of family '"+e+"'");c.orderedStyles.push(l)})});return c}function q(b,a){var c={},e=[];a||(a={});b.forEach(function(b){n(b,c)});Object.keys(c).forEach(function(b){a[b]||(a[b]=l(c[b]));e.push(a[b])});return e}function m(a){for(var c=b.rootElement.masterStyles.firstElementChild;c&&(c.namespaceURI!==h||"master-page"!==c.localName||c.getAttributeNS(h,
"name")!==a);)c=c.nextElementSibling;return c}function p(b,a){var c;b&&(c=w.convertMeasure(b,"px"));void 0===c&&a&&(c=w.convertMeasure(a,"px"));return c}var b,e=new odf.StyleInfo,r=odf.Namespaces.svgns,h=odf.Namespaces.stylens,u=odf.Namespaces.textns,x=odf.Namespaces.numberns,z=odf.Namespaces.fons,v=odf.OdfUtils,s=core.DomUtils,A=new core.Utils,w=new core.CSSUnits,E={paragraph:{"style:paragraph-properties":{"fo:text-align":"left"}}};this.getSystemDefaultStyleAttributes=f;this.setOdfContainer=function(a){b=
a};this.getFontMap=k;this.getAvailableParagraphStyles=function(){for(var a=b.rootElement.styles,c,e,d=[],a=a&&a.firstElementChild;a;)"style"===a.localName&&a.namespaceURI===h&&(c=a.getAttributeNS(h,"family"),"paragraph"===c&&(c=a.getAttributeNS(h,"name"),e=a.getAttributeNS(h,"display-name")||c,c&&e&&d.push({name:c,displayName:e}))),a=a.nextElementSibling;return d};this.isStyleUsed=function(a){var c,d=b.rootElement;c=e.hasDerivedStyles(d,odf.Namespaces.lookupNamespaceURI,a);a=(new e.UsedStyleList(d.styles)).uses(a)||
(new e.UsedStyleList(d.automaticStyles)).uses(a)||(new e.UsedStyleList(d.body)).uses(a);return c||a};this.getDefaultStyleElement=a;this.getStyleElement=d;this.getStyleAttributes=c;this.getInheritedStyleAttributes=g;this.getFirstCommonParentStyleNameOrSelf=function(a){var c=b.rootElement.styles,e;if(e=d(a,"paragraph",[b.rootElement.automaticStyles]))if(a=e.getAttributeNS(h,"parent-style-name"),!a)return null;return(e=d(a,"paragraph",[c]))?a:null};this.hasParagraphStyle=function(b){return Boolean(d(b,
"paragraph"))};this.getAppliedStyles=q;this.getAppliedStylesForElement=function(b,a){return q([b],a)[0]};this.updateStyle=function(a,c){var e,d;s.mapObjOntoNode(a,c,odf.Namespaces.lookupNamespaceURI);(e=(e=c["style:text-properties"])&&e["style:font-name"])&&!k().hasOwnProperty(e)&&(d=a.ownerDocument.createElementNS(h,"style:font-face"),d.setAttributeNS(h,"style:name",e),d.setAttributeNS(r,"svg:font-family",e),b.rootElement.fontFaceDecls.appendChild(d))};this.createDerivedStyleObject=function(a,e,
h){var f=d(a,e);runtime.assert(Boolean(f),"No style element found for '"+a+"' of family '"+e+"'");a=f.parentNode===b.rootElement.styles?{"style:parent-style-name":a}:c(f);a["style:family"]=e;A.mergeObjects(a,h);return a};this.getDefaultTabStopDistance=function(){for(var b=a("paragraph"),b=b&&b.firstElementChild,c;b;)b.namespaceURI===h&&"paragraph-properties"===b.localName&&(c=b.getAttributeNS(h,"tab-stop-distance")),b=b.nextElementSibling;c||(c="1.25cm");return v.parseNonNegativeLength(c)};this.getMasterPageElement=
m;this.getContentSize=function(a,c){var e,f,g,l,r,n,k,q,u,x;a:{f=d(a,c);runtime.assert("paragraph"===c||"table"===c,"styleFamily must be either paragraph or table");if(f){if(f=f.getAttributeNS(h,"master-page-name"))(e=m(f))||runtime.log("WARN: No master page definition found for "+f);e||(e=m("Standard"));e||(e=b.rootElement.masterStyles.getElementsByTagNameNS(h,"master-page")[0])||runtime.log("WARN: Document has no master pages defined");if(e)for(f=e.getAttributeNS(h,"page-layout-name"),g=b.rootElement.automaticStyles.getElementsByTagNameNS(h,
"page-layout"),l=0;l<g.length;l+=1)if(e=g.item(l),e.getAttributeNS(h,"name")===f)break a}e=null}e||(e=s.getDirectChild(b.rootElement.styles,h,"default-page-layout"));(e=s.getDirectChild(e,h,"page-layout-properties"))?("landscape"===e.getAttributeNS(h,"print-orientation")?(f="29.7cm",g="21.001cm"):(f="21.001cm",g="29.7cm"),f=p(e.getAttributeNS(z,"page-width"),f),g=p(e.getAttributeNS(z,"page-height"),g),l=p(e.getAttributeNS(z,"margin")),void 0===l?(l=p(e.getAttributeNS(z,"margin-left"),"2cm"),r=p(e.getAttributeNS(z,
"margin-right"),"2cm"),n=p(e.getAttributeNS(z,"margin-top"),"2cm"),k=p(e.getAttributeNS(z,"margin-bottom"),"2cm")):l=r=n=k=l,q=p(e.getAttributeNS(z,"padding")),void 0===q?(q=p(e.getAttributeNS(z,"padding-left"),"0cm"),u=p(e.getAttributeNS(z,"padding-right"),"0cm"),x=p(e.getAttributeNS(z,"padding-top"),"0cm"),e=p(e.getAttributeNS(z,"padding-bottom"),"0cm")):q=u=x=e=q):(f=p("21.001cm"),g=p("29.7cm"),l=r=n=k=l=p("2cm"),q=u=x=e=q=p("0cm"));return{width:f-l-r-q-u,height:g-n-k-x-e}}};odf.Formatting.StyleMetadata;
odf.Formatting.StyleData;odf.Formatting.AppliedStyle;
(function(){var f=odf.Namespaces.stylens,k=odf.Namespaces.textns,a={graphic:"draw","drawing-page":"draw",paragraph:"text",presentation:"presentation",ruby:"text",section:"text",table:"table","table-cell":"table","table-column":"table","table-row":"table",text:"text",list:"text",page:"office"};odf.StyleTreeNode=function(a){this.derivedStyles={};this.element=a};odf.StyleTree=function(d,c){function g(a){var b,c,d,h={};if(!a)return h;for(a=a.firstElementChild;a;){if(c=a.namespaceURI!==f||"style"!==a.localName&&
"default-style"!==a.localName?a.namespaceURI===k&&"list-style"===a.localName?"list":a.namespaceURI!==f||"page-layout"!==a.localName&&"default-page-layout"!==a.localName?void 0:"page":a.getAttributeNS(f,"family"))(b=a.getAttributeNS(f,"name"))||(b=""),h.hasOwnProperty(c)?d=h[c]:h[c]=d={},d[b]=a;a=a.nextElementSibling}return h}function n(a,b){if(a.hasOwnProperty(b))return a[b];var c=null,d=Object.keys(a),h;for(h=0;h<d.length&&!(c=n(a[d[h]].derivedStyles,b));h+=1);return c}function l(a,b,c){var d,h,
g;if(!b.hasOwnProperty(a))return null;d=new odf.StyleTreeNode(b[a]);h=d.element.getAttributeNS(f,"parent-style-name");g=null;h&&(g=n(c,h)||l(h,b,c));g?g.derivedStyles[a]=d:c[a]=d;delete b[a];return d}function q(a,b){a&&Object.keys(a).forEach(function(c){l(c,a,b)})}var m={};this.getStyleTree=function(){return m};(function(){var f,b,e;b=g(d);e=g(c);Object.keys(a).forEach(function(a){f=m[a]={};q(b[a],f);q(e[a],f)})})()}})();odf.StyleTree.Tree;
(function(){function f(a,c){try{a.insertRule(c,a.cssRules.length)}catch(d){runtime.log("cannot load rule: "+c+" - "+d)}}function k(a,c){this.listCounterCount=0;this.contentRules=a;this.counterIdStack=[];this.continuedCounterIdStack=c}function a(a){function c(e,d,l,n){var k=d.namespaceURI===g&&"list"===d.localName,p=d.namespaceURI===g&&"list-item"===d.localName;if(k||p){if(k){var k=l+=1,s,A,w;n.listCounterCount+=1;p=e+"-level"+k+"-"+n.listCounterCount;d.setAttributeNS("urn:webodf:names:helper","counter-id",
p);s=n.continuedCounterIdStack.shift();s||(s=p,b+=p+" 1 ",A='text|list[webodfhelper|counter-id="'+p+'"] > text|list-item:first-child > :not(text|list):first-child:before',A+="{",A+="counter-increment: "+s+" 0;",A+="}",f(a,A));for(;n.counterIdStack.length>=k;)n.counterIdStack.pop();n.counterIdStack.push(s);w=n.contentRules[k.toString()]||"";for(A=1;A<=k;A+=1)w=w.replace(A+"webodf-listLevel",n.counterIdStack[A-1]);A='text|list[webodfhelper|counter-id="'+p+'"] > text|list-item > :not(text|list):first-child:before';
A+="{";A+=w;A+="counter-increment: "+s+";";A+="}";f(a,A)}for(d=d.firstElementChild;d;)c(e,d,l,n),d=d.nextElementSibling}else n.continuedCounterIdStack=[]}var d=0,b="",e={};this.createCounterRules=function(b,a,f){var g=a.getAttributeNS(n,"id"),l=[];f&&(f=f.getAttributeNS("urn:webodf:names:helper","counter-id"),l=e[f].slice(0));b=new k(b,l);g?g="Y"+g:(d+=1,g="X"+d);c(g,a,0,b);e[g+"-level1-1"]=b.counterIdStack};this.initialiseCreatedCounters=function(){var c;c="office|document{"+("counter-reset: "+b+
";");c+="}";f(a,c)}}var d=odf.Namespaces.fons,c=odf.Namespaces.stylens,g=odf.Namespaces.textns,n=odf.Namespaces.xmlns,l={1:"decimal",a:"lower-latin",A:"upper-latin",i:"lower-roman",I:"upper-roman"};odf.ListStyleToCss=function(){function k(b){var a=r.parseLength(b);return a?e.convert(a.value,a.unit,"px"):(runtime.log("Could not parse value '"+b+"'."),0)}function m(b){return b.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function p(b,a){var c;b&&(c=b.getAttributeNS(g,"style-name"));return c===a}function b(b,
e,d){e=e.getElementsByTagNameNS(g,"list");b=new a(b);var f,r,k,q,w,E,N={},I;for(I=0;I<e.length;I+=1)if(f=e.item(I),E=f.getAttributeNS(g,"style-name")){k=f.getAttributeNS(g,"continue-numbering");q=f.getAttributeNS(g,"continue-list");(w=f.getAttributeNS(n,"id"))&&(N[w]=f);w=d[E].element.firstElementChild;for(var G=void 0,F={};w;){var G=(G=w.getAttributeNS(g,"level"))&&parseInt(G,10),K=w,t="",y=void 0,D=void 0,U=y=void 0;if("list-level-style-number"===K.localName){var t=K.getAttributeNS(c,"num-format"),
y=K.getAttributeNS(c,"num-suffix")||"",D=K.getAttributeNS(c,"num-prefix")||"",B="",C=K.getAttributeNS(g,"level"),O=K.getAttributeNS(g,"display-levels");D&&(B+='"'+m(D)+'"\n');if(l.hasOwnProperty(t))for(C=C?parseInt(C,10):1,O=O?parseInt(O,10):1;0<O;)B+=" counter("+(C-O+1)+"webodf-listLevel,"+l[t]+")",1<O&&(B+='"."'),O-=1;else B=t?B+(' "'+t+'"'):B+' ""';t="content:"+B+' "'+m(y)+'"'}else"list-level-style-image"===K.localName?t="content: none":"list-level-style-bullet"===K.localName&&(t=K.getAttributeNS(g,
"bullet-char"),t='content: "'+m(t)+'"');if(y=K.getElementsByTagNameNS(c,"list-level-properties")[0])D=y.getAttributeNS(g,"list-level-position-and-space-mode"),"label-alignment"===D&&((y=y.getElementsByTagNameNS(c,"list-level-label-alignment")[0])&&(U=y.getAttributeNS(g,"label-followed-by")),"space"===U&&(t+=' "\\a0"'));F[G]="\n"+t+";\n";w=w.nextElementSibling}w=F;k&&!q&&p(r,E)?b.createCounterRules(w,f,r):q&&p(N[q],E)?b.createCounterRules(w,f,N[q]):b.createCounterRules(w,f);r=f}b.initialiseCreatedCounters()}
var e=new core.CSSUnits,r=odf.OdfUtils;this.applyListStyles=function(a,e,l){var r,m;(r=e.list)&&Object.keys(r).forEach(function(b){m=r[b];for(var e=m.element.firstElementChild;e;){if(e.namespaceURI===g){for(var l=a,n=e,p='text|list[text|style-name="'+b+'"]',u=n.getAttributeNS(g,"level"),x=void 0,F=void 0,K=F=void 0,t=void 0,y=void 0,D=x=void 0,U=void 0,B=void 0,C=void 0,t=void 0,K=(F=n.getElementsByTagNameNS(c,"list-level-properties")[0])&&F.getAttributeNS(g,"list-level-position-and-space-mode"),
t=F&&F.getElementsByTagNameNS(c,"list-level-label-alignment")[0],x=u=u&&parseInt(u,10);1<x;)p+=" > text|list-item > text|list",x-=1;x=F&&F.getAttributeNS(d,"text-align")||"left";switch(x){case "end":x="right";break;case "start":x="left"}"label-alignment"===K?(y=t&&t.getAttributeNS(d,"margin-left")||"0px",B=t&&t.getAttributeNS(d,"text-indent")||"0px",C=t&&t.getAttributeNS(g,"label-followed-by"),t=k(y)):(y=F&&F.getAttributeNS(g,"space-before")||"0px",D=F&&F.getAttributeNS(g,"min-label-width")||"0px",
U=F&&F.getAttributeNS(g,"min-label-distance")||"0px",t=k(y)+k(D));F=p+" > text|list-item";F+="{";F+="margin-left: "+t+"px;";F+="}";f(l,F);F=p+" > text|list-item > text|list";F+="{";F+="margin-left: "+-t+"px;";F+="}";f(l,F);F=p+" > text|list-item > :not(text|list):first-child:before";F+="{";F+="text-align: "+x+";";F+="display: inline-block;";"label-alignment"===K?(F+="margin-left: "+B+";","listtab"===C&&(F+="padding-right: 0.2cm;")):(F+="min-width: "+D+";",F+="margin-left: "+(0===parseFloat(D)?"":
"-")+D+";",F+="padding-right: "+U+";");F+="}";f(l,F)}e=e.nextElementSibling}});b(a,l,r)}}})();odf.LazyStyleProperties=function(f,k){var a={};this.value=function(d){var c;a.hasOwnProperty(d)?c=a[d]:(c=k[d](),void 0===c&&f&&(c=f.value(d)),a[d]=c);return c};this.reset=function(d){f=d;a={}}};
odf.StyleParseUtils=function(){function f(a){var d,c;a=(a=/(-?[0-9]*[0-9][0-9]*(\.[0-9]*)?|0+\.[0-9]*[1-9][0-9]*|\.[0-9]*[1-9][0-9]*)((cm)|(mm)|(in)|(pt)|(pc)|(px))/.exec(a))?{value:parseFloat(a[1]),unit:a[3]}:null;c=a&&a.unit;"px"===c?d=a.value:"cm"===c?d=a.value/2.54*96:"mm"===c?d=a.value/25.4*96:"in"===c?d=96*a.value:"pt"===c?d=a.value/.75:"pc"===c&&(d=16*a.value);return d}var k=odf.Namespaces.stylens;this.parseLength=f;this.parsePositiveLengthOrPercent=function(a,d,c){var g;a&&(g=parseFloat(a.substr(0,
a.indexOf("%"))),isNaN(g)&&(g=void 0));var n;void 0!==g?(c&&(n=c.value(d)),g=void 0===n?void 0:n/100*g):g=f(a);return g};this.getPropertiesElement=function(a,d,c){for(d=c?c.nextElementSibling:d.firstElementChild;null!==d&&(d.localName!==a||d.namespaceURI!==k);)d=d.nextElementSibling;return d};this.parseAttributeList=function(a){a&&(a=a.replace(/^\s*(.*?)\s*$/g,"$1"));return a&&0<a.length?a.split(/\s+/):[]}};
odf.Style2CSS=function(){function f(b,a,c){var e=[];c=c.derivedStyles;var d;var h=z[b],g;void 0===h?a=null:(g=a?"["+h+'|style-name="'+a+'"]':"","presentation"===h&&(h="draw",g=a?'[presentation|style-name="'+a+'"]':""),a=h+"|"+v[b].join(g+","+h+"|")+g);null!==a&&e.push(a);for(d in c)c.hasOwnProperty(d)&&(a=f(b,d,c[d]),e=e.concat(a));return e}function k(b){var a="",c="",a=null;if("default-style"===b.localName)return null;a=b.getAttributeNS(p,"parent-style-name");c=b.getAttributeNS(p,"family");return a=
ca.getODFElementsWithXPath(O,a?"//style:*[@style:name='"+a+"'][@style:family='"+c+"']":"//style:default-style[@style:family='"+c+"']",odf.Namespaces.lookupNamespaceURI)[0]}function a(b,a){var c="",e,d,h;for(e=0;e<a.length;e+=1)if(d=a[e],h=b.getAttributeNS(d[0],d[1])){h=h.trim();if(y.hasOwnProperty(d[1])){var f=h,g=f.indexOf(" "),l=void 0;h=void 0;-1!==g?(l=f.substring(0,g),h=f.substring(g)):(l=f,h="");(l=B.parseLength(l))&&"pt"===l.unit&&.75>l.value&&(f="0.75pt"+h);h=f}else if(D.hasOwnProperty(d[1])){var f=
b,g=d[0],l=d[1],r=B.parseLength(h),m=void 0,n=void 0,t=void 0,q=void 0,t=void 0;if(r&&"%"===r.unit){m=r.value/100;n=k(f.parentNode);for(q="0";n;){if(t=u.getDirectChild(n,p,"paragraph-properties"))if(t=B.parseLength(t.getAttributeNS(g,l))){if("%"!==t.unit){q=t.value*m+t.unit;break}m*=t.value/100}n=k(n)}h=q}}d[2]&&(c+=d[2]+":"+h+";")}return c}function d(b,a,c,e){return a+a+c+c+e+e}function c(b,a){var e=[b],d=a.derivedStyles;Object.keys(d).forEach(function(b){b=c(b,d[b]);e=e.concat(b)});return e}function g(b,
a,e,d){function f(a,c){var e=[],d;a.forEach(function(b){g.forEach(function(a){e.push("draw|page[webodfhelper|page-style-name='"+a+"'] draw|frame[presentation|class='"+b+"']")})});0<e.length&&(d=e.join(",")+"{visibility:"+c+";}",b.insertRule(d,b.cssRules.length))}var g=c(a,d),l=[],r=[];["page-number","date-time","header","footer"].forEach(function(b){var a;a=e.getAttributeNS(h,"display-"+b);"true"===a?l.push(b):"false"===a&&r.push(b)});f(l,"visible");f(r,"hidden")}function n(b,c,y,D){var v,z;if("page"===
c){var J=D.element,O="",T,Q;Q=T="";y=u.getDirectChild(J,p,"page-layout-properties");var S;if(y)if(S=J.getAttributeNS(p,"name"),O+=a(y,K),(T=u.getDirectChild(y,p,"background-image"))&&(Q=T.getAttributeNS(r,"href"))&&(O=O+("background-image: url('odfkit:"+Q+"');")+a(T,A)),"presentation"===C)for(J=(J=u.getDirectChild(J.parentNode.parentNode,m,"master-styles"))&&J.firstElementChild;J;){if(J.namespaceURI===p&&"master-page"===J.localName&&J.getAttributeNS(p,"page-layout-name")===S){Q=J.getAttributeNS(p,
"name");T="draw|page[draw|master-page-name="+Q+"] {"+O+"}";Q="office|body, draw|page[draw|master-page-name="+Q+"] {"+a(y,t)+" }";try{b.insertRule(T,b.cssRules.length)}catch(ca){}try{b.insertRule(Q,b.cssRules.length)}catch(ha){}}J=J.nextElementSibling}else"text"===C&&(T="office|text {"+O+"}",Q="office|body {width: "+y.getAttributeNS(q,"page-width")+";}",b.insertRule(T,b.cssRules.length),b.insertRule(Q,b.cssRules.length))}else{O=f(c,y,D).join(",");S="";if(J=u.getDirectChild(D.element,p,"text-properties")){var X=
J,$=z="";T="";Q=1;J=""+a(X,s);v=X.getAttributeNS(p,"text-underline-style");"solid"===v&&(z+=" underline");v=X.getAttributeNS(p,"text-line-through-style");"solid"===v&&(z+=" line-through");z.length&&(J=J+("text-decoration:"+z+";\n")+("text-decoration-line:"+z+";\n"),J+="-moz-text-decoration-line:"+z+";\n");v=X.getAttributeNS(p,"text-line-through-type");switch(v){case "double":$+=" double";break;case "single":$+=" single"}$&&(J+="text-decoration-style:"+$+";\n",J+="-moz-text-decoration-style:"+$+";\n");
if(z=X.getAttributeNS(p,"font-name")||X.getAttributeNS(q,"font-family"))v=U[z],J+="font-family: "+(v||z)+";";if(v=X.getAttributeNS(p,"text-position"))z=x.parseAttributeList(v),v=z[0],z=z[1],J+="vertical-align: "+v+"\n; ",z&&(Q=parseFloat(z)/100);X.hasAttributeNS(q,"color")&&(v=X.getAttributeNS(q,"color"),v=(v||"").toLowerCase(),"#ffffff"==v||"white"==v||"ffffff"==v||"#fff"==v||"fff"==v)&&(J+="color: #D8D8D8;");if(X.hasAttributeNS(q,"font-size")||1!==Q){for(X=X.parentNode;X;){if(v=(v=u.getDirectChild(X,
p,"text-properties"))?B.parseFoFontSize(v.getAttributeNS(q,"font-size")):null){if("%"!==v.unit){T="font-size: "+v.value*Q+v.unit+";";break}Q*=v.value/100}X=k(X)}T||(T="font-size: "+parseFloat(P)*Q+ba.getUnits(P)+";")}J+=T;S+=J}if(J=u.getDirectChild(D.element,p,"paragraph-properties"))T=J,J=""+a(T,w),(Q=u.getDirectChild(T,p,"background-image"))&&(X=Q.getAttributeNS(r,"href"))&&(J=J+("background-image: url('odfkit:"+X+"');")+a(Q,A)),(T=T.getAttributeNS(q,"line-height"))&&"normal"!==T&&(T=B.parseFoLineHeight(T),
J="%"!==T.unit?J+("line-height: "+T.value+T.unit+";"):J+("line-height: "+T.value/100+";")),S+=J;if(J=u.getDirectChild(D.element,p,"graphic-properties"))X=J,J=""+a(X,E),T=X.getAttributeNS(l,"opacity"),Q=X.getAttributeNS(l,"fill"),X=X.getAttributeNS(l,"fill-color"),"solid"===Q||"hatch"===Q?X&&"none"!==X?(T=isNaN(parseFloat(T))?1:parseFloat(T)/100,Q=X.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,d),(X=(Q=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(Q))?{r:parseInt(Q[1],16),g:parseInt(Q[2],16),b:parseInt(Q[3],
16)}:null)&&(J+="background-color: rgba("+X.r+","+X.g+","+X.b+","+T+");")):J+="background: none;":"none"===Q&&(J+="background: none;"),S+=J;if(J=u.getDirectChild(D.element,p,"drawing-page-properties"))T=J,Q=""+a(T,E),"true"===T.getAttributeNS(h,"background-visible")&&(Q+="background: none;"),S+=Q,g(b,y,J,D);if(J=u.getDirectChild(D.element,p,"table-cell-properties"))y=S,S=""+a(J,N),S=y+S;if(J=u.getDirectChild(D.element,p,"table-row-properties"))y=S,S=""+a(J,G),S=y+S;if(J=u.getDirectChild(D.element,
p,"table-column-properties"))y=S,S=""+a(J,I),S=y+S;if(J=u.getDirectChild(D.element,p,"table-properties"))y=S,S=""+a(J,F),J=J.getAttributeNS(e,"border-model"),"collapsing"===J?S+="border-collapse:collapse;":"separating"===J&&(S+="border-collapse:separate;"),S=y+S;0!==S.length&&b.insertRule(O+"{"+S+"}",b.cssRules.length)}for(var ea in D.derivedStyles)D.derivedStyles.hasOwnProperty(ea)&&n(b,c,ea,D.derivedStyles[ea])}var l=odf.Namespaces.drawns,q=odf.Namespaces.fons,m=odf.Namespaces.officens,p=odf.Namespaces.stylens,
b=odf.Namespaces.svgns,e=odf.Namespaces.tablens,r=odf.Namespaces.xlinkns,h=odf.Namespaces.presentationns,u=core.DomUtils,x=new odf.StyleParseUtils,z={graphic:"draw","drawing-page":"draw",paragraph:"text",presentation:"presentation",ruby:"text",section:"text",table:"table","table-cell":"table","table-column":"table","table-row":"table",text:"text",list:"text",page:"office"},v={graphic:"circle connected control custom-shape ellipse frame g line measure page page-thumbnail path polygon polyline rect regular-polygon".split(" "),
paragraph:"alphabetical-index-entry-template h illustration-index-entry-template index-source-style object-index-entry-template p table-index-entry-template table-of-content-entry-template user-index-entry-template".split(" "),presentation:"caption circle connector control custom-shape ellipse frame g line measure page-thumbnail path polygon polyline rect regular-polygon".split(" "),"drawing-page":"caption circle connector control page custom-shape ellipse frame g line measure page-thumbnail path polygon polyline rect regular-polygon".split(" "),
ruby:["ruby","ruby-text"],section:"alphabetical-index bibliography illustration-index index-title object-index section table-of-content table-index user-index".split(" "),table:["background","table"],"table-cell":"body covered-table-cell even-columns even-rows first-column first-row last-column last-row odd-columns odd-rows table-cell".split(" "),"table-column":["table-column"],"table-row":["table-row"],text:"a index-entry-chapter index-entry-link-end index-entry-link-start index-entry-page-number index-entry-span index-entry-tab-stop index-entry-text index-title-template linenumbering-configuration list-level-style-number list-level-style-bullet outline-level-style span".split(" "),
list:["list-item"]},s=[[q,"color","color"],[q,"background-color","background-color"],[q,"font-weight","font-weight"],[q,"font-style","font-style"]],A=[[p,"repeat","background-repeat"]],w=[[q,"background-color","background-color"],[q,"text-align","text-align"],[q,"text-indent","text-indent"],[q,"padding","padding"],[q,"padding-left","padding-left"],[q,"padding-right","padding-right"],[q,"padding-top","padding-top"],[q,"padding-bottom","padding-bottom"],[q,"border-left","border-left"],[q,"border-right",
"border-right"],[q,"border-top","border-top"],[q,"border-bottom","border-bottom"],[q,"margin","margin"],[q,"margin-left","margin-left"],[q,"margin-right","margin-right"],[q,"margin-top","margin-top"],[q,"margin-bottom","margin-bottom"],[q,"border","border"]],E=[[q,"background-color","background-color"],[q,"min-height","min-height"],[l,"stroke","border"],[b,"stroke-color","border-color"],[b,"stroke-width","border-width"],[q,"border","border"],[q,"border-left","border-left"],[q,"border-right","border-right"],
[q,"border-top","border-top"],[q,"border-bottom","border-bottom"]],N=[[q,"background-color","background-color"],[q,"border-left","border-left"],[q,"border-right","border-right"],[q,"border-top","border-top"],[q,"border-bottom","border-bottom"],[q,"border","border"]],I=[[p,"column-width","width"]],G=[[p,"row-height","height"],[q,"keep-together",null]],F=[[p,"width","width"],[q,"margin-left","margin-left"],[q,"margin-right","margin-right"],[q,"margin-top","margin-top"],[q,"margin-bottom","margin-bottom"]],
K=[[q,"background-color","background-color"],[q,"padding","padding"],[q,"padding-left","padding-left"],[q,"padding-right","padding-right"],[q,"padding-top","padding-top"],[q,"padding-bottom","padding-bottom"],[q,"border","border"],[q,"border-left","border-left"],[q,"border-right","border-right"],[q,"border-top","border-top"],[q,"border-bottom","border-bottom"],[q,"margin","margin"],[q,"margin-left","margin-left"],[q,"margin-right","margin-right"],[q,"margin-top","margin-top"],[q,"margin-bottom","margin-bottom"]],
t=[[q,"page-width","width"],[q,"page-height","height"]],y={border:!0,"border-left":!0,"border-right":!0,"border-top":!0,"border-bottom":!0,"stroke-width":!0},D={margin:!0,"margin-left":!0,"margin-right":!0,"margin-top":!0,"margin-bottom":!0},U={},B=odf.OdfUtils,C,O,P,ca=xmldom.XPath,ba=new core.CSSUnits;this.style2css=function(b,a,c,e,d){function h(b,a){f="@namespace "+b+" url("+a+");";try{c.insertRule(f,c.cssRules.length)}catch(e){}}var f,g,l;for(O=a;c.cssRules.length;)c.deleteRule(c.cssRules.length-
1);odf.Namespaces.forEachPrefix(h);h("webodfhelper","urn:webodf:names:helper");U=e;C=b;P=runtime.getWindow().getComputedStyle(document.body,null).getPropertyValue("font-size")||"12pt";b=0;a=50;window.location.hash&&(e=(window.location.hash.split(".").pop()||"").toLowerCase(),"odp"==e||"ods"==e)&&(a=2E3);for(l in z)if(z.hasOwnProperty(l))for(g in e=d[l],e)if(e.hasOwnProperty(g)){b++;if(b>a){b=0;break}n(c,l,g,e[g])}}};
(function(){function f(k,a){var d=this;this.getDistance=function(a){var f=d.x-a.x;a=d.y-a.y;return Math.sqrt(f*f+a*a)};this.getCenter=function(a){return new f((d.x+a.x)/2,(d.y+a.y)/2)};this.x;this.y;d.x=k;d.y=a}gui.ZoomHelper=function(){function k(b,a,c,d){b=d?"translate3d("+b+"px, "+a+"px, 0) scale3d("+c+", "+c+", 1)":"translate("+b+"px, "+a+"px) scale("+c+")";e.style.WebkitTransform=b;e.style.MozTransform=b;e.style.msTransform=b;e.style.OTransform=b;e.style.transform=b}function a(b){b?k(-r.x,-r.y,
x,!0):(k(0,0,x,!0),k(0,0,x,!1))}function d(b){if(v&&N){var a=v.style.overflow,c=v.classList.contains("webodf-customScrollbars");b&&c||!b&&!c||(b?(v.classList.add("webodf-customScrollbars"),v.style.overflow="hidden",runtime.requestAnimationFrame(function(){v.style.overflow=a})):v.classList.remove("webodf-customScrollbars"))}}function c(){k(-r.x,-r.y,x,!0);v.scrollLeft=0;v.scrollTop=0;I=s.style.overflow;s.style.overflow="visible";d(!1)}function g(){k(0,0,x,!0);v.scrollLeft=r.x;v.scrollTop=r.y;s.style.overflow=
I||"";d(!0)}function n(b){return new f(b.pageX-e.offsetLeft,b.pageY-e.offsetTop)}function l(b){if(h){r.x-=b.x-h.x;r.y-=b.y-h.y;var a=r;r=new f(Math.min(Math.max(a.x,e.offsetLeft),(e.offsetLeft+e.offsetWidth)*x-v.clientWidth),Math.min(Math.max(a.y,e.offsetTop),(e.offsetTop+e.offsetHeight)*x-v.clientHeight))}h=b}function q(b){var a=b.touches.length,e=0<a?n(b.touches[0]):null;b=1<a?n(b.touches[1]):null;e&&b?(u=e.getDistance(b),z=x,h=e.getCenter(b),c(),E=w.PINCH):e&&(h=e,E=w.SCROLL)}function m(b){var d=
b.touches.length,h=0<d?n(b.touches[0]):null,d=1<d?n(b.touches[1]):null;if(h&&d)if(b.preventDefault(),E===w.SCROLL)E=w.PINCH,c(),u=h.getDistance(d);else{b=h.getCenter(d);h=h.getDistance(d)/u;l(b);var d=x,f=Math.min(4,e.offsetParent.clientWidth/e.offsetWidth);x=z*h;x=Math.min(Math.max(x,f),4);h=x/d;r.x+=(h-1)*(b.x+r.x);r.y+=(h-1)*(b.y+r.y);a(!0)}else h&&(E===w.PINCH?(E=w.SCROLL,g()):l(h))}function p(){E===w.PINCH&&(A.emit(gui.ZoomHelper.signalZoomChanged,x),g(),a(!1));E=w.NONE}function b(){v&&(v.removeEventListener("touchstart",
q,!1),v.removeEventListener("touchmove",m,!1),v.removeEventListener("touchend",p,!1))}var e,r,h,u,x,z,v,s,A=new core.EventNotifier([gui.ZoomHelper.signalZoomChanged]),w={NONE:0,SCROLL:1,PINCH:2},E=w.NONE,N=runtime.getWindow().hasOwnProperty("ontouchstart"),I="";this.subscribe=function(b,a){A.subscribe(b,a)};this.unsubscribe=function(b,a){A.unsubscribe(b,a)};this.getZoomLevel=function(){return x};this.setZoomLevel=function(b){e&&(x=b,a(!1),A.emit(gui.ZoomHelper.signalZoomChanged,x))};this.destroy=
function(a){b();d(!1);a()};this.setZoomableElement=function(c){b();e=c;v=e.offsetParent;s=e.parentNode;a(!1);v&&(v.addEventListener("touchstart",q,!1),v.addEventListener("touchmove",m,!1),v.addEventListener("touchend",p,!1));d(!0)};z=x=1;r=new f(0,0)};gui.ZoomHelper.signalZoomChanged="zoomChanged"})();ops.Canvas=function(){};ops.Canvas.prototype.getZoomLevel=function(){};ops.Canvas.prototype.getElement=function(){};ops.Canvas.prototype.getSizer=function(){};ops.Canvas.prototype.getZoomHelper=function(){};
(function(){function f(){function b(e){c=!0;runtime.setTimeout(function(){try{e()}catch(d){runtime.log(String(d)+"\n"+d.stack)}c=!1;0<a.length&&b(a.pop())},10)}var a=[],c=!1;this.clearQueue=function(){a.length=0};this.addToQueue=function(e){if(0===a.length&&!c)return b(e);a.push(e)}}function k(b){function a(){for(;0<c.cssRules.length;)c.deleteRule(0);c.insertRule("#shadowContent draw|page {display:none;}",0);c.insertRule("office|presentation draw|page {display:none;}",1);c.insertRule("#shadowContent draw|page:nth-of-type("+
e+") {display:block;}",2);c.insertRule("office|presentation draw|page:nth-of-type("+e+") {display:block;}",3)}var c=b.sheet,e=1;this.showFirstPage=function(){e=1;a()};this.showNextPage=function(){e+=1;a()};this.showPreviousPage=function(){1<e&&(e-=1,a())};this.showPage=function(b){0<b&&(e=b,a())};this.css=b;this.destroy=function(a){b.parentNode.removeChild(b);a()}}function a(b){for(;b.firstChild;)b.removeChild(b.firstChild)}function d(b){b=b.sheet;for(var a=b.cssRules;a.length;)b.deleteRule(a.length-
1)}function c(b,a,c){var e=new odf.Style2CSS,d=new odf.ListStyleToCss;c=c.sheet;var h=(new odf.StyleTree(b.rootElement.styles,b.rootElement.automaticStyles)).getStyleTree();e.style2css(b.getDocumentType(),b.rootElement,c,a.getFontMap(),h);d.applyListStyles(c,h,b.rootElement.body)}function g(b,a){(new odf.FontLoader).loadFonts(b,a.sheet)}function n(b,a,c){var e=null;b=b.rootElement.body.getElementsByTagNameNS(F,c+"-decl");c=a.getAttributeNS(F,"use-"+c+"-name");var d;if(c&&0<b.length)for(a=0;a<b.length;a+=
1)if(d=b[a],d.getAttributeNS(F,"name")===c){e=d.textContent;break}return e}function l(b,c,e,d){var h=b.ownerDocument;c=t.getElementsByTagNameNS(b,c,e);for(b=0;b<c.length;b+=1)a(c[b]),d&&(e=c[b],e.appendChild(h.createTextNode(d)))}function q(b,a,c){a.setAttributeNS("urn:webodf:names:helper","styleid",b);var e,d=a.getAttributeNS(I,"anchor-type"),h=a.getAttributeNS(E,"x"),f=a.getAttributeNS(E,"y"),g=a.getAttributeNS(E,"width"),l=a.getAttributeNS(E,"height"),r=a.getAttributeNS(s,"min-height"),m=a.getAttributeNS(s,
"min-width");if("as-char"===d||"char"===d||"paragraph"===d)e="display: inline-block;";else if(d||h||f)e="position: absolute;";else if(g||l||r||m)e="display: block;";h&&(e+="left: "+h+";");f&&(e+="top: "+f+";");g&&(e+="width: "+g+";");l&&(e+="height: "+l+";");r&&(e+="min-height: "+r+";");m&&(e+="min-width: "+m+";");e&&(e="draw|"+a.localName+'[webodfhelper|styleid="'+b+'"] {'+e+"}",c.insertRule(e,c.cssRules.length))}function m(b){for(b=b.firstChild;b;){if(b.namespaceURI===A&&"binary-data"===b.localName)return"data:image/png;base64,"+
b.textContent.replace(/[\r\n\s]/g,"");b=b.nextSibling}return""}function p(b,a,c,e){function d(a){a&&(a='draw|image[webodfhelper|styleid="'+b+'"] {'+("background-image: url("+a+");")+"}",e.insertRule(a,e.cssRules.length))}function h(b){d(b.url)}c.setAttributeNS("urn:webodf:names:helper","styleid",b);var f=c.getAttributeNS(G,"href"),g;if(f)try{g=a.getPart(f),g.onchange=h,g.load()}catch(l){runtime.log("slight problem: "+String(l))}else f=m(c),d(f)}function b(b){var a=b.ownerDocument;t.getElementsByTagNameNS(b,
I,"line-break").forEach(function(b){b.hasChildNodes()||b.appendChild(a.createElement("br"))})}function e(b){var a=b.ownerDocument;t.getElementsByTagNameNS(b,I,"s").forEach(function(b){for(var c,e;b.firstChild;)b.removeChild(b.firstChild);b.appendChild(a.createTextNode(" "));e=parseInt(b.getAttributeNS(I,"c"),10);if(1<e)for(b.removeAttributeNS(I,"c"),c=1;c<e;c+=1)b.parentNode.insertBefore(b.cloneNode(!0),b)})}function r(b){t.getElementsByTagNameNS(b,I,"tab").forEach(function(b){b.textContent="\t"})}
function h(b,a){function c(b,e){var f=g.documentElement.namespaceURI;"video/"===e.substr(0,6)?(d=g.createElementNS(f,"video"),d.setAttribute("controls","controls"),h=g.createElementNS(f,"source"),b&&h.setAttribute("src",b),h.setAttribute("type",e),d.appendChild(h),a.parentNode.appendChild(d)):a.innerHtml="Unrecognised Plugin"}function e(b){c(b.url,b.mimetype)}var d,h,f,g=a.ownerDocument,l;if(f=a.getAttributeNS(G,"href"))try{l=b.getPart(f),l.onchange=e,l.load()}catch(r){runtime.log("slight problem: "+
String(r))}else runtime.log("using MP4 data fallback"),f=m(a),c(f,"video/mp4")}function u(b){var a=b.getElementsByTagName("head")[0],c,e;c=b.styleSheets.length;for(e=a.firstElementChild;e&&("style"!==e.localName||!e.hasAttribute("webodfcss"));)e=e.nextElementSibling;if(e)return c=parseInt(e.getAttribute("webodfcss"),10),e.setAttribute("webodfcss",c+1),e;"string"===String(typeof webodf_css)?c=webodf_css:(e="webodf.css",runtime.currentDirectory&&(e=runtime.currentDirectory(),0<e.length&&"/"!==e.substr(-1)&&
(e+="/"),e+="../webodf.css"),c=runtime.readFileSync(e,"utf-8"));e=b.createElementNS(a.namespaceURI,"style");e.setAttribute("media","screen, print, handheld, projection");e.setAttribute("type","text/css");e.setAttribute("webodfcss","1");e.appendChild(b.createTextNode(c));a.appendChild(e);return e}function x(b){var a=parseInt(b.getAttribute("webodfcss"),10);1===a?b.parentNode.removeChild(b):b.setAttribute("count",a-1)}function z(b){var a=b.getElementsByTagName("head")[0],c=b.createElementNS(a.namespaceURI,
"style"),e="";c.setAttribute("type","text/css");c.setAttribute("media","screen, print, handheld, projection");odf.Namespaces.forEachPrefix(function(b,a){e+="@namespace "+b+" url("+a+");\n"});e+="@namespace webodfhelper url(urn:webodf:names:helper);\n";c.appendChild(b.createTextNode(e));a.appendChild(c);return c}var v=odf.Namespaces.drawns,s=odf.Namespaces.fons,A=odf.Namespaces.officens,w=odf.Namespaces.stylens,E=odf.Namespaces.svgns,N=odf.Namespaces.tablens,I=odf.Namespaces.textns,G=odf.Namespaces.xlinkns,
F=odf.Namespaces.presentationns,K=xmldom.XPath,t=core.DomUtils;odf.OdfCanvas=function(m,D){function s(b,a,c){function e(b,a,c,d){ma.addToQueue(function(){p(b,a,c,d)})}var d,h;d=a.getElementsByTagNameNS(v,"image");for(a=0;a<d.length;a+=1)h=d.item(a),e("image"+String(a),b,h,c)}function B(b,a){function c(b,a){ma.addToQueue(function(){h(b,a)})}var e,d,f;d=a.getElementsByTagNameNS(v,"plugin");for(e=0;e<d.length;e+=1)f=d.item(e),c(b,f)}function C(){var b;b=Z.firstChild;var a=fa.getZoomLevel();b&&(Z.style.WebkitTransformOrigin=
"0% 0%",Z.style.MozTransformOrigin="0% 0%",Z.style.msTransformOrigin="0% 0%",Z.style.OTransformOrigin="0% 0%",Z.style.transformOrigin="0% 0%",Q&&((b=Q.getMinimumHeightForAnnotationPane())?Z.style.minHeight=b:Z.style.removeProperty("min-height")),m.style.width=Math.round(a*Z.offsetWidth)+"px",m.style.height=Math.round(a*Z.offsetHeight)+"px",m.style.display="inline-block")}function G(c,d){var h=X.sheet;a(m);Z=W.createElementNS(m.namespaceURI,"div");Z.style.display="inline-block";Z.style.background=
"white";Z.style.setProperty("float","left","important");Z.appendChild(d);m.appendChild(Z);J=W.createElementNS(m.namespaceURI,"div");J.id="annotationsPane";$=W.createElementNS(m.namespaceURI,"div");$.id="shadowContent";$.style.position="absolute";$.style.top=0;$.style.left=0;c.getContentElement().appendChild($);var f=d.body,g,k=[],p;for(g=f.firstElementChild;g&&g!==f;)if(g.namespaceURI===v&&(k[k.length]=g),g.firstElementChild)g=g.firstElementChild;else{for(;g&&g!==f&&!g.nextElementSibling;)g=g.parentNode;
g&&g.nextElementSibling&&(g=g.nextElementSibling)}for(p=0;p<k.length;p+=1)g=k[p],q("frame"+String(p),g,h);k=K.getODFElementsWithXPath(f,".//*[*[@text:anchor-type='paragraph']]",odf.Namespaces.lookupNamespaceURI);for(g=0;g<k.length;g+=1)f=k[g],f.setAttributeNS&&f.setAttributeNS("urn:webodf:names:helper","containsparagraphanchor",!0);f=Y;g=$;var u,x,D,z,C=0,E;p=c.rootElement.ownerDocument;if((k=d.body.firstElementChild)&&k.namespaceURI===A&&("presentation"===k.localName||"drawing"===k.localName))for(k=
k.firstElementChild;k;){if(u=(u=k.getAttributeNS(v,"master-page-name"))?f.getMasterPageElement(u):null){x=k.getAttributeNS("urn:webodf:names:helper","styleid");D=p.createElementNS(v,"draw:page");E=u.firstElementChild;for(C=0;E;)"true"!==E.getAttributeNS(F,"placeholder")&&(z=E.cloneNode(!0),D.appendChild(z)),E=E.nextElementSibling,C+=1;E=z=C=void 0;for(var O=t.getElementsByTagNameNS(D,v,"frame"),C=0;C<O.length;C+=1)z=O[C],(E=z.getAttributeNS(F,"class"))&&!/^(date-time|footer|header|page-number)$/.test(E)&&
z.parentNode.removeChild(z);z=t.getElementsByTagNameNS(D,v,"*");for(C=0;C<z.length;C+=1)q(x+"_"+C,z[C],h);g.appendChild(D);C=String(g.getElementsByTagNameNS(v,"page").length);l(D,I,"page-number",C);l(D,F,"header",n(c,k,"header"));l(D,F,"footer",n(c,k,"footer"));q(x,D,h);D.setAttributeNS("urn:webodf:names:helper","page-style-name",k.getAttributeNS(v,"style-name"));D.setAttributeNS(v,"draw:master-page-name",u.getAttributeNS(w,"name"))}k=k.nextElementSibling}f=d.body;p=t.getElementsByTagNameNS(f,N,"table-cell");
for(g=0;g<p.length;g+=1)if(u=p[g],u.hasAttributeNS(N,"number-columns-repeated")&&(x=u.getAttributeNS(N,"number-columns-repeated"),!(100<x)))for(k=1;k<x;k++)u.parentNode.insertBefore(u.cloneNode(!0),u.nextSibling);p=t.getElementsByTagNameNS(f,N,"covered-table-cell");for(g=0;g<p.length;g+=1)if(u=p[g],x=u.hasAttributeNS(N,"number-columns-repeated")?u.getAttributeNS(N,"number-columns-repeated"):1,!(100<x)){for(k=0;k<x;k++)D=document.createElementNS(N,"table:table-cell"),u.parentNode.insertBefore(D,u);
u.parentNode.removeChild(u)}p=t.getElementsByTagNameNS(f,v,"control");for(g=0;g<p.length;g+=1)u=p[g],u.parentNode.removeChild(u);b(d.body);e(d.body);r(d.body);s(c,d.body,h);B(c,d.body);Z.insertBefore($,Z.firstChild);fa.setZoomableElement(Z)}function E(b){aa?(J.parentNode||Z.appendChild(J),Q&&Q.forgetAnnotations(),Q=new gui.AnnotationViewManager(da,b.body,J,T),t.getElementsByTagNameNS(b.body,A,"annotation").forEach(Q.addAnnotation),Q.rerenderAnnotations(),C()):J.parentNode&&(Z.removeChild(J),Q.forgetAnnotations(),
C())}function ca(b){function e(){d(R);d(ha);d(X);a(m);m.style.display="inline-block";var h=H.rootElement;m.ownerDocument.importNode(h,!0);Y.setOdfContainer(H);g(H,R);c(H,Y,ha);G(H,h);E(h);b||ma.addToQueue(function(){var b=[H];if(ea.hasOwnProperty("statereadychange")){var a=ea.statereadychange,c;for(c=0;c<a.length;c+=1)a[c].apply(null,b)}})}H.state===odf.OdfContainer.DONE?e():(runtime.log("WARNING: refreshOdf called but ODF was not DONE."),pa=runtime.setTimeout(function V(){H.state===odf.OdfContainer.DONE?
e():(g_errmsg(),pa=runtime.setTimeout(V,500))},100))}function ba(b){ma.clearQueue();m.innerHTML=runtime.tr("Loading")+"...";m.removeAttribute("style");H=new odf.OdfContainer(b,function(b){H=b;ca(!1)})}runtime.assert(null!==m&&void 0!==m,"odf.OdfCanvas constructor needs DOM element");runtime.assert(null!==m.ownerDocument&&void 0!==m.ownerDocument,"odf.OdfCanvas constructor needs DOM");var da=this,W=m.ownerDocument,H,Y=new odf.Formatting,ga,Z=null,J=null,aa=!1,T=!1,Q=null,S,R,ha,X,$,ea={},pa,ka,ia=
!1,la=!1,ma=new f,fa=new gui.ZoomHelper,ja=D||new gui.SingleScrollViewport(m.parentNode);this.refreshCSS=function(){ia=!0;ka.trigger()};this.refreshSize=function(){ka.trigger()};this.odfContainer=function(){return H};this.setOdfContainer=function(b,a){H=b;ca(!0===a)};this.load=this.load=ba;this.save=function(b){H.save(b)};this.addListener=function(b,a){switch(b){case "click":var c=b;m.addEventListener?m.addEventListener(c,a,!1):m.attachEvent?m.attachEvent("on"+c,a):m["on"+c]=a;break;default:c=ea.hasOwnProperty(b)?
ea[b]:ea[b]=[],a&&-1===c.indexOf(a)&&c.push(a)}};this.getFormatting=function(){return Y};this.getAnnotationViewManager=function(){return Q};this.refreshAnnotations=function(){E(H.rootElement)};this.rerenderAnnotations=function(){Q&&(la=!0,ka.trigger())};this.getSizer=function(){return Z};this.enableAnnotations=function(b,a){b!==aa&&(aa=b,T=a,H&&E(H.rootElement))};this.addAnnotation=function(b){Q&&(Q.addAnnotation(b),C())};this.forgetAnnotations=function(){Q&&(Q.forgetAnnotations(),C())};this.getZoomHelper=
function(){return fa};this.setZoomLevel=function(b){fa.setZoomLevel(b)};this.getZoomLevel=function(){return fa.getZoomLevel()};this.fitToContainingElement=function(b,a){var c=fa.getZoomLevel(),e=m.offsetHeight/c,c=b/(m.offsetWidth/c);a/e<c&&(c=a/e);fa.setZoomLevel(c)};this.fitToWidth=function(b){var a=m.offsetWidth/fa.getZoomLevel();fa.setZoomLevel(b/a)};this.fitSmart=function(b,a){var c,e;e=fa.getZoomLevel();c=m.offsetWidth/e;e=m.offsetHeight/e;c=b/c;void 0!==a&&a/e<c&&(c=a/e);fa.setZoomLevel(Math.min(1,
c))};this.fitToHeight=function(b){var a=m.offsetHeight/fa.getZoomLevel();fa.setZoomLevel(b/a)};this.showFirstPage=function(){ga.showFirstPage()};this.showNextPage=function(){ga.showNextPage()};this.showPreviousPage=function(){ga.showPreviousPage()};this.showPage=function(b){ga.showPage(b);if(window.location.hash&&(b=(window.location.hash.split(".").pop()||"").toLowerCase(),"ods"==b||"fods"==b||"ots"==b))return;C()};this.getElement=function(){return m};this.getViewport=function(){return ja};this.addCssForFrameWithImage=
function(b){var a=b.getAttributeNS(v,"name"),c=b.firstElementChild;q(a,b,X.sheet);c&&p(a+"img",H,c,X.sheet)};this.destroy=function(b){var a=W.getElementsByTagName("head")[0],c=[ga.destroy,ka.destroy];runtime.clearTimeout(pa);J&&J.parentNode&&J.parentNode.removeChild(J);fa.destroy(function(){Z&&(m.removeChild(Z),Z=null)});x(S);a.removeChild(R);a.removeChild(ha);a.removeChild(X);core.Async.destroyAll(c,b)};S=u(W);ga=new k(z(W));R=z(W);ha=z(W);X=z(W);ka=core.Task.createRedrawTask(function(){ia&&(c(H,
Y,ha),ia=!1);la&&(Q&&Q.rerenderAnnotations(),la=!1);C()});fa.subscribe(gui.ZoomHelper.signalZoomChanged,C)}})();
odf.StepUtils=function(){this.getContentBounds=function(f){var k=f.container(),a,d;runtime.assert(f.isStep(),"Step iterator must be on a step");k.nodeType===Node.TEXT_NODE&&0<f.offset()?a=f.offset():(k=f.leftNode())&&k.nodeType===Node.TEXT_NODE&&(a=k.length);k&&(k.nodeType===Node.TEXT_NODE?(runtime.assert(0<a,"Empty text node found"),d={container:k,startOffset:a-1,endOffset:a}):d={container:k,startOffset:0,endOffset:k.childNodes.length});return d}};
ops.MemberProperties=function(){this.fullName;this.color;this.imageUrl};
ops.Member=function(f,k){var a=new ops.MemberProperties;this.getMemberId=function(){return f};this.getProperties=function(){return a};this.setProperties=function(d){Object.keys(d).forEach(function(c){a[c]=d[c]})};this.removeProperties=function(d){Object.keys(d).forEach(function(c){"fullName"!==c&&"color"!==c&&"imageUrl"!==c&&a.hasOwnProperty(c)&&delete a[c]})};runtime.assert(Boolean(f),"No memberId was supplied!");k.fullName||(k.fullName=runtime.tr("Unknown Author"));k.color||(k.color="black");k.imageUrl||
(k.imageUrl="avatar-joe.png");a=k};ops.Document=function(){};ops.Document.prototype.getMemberIds=function(){};ops.Document.prototype.removeCursor=function(f){};ops.Document.prototype.getDocumentElement=function(){};ops.Document.prototype.getRootNode=function(){};ops.Document.prototype.getDOMDocument=function(){};ops.Document.prototype.cloneDocumentElement=function(){};ops.Document.prototype.setDocumentElement=function(f){};ops.Document.prototype.subscribe=function(f,k){};
ops.Document.prototype.unsubscribe=function(f,k){};ops.Document.prototype.getCanvas=function(){};ops.Document.prototype.createRootFilter=function(f){};ops.Document.prototype.createPositionIterator=function(f){};ops.Document.signalCursorAdded="cursor/added";ops.Document.signalCursorRemoved="cursor/removed";ops.Document.signalCursorMoved="cursor/moved";ops.Document.signalMemberAdded="member/added";ops.Document.signalMemberUpdated="member/updated";ops.Document.signalMemberRemoved="member/removed";
ops.OdtCursor=function(f,k){var a=this,d={},c,g,n=new core.EventNotifier([ops.OdtCursor.signalCursorUpdated]);this.removeFromDocument=function(){g.remove()};this.subscribe=function(a,c){n.subscribe(a,c)};this.unsubscribe=function(a,c){n.unsubscribe(a,c)};this.getMemberId=function(){return f};this.getNode=function(){return g.getNode()};this.getAnchorNode=function(){return g.getAnchorNode()};this.getSelectedRange=function(){return g.getSelectedRange()};this.setSelectedRange=function(c,d){g.setSelectedRange(c,
d);n.emit(ops.OdtCursor.signalCursorUpdated,a)};this.hasForwardSelection=function(){return g.hasForwardSelection()};this.getDocument=function(){return k};this.getSelectionType=function(){return c};this.setSelectionType=function(a){d.hasOwnProperty(a)?c=a:runtime.log("Invalid selection type: "+a)};this.resetSelectionType=function(){a.setSelectionType(ops.OdtCursor.RangeSelection)};g=new core.Cursor(k.getDOMDocument(),f);d[ops.OdtCursor.RangeSelection]=!0;d[ops.OdtCursor.RegionSelection]=!0;a.resetSelectionType()};
ops.OdtCursor.RangeSelection="Range";ops.OdtCursor.RegionSelection="Region";ops.OdtCursor.signalCursorUpdated="cursorUpdated";
(function(){var f=0;ops.StepsCache=function(k,a,d){function c(b,a){var c=this;this.nodeId=b;this.steps=-1;this.node=a;this.previousBookmark=this.nextBookmark=null;this.setIteratorPosition=function(b){b.setPositionBeforeElement(a);d(c.steps,b)}}function g(b,a,c){var e=this;this.nodeId=b;this.steps=a;this.node=c;this.previousBookmark=this.nextBookmark=null;this.setIteratorPosition=function(b){b.setUnfilteredPosition(c,0);d(e.steps,b)}}function n(b,a){var c="["+b.nodeId;a&&(c+=" => "+a.nodeId);return c+
"]"}function l(){for(var b=x,a,c,e,d=new core.LoopWatchDog(0,1E5),h={};b;){d.check();(a=b.previousBookmark)?runtime.assert(a.nextBookmark===b,"Broken bookmark link to previous @"+n(a,b)):(runtime.assert(b===x,"Broken bookmark link @"+n(b)),runtime.assert(void 0===z||x===x||x.steps<=z,"Base point is damaged @"+n(b)));(c=b.nextBookmark)&&runtime.assert(c.previousBookmark===b,"Broken bookmark link to next @"+n(b,c));if(void 0===z||b===x||b.steps<=z)runtime.assert(u.containsNode(k,b.node),"Disconnected node is being reported as undamaged @"+
n(b)),a&&(e=b.node.compareDocumentPosition(a.node),runtime.assert(0===e||0!==(e&s),"Bookmark order with previous does not reflect DOM order @"+n(a,b))),c&&u.containsNode(k,c.node)&&(e=b.node.compareDocumentPosition(c.node),runtime.assert(0===e||0!==(e&v),"Bookmark order with next does not reflect DOM order @"+n(b,c)));b=b.nextBookmark}Object.keys(r).forEach(function(b){var a=r[b];(void 0===z||b<=z)&&runtime.assert(a.steps<=b,"Bookmark step of "+a.steps+" exceeds cached step lookup for "+b+" @"+n(a));
runtime.assert(!1===h.hasOwnProperty(a.nodeId),"Bookmark "+n(a)+" appears twice in cached step lookup at steps "+h[a.nodeId]+" and "+b);h[a.nodeId]=b})}function q(b){var a="";b.nodeType===Node.ELEMENT_NODE&&(a=b.getAttributeNS("urn:webodf:names:steps","nodeId")||"");return a}function m(b){var a=f.toString();b.setAttributeNS("urn:webodf:names:steps","nodeId",a);f+=1;return a}function p(b){var c,e,d=new core.LoopWatchDog(0,1E4);void 0!==z&&b>z&&(b=z);for(c=Math.floor(b/a)*a;!e&&0<=c;)e=r[c],c-=a;for(e=
e||x;e.nextBookmark&&e.nextBookmark.steps<=b;)d.check(),e=e.nextBookmark;runtime.assert(-1===b||e.steps<=b,"Bookmark @"+n(e)+" at step "+e.steps+" exceeds requested step of "+b);return e}function b(b){b.previousBookmark&&(b.previousBookmark.nextBookmark=b.nextBookmark);b.nextBookmark&&(b.nextBookmark.previousBookmark=b.previousBookmark)}function e(b){for(var a,c=null;!c&&b&&b!==k;)(a=q(b))&&(c=h[a])&&c.node!==b&&(runtime.log("Cloned node detected. Creating new bookmark"),c=null,b.removeAttributeNS("urn:webodf:names:steps",
"nodeId")),b=b.parentNode;return c}var r={},h={},u=core.DomUtils,x,z,v=Node.DOCUMENT_POSITION_FOLLOWING,s=Node.DOCUMENT_POSITION_PRECEDING,A;this.updateBookmark=function(e,d){var f,g=Math.ceil(e/a)*a,l,n,s;if(void 0!==z&&z<e){l=p(z);for(n=l.nextBookmark;n&&n.steps<=e;)f=n.nextBookmark,s=Math.ceil(n.steps/a)*a,r[s]===n&&delete r[s],u.containsNode(k,n.node)?n.steps=e+1:(b(n),delete h[n.nodeId]),n=f;z=e}else l=p(e);n=q(d)||m(d);f=h[n];f?f.node!==d&&(runtime.log("Cloned node detected. Creating new bookmark"),
n=m(d),f=h[n]=new c(n,d)):f=h[n]=new c(n,d);n=f;n.steps!==e&&(f=Math.ceil(n.steps/a)*a,f!==g&&r[f]===n&&delete r[f],n.steps=e);if(l!==n&&l.nextBookmark!==n){if(l.steps===n.steps)for(;0!==(n.node.compareDocumentPosition(l.node)&v)&&l!==x;)l=l.previousBookmark;l!==n&&l.nextBookmark!==n&&(b(n),f=l.nextBookmark,n.nextBookmark=l.nextBookmark,n.previousBookmark=l,l.nextBookmark=n,f&&(f.previousBookmark=n))}l=r[g];if(!l||n.steps>l.steps)r[g]=n;A()};this.setToClosestStep=function(b,a){var c;A();c=p(b);c.setIteratorPosition(a);
return c.steps};this.setToClosestDomPoint=function(b,a,c){var d,h;A();if(b===k&&0===a)d=x;else if(b===k&&a===k.childNodes.length)for(h in d=x,r)r.hasOwnProperty(h)&&(b=r[h],b.steps>d.steps&&(d=b));else if(d=e(b.childNodes.item(a)||b),!d)for(c.setUnfilteredPosition(b,a);!d&&c.previousNode();)d=e(c.getCurrentNode());d=d||x;void 0!==z&&d.steps>z&&(d=p(z));d.setIteratorPosition(c);return d.steps};this.damageCacheAfterStep=function(b){0>b&&(b=-1);void 0===z?z=b:b<z&&(z=b);A()};(function(){var b=q(k)||
m(k);x=new g(b,0,k);A=ops.StepsCache.ENABLE_CACHE_VERIFICATION?l:function(){}})()};ops.StepsCache.ENABLE_CACHE_VERIFICATION=!1;ops.StepsCache.Bookmark=function(){};ops.StepsCache.Bookmark.prototype.nodeId;ops.StepsCache.Bookmark.prototype.node;ops.StepsCache.Bookmark.prototype.steps;ops.StepsCache.Bookmark.prototype.previousBookmark;ops.StepsCache.Bookmark.prototype.nextBookmark;ops.StepsCache.Bookmark.prototype.setIteratorPosition=function(f){}})();
(function(){ops.OdtStepsTranslator=function(f,k,a,d){function c(b,a,c){var e=a.getCurrentNode();a.isBeforeNode()&&p.isParagraph(e)&&(c||(b+=1),m.updateBookmark(b,e))}function g(b,e){do{if(a.acceptPosition(e)===r){c(b,e,!0);break}c(b-1,e,!1)}while(e.nextPosition())}function n(){var b=f();b!==q&&(q&&runtime.log("Undo detected. Resetting steps cache"),q=b,m=new ops.StepsCache(q,d,g),e=k(q))}function l(b,c){if(!c||a.acceptPosition(b)===r)return!0;for(;b.previousPosition();)if(a.acceptPosition(b)===r){if(c(h,
b.container(),b.unfilteredDomOffset()))return!0;break}for(;b.nextPosition();)if(a.acceptPosition(b)===r){if(c(u,b.container(),b.unfilteredDomOffset()))return!0;break}return!1}var q,m,p=odf.OdfUtils,b=core.DomUtils,e,r=core.PositionFilter.FilterResult.FILTER_ACCEPT,h=core.StepDirection.PREVIOUS,u=core.StepDirection.NEXT;this.convertStepsToDomPoint=function(b){var d,h;if(isNaN(b))throw new TypeError("Requested steps is not numeric ("+b+")");if(0>b)throw new RangeError("Requested steps is negative ("+
b+")");n();for(d=m.setToClosestStep(b,e);d<b&&e.nextPosition();)(h=a.acceptPosition(e)===r)&&(d+=1),c(d,e,h);if(d!==b)throw new RangeError("Requested steps ("+b+") exceeds available steps ("+d+")");return{node:e.container(),offset:e.unfilteredDomOffset()}};this.convertDomPointToSteps=function(d,h,f){var g;n();b.containsNode(q,d)||(h=0>b.comparePoints(q,0,d,h),d=q,h=h?0:q.childNodes.length);e.setUnfilteredPosition(d,h);l(e,f)||e.setUnfilteredPosition(d,h);f=e.container();h=e.unfilteredDomOffset();
d=m.setToClosestDomPoint(f,h,e);if(0>b.comparePoints(e.container(),e.unfilteredDomOffset(),f,h))return 0<d?d-1:d;for(;(e.container()!==f||e.unfilteredDomOffset()!==h)&&e.nextPosition();)(g=a.acceptPosition(e)===r)&&(d+=1),c(d,e,g);return d+0};this.prime=function(){var b,d;n();for(b=m.setToClosestStep(0,e);e.nextPosition();)(d=a.acceptPosition(e)===r)&&(b+=1),c(b,e,d)};this.handleStepsInserted=function(b){n();m.damageCacheAfterStep(b.position)};this.handleStepsRemoved=function(b){n();m.damageCacheAfterStep(b.position-
1)};n()}})();ops.Operation=function(){};ops.Operation.prototype.init=function(f){};ops.Operation.prototype.isEdit;ops.Operation.prototype.group;ops.Operation.prototype.execute=function(f){};ops.Operation.prototype.spec=function(){};
ops.TextPositionFilter=function(){function f(a,d,f){var m,p;if(d){if(k.isInlineRoot(d)&&k.isGroupingElement(f))return g;m=k.lookLeftForCharacter(d);if(1===m||2===m&&(k.scanRightForAnyCharacter(f)||k.scanRightForAnyCharacter(k.nextNode(a))))return c}else if(k.isInlineRoot(a.previousSibling)&&k.isGroupingElement(a))return c;m=null===d&&k.isParagraph(a);p=k.lookRightForCharacter(f);if(m)return p?c:k.scanRightForAnyCharacter(f)?g:c;if(!p)return g;d=d||k.previousNode(a);return k.scanLeftForAnyCharacter(d)?
g:c}var k=odf.OdfUtils,a=Node.ELEMENT_NODE,d=Node.TEXT_NODE,c=core.PositionFilter.FilterResult.FILTER_ACCEPT,g=core.PositionFilter.FilterResult.FILTER_REJECT;this.acceptPosition=function(n){var l=n.container(),q=l.nodeType,m,p,b;if(q!==a&&q!==d)return g;if(q===d){q=n.unfilteredDomOffset();m=l.data;runtime.assert(q!==m.length,"Unexpected offset.");if(0<q){n=m[q-1];if(!k.isODFWhitespace(n))return c;if(1<q)if(n=m[q-2],!k.isODFWhitespace(n))p=c;else{if(!k.isODFWhitespace(m.substr(0,q)))return g}else b=
k.previousNode(l),k.scanLeftForNonSpace(b)&&(p=c);if(p===c)return k.isTrailingWhitespace(l,q)?g:c;p=m[q];return k.isODFWhitespace(p)?g:k.scanLeftForAnyCharacter(k.previousNode(l))?g:c}b=n.leftNode();p=l;l=l.parentNode;p=f(l,b,p)}else k.isGroupingElement(l)?(b=n.leftNode(),p=n.rightNode(),p=f(l,b,p)):p=g;return p}};
ops.OdtDocument=function(f){function k(b){return new core.PositionIterator(b,I,K,!1)}function a(){var b=f.odfContainer().getContentElement(),a=b&&b.localName;runtime.assert("text"===a,"Unsupported content element type '"+a+"' for OdtDocument");return b}function d(){return b.getDocumentElement().ownerDocument}function c(b){for(;b&&!(b.namespaceURI===odf.Namespaces.officens&&"text"===b.localName||b.namespaceURI===odf.Namespaces.officens&&"annotation"===b.localName);)b=b.parentNode;return b}function g(b){this.acceptPosition=
function(a){a=a.container();var e;e="string"===typeof b?u[b].getNode():b;return c(a)===c(e)?v:s}}function n(b,a,c,e){e=k(e);var d;1===c.length?d=c[0]:(d=new core.PositionFilterChain,c.forEach(d.addFilter));c=new core.StepIterator(d,e);c.setPosition(b,a);return c}function l(b){var c=k(a());b=E.convertStepsToDomPoint(b);c.setUnfilteredPosition(b.node,b.offset);return c}function q(b){return b===A}function m(b){var a,c=[],d,f=2;runtime.assert(b.isStep(),"positionIterator is not at a step");do{if(a=e.getContentBounds(b))if(a=
a.container,r.isDowngradableSpaceElement(a)){for(d=a.lastChild;a.firstChild;)c.push(a.firstChild),a.parentNode.insertBefore(a.firstChild,a);a.parentNode.removeChild(a);b.setPosition(d,d.nodeType===Node.TEXT_NODE?d.length:d.childNodes.length);b.roundToPreviousStep()}f-=1}while(0<f&&b.nextStep());c.forEach(h.normalizeTextNodes)}function p(b,a,c){b=b.childNodes.item(a)||b;return(b=r.getParagraphElement(b))&&h.containsNode(c,b)?b:c}var b=this,e,r=odf.OdfUtils,h=core.DomUtils,u={},x={},z=new core.EventNotifier([ops.Document.signalMemberAdded,
ops.Document.signalMemberUpdated,ops.Document.signalMemberRemoved,ops.Document.signalCursorAdded,ops.Document.signalCursorRemoved,ops.Document.signalCursorMoved,ops.OdtDocument.signalParagraphChanged,ops.OdtDocument.signalParagraphStyleModified,ops.OdtDocument.signalCommonStyleCreated,ops.OdtDocument.signalCommonStyleDeleted,ops.OdtDocument.signalTableAdded,ops.OdtDocument.signalOperationStart,ops.OdtDocument.signalOperationEnd,ops.OdtDocument.signalProcessingBatchStart,ops.OdtDocument.signalProcessingBatchEnd,
ops.OdtDocument.signalUndoStackChanged,ops.OdtDocument.signalStepsInserted,ops.OdtDocument.signalStepsRemoved,ops.OdtDocument.signalMetadataUpdated,ops.OdtDocument.signalAnnotationAdded]),v=core.PositionFilter.FilterResult.FILTER_ACCEPT,s=core.PositionFilter.FilterResult.FILTER_REJECT,A=core.StepDirection.NEXT,w,E,N,I=NodeFilter.SHOW_ALL,G=new gui.BlacklistNamespaceNodeFilter(["urn:webodf:names:cursor","urn:webodf:names:editinfo"]),F=new gui.OdfTextBodyNodeFilter,K=new core.NodeFilterChain([G,F]);
this.createPositionIterator=k;this.getDocumentElement=function(){return f.odfContainer().rootElement};this.getDOMDocument=function(){return this.getDocumentElement().ownerDocument};this.cloneDocumentElement=function(){var a=b.getDocumentElement(),c=f.getAnnotationViewManager();c&&c.forgetAnnotations();a=a.cloneNode(!0);f.refreshAnnotations();return a};this.setDocumentElement=function(b){var a=f.odfContainer();a.setRootElement(b);f.setOdfContainer(a,!0);f.refreshCSS()};this.getDOMDocument=d;this.getRootElement=
c;this.createStepIterator=n;this.getIteratorAtPosition=l;this.convertCursorStepToDomPoint=function(b){return E.convertStepsToDomPoint(b)};this.convertDomPointToCursorStep=function(b,a,c){var e;c===A&&(e=q);return E.convertDomPointToSteps(b,a,e)};this.convertDomToCursorRange=function(b){var a;a=E.convertDomPointToSteps(b.anchorNode,b.anchorOffset);b=b.anchorNode===b.focusNode&&b.anchorOffset===b.focusOffset?a:E.convertDomPointToSteps(b.focusNode,b.focusOffset);return{position:a,length:b-a}};this.convertCursorToDomRange=
function(b,a){var c=d().createRange(),e,h;e=E.convertStepsToDomPoint(b);a?(h=E.convertStepsToDomPoint(b+a),0<a?(c.setStart(e.node,e.offset),c.setEnd(h.node,h.offset)):(c.setStart(h.node,h.offset),c.setEnd(e.node,e.offset))):c.setStart(e.node,e.offset);return c};this.upgradeWhitespacesAtPosition=function(b){var a=l(b),a=new core.StepIterator(w,a),c,d=2;runtime.assert(a.isStep(),"positionIterator is not at a step (requested step: "+b+")");do{if(c=e.getContentBounds(a))if(b=c.container,c=c.startOffset,
b.nodeType===Node.TEXT_NODE&&r.isSignificantWhitespace(b,c)){runtime.assert(" "===b.data[c],"upgradeWhitespaceToElement: textNode.data[offset] should be a literal space");var h=b.ownerDocument.createElementNS(odf.Namespaces.textns,"text:s"),f=b.parentNode,g=b;h.appendChild(b.ownerDocument.createTextNode(" "));1===b.length?f.replaceChild(h,b):(b.deleteData(c,1),0<c&&(c<b.length&&b.splitText(c),g=b.nextSibling),f.insertBefore(h,g));b=h;a.setPosition(b,b.childNodes.length);a.roundToPreviousStep()}d-=
1}while(0<d&&a.nextStep())};this.downgradeWhitespaces=m;this.downgradeWhitespacesAtPosition=function(b){b=l(b);b=new core.StepIterator(w,b);m(b)};this.getTextNodeAtStep=function(a,c){var e=l(a),h=e.container(),f,g=0,m=null;h.nodeType===Node.TEXT_NODE?(f=h,g=e.unfilteredDomOffset(),0<f.length&&(0<g&&(f=f.splitText(g)),f.parentNode.insertBefore(d().createTextNode(""),f),f=f.previousSibling,g=0)):(f=d().createTextNode(""),g=0,h.insertBefore(f,e.rightNode()));if(c){if(u[c]&&b.getCursorPosition(c)===a){for(m=
u[c].getNode();m.nextSibling&&"cursor"===m.nextSibling.localName;)m.parentNode.insertBefore(m.nextSibling,m);0<f.length&&f.nextSibling!==m&&(f=d().createTextNode(""),g=0);m.parentNode.insertBefore(f,m)}}else for(;f.nextSibling&&"cursor"===f.nextSibling.localName;)f.parentNode.insertBefore(f.nextSibling,f);for(;f.previousSibling&&f.previousSibling.nodeType===Node.TEXT_NODE;)e=f.previousSibling,e.appendData(f.data),g=e.length,f=e,f.parentNode.removeChild(f.nextSibling);for(;f.nextSibling&&f.nextSibling.nodeType===
Node.TEXT_NODE;)e=f.nextSibling,f.appendData(e.data),f.parentNode.removeChild(e);return{textNode:f,offset:g}};this.fixCursorPositions=function(){Object.keys(u).forEach(function(a){var e=u[a],d=c(e.getNode()),h=b.createRootFilter(d),f,g,l,m=!1;l=e.getSelectedRange();f=p(l.startContainer,l.startOffset,d);g=n(l.startContainer,l.startOffset,[w,h],f);l.collapsed?d=g:(f=p(l.endContainer,l.endOffset,d),d=n(l.endContainer,l.endOffset,[w,h],f));g.isStep()&&d.isStep()?g.container()!==d.container()||g.offset()!==
d.offset()||l.collapsed&&e.getAnchorNode()===e.getNode()||(m=!0,l.setStart(g.container(),g.offset()),l.collapse(!0)):(m=!0,runtime.assert(g.roundToClosestStep(),"No walkable step found for cursor owned by "+a),l.setStart(g.container(),g.offset()),runtime.assert(d.roundToClosestStep(),"No walkable step found for cursor owned by "+a),l.setEnd(d.container(),d.offset()));m&&(e.setSelectedRange(l,e.hasForwardSelection()),b.emit(ops.Document.signalCursorMoved,e))})};this.getCursorPosition=function(b){return(b=
u[b])?E.convertDomPointToSteps(b.getNode(),0):0};this.getCursorSelection=function(b){b=u[b];var a=0,c=0;b&&(a=E.convertDomPointToSteps(b.getNode(),0),c=E.convertDomPointToSteps(b.getAnchorNode(),0));return{position:c,length:a-c}};this.getPositionFilter=function(){return w};this.getOdfCanvas=function(){return f};this.getCanvas=function(){return f};this.getRootNode=a;this.addMember=function(b){runtime.assert(void 0===x[b.getMemberId()],"This member already exists");x[b.getMemberId()]=b};this.getMember=
function(b){return x.hasOwnProperty(b)?x[b]:null};this.removeMember=function(b){delete x[b]};this.getCursor=function(b){return u[b]};this.getMemberIds=function(){var b=[],a;for(a in u)u.hasOwnProperty(a)&&b.push(u[a].getMemberId());return b};this.addCursor=function(a){runtime.assert(Boolean(a),"OdtDocument::addCursor without cursor");var c=a.getMemberId(),e=b.convertCursorToDomRange(0,0);runtime.assert("string"===typeof c,"OdtDocument::addCursor has cursor without memberid");runtime.assert(!u[c],
"OdtDocument::addCursor is adding a duplicate cursor with memberid "+c);a.setSelectedRange(e,!0);u[c]=a};this.removeCursor=function(a){var c=u[a];return c?(c.removeFromDocument(),delete u[a],b.emit(ops.Document.signalCursorRemoved,a),!0):!1};this.moveCursor=function(a,c,e,d){a=u[a];c=b.convertCursorToDomRange(c,e);a&&(a.setSelectedRange(c,0<=e),a.setSelectionType(d||ops.OdtCursor.RangeSelection))};this.getFormatting=function(){return f.getFormatting()};this.emit=function(b,a){z.emit(b,a)};this.subscribe=
function(b,a){z.subscribe(b,a)};this.unsubscribe=function(b,a){z.unsubscribe(b,a)};this.createRootFilter=function(b){return new g(b)};this.close=function(b){b()};this.destroy=function(b){b()};w=new ops.TextPositionFilter;e=new odf.StepUtils;E=new ops.OdtStepsTranslator(a,k,w,500);z.subscribe(ops.OdtDocument.signalStepsInserted,E.handleStepsInserted);z.subscribe(ops.OdtDocument.signalStepsRemoved,E.handleStepsRemoved);z.subscribe(ops.OdtDocument.signalOperationEnd,function(a){var c=a.spec(),e=c.memberid,
d=(new Date(c.timestamp)).toISOString(),h=f.odfContainer(),g={setProperties:{},removedProperties:[]};a.isEdit&&("UpdateMetadata"===c.optype&&(g.setProperties=JSON.parse(JSON.stringify(c.setProperties)),c.removedProperties&&(g.removedProperties=c.removedProperties.attributes.split(","))),c=b.getMember(e).getProperties().fullName,h.setMetadata({"dc:creator":c,"dc:date":d},null),g.setProperties["dc:creator"]=c,g.setProperties["dc:date"]=d,N||(g.setProperties["meta:editing-cycles"]=h.incrementEditingCycles(),
h.setMetadata(null,["meta:editing-duration","meta:document-statistic"])),N=a,b.emit(ops.OdtDocument.signalMetadataUpdated,g))});z.subscribe(ops.OdtDocument.signalProcessingBatchEnd,core.Task.processTasks)};ops.OdtDocument.signalParagraphChanged="paragraph/changed";ops.OdtDocument.signalTableAdded="table/added";ops.OdtDocument.signalCommonStyleCreated="style/created";ops.OdtDocument.signalCommonStyleDeleted="style/deleted";ops.OdtDocument.signalParagraphStyleModified="paragraphstyle/modified";
ops.OdtDocument.signalOperationStart="operation/start";ops.OdtDocument.signalOperationEnd="operation/end";ops.OdtDocument.signalProcessingBatchStart="router/batchstart";ops.OdtDocument.signalProcessingBatchEnd="router/batchend";ops.OdtDocument.signalUndoStackChanged="undo/changed";ops.OdtDocument.signalStepsInserted="steps/inserted";ops.OdtDocument.signalStepsRemoved="steps/removed";ops.OdtDocument.signalMetadataUpdated="metadata/updated";ops.OdtDocument.signalAnnotationAdded="annotation/added";
ops.OpAddAnnotation=function(){function f(a,c,d){var f=a.getTextNodeAtStep(d,k);f&&(a=f.textNode,d=a.parentNode,f.offset!==a.length&&a.splitText(f.offset),d.insertBefore(c,a.nextSibling),0===a.length&&d.removeChild(a))}var k,a,d,c,g,n;this.init=function(f){k=f.memberid;a=parseInt(f.timestamp,10);d=parseInt(f.position,10);c=parseInt(f.length,10)||0;g=f.name};this.isEdit=!0;this.group=void 0;this.execute=function(l){var q=l.getCursor(k),m,p;n=l.getDOMDocument();var b=new Date(a),e,r,h;e=n.createElementNS(odf.Namespaces.officens,
"office:annotation");e.setAttributeNS(odf.Namespaces.officens,"office:name",g);m=n.createElementNS(odf.Namespaces.dcns,"dc:creator");m.setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",k);m.textContent=l.getMember(k).getProperties().fullName;p=n.createElementNS(odf.Namespaces.dcns,"dc:date");p.appendChild(n.createTextNode(b.toISOString()));b=n.createElementNS(odf.Namespaces.textns,"text:list");r=n.createElementNS(odf.Namespaces.textns,"text:list-item");h=n.createElementNS(odf.Namespaces.textns,
"text:p");r.appendChild(h);b.appendChild(r);e.appendChild(m);e.appendChild(p);e.appendChild(b);c&&(m=n.createElementNS(odf.Namespaces.officens,"office:annotation-end"),m.setAttributeNS(odf.Namespaces.officens,"office:name",g),e.annotationEndElement=m,f(l,m,d+c));f(l,e,d);l.emit(ops.OdtDocument.signalStepsInserted,{position:d});q&&(m=n.createRange(),p=e.getElementsByTagNameNS(odf.Namespaces.textns,"p")[0],m.selectNodeContents(p),q.setSelectedRange(m,!1),q.setSelectionType(ops.OdtCursor.RangeSelection),
l.emit(ops.Document.signalCursorMoved,q));l.getOdfCanvas().addAnnotation(e);l.fixCursorPositions();l.emit(ops.OdtDocument.signalAnnotationAdded,{memberId:k,annotation:e});return!0};this.spec=function(){return{optype:"AddAnnotation",memberid:k,timestamp:a,position:d,length:c,name:g}}};ops.OpAddAnnotation.Spec;ops.OpAddAnnotation.InitSpec;
ops.OpAddCursor=function(){var f,k;this.init=function(a){f=a.memberid;k=a.timestamp};this.isEdit=!1;this.group=void 0;this.execute=function(a){var d=a.getCursor(f);if(d)return!1;d=new ops.OdtCursor(f,a);a.addCursor(d);a.emit(ops.Document.signalCursorAdded,d);return!0};this.spec=function(){return{optype:"AddCursor",memberid:f,timestamp:k}}};ops.OpAddCursor.Spec;ops.OpAddCursor.InitSpec;
ops.OpAddMember=function(){var f,k,a;this.init=function(d){f=d.memberid;k=parseInt(d.timestamp,10);a=d.setProperties};this.isEdit=!1;this.group=void 0;this.execute=function(d){var c;if(d.getMember(f))return!1;c=new ops.Member(f,a);d.addMember(c);d.emit(ops.Document.signalMemberAdded,c);return!0};this.spec=function(){return{optype:"AddMember",memberid:f,timestamp:k,setProperties:a}}};ops.OpAddMember.Spec;ops.OpAddMember.InitSpec;
ops.OpAddStyle=function(){var f,k,a,d,c,g,n=odf.Namespaces.stylens;this.init=function(l){f=l.memberid;k=l.timestamp;a=l.styleName;d=l.styleFamily;c="true"===l.isAutomaticStyle||!0===l.isAutomaticStyle;g=l.setProperties};this.isEdit=!0;this.group=void 0;this.execute=function(f){var k=f.getOdfCanvas().odfContainer(),m=f.getFormatting(),p=f.getDOMDocument().createElementNS(n,"style:style");if(!p)return!1;g&&m.updateStyle(p,g);p.setAttributeNS(n,"style:family",d);p.setAttributeNS(n,"style:name",a);c?
k.rootElement.automaticStyles.appendChild(p):k.rootElement.styles.appendChild(p);f.getOdfCanvas().refreshCSS();c||f.emit(ops.OdtDocument.signalCommonStyleCreated,{name:a,family:d});return!0};this.spec=function(){return{optype:"AddStyle",memberid:f,timestamp:k,styleName:a,styleFamily:d,isAutomaticStyle:c,setProperties:g}}};ops.OpAddStyle.Spec;ops.OpAddStyle.InitSpec;
odf.ObjectNameGenerator=function(f,k){function a(b,a){var c={};this.generateName=function(){var e=a(),d=0,f;do f=b+d,d+=1;while(c[f]||e[f]);c[f]=!0;return f}}function d(){var b={};[f.rootElement.automaticStyles,f.rootElement.styles].forEach(function(a){for(a=a.firstElementChild;a;)a.namespaceURI===c&&"style"===a.localName&&(b[a.getAttributeNS(c,"name")]=!0),a=a.nextElementSibling});return b}var c=odf.Namespaces.stylens,g=odf.Namespaces.drawns,n=odf.Namespaces.xlinkns,l=(new core.Utils).hashString(k),
q=null,m=null,p=null,b={},e={};this.generateStyleName=function(){null===q&&(q=new a("auto"+l+"_",function(){return d()}));return q.generateName()};this.generateFrameName=function(){var c,e,d;if(null===m){e=f.rootElement.body.getElementsByTagNameNS(g,"frame");for(c=0;c<e.length;c+=1)d=e.item(c),b[d.getAttributeNS(g,"name")]=!0;m=new a("fr"+l+"_",function(){return b})}return m.generateName()};this.generateImageName=function(){var b,c,d;if(null===p){d=f.rootElement.body.getElementsByTagNameNS(g,"image");
for(b=0;b<d.length;b+=1)c=d.item(b),c=c.getAttributeNS(n,"href"),c=c.substring(9,c.lastIndexOf(".")),e[c]=!0;p=new a("img"+l+"_",function(){return e})}return p.generateName()}};
odf.TextStyleApplicator=function(f,k,a){function d(a){function c(b,a){return"object"===typeof b&&"object"===typeof a?Object.keys(b).every(function(d){return c(b[d],a[d])}):b===a}var b={};this.isStyleApplied=function(e){e=k.getAppliedStylesForElement(e,b).styleProperties;return c(a,e)}}function c(c){var d={};this.applyStyleToContainer=function(b){var e;e=b.getAttributeNS(l,"style-name");var g=b.ownerDocument;e=e||"";if(!d.hasOwnProperty(e)){var h=e,n;n=e?k.createDerivedStyleObject(e,"text",c):c;g=
g.createElementNS(q,"style:style");k.updateStyle(g,n);g.setAttributeNS(q,"style:name",f.generateStyleName());g.setAttributeNS(q,"style:family","text");g.setAttributeNS("urn:webodf:names:scope","scope","document-content");a.appendChild(g);d[h]=g}e=d[e].getAttributeNS(q,"name");b.setAttributeNS(l,"text:style-name",e)}}function g(a,c){var b=a.ownerDocument,e=a.parentNode,d,f,g,k=new core.LoopWatchDog(1E4);f=[];f.push(a);for(g=a.nextSibling;g&&n.rangeContainsNode(c,g);)k.check(),f.push(g),g=g.nextSibling;
"span"!==e.localName||e.namespaceURI!==l?(d=b.createElementNS(l,"text:span"),e.insertBefore(d,a),b=!1):(a.previousSibling&&!n.rangeContainsNode(c,e.firstChild)?(d=e.cloneNode(!1),e.parentNode.insertBefore(d,e.nextSibling)):d=e,b=!0);f.forEach(function(b){b.parentNode!==d&&d.appendChild(b)});if(g&&b)for(f=d.cloneNode(!1),d.parentNode.insertBefore(f,d.nextSibling);g;)k.check(),b=g.nextSibling,f.appendChild(g),g=b;return d}var n=core.DomUtils,l=odf.Namespaces.textns,q=odf.Namespaces.stylens;this.applyStyle=
function(a,f,b){var e={},l,h,n,k;runtime.assert(b&&b.hasOwnProperty("style:text-properties"),"applyStyle without any text properties");e["style:text-properties"]=b["style:text-properties"];n=new c(e);k=new d(e);a.forEach(function(b){l=k.isStyleApplied(b);!1===l&&(h=g(b,f),n.applyStyleToContainer(h))})}};
ops.OpApplyDirectStyling=function(){function f(a,c,d){var b=a.getOdfCanvas().odfContainer(),e=l.splitBoundaries(c),f=n.getTextNodes(c,!1);(new odf.TextStyleApplicator(new odf.ObjectNameGenerator(b,k),a.getFormatting(),b.rootElement.automaticStyles)).applyStyle(f,c,d);e.forEach(l.normalizeTextNodes)}var k,a,d,c,g,n=odf.OdfUtils,l=core.DomUtils;this.init=function(f){k=f.memberid;a=f.timestamp;d=parseInt(f.position,10);c=parseInt(f.length,10);g=f.setProperties};this.isEdit=!0;this.group=void 0;this.execute=
function(l){var m=l.convertCursorToDomRange(d,c),p=n.getParagraphElements(m);f(l,m,g);m.detach();l.getOdfCanvas().refreshCSS();l.fixCursorPositions();p.forEach(function(b){l.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:b,memberId:k,timeStamp:a})});l.getOdfCanvas().rerenderAnnotations();return!0};this.spec=function(){return{optype:"ApplyDirectStyling",memberid:k,timestamp:a,position:d,length:c,setProperties:g}}};ops.OpApplyDirectStyling.Spec;ops.OpApplyDirectStyling.InitSpec;
ops.OpApplyHyperlink=function(){function f(a){for(;a;){if(l.isHyperlink(a))return!0;a=a.parentNode}return!1}var k,a,d,c,g,n=core.DomUtils,l=odf.OdfUtils;this.init=function(f){k=f.memberid;a=f.timestamp;d=f.position;c=f.length;g=f.hyperlink};this.isEdit=!0;this.group=void 0;this.execute=function(q){var m=q.getDOMDocument(),p=q.convertCursorToDomRange(d,c),b=n.splitBoundaries(p),e=[],r=l.getTextNodes(p,!1);if(0===r.length)return!1;r.forEach(function(b){var a=l.getParagraphElement(b);runtime.assert(!1===
f(b),"The given range should not contain any link.");var c=g,d=m.createElementNS(odf.Namespaces.textns,"text:a");d.setAttributeNS(odf.Namespaces.xlinkns,"xlink:type","simple");d.setAttributeNS(odf.Namespaces.xlinkns,"xlink:href",c);b.parentNode.insertBefore(d,b);d.appendChild(b);-1===e.indexOf(a)&&e.push(a)});b.forEach(n.normalizeTextNodes);p.detach();q.fixCursorPositions();q.getOdfCanvas().refreshSize();q.getOdfCanvas().rerenderAnnotations();e.forEach(function(b){q.emit(ops.OdtDocument.signalParagraphChanged,
{paragraphElement:b,memberId:k,timeStamp:a})});return!0};this.spec=function(){return{optype:"ApplyHyperlink",memberid:k,timestamp:a,position:d,length:c,hyperlink:g}}};ops.OpApplyHyperlink.Spec;ops.OpApplyHyperlink.InitSpec;
ops.OpInsertImage=function(){var f,k,a,d,c,g,n,l,q=odf.Namespaces.drawns,m=odf.Namespaces.svgns,p=odf.Namespaces.textns,b=odf.Namespaces.xlinkns,e=odf.OdfUtils;this.init=function(b){f=b.memberid;k=b.timestamp;a=b.position;d=b.filename;c=b.frameWidth;g=b.frameHeight;n=b.frameStyleName;l=b.frameName};this.isEdit=!0;this.group=void 0;this.execute=function(r){var h=r.getOdfCanvas(),u=r.getTextNodeAtStep(a,f),x,z;if(!u)return!1;x=u.textNode;z=e.getParagraphElement(x);var u=u.offset!==x.length?x.splitText(u.offset):
x.nextSibling,v=r.getDOMDocument(),s=v.createElementNS(q,"draw:image"),v=v.createElementNS(q,"draw:frame");s.setAttributeNS(b,"xlink:href",d);s.setAttributeNS(b,"xlink:type","simple");s.setAttributeNS(b,"xlink:show","embed");s.setAttributeNS(b,"xlink:actuate","onLoad");v.setAttributeNS(q,"draw:style-name",n);v.setAttributeNS(q,"draw:name",l);v.setAttributeNS(p,"text:anchor-type","as-char");v.setAttributeNS(m,"svg:width",c);v.setAttributeNS(m,"svg:height",g);v.appendChild(s);x.parentNode.insertBefore(v,
u);r.emit(ops.OdtDocument.signalStepsInserted,{position:a});0===x.length&&x.parentNode.removeChild(x);h.addCssForFrameWithImage(v);h.refreshCSS();r.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:z,memberId:f,timeStamp:k});h.rerenderAnnotations();return!0};this.spec=function(){return{optype:"InsertImage",memberid:f,timestamp:k,filename:d,position:a,frameWidth:c,frameHeight:g,frameStyleName:n,frameName:l}}};ops.OpInsertImage.Spec;ops.OpInsertImage.InitSpec;
ops.OpInsertTable=function(){function f(b,a){var f;if(1===m.length)f=m[0];else if(3===m.length)switch(b){case 0:f=m[0];break;case d-1:f=m[2];break;default:f=m[1]}else f=m[b];if(1===f.length)return f[0];if(3===f.length)switch(a){case 0:return f[0];case c-1:return f[2];default:return f[1]}return f[a]}var k,a,d,c,g,n,l,q,m,p=odf.OdfUtils;this.init=function(b){k=b.memberid;a=b.timestamp;g=b.position;d=b.initialRows;c=b.initialColumns;n=b.tableName;l=b.tableStyleName;q=b.tableColumnStyleName;m=b.tableCellStyleMatrix};
this.isEdit=!0;this.group=void 0;this.execute=function(b){var e=b.getTextNodeAtStep(g),m=b.getRootNode();if(e){var h=b.getDOMDocument(),u=h.createElementNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:table"),x=h.createElementNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:table-column"),z,v,s,A;l&&u.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:style-name",l);n&&u.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:name",n);x.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0",
"table:number-columns-repeated",c);q&&x.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:style-name",q);u.appendChild(x);for(s=0;s<d;s+=1){x=h.createElementNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:table-row");for(A=0;A<c;A+=1)z=h.createElementNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:table-cell"),(v=f(s,A))&&z.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:style-name",v),v=h.createElementNS("urn:oasis:names:tc:opendocument:xmlns:text:1.0",
"text:p"),z.appendChild(v),x.appendChild(z);u.appendChild(x)}e=p.getParagraphElement(e.textNode);m.insertBefore(u,e.nextSibling);b.emit(ops.OdtDocument.signalStepsInserted,{position:g});b.getOdfCanvas().refreshSize();b.emit(ops.OdtDocument.signalTableAdded,{tableElement:u,memberId:k,timeStamp:a});b.getOdfCanvas().rerenderAnnotations();return!0}return!1};this.spec=function(){return{optype:"InsertTable",memberid:k,timestamp:a,position:g,initialRows:d,initialColumns:c,tableName:n,tableStyleName:l,tableColumnStyleName:q,
tableCellStyleMatrix:m}}};ops.OpInsertTable.Spec;ops.OpInsertTable.InitSpec;
ops.OpInsertText=function(){function f(a){return"\t"!==a&&n.isODFWhitespace(a)}var k,a,d,c,g,n=odf.OdfUtils;this.init=function(f){k=f.memberid;a=f.timestamp;d=f.position;g=f.text;c="true"===f.moveCursor||!0===f.moveCursor};this.isEdit=!0;this.group=void 0;this.execute=function(l){var q,m,p,b=null,e=l.getDOMDocument(),r,h=0,u,x=l.getCursor(k),z;l.upgradeWhitespacesAtPosition(d);if(q=l.getTextNodeAtStep(d)){m=q.textNode;b=m.nextSibling;p=m.parentNode;r=n.getParagraphElement(m);for(z=0;z<g.length;z+=
1){if(!(u="\t"===g[z])){u=g;var v=z;u=f(u[v])&&(0===v||v===u.length-1||f(u[v-1]))}u&&(0===h?(q.offset!==m.length&&(b=m.splitText(q.offset)),0<z&&m.appendData(g.substring(0,z))):h<z&&(h=g.substring(h,z),p.insertBefore(e.createTextNode(h),b)),h=z+1,"\t"===g[z]?(u=e.createElementNS("urn:oasis:names:tc:opendocument:xmlns:text:1.0","text:tab"),u.appendChild(e.createTextNode("\t"))):(" "!==g[z]&&runtime.log("WARN: InsertText operation contains non-tab, non-space whitespace character (character code "+g.charCodeAt(z)+
")"),u=e.createElementNS("urn:oasis:names:tc:opendocument:xmlns:text:1.0","text:s"),u.appendChild(e.createTextNode(" "))),p.insertBefore(u,b))}0===h?m.insertData(q.offset,g):h<g.length&&(q=g.substring(h),p.insertBefore(e.createTextNode(q),b));p=m.parentNode;b=m.nextSibling;p.removeChild(m);p.insertBefore(m,b);0===m.length&&m.parentNode.removeChild(m);l.emit(ops.OdtDocument.signalStepsInserted,{position:d});x&&c&&(l.moveCursor(k,d+g.length,0),l.emit(ops.Document.signalCursorMoved,x));l.downgradeWhitespacesAtPosition(d);
l.downgradeWhitespacesAtPosition(d+g.length);l.getOdfCanvas().refreshSize();l.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:r,memberId:k,timeStamp:a});l.getOdfCanvas().rerenderAnnotations();return!0}return!1};this.spec=function(){return{optype:"InsertText",memberid:k,timestamp:a,position:d,text:g,moveCursor:c}}};ops.OpInsertText.Spec;ops.OpInsertText.InitSpec;
odf.CollapsingRules=function(f){function k(a){return d.isODFNode(a)||"br"===a.localName&&d.isLineBreak(a.parentNode)||a.nodeType===Node.TEXT_NODE&&d.isODFNode(a.parentNode)}function a(g){var n;g.nodeType===Node.TEXT_NODE?(n=g.parentNode,n.removeChild(g)):n=c.removeUnwantedNodes(g,k);if(g=n)g=n,g=!d.isParagraph(g)&&g!==f&&d.hasNoODFContent(g);return g?a(n):n}var d=odf.OdfUtils,c=core.DomUtils;this.mergeChildrenIntoParent=a};
ops.OpMergeParagraph=function(){function f(b){return p.isGroupingElement(b)&&p.hasNoODFContent(b)}function k(b){if(b.nodeType===Node.TEXT_NODE){if(0===b.length)return runtime.log("WARN: Empty text node found during merge operation"),!0;if(p.isODFWhitespace(b.data)&&!1===p.isSignificantWhitespace(b,0))return!0;b="#text"}else b=(b.prefix?b.prefix+":":"")+b.localName;runtime.log("WARN: Unexpected text element found near paragraph boundary ["+b+"]");return!1}function a(a){a.collapsed||(b.splitBoundaries(a),
a=p.getTextElements(a,!1,!0).filter(k),a.forEach(function(b){b.parentNode.removeChild(b)}))}function d(b,a,c){b=b.convertCursorStepToDomPoint(a);var e=p.getParagraphElement(b.node,b.offset);runtime.assert(Boolean(e),"Paragraph not found at step "+a);c&&c.setPosition(b.node,b.offset);return e}var c,g,n,l,q,m,p=odf.OdfUtils,b=core.DomUtils,e=odf.Namespaces.textns;this.init=function(b){c=b.memberid;g=b.timestamp;n=b.moveCursor;l=b.paragraphStyleName;q=parseInt(b.sourceStartPosition,10);m=parseInt(b.destinationStartPosition,
10)};this.isEdit=!0;this.group=void 0;this.execute=function(k){var h,p,x=k.getCursor(c);h=k.getRootNode();var z=new odf.CollapsingRules(h),v=k.createStepIterator(h,0,[k.getPositionFilter()],h),s;runtime.assert(m<q,"Destination paragraph ("+m+") must be before source paragraph ("+q+")");p=d(k,m);h=d(k,q,v);v.previousStep();runtime.assert(b.containsNode(p,v.container()),"Destination paragraph must be adjacent to the source paragraph");s=p.ownerDocument.createRange();v.setPosition(p,p.childNodes.length);
v.roundToPreviousStep();s.setStart(v.container(),v.offset());s.setEnd(p,p.childNodes.length);a(s);s=p.childNodes.length;var A=h.ownerDocument.createRange();v.setPosition(h,0);v.roundToNextStep();A.setStart(h,0);A.setEnd(v.container(),v.offset());a(A);for(A=h.firstChild;A;)"editinfo"===A.localName?h.removeChild(A):(p.appendChild(A),b.removeUnwantedNodes(A,f)),A=h.firstChild;runtime.assert(0===h.childNodes.length,"Source paragraph should be empty before it is removed");z.mergeChildrenIntoParent(h);
k.emit(ops.OdtDocument.signalStepsRemoved,{position:q-1});v.setPosition(p,s);v.roundToClosestStep();v.previousStep()||v.roundToNextStep();k.downgradeWhitespaces(v);l?p.setAttributeNS(e,"text:style-name",l):p.removeAttributeNS(e,"style-name");x&&n&&(k.moveCursor(c,q-1,0),k.emit(ops.Document.signalCursorMoved,x));k.fixCursorPositions();k.getOdfCanvas().refreshSize();k.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:p,memberId:c,timeStamp:g});k.getOdfCanvas().rerenderAnnotations();return!0};
this.spec=function(){return{optype:"MergeParagraph",memberid:c,timestamp:g,moveCursor:n,paragraphStyleName:l,sourceStartPosition:q,destinationStartPosition:m}}};ops.OpMergeParagraph.Spec;ops.OpMergeParagraph.InitSpec;
ops.OpMoveCursor=function(){var f,k,a,d,c;this.init=function(g){f=g.memberid;k=g.timestamp;a=g.position;d=g.length||0;c=g.selectionType||ops.OdtCursor.RangeSelection};this.isEdit=!1;this.group=void 0;this.execute=function(g){var k=g.getCursor(f),l;if(!k)return!1;l=g.convertCursorToDomRange(a,d);k.setSelectedRange(l,0<=d);k.setSelectionType(c);g.emit(ops.Document.signalCursorMoved,k);return!0};this.spec=function(){return{optype:"MoveCursor",memberid:f,timestamp:k,position:a,length:d,selectionType:c}}};
ops.OpMoveCursor.Spec;ops.OpMoveCursor.InitSpec;
ops.OpRemoveAnnotation=function(){var f,k,a,d,c=core.DomUtils;this.init=function(c){f=c.memberid;k=c.timestamp;a=parseInt(c.position,10);d=parseInt(c.length,10)};this.isEdit=!0;this.group=void 0;this.execute=function(d){function f(a){k.parentNode.insertBefore(a,k)}for(var l=d.getIteratorAtPosition(a).container(),k;l.namespaceURI!==odf.Namespaces.officens||"annotation"!==l.localName;)l=l.parentNode;if(null===l)return!1;k=l;l=k.annotationEndElement;d.getOdfCanvas().forgetAnnotations();c.getElementsByTagNameNS(k,
"urn:webodf:names:cursor","cursor").forEach(f);c.getElementsByTagNameNS(k,"urn:webodf:names:cursor","anchor").forEach(f);k.parentNode.removeChild(k);l&&l.parentNode.removeChild(l);d.emit(ops.OdtDocument.signalStepsRemoved,{position:0<a?a-1:a});d.fixCursorPositions();d.getOdfCanvas().refreshAnnotations();return!0};this.spec=function(){return{optype:"RemoveAnnotation",memberid:f,timestamp:k,position:a,length:d}}};ops.OpRemoveAnnotation.Spec;ops.OpRemoveAnnotation.InitSpec;
ops.OpRemoveBlob=function(){var f,k,a;this.init=function(d){f=d.memberid;k=d.timestamp;a=d.filename};this.isEdit=!0;this.group=void 0;this.execute=function(d){d.getOdfCanvas().odfContainer().removeBlob(a);return!0};this.spec=function(){return{optype:"RemoveBlob",memberid:f,timestamp:k,filename:a}}};ops.OpRemoveBlob.Spec;ops.OpRemoveBlob.InitSpec;
ops.OpRemoveCursor=function(){var f,k;this.init=function(a){f=a.memberid;k=a.timestamp};this.isEdit=!1;this.group=void 0;this.execute=function(a){return a.removeCursor(f)?!0:!1};this.spec=function(){return{optype:"RemoveCursor",memberid:f,timestamp:k}}};ops.OpRemoveCursor.Spec;ops.OpRemoveCursor.InitSpec;
ops.OpRemoveHyperlink=function(){var f,k,a,d,c=core.DomUtils,g=odf.OdfUtils;this.init=function(c){f=c.memberid;k=c.timestamp;a=c.position;d=c.length};this.isEdit=!0;this.group=void 0;this.execute=function(n){var l=n.convertCursorToDomRange(a,d),q=g.getHyperlinkElements(l);runtime.assert(1===q.length,"The given range should only contain a single link.");q=c.mergeIntoParent(q[0]);l.detach();n.fixCursorPositions();n.getOdfCanvas().refreshSize();n.getOdfCanvas().rerenderAnnotations();n.emit(ops.OdtDocument.signalParagraphChanged,
{paragraphElement:g.getParagraphElement(q),memberId:f,timeStamp:k});return!0};this.spec=function(){return{optype:"RemoveHyperlink",memberid:f,timestamp:k,position:a,length:d}}};ops.OpRemoveHyperlink.Spec;ops.OpRemoveHyperlink.InitSpec;
ops.OpRemoveMember=function(){var f,k;this.init=function(a){f=a.memberid;k=parseInt(a.timestamp,10)};this.isEdit=!1;this.group=void 0;this.execute=function(a){if(!a.getMember(f))return!1;a.removeMember(f);a.emit(ops.Document.signalMemberRemoved,f);return!0};this.spec=function(){return{optype:"RemoveMember",memberid:f,timestamp:k}}};ops.OpRemoveMember.Spec;ops.OpRemoveMember.InitSpec;
ops.OpRemoveStyle=function(){var f,k,a,d;this.init=function(c){f=c.memberid;k=c.timestamp;a=c.styleName;d=c.styleFamily};this.isEdit=!0;this.group=void 0;this.execute=function(c){var f=c.getFormatting().getStyleElement(a,d);if(!f)return!1;f.parentNode.removeChild(f);c.getOdfCanvas().refreshCSS();c.emit(ops.OdtDocument.signalCommonStyleDeleted,{name:a,family:d});return!0};this.spec=function(){return{optype:"RemoveStyle",memberid:f,timestamp:k,styleName:a,styleFamily:d}}};ops.OpRemoveStyle.Spec;ops.OpRemoveStyle.InitSpec;
ops.OpRemoveText=function(){var f,k,a,d,c=odf.OdfUtils,g=core.DomUtils;this.init=function(c){runtime.assert(0<=c.length,"OpRemoveText only supports positive lengths");f=c.memberid;k=c.timestamp;a=parseInt(c.position,10);d=parseInt(c.length,10)};this.isEdit=!0;this.group=void 0;this.execute=function(n){var l,q,m,p=n.getCursor(f),b=new odf.CollapsingRules(n.getRootNode());n.upgradeWhitespacesAtPosition(a);n.upgradeWhitespacesAtPosition(a+d);l=n.convertCursorToDomRange(a,d);g.splitBoundaries(l);q=c.getTextElements(l,
!1,!0);m=c.getParagraphElement(l.startContainer,l.startOffset);runtime.assert(void 0!==m,"Attempting to remove text outside a paragraph element");l.detach();q.forEach(function(a){a.parentNode?(runtime.assert(g.containsNode(m,a),"RemoveText only supports removing elements within the same paragraph"),b.mergeChildrenIntoParent(a)):runtime.log("WARN: text element has already been removed from it's container")});n.emit(ops.OdtDocument.signalStepsRemoved,{position:a});n.downgradeWhitespacesAtPosition(a);
n.fixCursorPositions();n.getOdfCanvas().refreshSize();n.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:m,memberId:f,timeStamp:k});p&&(p.resetSelectionType(),n.emit(ops.Document.signalCursorMoved,p));n.getOdfCanvas().rerenderAnnotations();return!0};this.spec=function(){return{optype:"RemoveText",memberid:f,timestamp:k,position:a,length:d}}};ops.OpRemoveText.Spec;ops.OpRemoveText.InitSpec;
ops.OpSetBlob=function(){var f,k,a,d,c;this.init=function(g){f=g.memberid;k=g.timestamp;a=g.filename;d=g.mimetype;c=g.content};this.isEdit=!0;this.group=void 0;this.execute=function(f){f.getOdfCanvas().odfContainer().setBlob(a,d,c);return!0};this.spec=function(){return{optype:"SetBlob",memberid:f,timestamp:k,filename:a,mimetype:d,content:c}}};ops.OpSetBlob.Spec;ops.OpSetBlob.InitSpec;
ops.OpSetParagraphStyle=function(){function f(a,c,d){var f=[a.getPositionFilter()],g=d.container();d=d.unfilteredDomOffset();return!1===a.createStepIterator(g,d,f,c).previousStep()}var k,a,d,c,g=odf.OdfUtils;this.init=function(f){k=f.memberid;a=f.timestamp;d=f.position;c=f.styleName};this.isEdit=!0;this.group=void 0;this.execute=function(n){var l,q;l=n.getIteratorAtPosition(d);return(q=g.getParagraphElement(l.container()))?(runtime.assert(f(n,q,l),"SetParagraphStyle position should be the first position in the paragraph"),
c?q.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:text:1.0","text:style-name",c):q.removeAttributeNS("urn:oasis:names:tc:opendocument:xmlns:text:1.0","style-name"),n.getOdfCanvas().refreshSize(),n.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:q,timeStamp:a,memberId:k}),n.getOdfCanvas().rerenderAnnotations(),!0):!1};this.spec=function(){return{optype:"SetParagraphStyle",memberid:k,timestamp:a,position:d,styleName:c}}};ops.OpSetParagraphStyle.Spec;ops.OpSetParagraphStyle.InitSpec;
ops.OpSplitParagraph=function(){var f,k,a,d,c,g,n=odf.OdfUtils,l=odf.Namespaces.textns;this.init=function(l){f=l.memberid;k=l.timestamp;d=l.position;a=l.sourceParagraphPosition;g=l.paragraphStyleName;c="true"===l.moveCursor||!0===l.moveCursor};this.isEdit=!0;this.group=void 0;this.execute=function(a){var m,p,b,e,r,h,u,x=a.getCursor(f);a.upgradeWhitespacesAtPosition(d);m=a.getTextNodeAtStep(d);if(!m)return!1;p=n.getParagraphElement(m.textNode);if(!p)return!1;b=n.isListItem(p.parentNode)?p.parentNode:
p;0===m.offset?(u=m.textNode.previousSibling,h=null):(u=m.textNode,h=m.offset>=m.textNode.length?null:m.textNode.splitText(m.offset));for(e=m.textNode;e!==b;){e=e.parentNode;r=e.cloneNode(!1);h&&r.appendChild(h);if(u)for(;u&&u.nextSibling;)r.appendChild(u.nextSibling);else for(;e.firstChild;)r.appendChild(e.firstChild);e.parentNode.insertBefore(r,e.nextSibling);u=e;h=r}n.isListItem(h)&&(h=h.childNodes.item(0));g?h.setAttributeNS(l,"text:style-name",g):h.removeAttributeNS(l,"style-name");0===m.textNode.length&&
m.textNode.parentNode.removeChild(m.textNode);a.emit(ops.OdtDocument.signalStepsInserted,{position:d});x&&c&&(a.moveCursor(f,d+1,0),a.emit(ops.Document.signalCursorMoved,x));a.fixCursorPositions();a.getOdfCanvas().refreshSize();a.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:p,memberId:f,timeStamp:k});a.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:h,memberId:f,timeStamp:k});a.getOdfCanvas().rerenderAnnotations();return!0};this.spec=function(){return{optype:"SplitParagraph",
memberid:f,timestamp:k,position:d,sourceParagraphPosition:a,paragraphStyleName:g,moveCursor:c}}};ops.OpSplitParagraph.Spec;ops.OpSplitParagraph.InitSpec;
ops.OpUpdateMember=function(){function f(a){var c="//dc:creator[@editinfo:memberid='"+k+"']";a=xmldom.XPath.getODFElementsWithXPath(a.getRootNode(),c,function(a){return"editinfo"===a?"urn:webodf:names:editinfo":odf.Namespaces.lookupNamespaceURI(a)});for(c=0;c<a.length;c+=1)a[c].textContent=d.fullName}var k,a,d,c;this.init=function(f){k=f.memberid;a=parseInt(f.timestamp,10);d=f.setProperties;c=f.removedProperties};this.isEdit=!1;this.group=void 0;this.execute=function(a){var n=a.getMember(k);if(!n)return!1;
c&&n.removeProperties(c);d&&(n.setProperties(d),d.fullName&&f(a));a.emit(ops.Document.signalMemberUpdated,n);return!0};this.spec=function(){return{optype:"UpdateMember",memberid:k,timestamp:a,setProperties:d,removedProperties:c}}};ops.OpUpdateMember.Spec;ops.OpUpdateMember.InitSpec;
ops.OpUpdateMetadata=function(){var f,k,a,d;this.init=function(c){f=c.memberid;k=parseInt(c.timestamp,10);a=c.setProperties;d=c.removedProperties};this.isEdit=!0;this.group=void 0;this.execute=function(c){c=c.getOdfCanvas().odfContainer();var f=null;d&&(f=d.attributes.split(","));c.setMetadata(a,f);return!0};this.spec=function(){return{optype:"UpdateMetadata",memberid:f,timestamp:k,setProperties:a,removedProperties:d}}};ops.OpUpdateMetadata.Spec;ops.OpUpdateMetadata.InitSpec;
ops.OpUpdateParagraphStyle=function(){function f(a,c){var d,f,b=c?c.split(","):[];for(d=0;d<b.length;d+=1)f=b[d].split(":"),a.removeAttributeNS(odf.Namespaces.lookupNamespaceURI(f[0]),f[1])}var k,a,d,c,g,n=odf.Namespaces.stylens;this.init=function(f){k=f.memberid;a=f.timestamp;d=f.styleName;c=f.setProperties;g=f.removedProperties};this.isEdit=!0;this.group=void 0;this.execute=function(a){var k=a.getFormatting(),m,p,b;return(m=""!==d?k.getStyleElement(d,"paragraph"):k.getDefaultStyleElement("paragraph"))?
(p=m.getElementsByTagNameNS(n,"paragraph-properties").item(0),b=m.getElementsByTagNameNS(n,"text-properties").item(0),c&&k.updateStyle(m,c),g&&(k=g["style:paragraph-properties"],p&&k&&(f(p,k.attributes),0===p.attributes.length&&m.removeChild(p)),k=g["style:text-properties"],b&&k&&(f(b,k.attributes),0===b.attributes.length&&m.removeChild(b)),f(m,g.attributes)),a.getOdfCanvas().refreshCSS(),a.emit(ops.OdtDocument.signalParagraphStyleModified,d),a.getOdfCanvas().rerenderAnnotations(),!0):!1};this.spec=
function(){return{optype:"UpdateParagraphStyle",memberid:k,timestamp:a,styleName:d,setProperties:c,removedProperties:g}}};ops.OpUpdateParagraphStyle.Spec;ops.OpUpdateParagraphStyle.InitSpec;
ops.OperationFactory=function(){function f(a){return function(d){return new a}}var k;this.register=function(a,d){k[a]=d};this.create=function(a){var d=null,c=k[a.optype];c&&(d=c(a),d.init(a));return d};k={AddMember:f(ops.OpAddMember),UpdateMember:f(ops.OpUpdateMember),RemoveMember:f(ops.OpRemoveMember),AddCursor:f(ops.OpAddCursor),ApplyDirectStyling:f(ops.OpApplyDirectStyling),SetBlob:f(ops.OpSetBlob),RemoveBlob:f(ops.OpRemoveBlob),InsertImage:f(ops.OpInsertImage),InsertTable:f(ops.OpInsertTable),
InsertText:f(ops.OpInsertText),RemoveText:f(ops.OpRemoveText),MergeParagraph:f(ops.OpMergeParagraph),SplitParagraph:f(ops.OpSplitParagraph),SetParagraphStyle:f(ops.OpSetParagraphStyle),UpdateParagraphStyle:f(ops.OpUpdateParagraphStyle),AddStyle:f(ops.OpAddStyle),RemoveStyle:f(ops.OpRemoveStyle),MoveCursor:f(ops.OpMoveCursor),RemoveCursor:f(ops.OpRemoveCursor),AddAnnotation:f(ops.OpAddAnnotation),RemoveAnnotation:f(ops.OpRemoveAnnotation),UpdateMetadata:f(ops.OpUpdateMetadata),ApplyHyperlink:f(ops.OpApplyHyperlink),
RemoveHyperlink:f(ops.OpRemoveHyperlink)}};ops.OperationFactory.SpecConstructor;ops.OperationRouter=function(){};ops.OperationRouter.prototype.setOperationFactory=function(f){};ops.OperationRouter.prototype.setPlaybackFunction=function(f){};ops.OperationRouter.prototype.push=function(f){};ops.OperationRouter.prototype.close=function(f){};ops.OperationRouter.prototype.subscribe=function(f,k){};ops.OperationRouter.prototype.unsubscribe=function(f,k){};
ops.OperationRouter.prototype.hasLocalUnsyncedOps=function(){};ops.OperationRouter.prototype.hasSessionHostConnection=function(){};ops.OperationRouter.signalProcessingBatchStart="router/batchstart";ops.OperationRouter.signalProcessingBatchEnd="router/batchend";
ops.TrivialOperationRouter=function(){var f=new core.EventNotifier([ops.OperationRouter.signalProcessingBatchStart,ops.OperationRouter.signalProcessingBatchEnd]),k,a,d=0;this.setOperationFactory=function(a){k=a};this.setPlaybackFunction=function(c){a=c};this.push=function(c){d+=1;f.emit(ops.OperationRouter.signalProcessingBatchStart,{});c.forEach(function(c){c=c.spec();c.timestamp=Date.now();c=k.create(c);c.group="g"+d;a(c)});f.emit(ops.OperationRouter.signalProcessingBatchEnd,{})};this.close=function(a){a()};
this.subscribe=function(a,d){f.subscribe(a,d)};this.unsubscribe=function(a,d){f.unsubscribe(a,d)};this.hasLocalUnsyncedOps=function(){return!1};this.hasSessionHostConnection=function(){return!0}};
ops.Session=function(f){function k(a){c.emit(ops.OdtDocument.signalProcessingBatchStart,a)}function a(a){c.emit(ops.OdtDocument.signalProcessingBatchEnd,a)}var d=new ops.OperationFactory,c=new ops.OdtDocument(f),g=null;this.setOperationFactory=function(a){d=a;g&&g.setOperationFactory(d)};this.setOperationRouter=function(f){g&&(g.unsubscribe(ops.OperationRouter.signalProcessingBatchStart,k),g.unsubscribe(ops.OperationRouter.signalProcessingBatchEnd,a));g=f;g.subscribe(ops.OperationRouter.signalProcessingBatchStart,
k);g.subscribe(ops.OperationRouter.signalProcessingBatchEnd,a);f.setPlaybackFunction(function(a){c.emit(ops.OdtDocument.signalOperationStart,a);return a.execute(c)?(c.emit(ops.OdtDocument.signalOperationEnd,a),!0):!1});f.setOperationFactory(d)};this.getOperationFactory=function(){return d};this.getOdtDocument=function(){return c};this.enqueue=function(a){g.push(a)};this.close=function(a){g.close(function(d){d?a(d):c.close(a)})};this.destroy=function(a){c.destroy(a)};this.setOperationRouter(new ops.TrivialOperationRouter)};
gui.AnnotationController=function(f,k,a){function d(){var b=l.getCursor(a),b=b&&b.getNode(),c=!1;b&&(c=!p.isWithinAnnotation(b,l.getRootNode()));c!==q&&(q=c,m.emit(gui.AnnotationController.annotatableChanged,q))}function c(b){b.getMemberId()===a&&d()}function g(b){b===a&&d()}function n(b){b.getMemberId()===a&&d()}var l=f.getOdtDocument(),q=!1,m=new core.EventNotifier([gui.AnnotationController.annotatableChanged]),p=odf.OdfUtils,b=core.StepDirection.NEXT;this.isAnnotatable=function(){return q};this.addAnnotation=
function(){var b=new ops.OpAddAnnotation,c=l.getCursorSelection(a),d=c.length,c=c.position;q&&(c=0<=d?c:c+d,d=Math.abs(d),b.init({memberid:a,position:c,length:d,name:a+Date.now()}),f.enqueue([b]))};this.removeAnnotation=function(c){var d,h;d=l.getMember(a).getProperties().fullName;if(!0!==k.getState(gui.CommonConstraints.EDIT.ANNOTATIONS.ONLY_DELETE_OWN)||d===p.getAnnotationCreator(c))d=l.convertDomPointToCursorStep(c,0,b),h=l.convertDomPointToCursorStep(c,c.childNodes.length),c=new ops.OpRemoveAnnotation,
c.init({memberid:a,position:d,length:h-d}),h=new ops.OpMoveCursor,h.init({memberid:a,position:0<d?d-1:d,length:0}),f.enqueue([c,h])};this.subscribe=function(b,a){m.subscribe(b,a)};this.unsubscribe=function(b,a){m.unsubscribe(b,a)};this.destroy=function(b){l.unsubscribe(ops.Document.signalCursorAdded,c);l.unsubscribe(ops.Document.signalCursorRemoved,g);l.unsubscribe(ops.Document.signalCursorMoved,n);b()};k.registerConstraint(gui.CommonConstraints.EDIT.ANNOTATIONS.ONLY_DELETE_OWN);l.subscribe(ops.Document.signalCursorAdded,
c);l.subscribe(ops.Document.signalCursorRemoved,g);l.subscribe(ops.Document.signalCursorMoved,n);d()};gui.AnnotationController.annotatableChanged="annotatable/changed";
gui.Avatar=function(f,k){var a=this,d,c,g;this.setColor=function(a){c.style.borderColor=a};this.setImageUrl=function(d){a.isVisible()?c.src=d:g=d};this.isVisible=function(){return"block"===d.style.display};this.show=function(){g&&(c.src=g,g=void 0);d.style.display="block"};this.hide=function(){d.style.display="none"};this.markAsFocussed=function(a){a?d.classList.add("active"):d.classList.remove("active")};this.destroy=function(a){f.removeChild(d);a()};(function(){var a=f.ownerDocument;d=a.createElement("div");
c=a.createElement("img");d.appendChild(c);d.style.display=k?"block":"none";d.className="handle";f.appendChild(d)})()};gui.StepInfo=function(){};gui.StepInfo.VisualDirection={LEFT_TO_RIGHT:0,RIGHT_TO_LEFT:1};gui.StepInfo.prototype.token;gui.StepInfo.prototype.container=function(){};gui.StepInfo.prototype.offset=function(){};gui.StepInfo.prototype.direction;gui.StepInfo.prototype.visualDirection;gui.VisualStepScanner=function(){};gui.VisualStepScanner.prototype.token;
gui.VisualStepScanner.prototype.process=function(f,k,a){};
gui.GuiStepUtils=function(){function f(c){c=a.getContentBounds(c);var f,g=null;if(c)if(c.container.nodeType===Node.TEXT_NODE)f=c.container.ownerDocument.createRange(),f.setStart(c.container,c.startOffset),f.setEnd(c.container,c.endOffset),(g=0<f.getClientRects().length?f.getBoundingClientRect():null)&&" "===c.container.data.substring(c.startOffset,c.endOffset)&&1>=g.width&&(g=null),f.detach();else if(k.isCharacterElement(c.container)||k.isCharacterFrame(c.container))g=d.getBoundingClientRect(c.container);
return g}var k=odf.OdfUtils,a=new odf.StepUtils,d=core.DomUtils,c=core.StepDirection.NEXT,g=gui.StepInfo.VisualDirection.LEFT_TO_RIGHT,n=gui.StepInfo.VisualDirection.RIGHT_TO_LEFT;this.getContentRect=f;this.moveToFilteredStep=function(a,d,k){function p(b,a){a.process(v,h,u)&&(b=!0,!x&&a.token&&(x=a.token));return b}var b=d===c,e,r,h,u,x,z=a.snapshot();e=!1;var v;do e=f(a),v={token:a.snapshot(),container:a.container,offset:a.offset,direction:d,visualDirection:d===c?g:n},r=a.nextStep()?f(a):null,a.restore(v.token),
b?(h=e,u=r):(h=r,u=e),e=k.reduce(p,!1);while(!e&&a.advanceStep(d));e||k.forEach(function(b){!x&&b.token&&(x=b.token)});a.restore(x||z);return Boolean(x)}};
gui.Caret=function(f,k,a,d){function c(){b.style.opacity="0"===b.style.opacity?"1":"0";w.trigger()}function g(){u.selectNodeContents(h);return u.getBoundingClientRect()}function n(b){return F[b]!==G[b]}function l(){Object.keys(G).forEach(function(b){F[b]=G[b]})}function q(){if(!1===G.isShown||f.getSelectionType()!==ops.OdtCursor.RangeSelection||!d&&!f.getSelectedRange().collapsed)G.visibility="hidden",b.style.visibility="hidden",w.cancel();else if(G.visibility="visible",b.style.visibility="visible",
!1===G.isFocused)b.style.opacity="1",w.cancel();else{if(E||n("visibility"))b.style.opacity="1",w.cancel();w.trigger()}if(I||N){var a;a=f.getNode();var c,h,m=z.getBoundingClientRect(x.getSizer()),q=!1,u=0;a.removeAttributeNS("urn:webodf:names:cursor","caret-sizer-active");if(0<a.getClientRects().length)h=g(),u=h.left-z.getBoundingClientRect(a).left,q=!0;else if(s.setPosition(a,0),h=v.getContentRect(s),!h&&s.nextStep()&&(c=v.getContentRect(s))&&(h=c,q=!0),h||(a.setAttributeNS("urn:webodf:names:cursor",
"caret-sizer-active","true"),h=g(),q=!0),!h)for(runtime.log("WARN: No suitable client rectangle found for visual caret for "+f.getMemberId());a;){if(0<a.getClientRects().length){h=z.getBoundingClientRect(a);q=!0;break}a=a.parentNode}h=z.translateRect(h,m,x.getZoomLevel());a={top:h.top,height:h.height,right:q?h.left:h.right,width:z.adaptRangeDifferenceToZoomLevel(u,x.getZoomLevel())};8>a.height&&(a={top:a.top-(8-a.height)/2,height:8,right:a.right});p.style.height=a.height+"px";p.style.top=a.top+"px";
p.style.left=a.right-a.width+"px";p.style.width=a.width?a.width+"px":"";r&&(a=runtime.getWindow().getComputedStyle(f.getNode(),null),a.font?r.style.font=a.font:(r.style.fontStyle=a.fontStyle,r.style.fontVariant=a.fontVariant,r.style.fontWeight=a.fontWeight,r.style.fontSize=a.fontSize,r.style.lineHeight=a.lineHeight,r.style.fontFamily=a.fontFamily))}G.isShown&&N&&k.scrollIntoView(b.getBoundingClientRect());n("isFocused")&&e.markAsFocussed(G.isFocused);l();I=N=E=!1}function m(b){p.parentNode.removeChild(p);
h.parentNode.removeChild(h);b()}var p,b,e,r,h,u,x=f.getDocument().getCanvas(),z=core.DomUtils,v=new gui.GuiStepUtils,s,A,w,E=!1,N=!1,I=!1,G={isFocused:!1,isShown:!0,visibility:"hidden"},F={isFocused:!G.isFocused,isShown:!G.isShown,visibility:"hidden"};this.handleUpdate=function(){I=!0;A.trigger()};this.refreshCursorBlinking=function(){E=!0;A.trigger()};this.setFocus=function(){G.isFocused=!0;A.trigger()};this.removeFocus=function(){G.isFocused=!1;A.trigger()};this.show=function(){G.isShown=!0;A.trigger()};
this.hide=function(){G.isShown=!1;A.trigger()};this.setAvatarImageUrl=function(b){e.setImageUrl(b)};this.setColor=function(a){b.style.borderColor=a;e.setColor(a)};this.getCursor=function(){return f};this.getFocusElement=function(){return b};this.toggleHandleVisibility=function(){e.isVisible()?e.hide():e.show()};this.showHandle=function(){e.show()};this.hideHandle=function(){e.hide()};this.setOverlayElement=function(b){r=b;p.appendChild(b);I=!0;A.trigger()};this.ensureVisible=function(){N=!0;A.trigger()};
this.getBoundingClientRect=function(){return z.getBoundingClientRect(p)};this.destroy=function(b){core.Async.destroyAll([A.destroy,w.destroy,e.destroy,m],b)};(function(){var d=f.getDocument(),g=[d.createRootFilter(f.getMemberId()),d.getPositionFilter()],l=d.getDOMDocument();u=l.createRange();h=l.createElement("span");h.className="webodf-caretSizer";h.textContent="|";f.getNode().appendChild(h);p=l.createElement("div");p.setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",f.getMemberId());
p.className="webodf-caretOverlay";b=l.createElement("div");b.className="caret";p.appendChild(b);e=new gui.Avatar(p,a);x.getSizer().appendChild(p);s=d.createStepIterator(f.getNode(),0,g,d.getRootNode());A=core.Task.createRedrawTask(q);w=core.Task.createTimeoutTask(c,500);A.triggerImmediate()})()};
odf.TextSerializer=function(){function f(d){var c="",g=k.filter?k.filter.acceptNode(d):NodeFilter.FILTER_ACCEPT,n=d.nodeType,l;if((g===NodeFilter.FILTER_ACCEPT||g===NodeFilter.FILTER_SKIP)&&a.isTextContentContainingNode(d))for(l=d.firstChild;l;)c+=f(l),l=l.nextSibling;g===NodeFilter.FILTER_ACCEPT&&(n===Node.ELEMENT_NODE&&a.isParagraph(d)?c+="\n":n===Node.TEXT_NODE&&d.textContent&&(c+=d.textContent));return c}var k=this,a=odf.OdfUtils;this.filter=null;this.writeToString=function(a){if(!a)return"";
a=f(a);"\n"===a[a.length-1]&&(a=a.substr(0,a.length-1));return a}};gui.MimeDataExporter=function(){var f;this.exportRangeToDataTransfer=function(k,a){var d;d=a.startContainer.ownerDocument.createElement("span");d.appendChild(a.cloneContents());d=f.writeToString(d);try{k.setData("text/plain",d)}catch(c){k.setData("Text",d)}};f=new odf.TextSerializer;f.filter=new odf.OdfNodeFilter};
gui.Clipboard=function(f){this.setDataFromRange=function(k,a){var d,c=k.clipboardData;d=runtime.getWindow();!c&&d&&(c=d.clipboardData);c?(d=!0,f.exportRangeToDataTransfer(c,a),k.preventDefault()):d=!1;return d}};
gui.SessionContext=function(f,k){var a=f.getOdtDocument(),d=odf.OdfUtils;this.isLocalCursorWithinOwnAnnotation=function(){var c=a.getCursor(k),f;if(!c)return!1;f=c&&c.getNode();c=a.getMember(k).getProperties().fullName;return(f=d.getParentAnnotation(f,a.getRootNode()))&&d.getAnnotationCreator(f)===c?!0:!1}};
gui.StyleSummary=function(f){function k(a,d){var l=a+"|"+d,k;c.hasOwnProperty(l)||(k=[],f.forEach(function(c){c=(c=c.styleProperties[a])&&c[d];-1===k.indexOf(c)&&k.push(c)}),c[l]=k);return c[l]}function a(a,c,d){return function(){var f=k(a,c);return d.length>=f.length&&f.every(function(a){return-1!==d.indexOf(a)})}}function d(a,c){var d=k(a,c);return 1===d.length?d[0]:void 0}var c={};this.getPropertyValues=k;this.getCommonValue=d;this.isBold=a("style:text-properties","fo:font-weight",["bold"]);this.isItalic=
a("style:text-properties","fo:font-style",["italic"]);this.hasUnderline=a("style:text-properties","style:text-underline-style",["solid"]);this.hasStrikeThrough=a("style:text-properties","style:text-line-through-style",["solid"]);this.fontSize=function(){var a=d("style:text-properties","fo:font-size");return a&&parseFloat(a)};this.fontName=function(){return d("style:text-properties","style:font-name")};this.isAlignedLeft=a("style:paragraph-properties","fo:text-align",["left","start"]);this.isAlignedCenter=
a("style:paragraph-properties","fo:text-align",["center"]);this.isAlignedRight=a("style:paragraph-properties","fo:text-align",["right","end"]);this.isAlignedJustified=a("style:paragraph-properties","fo:text-align",["justify"]);this.text={isBold:this.isBold,isItalic:this.isItalic,hasUnderline:this.hasUnderline,hasStrikeThrough:this.hasStrikeThrough,fontSize:this.fontSize,fontName:this.fontName};this.paragraph={isAlignedLeft:this.isAlignedLeft,isAlignedCenter:this.isAlignedCenter,isAlignedRight:this.isAlignedRight,
isAlignedJustified:this.isAlignedJustified}};
gui.DirectFormattingController=function(f,k,a,d,c,g,n){function l(){return Y.value().styleSummary}function q(){return Y.value().enabledFeatures}function m(b){var a;b.collapsed?(a=b.startContainer,a.hasChildNodes()&&b.startOffset<a.childNodes.length&&(a=a.childNodes.item(b.startOffset)),b=[a]):b=P.getTextElements(b,!0,!1);return b}function p(){var b=C.getCursor(d),c=b&&b.getSelectedRange(),e=[],e=[],f=!0,h={directTextStyling:!0,directParagraphStyling:!0};c&&(e=m(c),0===e.length&&(e=[c.startContainer,
c.endContainer],f=!1),e=C.getFormatting().getAppliedStyles(e));void 0!==e[0]&&W&&(e[0].styleProperties=O.mergeObjects(e[0].styleProperties,W));!0===k.getState(gui.CommonConstraints.EDIT.REVIEW_MODE)&&(h.directTextStyling=h.directParagraphStyling=a.isLocalCursorWithinOwnAnnotation());h.directTextStyling&&(h.directTextStyling=f&&void 0!==b&&b.getSelectionType()===ops.OdtCursor.RangeSelection);return{enabledFeatures:h,appliedStyles:e,styleSummary:new gui.StyleSummary(e)}}function b(b,a){var c={};Object.keys(b).forEach(function(e){var d=
b[e](),f=a[e]();d!==f&&(c[e]=f)});return c}function e(){var a,c;c=H.styleSummary;var e=Y.value(),d=e.styleSummary,f=H.enabledFeatures,h=e.enabledFeatures;a=b(c.text,d.text);c=b(c.paragraph,d.paragraph);f=!(h.directTextStyling===f.directTextStyling&&h.directParagraphStyling===f.directParagraphStyling);H=e;f&&ca.emit(gui.DirectFormattingController.enabledChanged,h);0<Object.keys(a).length&&ca.emit(gui.DirectFormattingController.textStylingChanged,a);0<Object.keys(c).length&&ca.emit(gui.DirectFormattingController.paragraphStylingChanged,
c)}function r(){Y.reset();e()}function h(b){("string"===typeof b?b:b.getMemberId())===d&&Y.reset()}function u(){Y.reset()}function x(b){var a=C.getCursor(d);b=b.paragraphElement;a&&P.getParagraphElement(a.getNode())===b&&Y.reset()}function z(b,a){a(!b());return!0}function v(b){if(q().directTextStyling){var a=C.getCursorSelection(d),c={"style:text-properties":b};0!==a.length?(b=new ops.OpApplyDirectStyling,b.init({memberid:d,position:a.position,length:a.length,setProperties:c}),f.enqueue([b])):(W=
O.mergeObjects(W||{},c),Y.reset())}}function s(b,a){var c={};c[b]=a;v(c)}function A(b){b=b.spec();W&&b.memberid===d&&"SplitParagraph"!==b.optype&&(W=null,Y.reset())}function w(b){s("fo:font-weight",b?"bold":"normal")}function E(b){s("fo:font-style",b?"italic":"normal")}function N(b){s("style:text-underline-style",b?"solid":"none")}function I(b){s("style:text-line-through-style",b?"solid":"none")}function G(b){if(q().directParagraphStyling){var a=C.getCursor(d).getSelectedRange(),a=P.getParagraphElements(a),
e=C.getFormatting(),h=[],g={},l;a.forEach(function(a){var f=C.convertDomPointToCursorStep(a,0,da),k=a.getAttributeNS(odf.Namespaces.textns,"style-name"),m;a=k?g.hasOwnProperty(k)?g[k]:void 0:l;a||(a=c.generateStyleName(),k?(g[k]=a,m=e.createDerivedStyleObject(k,"paragraph",{})):(l=a,m={}),m=b(m),k=new ops.OpAddStyle,k.init({memberid:d,styleName:a.toString(),styleFamily:"paragraph",isAutomaticStyle:!0,setProperties:m}),h.push(k));k=new ops.OpSetParagraphStyle;k.init({memberid:d,styleName:a.toString(),
position:f});h.push(k)});f.enqueue(h)}}function F(b){G(function(a){return O.mergeObjects(a,b)})}function K(b){F({"style:paragraph-properties":{"fo:text-align":b}})}function t(b,a){var c=C.getFormatting().getDefaultTabStopDistance(),e=a["style:paragraph-properties"],d;e&&(e=e["fo:margin-left"],d=P.parseLength(e));return O.mergeObjects(a,{"style:paragraph-properties":{"fo:margin-left":d&&d.unit===c.unit?d.value+b*c.value+d.unit:b*c.value+c.unit}})}function y(b,a){var c=m(b),c=0===c.length?[b.startContainer]:
c,c=C.getFormatting().getAppliedStyles(c),e=0<c.length?c[0].styleProperties:void 0,d=C.getFormatting().getAppliedStylesForElement(a).styleProperties;if(!e||"text"!==e["style:family"]||!e["style:text-properties"])return!1;if(!d||!d["style:text-properties"])return!0;e=e["style:text-properties"];d=d["style:text-properties"];return!Object.keys(e).every(function(b){return e[b]===d[b]})}function D(){}function U(){return!1}var B=this,C=f.getOdtDocument(),O=new core.Utils,P=odf.OdfUtils,ca=new core.EventNotifier([gui.DirectFormattingController.enabledChanged,
gui.DirectFormattingController.textStylingChanged,gui.DirectFormattingController.paragraphStylingChanged]),ba=odf.Namespaces.textns,da=core.StepDirection.NEXT,W=null,H,Y;this.enabledFeatures=q;this.formatTextSelection=v;this.createCursorStyleOp=function(b,a,c){var e=null,f=W;c&&(f=(c=Y.value().appliedStyles[0])&&c.styleProperties);f&&f["style:text-properties"]&&(e=new ops.OpApplyDirectStyling,e.init({memberid:d,position:b,length:a,setProperties:{"style:text-properties":f["style:text-properties"]}}),
W=null,Y.reset());return e};this.setBold=w;this.setItalic=E;this.setHasUnderline=N;this.setHasStrikethrough=I;this.setFontSize=function(b){s("fo:font-size",b+"pt")};this.setFontName=function(b){s("style:font-name",b)};this.getAppliedStyles=function(){return Y.value().appliedStyles};this.toggleBold=z.bind(B,function(){return l().isBold()},w);this.toggleItalic=z.bind(B,function(){return l().isItalic()},E);this.toggleUnderline=z.bind(B,function(){return l().hasUnderline()},N);this.toggleStrikethrough=
z.bind(B,function(){return l().hasStrikeThrough()},I);this.isBold=function(){return l().isBold()};this.isItalic=function(){return l().isItalic()};this.hasUnderline=function(){return l().hasUnderline()};this.hasStrikeThrough=function(){return l().hasStrikeThrough()};this.fontSize=function(){return l().fontSize()};this.fontName=function(){return l().fontName()};this.isAlignedLeft=function(){return l().isAlignedLeft()};this.isAlignedCenter=function(){return l().isAlignedCenter()};this.isAlignedRight=
function(){return l().isAlignedRight()};this.isAlignedJustified=function(){return l().isAlignedJustified()};this.alignParagraphLeft=function(){K("left");return!0};this.alignParagraphCenter=function(){K("center");return!0};this.alignParagraphRight=function(){K("right");return!0};this.alignParagraphJustified=function(){K("justify");return!0};this.indent=function(){G(t.bind(null,1));return!0};this.outdent=function(){G(t.bind(null,-1));return!0};this.createParagraphStyleOps=function(b){if(!q().directParagraphStyling)return[];
var a=C.getCursor(d),e=a.getSelectedRange(),f=[],h,g;a.hasForwardSelection()?(h=a.getAnchorNode(),g=a.getNode()):(h=a.getNode(),g=a.getAnchorNode());a=P.getParagraphElement(g);runtime.assert(Boolean(a),"DirectFormattingController: Cursor outside paragraph");var l=a,k=[C.getPositionFilter(),C.createRootFilter(d)];if(!1!==C.createStepIterator(e.endContainer,e.endOffset,k,l).nextStep())return f;g!==h&&(a=P.getParagraphElement(h));if(!W&&!y(e,a))return f;e=(e=Y.value().appliedStyles[0])&&e.styleProperties;
if(!e)return f;if(a=a.getAttributeNS(ba,"style-name"))e={"style:text-properties":e["style:text-properties"]},e=C.getFormatting().createDerivedStyleObject(a,"paragraph",e);h=c.generateStyleName();a=new ops.OpAddStyle;a.init({memberid:d,styleName:h,styleFamily:"paragraph",isAutomaticStyle:!0,setProperties:e});f.push(a);a=new ops.OpSetParagraphStyle;a.init({memberid:d,styleName:h,position:b});f.push(a);return f};this.subscribe=function(b,a){ca.subscribe(b,a)};this.unsubscribe=function(b,a){ca.unsubscribe(b,
a)};this.destroy=function(b){C.unsubscribe(ops.Document.signalCursorAdded,h);C.unsubscribe(ops.Document.signalCursorRemoved,h);C.unsubscribe(ops.Document.signalCursorMoved,h);C.unsubscribe(ops.OdtDocument.signalParagraphStyleModified,u);C.unsubscribe(ops.OdtDocument.signalParagraphChanged,x);C.unsubscribe(ops.OdtDocument.signalOperationEnd,A);C.unsubscribe(ops.OdtDocument.signalProcessingBatchEnd,e);k.unsubscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,r);b()};(function(){C.subscribe(ops.Document.signalCursorAdded,
h);C.subscribe(ops.Document.signalCursorRemoved,h);C.subscribe(ops.Document.signalCursorMoved,h);C.subscribe(ops.OdtDocument.signalParagraphStyleModified,u);C.subscribe(ops.OdtDocument.signalParagraphChanged,x);C.subscribe(ops.OdtDocument.signalOperationEnd,A);C.subscribe(ops.OdtDocument.signalProcessingBatchEnd,e);k.subscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,r);Y=new core.LazyProperty(p);H=Y.value();g||(B.formatTextSelection=D,B.setBold=D,B.setItalic=D,B.setHasUnderline=D,B.setHasStrikethrough=
D,B.setFontSize=D,B.setFontName=D,B.toggleBold=U,B.toggleItalic=U,B.toggleUnderline=U,B.toggleStrikethrough=U);n||(B.alignParagraphCenter=D,B.alignParagraphJustified=D,B.alignParagraphLeft=D,B.alignParagraphRight=D,B.createParagraphStyleOps=function(){return[]},B.indent=D,B.outdent=D)})()};gui.DirectFormattingController.enabledChanged="enabled/changed";gui.DirectFormattingController.textStylingChanged="textStyling/changed";gui.DirectFormattingController.paragraphStylingChanged="paragraphStyling/changed";
gui.DirectFormattingController.SelectionInfo=function(){this.enabledFeatures;this.appliedStyles;this.styleSummary};
gui.KeyboardHandler=function(){function f(a,d){d||(d=k.None);switch(a){case gui.KeyboardHandler.KeyCode.LeftMeta:case gui.KeyboardHandler.KeyCode.RightMeta:case gui.KeyboardHandler.KeyCode.MetaInMozilla:d|=k.Meta;break;case gui.KeyboardHandler.KeyCode.Ctrl:d|=k.Ctrl;break;case gui.KeyboardHandler.KeyCode.Alt:d|=k.Alt;break;case gui.KeyboardHandler.KeyCode.Shift:d|=k.Shift}return a+":"+d}var k=gui.KeyboardHandler.Modifier,a=null,d={};this.setDefault=function(c){a=c};this.bind=function(a,g,k,l){a=f(a,
g);runtime.assert(l||!1===d.hasOwnProperty(a),"tried to overwrite the callback handler of key combo: "+a);d[a]=k};this.unbind=function(a,g){var k=f(a,g);delete d[k]};this.reset=function(){a=null;d={}};this.handleEvent=function(c){var g=c.keyCode,n=k.None;c.metaKey&&(n|=k.Meta);c.ctrlKey&&(n|=k.Ctrl);c.altKey&&(n|=k.Alt);c.shiftKey&&(n|=k.Shift);g=f(g,n);g=d[g];n=!1;g?n=g():null!==a&&(n=a(c));n&&(c.preventDefault?c.preventDefault():c.returnValue=!1)}};
gui.KeyboardHandler.Modifier={None:0,Meta:1,Ctrl:2,Alt:4,CtrlAlt:6,Shift:8,MetaShift:9,CtrlShift:10,AltShift:12};gui.KeyboardHandler.KeyCode={Backspace:8,Tab:9,Clear:12,Enter:13,Shift:16,Ctrl:17,Alt:18,End:35,Home:36,Left:37,Up:38,Right:39,Down:40,Delete:46,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,LeftMeta:91,RightMeta:93,MetaInMozilla:224};
gui.HyperlinkClickHandler=function(f,k,a){function d(){var b=f();runtime.assert(Boolean(b.classList),"Document container has no classList element");b.classList.remove("webodf-inactiveLinks")}function c(){var b=f();runtime.assert(Boolean(b.classList),"Document container has no classList element");b.classList.add("webodf-inactiveLinks")}function g(){b.removeEventListener("focus",c,!1);r.forEach(function(b){k.unbind(b.keyCode,b.modifier);a.unbind(b.keyCode,b.modifier)});r.length=0}function n(e){g();
if(e!==l.None){b.addEventListener("focus",c,!1);switch(e){case l.Ctrl:r.push({keyCode:q.Ctrl,modifier:l.None});break;case l.Meta:r.push({keyCode:q.LeftMeta,modifier:l.None}),r.push({keyCode:q.RightMeta,modifier:l.None}),r.push({keyCode:q.MetaInMozilla,modifier:l.None})}r.forEach(function(b){k.bind(b.keyCode,b.modifier,d);a.bind(b.keyCode,b.modifier,c)})}}var l=gui.KeyboardHandler.Modifier,q=gui.KeyboardHandler.KeyCode,m=xmldom.XPath,p=odf.OdfUtils,b=runtime.getWindow(),e=l.None,r=[];runtime.assert(null!==
b,"Expected to be run in an environment which has a global window, like a browser.");this.handleClick=function(a){var c=a.target||a.srcElement,d,g;a.ctrlKey?d=l.Ctrl:a.metaKey&&(d=l.Meta);if(e===l.None||e===d){a:{for(;null!==c;){if(p.isHyperlink(c))break a;if(p.isParagraph(c))break;c=c.parentNode}c=null}c&&(c=p.getHyperlinkTarget(c),""!==c&&("#"===c[0]?(c=c.substring(1),d=f(),g=m.getODFElementsWithXPath(d,"//text:bookmark-start[@text:name='"+c+"']",odf.Namespaces.lookupNamespaceURI),0===g.length&&
(g=m.getODFElementsWithXPath(d,"//text:bookmark[@text:name='"+c+"']",odf.Namespaces.lookupNamespaceURI)),0<g.length&&g[0].scrollIntoView(!0)):b.open(c),a.preventDefault?a.preventDefault():a.returnValue=!1))}};this.setModifier=function(b){e!==b&&(runtime.assert(b===l.None||b===l.Ctrl||b===l.Meta,"Unsupported KeyboardHandler.Modifier value: "+b),e=b,e!==l.None?c():d(),n(e))};this.getModifier=function(){return e};this.destroy=function(b){c();g();b()}};
gui.EventManager=function(f){function k(b){function a(b,c,e){var d,f=!1;d="on"+c;b.attachEvent&&(b.attachEvent(d,e),f=!0);!f&&b.addEventListener&&(b.addEventListener(c,e,!1),f=!0);f&&!A[c]||!b.hasOwnProperty(d)||(b[d]=e)}function c(b,a,e){var d="on"+a;b.detachEvent&&b.detachEvent(d,e);b.removeEventListener&&b.removeEventListener(a,e,!1);b[d]===e&&(b[d]=null)}function e(a){if(-1===f.indexOf(a)){f.push(a);if(d.filters.every(function(b){return b(a)}))try{h.emit(b,a)}catch(c){runtime.log("Error occurred while processing "+
b+":\n"+c.message+"\n"+c.stack)}runtime.setTimeout(function(){f.splice(f.indexOf(a),1)},0)}}var d=this,f=[],h=new core.EventNotifier([b]);this.filters=[];this.subscribe=function(a){h.subscribe(b,a)};this.unsubscribe=function(a){h.unsubscribe(b,a)};this.destroy=function(){c(s,b,e);c(I,b,e);c(G,b,e)};w[b]&&a(s,b,e);a(I,b,e);a(G,b,e)}function a(b,a,c){function e(a){c(a,d,function(a){a.type=b;f.emit(b,a)})}var d={},f=new core.EventNotifier([b]);this.subscribe=function(a){f.subscribe(b,a)};this.unsubscribe=
function(a){f.unsubscribe(b,a)};this.destroy=function(){a.forEach(function(b){F.unsubscribe(b,e)})};(function(){a.forEach(function(b){F.subscribe(b,e)})})()}function d(b){runtime.clearTimeout(b);delete K[b]}function c(b,a){var c=runtime.setTimeout(function(){b();d(c)},a);K[c]=!0;return c}function g(b,a,e){var f=b.touches.length,h=b.touches[0],g=a.timer;"touchmove"===b.type||"touchend"===b.type?g&&d(g):"touchstart"===b.type&&(1!==f?runtime.clearTimeout(g):g=c(function(){e({clientX:h.clientX,clientY:h.clientY,
pageX:h.pageX,pageY:h.pageY,target:b.target||b.srcElement||null,detail:1})},400));a.timer=g}function n(b,a,c){var e=b.touches[0],d=b.target||b.srcElement||null,f=a.target;1!==b.touches.length||"touchend"===b.type?f=null:"touchstart"===b.type&&"webodf-draggable"===d.getAttribute("class")?f=d:"touchmove"===b.type&&f&&(b.preventDefault(),b.stopPropagation(),c({clientX:e.clientX,clientY:e.clientY,pageX:e.pageX,pageY:e.pageY,target:f,detail:1}));a.target=f}function l(b,a,c){var e=b.target||b.srcElement||
null,d=a.dragging;"drag"===b.type?d=!0:"touchend"===b.type&&d&&(d=!1,b=b.changedTouches[0],c({clientX:b.clientX,clientY:b.clientY,pageX:b.pageX,pageY:b.pageY,target:e,detail:1}));a.dragging=d}function q(){G.classList.add("webodf-touchEnabled");F.unsubscribe("touchstart",q)}function m(b){var a=b.scrollX,c=b.scrollY;this.restore=function(){b.scrollX===a&&b.scrollY===c||b.scrollTo(a,c)}}function p(b){var a=b.scrollTop,c=b.scrollLeft;this.restore=function(){if(b.scrollTop!==a||b.scrollLeft!==c)b.scrollTop=
a,b.scrollLeft=c}}function b(b,a){var c=N[b]||E[b]||null;!c&&a&&(c=N[b]=new k(b));return c}function e(a,c){b(a,!0).subscribe(c)}function r(a,c){var e=b(a,!1);e&&e.unsubscribe(c)}function h(){return f.getDOMDocument().activeElement===I}function u(){h()&&I.blur();I.setAttribute("disabled","true")}function x(){I.removeAttribute("disabled")}function z(b){for(var a=[];b;)(b.scrollWidth>b.clientWidth||b.scrollHeight>b.clientHeight)&&a.push(new p(b)),b=b.parentNode;a.push(new m(s));return a}function v(){var b;
h()||(b=z(I),x(),I.focus(),b.forEach(function(b){b.restore()}))}var s=runtime.getWindow(),A={beforecut:!0,beforepaste:!0,longpress:!0,drag:!0,dragstop:!0},w={mousedown:!0,mouseup:!0,focus:!0},E={},N={},I,G=f.getCanvas().getElement(),F=this,K={};this.addFilter=function(a,c){b(a,!0).filters.push(c)};this.removeFilter=function(a,c){var e=b(a,!0),d=e.filters.indexOf(c);-1!==d&&e.filters.splice(d,1)};this.subscribe=e;this.unsubscribe=r;this.hasFocus=h;this.focus=v;this.getEventTrap=function(){return I};
this.setEditing=function(b){var a=h();a&&I.blur();b?I.removeAttribute("readOnly"):I.setAttribute("readOnly","true");a&&v()};this.destroy=function(b){r("touchstart",q);Object.keys(K).forEach(function(b){d(parseInt(b,10))});K.length=0;Object.keys(E).forEach(function(b){E[b].destroy()});E={};r("mousedown",u);r("mouseup",x);r("contextmenu",x);Object.keys(N).forEach(function(b){N[b].destroy()});N={};I.parentNode.removeChild(I);b()};(function(){var b=f.getOdfCanvas().getSizer(),c=b.ownerDocument;runtime.assert(Boolean(s),
"EventManager requires a window object to operate correctly");I=c.createElement("textarea");I.id="eventTrap";I.setAttribute("tabindex","-1");I.setAttribute("readOnly","true");I.setAttribute("rows","1");b.appendChild(I);e("mousedown",u);e("mouseup",x);e("contextmenu",x);E.longpress=new a("longpress",["touchstart","touchmove","touchend"],g);E.drag=new a("drag",["touchstart","touchmove","touchend"],n);E.dragstop=new a("dragstop",["drag","touchend"],l);e("touchstart",q)})()};
gui.IOSSafariSupport=function(f){function k(){a.innerHeight!==a.outerHeight&&(d.style.display="none",runtime.requestAnimationFrame(function(){d.style.display="block"}))}var a=runtime.getWindow(),d=f.getEventTrap();this.destroy=function(a){f.unsubscribe("focus",k);d.removeAttribute("autocapitalize");d.style.WebkitTransform="";a()};f.subscribe("focus",k);d.setAttribute("autocapitalize","off");d.style.WebkitTransform="translateX(-10000px)"};
gui.HyperlinkController=function(f,k,a,d){function c(){var c=!0;!0===k.getState(gui.CommonConstraints.EDIT.REVIEW_MODE)&&(c=a.isLocalCursorWithinOwnAnnotation());c!==m&&(m=c,q.emit(gui.HyperlinkController.enabledChanged,m))}function g(a){a.getMemberId()===d&&c()}var n=odf.OdfUtils,l=f.getOdtDocument(),q=new core.EventNotifier([gui.HyperlinkController.enabledChanged]),m=!1;this.isEnabled=function(){return m};this.subscribe=function(a,b){q.subscribe(a,b)};this.unsubscribe=function(a,b){q.unsubscribe(a,
b)};this.addHyperlink=function(a,b){if(m){var c=l.getCursorSelection(d),g=new ops.OpApplyHyperlink,h=[];if(0===c.length||b)b=b||a,g=new ops.OpInsertText,g.init({memberid:d,position:c.position,text:b}),c.length=b.length,h.push(g);g=new ops.OpApplyHyperlink;g.init({memberid:d,position:c.position,length:c.length,hyperlink:a});h.push(g);f.enqueue(h)}};this.removeHyperlinks=function(){if(m){var a=l.createPositionIterator(l.getRootNode()),b=l.getCursor(d).getSelectedRange(),c=n.getHyperlinkElements(b),
g=b.collapsed&&1===c.length,h=l.getDOMDocument().createRange(),k=[],q,z;0!==c.length&&(c.forEach(function(b){h.selectNodeContents(b);q=l.convertDomToCursorRange({anchorNode:h.startContainer,anchorOffset:h.startOffset,focusNode:h.endContainer,focusOffset:h.endOffset});z=new ops.OpRemoveHyperlink;z.init({memberid:d,position:q.position,length:q.length});k.push(z)}),g||(g=c[0],-1===b.comparePoint(g,0)&&(h.setStart(g,0),h.setEnd(b.startContainer,b.startOffset),q=l.convertDomToCursorRange({anchorNode:h.startContainer,
anchorOffset:h.startOffset,focusNode:h.endContainer,focusOffset:h.endOffset}),0<q.length&&(z=new ops.OpApplyHyperlink,z.init({memberid:d,position:q.position,length:q.length,hyperlink:n.getHyperlinkTarget(g)}),k.push(z))),c=c[c.length-1],a.moveToEndOfNode(c),a=a.unfilteredDomOffset(),1===b.comparePoint(c,a)&&(h.setStart(b.endContainer,b.endOffset),h.setEnd(c,a),q=l.convertDomToCursorRange({anchorNode:h.startContainer,anchorOffset:h.startOffset,focusNode:h.endContainer,focusOffset:h.endOffset}),0<q.length&&
(z=new ops.OpApplyHyperlink,z.init({memberid:d,position:q.position,length:q.length,hyperlink:n.getHyperlinkTarget(c)}),k.push(z)))),f.enqueue(k),h.detach())}};this.destroy=function(a){l.unsubscribe(ops.Document.signalCursorMoved,g);k.unsubscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,c);a()};l.subscribe(ops.Document.signalCursorMoved,g);k.subscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,c);c()};gui.HyperlinkController.enabledChanged="enabled/changed";
gui.ImageController=function(f,k,a,d,c){function g(){var b=!0;!0===k.getState(gui.CommonConstraints.EDIT.REVIEW_MODE)&&(b=a.isLocalCursorWithinOwnAnnotation());b!==r&&(r=b,e.emit(gui.ImageController.enabledChanged,r))}function n(b){b.getMemberId()===d&&g()}var l={"image/gif":".gif","image/jpeg":".jpg","image/png":".png"},q=odf.Namespaces.textns,m=f.getOdtDocument(),p=odf.OdfUtils,b=m.getFormatting(),e=new core.EventNotifier([gui.HyperlinkController.enabledChanged]),r=!1;this.isEnabled=function(){return r};
this.subscribe=function(b,a){e.subscribe(b,a)};this.unsubscribe=function(b,a){e.unsubscribe(b,a)};this.insertImage=function(a,e,g,k){if(r){runtime.assert(0<g&&0<k,"Both width and height of the image should be greater than 0px.");k={width:g,height:k};if(g=p.getParagraphElement(m.getCursor(d).getNode()).getAttributeNS(q,"style-name")){g=b.getContentSize(g,"paragraph");var n=1,s=1;k.width>g.width&&(n=g.width/k.width);k.height>g.height&&(s=g.height/k.height);g=Math.min(n,s);k={width:k.width*g,height:k.height*
g}}g=k.width+"px";k=k.height+"px";var A=m.getOdfCanvas().odfContainer().rootElement.styles,n=a.toLowerCase(),s=l.hasOwnProperty(n)?l[n]:null,w,n=[];runtime.assert(null!==s,"Image type is not supported: "+a);s="Pictures/"+c.generateImageName()+s;w=new ops.OpSetBlob;w.init({memberid:d,filename:s,mimetype:a,content:e});n.push(w);b.getStyleElement("Graphics","graphic",[A])||(a=new ops.OpAddStyle,a.init({memberid:d,styleName:"Graphics",styleFamily:"graphic",isAutomaticStyle:!1,setProperties:{"style:graphic-properties":{"text:anchor-type":"paragraph",
"svg:x":"0cm","svg:y":"0cm","style:wrap":"dynamic","style:number-wrapped-paragraphs":"no-limit","style:wrap-contour":"false","style:vertical-pos":"top","style:vertical-rel":"paragraph","style:horizontal-pos":"center","style:horizontal-rel":"paragraph"}}}),n.push(a));a=c.generateStyleName();e=new ops.OpAddStyle;e.init({memberid:d,styleName:a,styleFamily:"graphic",isAutomaticStyle:!0,setProperties:{"style:parent-style-name":"Graphics","style:graphic-properties":{"style:vertical-pos":"top","style:vertical-rel":"baseline",
"style:horizontal-pos":"center","style:horizontal-rel":"paragraph","fo:background-color":"transparent","style:background-transparency":"100%","style:shadow":"none","style:mirror":"none","fo:clip":"rect(0cm, 0cm, 0cm, 0cm)","draw:luminance":"0%","draw:contrast":"0%","draw:red":"0%","draw:green":"0%","draw:blue":"0%","draw:gamma":"100%","draw:color-inversion":"false","draw:image-opacity":"100%","draw:color-mode":"standard"}}});n.push(e);w=new ops.OpInsertImage;w.init({memberid:d,position:m.getCursorPosition(d),
filename:s,frameWidth:g,frameHeight:k,frameStyleName:a,frameName:c.generateFrameName()});n.push(w);f.enqueue(n)}};this.destroy=function(b){m.unsubscribe(ops.Document.signalCursorMoved,n);k.unsubscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,g);b()};m.subscribe(ops.Document.signalCursorMoved,n);k.subscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,g);g()};gui.ImageController.enabledChanged="enabled/changed";
gui.ImageSelector=function(f){function k(){var a=f.getSizer(),g=c.createElement("div");g.id="imageSelector";g.style.borderWidth="1px";a.appendChild(g);d.forEach(function(a){var d=c.createElement("div");d.className=a;g.appendChild(d)});return g}var a=odf.Namespaces.svgns,d="topLeft topRight bottomRight bottomLeft topMiddle rightMiddle bottomMiddle leftMiddle".split(" "),c=f.getElement().ownerDocument,g=!1;this.select=function(d){var l,q,m=c.getElementById("imageSelector");m||(m=k());g=!0;l=m.parentNode;
q=d.getBoundingClientRect();var p=l.getBoundingClientRect(),b=f.getZoomLevel();l=(q.left-p.left)/b-1;q=(q.top-p.top)/b-1;m.style.display="block";m.style.left=l+"px";m.style.top=q+"px";m.style.width=d.getAttributeNS(a,"width");m.style.height=d.getAttributeNS(a,"height")};this.clearSelection=function(){var a;g&&(a=c.getElementById("imageSelector"))&&(a.style.display="none");g=!1};this.isSelectorElement=function(a){var d=c.getElementById("imageSelector");return d?a===d||a.parentNode===d:!1}};
(function(){function f(f){function a(a){n=a.which&&String.fromCharCode(a.which)===g;g=void 0;return!1===n}function d(){n=!1}function c(a){g=a.data;n=!1}var g,n=!1;this.destroy=function(g){f.unsubscribe("textInput",d);f.unsubscribe("compositionend",c);f.removeFilter("keypress",a);g()};f.subscribe("textInput",d);f.subscribe("compositionend",c);f.addFilter("keypress",a)}gui.InputMethodEditor=function(k,a){function d(a){b&&(a?b.getNode().setAttributeNS("urn:webodf:names:cursor","composing","true"):(b.getNode().removeAttributeNS("urn:webodf:names:cursor",
"composing"),h.textContent=""))}function c(){x&&(x=!1,d(!1),v.emit(gui.InputMethodEditor.signalCompositionEnd,{data:z}),z="")}function g(){N||(N=!0,c(),b&&b.getSelectedRange().collapsed?e.value="":e.value=A.writeToString(b.getSelectedRange().cloneContents()),e.setSelectionRange(0,e.value.length),N=!1)}function n(){a.hasFocus()&&u.trigger()}function l(){s=void 0;u.cancel();d(!0);x||v.emit(gui.InputMethodEditor.signalCompositionStart,{data:""})}function q(b){b=s=b.data;x=!0;z+=b;u.trigger()}function m(b){b.data!==
s&&(b=b.data,x=!0,z+=b,u.trigger());s=void 0}function p(){h.textContent=e.value}var b=null,e=a.getEventTrap(),r=e.ownerDocument,h,u,x=!1,z="",v=new core.EventNotifier([gui.InputMethodEditor.signalCompositionStart,gui.InputMethodEditor.signalCompositionEnd]),s,A,w=[],E,N=!1;this.subscribe=v.subscribe;this.unsubscribe=v.unsubscribe;this.registerCursor=function(c){c.getMemberId()===k&&(b=c,b.getNode().appendChild(h),c.subscribe(ops.OdtCursor.signalCursorUpdated,n),a.subscribe("input",p),a.subscribe("compositionupdate",
p))};this.removeCursor=function(c){b&&c===k&&(b.getNode().removeChild(h),b.unsubscribe(ops.OdtCursor.signalCursorUpdated,n),a.unsubscribe("input",p),a.unsubscribe("compositionupdate",p),b=null)};this.destroy=function(b){a.unsubscribe("compositionstart",l);a.unsubscribe("compositionend",q);a.unsubscribe("textInput",m);a.unsubscribe("keypress",c);a.unsubscribe("focus",g);core.Async.destroyAll(E,b)};(function(){A=new odf.TextSerializer;A.filter=new odf.OdfNodeFilter;a.subscribe("compositionstart",l);
a.subscribe("compositionend",q);a.subscribe("textInput",m);a.subscribe("keypress",c);a.subscribe("focus",g);w.push(new f(a));E=w.map(function(b){return b.destroy});h=r.createElement("span");h.setAttribute("id","composer");u=core.Task.createTimeoutTask(g,1);E.push(u.destroy)})()};gui.InputMethodEditor.signalCompositionStart="input/compositionstart";gui.InputMethodEditor.signalCompositionEnd="input/compositionend"})();
gui.MetadataController=function(f,k){function a(a){g.emit(gui.MetadataController.signalMetadataChanged,a)}function d(a){var c=-1===n.indexOf(a);c||runtime.log("Setting "+a+" is restricted.");return c}var c=f.getOdtDocument(),g=new core.EventNotifier([gui.MetadataController.signalMetadataChanged]),n=["dc:creator","dc:date","meta:editing-cycles","meta:editing-duration","meta:document-statistic"];this.setMetadata=function(a,c){var g={},n="",b;a&&Object.keys(a).filter(d).forEach(function(b){g[b]=a[b]});
c&&(n=c.filter(d).join(","));if(0<n.length||0<Object.keys(g).length)b=new ops.OpUpdateMetadata,b.init({memberid:k,setProperties:g,removedProperties:0<n.length?{attributes:n}:null}),f.enqueue([b])};this.getMetadata=function(a){var d;runtime.assert("string"===typeof a,"Property must be a string");d=a.split(":");runtime.assert(2===d.length,"Property must be a namespace-prefixed string");a=odf.Namespaces.lookupNamespaceURI(d[0]);runtime.assert(Boolean(a),"Prefix must be for an ODF namespace.");return c.getOdfCanvas().odfContainer().getMetadata(a,
d[1])};this.subscribe=function(a,c){g.subscribe(a,c)};this.unsubscribe=function(a,c){g.unsubscribe(a,c)};this.destroy=function(d){c.unsubscribe(ops.OdtDocument.signalMetadataUpdated,a);d()};c.subscribe(ops.OdtDocument.signalMetadataUpdated,a)};gui.MetadataController.signalMetadataChanged="metadata/changed";
gui.PasteController=function(f,k,a,d){function c(){l=!0===k.getState(gui.CommonConstraints.EDIT.REVIEW_MODE)?a.isLocalCursorWithinOwnAnnotation():!0}function g(b){b.getMemberId()===d&&c()}var n=f.getOdtDocument(),l=!1,q=odf.Namespaces.textns,m=core.StepDirection.NEXT,p=odf.OdfUtils;this.isEnabled=function(){return l};this.paste=function(b){if(l){var a=n.getCursorPosition(d),c=n.getCursor(d).getNode(),c=p.getParagraphElement(c),h=c.getAttributeNS(q,"style-name")||"",g=a,k=[],z=n.convertDomPointToCursorStep(c,
0,m);b.replace(/\r/g,"").split("\n").forEach(function(b){var a=new ops.OpInsertText,c=new ops.OpSplitParagraph;a.init({memberid:d,position:g,text:b,moveCursor:!0});k.push(a);g+=b.length;c.init({memberid:d,position:g,paragraphStyleName:h,sourceParagraphPosition:z,moveCursor:!0});k.push(c);z=g+=1});k.pop();f.enqueue(k)}};this.destroy=function(b){n.unsubscribe(ops.Document.signalCursorMoved,g);k.unsubscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,c);b()};n.subscribe(ops.Document.signalCursorMoved,g);
k.subscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,c);c()};gui.ClosestXOffsetScanner=function(f){function k(a){return null!==a&&void 0!==c?Math.abs(a-f)>c:!1}function a(a){null!==a&&!1===k(a)&&(c=Math.abs(a-f))}var d=this,c,g=gui.StepInfo.VisualDirection.LEFT_TO_RIGHT;this.token=void 0;this.process=function(c,f,q){var m,p;c.visualDirection===g?(m=f&&f.right,p=q&&q.left):(m=f&&f.left,p=q&&q.right);if(k(m)||k(p))return!0;if(f||q)a(m),a(p),d.token=c.token;return!1}};
gui.LineBoundaryScanner=function(){var f=this,k=null;this.token=void 0;this.process=function(a,d,c){var g;if(g=c)if(k){var n=k;g=Math.min(n.bottom-n.top,c.bottom-c.top);var l=Math.max(n.top,c.top),n=Math.min(n.bottom,c.bottom)-l;g=.4>=(0<g?n/g:0)}else g=!1;!d||c&&!g||(f.token=a.token);if(g)return!0;k=(a=k)&&d?{left:Math.min(a.left,d.left),right:Math.max(a.right,d.right),top:Math.min(a.top,d.top),bottom:Math.min(a.bottom,d.bottom)}:a||d;return!1}};
gui.ParagraphBoundaryScanner=function(){var f=this,k=!1,a,d=odf.OdfUtils;this.token=void 0;this.process=function(c){var g=d.getParagraphElement(c.container());k||(a=g,k=!0);if(a!==g)return!0;f.token=c.token;return!1}};
odf.WordBoundaryFilter=function(f,k){function a(b,a,c){for(var e=null,d=f.getRootNode(),g;b!==d&&null!==b&&null===e;)g=0>a?b.previousSibling:b.nextSibling,c(g)===NodeFilter.FILTER_ACCEPT&&(e=g),b=b.parentNode;return e}function d(b,a){var e;return null===b?r.NO_NEIGHBOUR:n.isCharacterElement(b)?r.SPACE_CHAR:b.nodeType===c||n.isTextSpan(b)||n.isHyperlink(b)?(e=b.textContent.charAt(a()),q.test(e)?r.SPACE_CHAR:l.test(e)?r.PUNCTUATION_CHAR:r.WORD_CHAR):r.OTHER}var c=Node.TEXT_NODE,g=Node.ELEMENT_NODE,
n=odf.OdfUtils,l=/[!-#%-*,-\/:-;?-@\[-\]_{}\u00a1\u00ab\u00b7\u00bb\u00bf;\u00b7\u055a-\u055f\u0589-\u058a\u05be\u05c0\u05c3\u05c6\u05f3-\u05f4\u0609-\u060a\u060c-\u060d\u061b\u061e-\u061f\u066a-\u066d\u06d4\u0700-\u070d\u07f7-\u07f9\u0964-\u0965\u0970\u0df4\u0e4f\u0e5a-\u0e5b\u0f04-\u0f12\u0f3a-\u0f3d\u0f85\u0fd0-\u0fd4\u104a-\u104f\u10fb\u1361-\u1368\u166d-\u166e\u169b-\u169c\u16eb-\u16ed\u1735-\u1736\u17d4-\u17d6\u17d8-\u17da\u1800-\u180a\u1944-\u1945\u19de-\u19df\u1a1e-\u1a1f\u1b5a-\u1b60\u1c3b-\u1c3f\u1c7e-\u1c7f\u2000-\u206e\u207d-\u207e\u208d-\u208e\u3008-\u3009\u2768-\u2775\u27c5-\u27c6\u27e6-\u27ef\u2983-\u2998\u29d8-\u29db\u29fc-\u29fd\u2cf9-\u2cfc\u2cfe-\u2cff\u2e00-\u2e7e\u3000-\u303f\u30a0\u30fb\ua60d-\ua60f\ua673\ua67e\ua874-\ua877\ua8ce-\ua8cf\ua92e-\ua92f\ua95f\uaa5c-\uaa5f\ufd3e-\ufd3f\ufe10-\ufe19\ufe30-\ufe52\ufe54-\ufe61\ufe63\ufe68\ufe6a-\ufe6b\uff01-\uff03\uff05-\uff0a\uff0c-\uff0f\uff1a-\uff1b\uff1f-\uff20\uff3b-\uff3d\uff3f\uff5b\uff5d\uff5f-\uff65]|\ud800[\udd00-\udd01\udf9f\udfd0]|\ud802[\udd1f\udd3f\ude50-\ude58]|\ud809[\udc00-\udc7e]/,
q=/\s/,m=core.PositionFilter.FilterResult.FILTER_ACCEPT,p=core.PositionFilter.FilterResult.FILTER_REJECT,b=odf.WordBoundaryFilter.IncludeWhitespace.TRAILING,e=odf.WordBoundaryFilter.IncludeWhitespace.LEADING,r={NO_NEIGHBOUR:0,SPACE_CHAR:1,PUNCTUATION_CHAR:2,WORD_CHAR:3,OTHER:4};this.acceptPosition=function(c){var f=c.container(),l=c.leftNode(),n=c.rightNode(),q=c.unfilteredDomOffset,s=function(){return c.unfilteredDomOffset()-1};f.nodeType===g&&(null===n&&(n=a(f,1,c.getNodeFilter())),null===l&&(l=
a(f,-1,c.getNodeFilter())));f!==n&&(q=function(){return 0});f!==l&&null!==l&&(s=function(){return l.textContent.length-1});f=d(l,s);n=d(n,q);return f===r.WORD_CHAR&&n===r.WORD_CHAR||f===r.PUNCTUATION_CHAR&&n===r.PUNCTUATION_CHAR||k===b&&f!==r.NO_NEIGHBOUR&&n===r.SPACE_CHAR||k===e&&f===r.SPACE_CHAR&&n!==r.NO_NEIGHBOUR?p:m}};odf.WordBoundaryFilter.IncludeWhitespace={None:0,TRAILING:1,LEADING:2};
gui.SelectionController=function(f,k){function a(b){var a=b.spec();if(b.isEdit||a.memberid===k)N=void 0,I.cancel()}function d(){var b=x.getCursor(k).getNode();return x.createStepIterator(b,0,[s,w],x.getRootElement(b))}function c(b,a,c){c=new odf.WordBoundaryFilter(x,c);var e=x.getRootElement(b)||x.getRootNode(),d=x.createRootFilter(e);return x.createStepIterator(b,a,[s,d,c],e)}function g(b,a){return a?{anchorNode:b.startContainer,anchorOffset:b.startOffset,focusNode:b.endContainer,focusOffset:b.endOffset}:
{anchorNode:b.endContainer,anchorOffset:b.endOffset,focusNode:b.startContainer,focusOffset:b.startOffset}}function n(b,a,c){var e=new ops.OpMoveCursor;e.init({memberid:k,position:b,length:a||0,selectionType:c});return e}function l(b,a,c){var e;e=x.getCursor(k);e=g(e.getSelectedRange(),e.hasForwardSelection());e.focusNode=b;e.focusOffset=a;c||(e.anchorNode=e.focusNode,e.anchorOffset=e.focusOffset);b=x.convertDomToCursorRange(e);f.enqueue([n(b.position,b.length)])}function q(b){var a;a=c(b.startContainer,
b.startOffset,G);a.roundToPreviousStep()&&b.setStart(a.container(),a.offset());a=c(b.endContainer,b.endOffset,F);a.roundToNextStep()&&b.setEnd(a.container(),a.offset())}function m(b){var a=v.getParagraphElements(b),c=a[0],a=a[a.length-1];c&&b.setStart(c,0);a&&(v.isParagraph(b.endContainer)&&0===b.endOffset?b.setEndBefore(a):b.setEnd(a,a.childNodes.length))}function p(b,a,c,e){var d,f;e?(d=c.startContainer,f=c.startOffset):(d=c.endContainer,f=c.endOffset);z.containsNode(b,d)||(f=0>z.comparePoints(b,
0,d,f)?0:b.childNodes.length,d=b);b=x.createStepIterator(d,f,a,v.getParagraphElement(d)||b);b.roundToClosestStep()||runtime.assert(!1,"No step found in requested range");e?c.setStart(b.container(),b.offset()):c.setEnd(b.container(),b.offset())}function b(b,a){var c=d();c.advanceStep(b)&&l(c.container(),c.offset(),a)}function e(b,a){var c,e=N,f=[new gui.LineBoundaryScanner,new gui.ParagraphBoundaryScanner];void 0===e&&E&&(e=E());isNaN(e)||(c=d(),A.moveToFilteredStep(c,b,f)&&c.advanceStep(b)&&(f=[new gui.ClosestXOffsetScanner(e),
new gui.LineBoundaryScanner,new gui.ParagraphBoundaryScanner],A.moveToFilteredStep(c,b,f)&&(l(c.container(),c.offset(),a),N=e,I.restart())))}function r(b,a){var c=d(),e=[new gui.LineBoundaryScanner,new gui.ParagraphBoundaryScanner];A.moveToFilteredStep(c,b,e)&&l(c.container(),c.offset(),a)}function h(b,a){var e=x.getCursor(k),e=g(e.getSelectedRange(),e.hasForwardSelection()),e=c(e.focusNode,e.focusOffset,G);e.advanceStep(b)&&l(e.container(),e.offset(),a)}function u(b,a,c){var e=!1,d=x.getCursor(k),
d=g(d.getSelectedRange(),d.hasForwardSelection()),e=x.getRootElement(d.focusNode);runtime.assert(Boolean(e),"SelectionController: Cursor outside root");d=x.createStepIterator(d.focusNode,d.focusOffset,[s,w],e);d.roundToClosestStep();d.advanceStep(b)&&(c=c(d.container()))&&(b===K?(d.setPosition(c,0),e=d.roundToNextStep()):(d.setPosition(c,c.childNodes.length),e=d.roundToPreviousStep()),e&&l(d.container(),d.offset(),a))}var x=f.getOdtDocument(),z=core.DomUtils,v=odf.OdfUtils,s=x.getPositionFilter(),
A=new gui.GuiStepUtils,w=x.createRootFilter(k),E=null,N,I,G=odf.WordBoundaryFilter.IncludeWhitespace.TRAILING,F=odf.WordBoundaryFilter.IncludeWhitespace.LEADING,K=core.StepDirection.PREVIOUS,t=core.StepDirection.NEXT;this.selectionToRange=function(b){var a=0<=z.comparePoints(b.anchorNode,b.anchorOffset,b.focusNode,b.focusOffset),c=b.focusNode.ownerDocument.createRange();a?(c.setStart(b.anchorNode,b.anchorOffset),c.setEnd(b.focusNode,b.focusOffset)):(c.setStart(b.focusNode,b.focusOffset),c.setEnd(b.anchorNode,
b.anchorOffset));return{range:c,hasForwardSelection:a}};this.rangeToSelection=g;this.selectImage=function(b){var a=x.getRootElement(b),c=x.createRootFilter(a),a=x.createStepIterator(b,0,[c,x.getPositionFilter()],a),e;a.roundToPreviousStep()||runtime.assert(!1,"No walkable position before frame");c=a.container();e=a.offset();a.setPosition(b,b.childNodes.length);a.roundToNextStep()||runtime.assert(!1,"No walkable position after frame");b=x.convertDomToCursorRange({anchorNode:c,anchorOffset:e,focusNode:a.container(),
focusOffset:a.offset()});b=n(b.position,b.length,ops.OdtCursor.RegionSelection);f.enqueue([b])};this.expandToWordBoundaries=q;this.expandToParagraphBoundaries=m;this.selectRange=function(b,a,c){var e=x.getOdfCanvas().getElement(),d,h=[s];d=z.containsNode(e,b.startContainer);e=z.containsNode(e,b.endContainer);if(d||e)if(d&&e&&(2===c?q(b):3<=c&&m(b)),(c=a?x.getRootElement(b.startContainer):x.getRootElement(b.endContainer))||(c=x.getRootNode()),h.push(x.createRootFilter(c)),p(c,h,b,!0),p(c,h,b,!1),b=
g(b,a),a=x.convertDomToCursorRange(b),b=x.getCursorSelection(k),a.position!==b.position||a.length!==b.length)b=n(a.position,a.length,ops.OdtCursor.RangeSelection),f.enqueue([b])};this.moveCursorToLeft=function(){b(K,!1);return!0};this.moveCursorToRight=function(){b(t,!1);return!0};this.extendSelectionToLeft=function(){b(K,!0);return!0};this.extendSelectionToRight=function(){b(t,!0);return!0};this.setCaretXPositionLocator=function(b){E=b};this.moveCursorUp=function(){e(K,!1);return!0};this.moveCursorDown=
function(){e(t,!1);return!0};this.extendSelectionUp=function(){e(K,!0);return!0};this.extendSelectionDown=function(){e(t,!0);return!0};this.moveCursorBeforeWord=function(){h(K,!1);return!0};this.moveCursorPastWord=function(){h(t,!1);return!0};this.extendSelectionBeforeWord=function(){h(K,!0);return!0};this.extendSelectionPastWord=function(){h(t,!0);return!0};this.moveCursorToLineStart=function(){r(K,!1);return!0};this.moveCursorToLineEnd=function(){r(t,!1);return!0};this.extendSelectionToLineStart=
function(){r(K,!0);return!0};this.extendSelectionToLineEnd=function(){r(t,!0);return!0};this.extendSelectionToParagraphStart=function(){u(K,!0,v.getParagraphElement);return!0};this.extendSelectionToParagraphEnd=function(){u(t,!0,v.getParagraphElement);return!0};this.moveCursorToParagraphStart=function(){u(K,!1,v.getParagraphElement);return!0};this.moveCursorToParagraphEnd=function(){u(t,!1,v.getParagraphElement);return!0};this.moveCursorToDocumentStart=function(){u(K,!1,x.getRootElement);return!0};
this.moveCursorToDocumentEnd=function(){u(t,!1,x.getRootElement);return!0};this.extendSelectionToDocumentStart=function(){u(K,!0,x.getRootElement);return!0};this.extendSelectionToDocumentEnd=function(){u(t,!0,x.getRootElement);return!0};this.extendSelectionToEntireDocument=function(){var b=x.getCursor(k),b=x.getRootElement(b.getNode()),a,c,e;runtime.assert(Boolean(b),"SelectionController: Cursor outside root");e=x.createStepIterator(b,0,[s,w],b);e.roundToClosestStep();a=e.container();c=e.offset();
e.setPosition(b,b.childNodes.length);e.roundToClosestStep();b=x.convertDomToCursorRange({anchorNode:a,anchorOffset:c,focusNode:e.container(),focusOffset:e.offset()});f.enqueue([n(b.position,b.length)]);return!0};this.destroy=function(b){x.unsubscribe(ops.OdtDocument.signalOperationStart,a);core.Async.destroyAll([I.destroy],b)};(function(){I=core.Task.createTimeoutTask(function(){N=void 0},2E3);x.subscribe(ops.OdtDocument.signalOperationStart,a)})()};
gui.TextController=function(f,k,a,d,c,g){function n(){u=!0===k.getState(gui.CommonConstraints.EDIT.REVIEW_MODE)?a.isLocalCursorWithinOwnAnnotation():!0}function l(b){b.getMemberId()===d&&n()}function q(b,a,c){var d=[e.getPositionFilter()];c&&d.push(e.createRootFilter(b.startContainer));c=e.createStepIterator(b.startContainer,b.startOffset,d,a);c.roundToClosestStep()||runtime.assert(!1,"No walkable step found in paragraph element at range start");a=e.convertDomPointToCursorStep(c.container(),c.offset());
b.collapsed?b=a:(c.setPosition(b.endContainer,b.endOffset),c.roundToClosestStep()||runtime.assert(!1,"No walkable step found in paragraph element at range end"),b=e.convertDomPointToCursorStep(c.container(),c.offset()));return{position:a,length:b-a}}function m(b){var a,c,e,f=r.getParagraphElements(b),g=b.cloneRange(),k=[];a=f[0];1<f.length&&(r.hasNoODFContent(a)&&(a=f[f.length-1]),c=a.getAttributeNS(odf.Namespaces.textns,"style-name")||"");f.forEach(function(a,f){var l,m;g.setStart(a,0);g.collapse(!0);
l=q(g,a,!1).position;0<f&&(m=new ops.OpMergeParagraph,m.init({memberid:d,paragraphStyleName:c,destinationStartPosition:e,sourceStartPosition:l,moveCursor:1===f}),k.unshift(m));e=l;g.selectNodeContents(a);if(l=h.rangeIntersection(g,b))l=q(l,a,!0),0<l.length&&(m=new ops.OpRemoveText,m.init({memberid:d,position:l.position,length:l.length}),k.unshift(m))});return k}function p(b){0>b.length&&(b.position+=b.length,b.length=-b.length);return b}function b(b){if(!u)return!1;var a,c=e.getCursor(d).getSelectedRange().cloneRange(),
h=p(e.getCursorSelection(d)),g;if(0===h.length){h=void 0;a=e.getCursor(d).getNode();g=e.getRootElement(a);var k=[e.getPositionFilter(),e.createRootFilter(g)];g=e.createStepIterator(a,0,k,g);g.roundToClosestStep()&&(b?g.nextStep():g.previousStep())&&(h=p(e.convertDomToCursorRange({anchorNode:a,anchorOffset:0,focusNode:g.container(),focusOffset:g.offset()})),b?(c.setStart(a,0),c.setEnd(g.container(),g.offset())):(c.setStart(g.container(),g.offset()),c.setEnd(a,0)))}h&&f.enqueue(m(c));return void 0!==
h}var e=f.getOdtDocument(),r=odf.OdfUtils,h=core.DomUtils,u=!1,x=odf.Namespaces.textns,z=core.StepDirection.NEXT;this.isEnabled=function(){return u};this.enqueueParagraphSplittingOps=function(){if(!u)return!1;var b=e.getCursor(d),a=b.getSelectedRange(),c=p(e.getCursorSelection(d)),h=[],b=r.getParagraphElement(b.getNode()),k=b.getAttributeNS(x,"style-name")||"";0<c.length&&(h=h.concat(m(a)));a=new ops.OpSplitParagraph;a.init({memberid:d,position:c.position,paragraphStyleName:k,sourceParagraphPosition:e.convertDomPointToCursorStep(b,
0,z),moveCursor:!0});h.push(a);g&&(c=g(c.position+1),h=h.concat(c));f.enqueue(h);return!0};this.removeTextByBackspaceKey=function(){return b(!1)};this.removeTextByDeleteKey=function(){return b(!0)};this.removeCurrentSelection=function(){if(!u)return!1;var b=e.getCursor(d).getSelectedRange();f.enqueue(m(b));return!0};this.insertText=function(b){if(u){var a=e.getCursor(d).getSelectedRange(),h=p(e.getCursorSelection(d)),g=[],k=!1;0<h.length&&(g=g.concat(m(a)),k=!0);a=new ops.OpInsertText;a.init({memberid:d,
position:h.position,text:b,moveCursor:!0});g.push(a);c&&(b=c(h.position,b.length,k))&&g.push(b);f.enqueue(g)}};this.destroy=function(b){e.unsubscribe(ops.Document.signalCursorMoved,l);k.unsubscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,n);b()};e.subscribe(ops.Document.signalCursorMoved,l);k.subscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,n);n()};gui.UndoManager=function(){};gui.UndoManager.prototype.subscribe=function(f,k){};gui.UndoManager.prototype.unsubscribe=function(f,k){};
gui.UndoManager.prototype.setDocument=function(f){};gui.UndoManager.prototype.setInitialState=function(){};gui.UndoManager.prototype.initialize=function(){};gui.UndoManager.prototype.purgeInitialState=function(){};gui.UndoManager.prototype.setPlaybackFunction=function(f){};gui.UndoManager.prototype.hasUndoStates=function(){};gui.UndoManager.prototype.hasRedoStates=function(){};gui.UndoManager.prototype.moveForward=function(f){};gui.UndoManager.prototype.moveBackward=function(f){};
gui.UndoManager.prototype.onOperationExecuted=function(f){};gui.UndoManager.signalUndoStackChanged="undoStackChanged";gui.UndoManager.signalUndoStateCreated="undoStateCreated";gui.UndoManager.signalUndoStateModified="undoStateModified";gui.SessionControllerOptions=function(){this.annotationsEnabled=this.directParagraphStylingEnabled=this.directTextStylingEnabled=!1};
(function(){var f=core.PositionFilter.FilterResult.FILTER_ACCEPT;gui.SessionController=function(k,a,d,c){function g(b){return b.target||b.srcElement||null}function n(b,a){var c=C.getDOMDocument(),e=null;c.caretRangeFromPoint?(c=c.caretRangeFromPoint(b,a),e={container:c.startContainer,offset:c.startOffset}):c.caretPositionFromPoint&&(c=c.caretPositionFromPoint(b,a))&&c.offsetNode&&(e={container:c.offsetNode,offset:c.offset});return e}function l(b){var c=C.getCursor(a).getSelectedRange();c.collapsed?
b.preventDefault():W.setDataFromRange(b,c)?ea.removeCurrentSelection():runtime.log("Cut operation failed")}function q(){return!1!==C.getCursor(a).getSelectedRange().collapsed}function m(b){var c=C.getCursor(a).getSelectedRange();c.collapsed?b.preventDefault():W.setDataFromRange(b,c)||runtime.log("Copy operation failed")}function p(b){var a;B.clipboardData&&B.clipboardData.getData?a=B.clipboardData.getData("Text"):b.clipboardData&&b.clipboardData.getData&&(a=b.clipboardData.getData("text/plain"));
a&&(ea.removeCurrentSelection(),fa.paste(a));b.preventDefault?b.preventDefault():b.returnValue=!1}function b(){return!1}function e(b){if(S)S.onOperationExecuted(b)}function r(b){C.emit(ops.OdtDocument.signalUndoStackChanged,b)}function h(){var b;return S?(b=R.hasFocus(),S.moveBackward(1),b&&R.focus(),!0):!1}function u(){var b;return S?(b=R.hasFocus(),S.moveForward(1),b&&R.focus(),!0):!1}function x(b){var c=C.getCursor(a).getSelectedRange(),e=g(b).getAttribute("end");c&&e&&(b=n(b.clientX,b.clientY))&&
(ia.setUnfilteredPosition(b.container,b.offset),T.acceptPosition(ia)===f&&(c=c.cloneRange(),"left"===e?c.setStart(ia.container(),ia.unfilteredDomOffset()):c.setEnd(ia.container(),ia.unfilteredDomOffset()),d.setSelectedRange(c,"right"===e),C.emit(ops.Document.signalCursorMoved,d)))}function z(){V.selectRange(d.getSelectedRange(),d.hasForwardSelection(),1)}function v(){var b=B.getSelection(),a=0<b.rangeCount&&V.selectionToRange(b);Z&&a&&(aa=!0,ka.clearSelection(),ia.setUnfilteredPosition(b.focusNode,
b.focusOffset),T.acceptPosition(ia)===f&&(2===na?V.expandToWordBoundaries(a.range):3<=na&&V.expandToParagraphBoundaries(a.range),d.setSelectedRange(a.range,a.hasForwardSelection),C.emit(ops.Document.signalCursorMoved,d)))}function s(b){var c=g(b),e=C.getCursor(a);if(Z=null!==c&&ca.containsNode(C.getOdfCanvas().getElement(),c))aa=!1,c=C.getRootElement(c)||C.getRootNode(),T=C.createRootFilter(c),na=0===b.button?b.detail:0,e&&b.shiftKey?B.getSelection().collapse(e.getAnchorNode(),0):(b=B.getSelection(),
c=e.getSelectedRange(),b.extend?e.hasForwardSelection()?(b.collapse(c.startContainer,c.startOffset),b.extend(c.endContainer,c.endOffset)):(b.collapse(c.endContainer,c.endOffset),b.extend(c.startContainer,c.startOffset)):(b.removeAllRanges(),b.addRange(c.cloneRange()))),1<na&&v()}function A(b){var a=C.getRootElement(b),c=C.createRootFilter(a),a=C.createStepIterator(b,0,[c,C.getPositionFilter()],a);a.setPosition(b,b.childNodes.length);return a.roundToNextStep()?{container:a.container(),offset:a.offset()}:
null}function w(b){var a;a=(a=B.getSelection())?{anchorNode:a.anchorNode,anchorOffset:a.anchorOffset,focusNode:a.focusNode,focusOffset:a.focusOffset}:null;var c=B.getSelection().isCollapsed,e,d;a.anchorNode||a.focusNode||!(e=n(b.clientX,b.clientY))||(a.anchorNode=e.container,a.anchorOffset=e.offset,a.focusNode=a.anchorNode,a.focusOffset=a.anchorOffset);if(ba.isImage(a.focusNode)&&0===a.focusOffset&&ba.isCharacterFrame(a.focusNode.parentNode)){if(d=a.focusNode.parentNode,e=d.getBoundingClientRect(),
b.clientX>e.left&&(e=A(d)))a.focusNode=e.container,a.focusOffset=e.offset,c&&(a.anchorNode=a.focusNode,a.anchorOffset=a.focusOffset)}else ba.isImage(a.focusNode.firstChild)&&1===a.focusOffset&&ba.isCharacterFrame(a.focusNode)&&(e=A(a.focusNode))&&(a.anchorNode=a.focusNode=e.container,a.anchorOffset=a.focusOffset=e.offset);a.anchorNode&&a.focusNode&&(a=V.selectionToRange(a),V.selectRange(a.range,a.hasForwardSelection,0===b.button?b.detail:0));R.focus()}function E(b){var a;if(a=n(b.clientX,b.clientY))b=
a.container,a=a.offset,b={anchorNode:b,anchorOffset:a,focusNode:b,focusOffset:a},b=V.selectionToRange(b),V.selectRange(b.range,b.hasForwardSelection,2),R.focus()}function N(b){var a=g(b),c,e,f;la.processRequests();Z&&(ba.isImage(a)&&ba.isCharacterFrame(a.parentNode)&&B.getSelection().isCollapsed?(V.selectImage(a.parentNode),R.focus()):ka.isSelectorElement(a)?R.focus():aa?(a=d.getSelectedRange(),e=a.collapsed,ba.isImage(a.endContainer)&&0===a.endOffset&&ba.isCharacterFrame(a.endContainer.parentNode)&&
(f=a.endContainer.parentNode,f=A(f))&&(a.setEnd(f.container,f.offset),e&&a.collapse(!1)),V.selectRange(a,d.hasForwardSelection(),0===b.button?b.detail:0),R.focus()):ta?w(b):(c=ca.cloneEvent(b),Q=runtime.setTimeout(function(){w(c)},0)),na=0,aa=Z=!1)}function I(b){var c=C.getCursor(a).getSelectedRange();c.collapsed||da.exportRangeToDataTransfer(b.dataTransfer,c)}function G(){Z&&R.focus();na=0;aa=Z=!1}function F(b){N(b)}function K(b){var a=g(b),c=null;"annotationRemoveButton"===a.className?(runtime.assert(ha,
"Remove buttons are displayed on annotations while annotation editing is disabled in the controller."),c=a.parentNode.getElementsByTagNameNS(odf.Namespaces.officens,"annotation").item(0),X.removeAnnotation(c),R.focus()):"webodf-draggable"!==a.getAttribute("class")&&N(b)}function t(b){(b=b.data)&&(-1===b.indexOf("\n")?ea.insertText(b):fa.paste(b))}function y(b){return function(){b();return!0}}function D(b){return function(c){return C.getCursor(a).getSelectionType()===ops.OdtCursor.RangeSelection?b(c):
!0}}function U(b){R.unsubscribe("keydown",H.handleEvent);R.unsubscribe("keypress",Y.handleEvent);R.unsubscribe("keyup",ga.handleEvent);R.unsubscribe("copy",m);R.unsubscribe("mousedown",s);R.unsubscribe("mousemove",la.trigger);R.unsubscribe("mouseup",K);R.unsubscribe("contextmenu",F);R.unsubscribe("dragstart",I);R.unsubscribe("dragend",G);R.unsubscribe("click",oa.handleClick);R.unsubscribe("longpress",E);R.unsubscribe("drag",x);R.unsubscribe("dragstop",z);C.unsubscribe(ops.OdtDocument.signalOperationEnd,
ma.trigger);C.unsubscribe(ops.Document.signalCursorAdded,ja.registerCursor);C.unsubscribe(ops.Document.signalCursorRemoved,ja.removeCursor);C.unsubscribe(ops.OdtDocument.signalOperationEnd,e);b()}var B=runtime.getWindow(),C=k.getOdtDocument(),O=new gui.SessionConstraints,P=new gui.SessionContext(k,a),ca=core.DomUtils,ba=odf.OdfUtils,da=new gui.MimeDataExporter,W=new gui.Clipboard(da),H=new gui.KeyboardHandler,Y=new gui.KeyboardHandler,ga=new gui.KeyboardHandler,Z=!1,J=new odf.ObjectNameGenerator(C.getOdfCanvas().odfContainer(),
a),aa=!1,T=null,Q,S=null,R=new gui.EventManager(C),ha=c.annotationsEnabled,X=new gui.AnnotationController(k,O,a),$=new gui.DirectFormattingController(k,O,P,a,J,c.directTextStylingEnabled,c.directParagraphStylingEnabled),ea=new gui.TextController(k,O,P,a,$.createCursorStyleOp,$.createParagraphStyleOps),pa=new gui.ImageController(k,O,P,a,J),ka=new gui.ImageSelector(C.getOdfCanvas()),ia=C.createPositionIterator(C.getRootNode()),la,ma,fa=new gui.PasteController(k,O,P,a),ja=new gui.InputMethodEditor(a,
R),na=0,oa=new gui.HyperlinkClickHandler(C.getOdfCanvas().getElement,H,ga),sa=new gui.HyperlinkController(k,O,P,a),V=new gui.SelectionController(k,a),ua=new gui.MetadataController(k,a),L=gui.KeyboardHandler.Modifier,M=gui.KeyboardHandler.KeyCode,qa=-1!==B.navigator.appVersion.toLowerCase().indexOf("mac"),ta=-1!==["iPad","iPod","iPhone"].indexOf(B.navigator.platform),ra;runtime.assert(null!==B,"Expected to be run in an environment which has a global window, like a browser.");this.undo=h;this.redo=
u;this.insertLocalCursor=function(){runtime.assert(void 0===k.getOdtDocument().getCursor(a),"Inserting local cursor a second time.");var b=new ops.OpAddCursor;b.init({memberid:a});k.enqueue([b]);R.focus()};this.removeLocalCursor=function(){runtime.assert(void 0!==k.getOdtDocument().getCursor(a),"Removing local cursor without inserting before.");var b=new ops.OpRemoveCursor;b.init({memberid:a});k.enqueue([b])};this.startEditing=function(){ja.subscribe(gui.InputMethodEditor.signalCompositionStart,ea.removeCurrentSelection);
ja.subscribe(gui.InputMethodEditor.signalCompositionEnd,t);R.subscribe("beforecut",q);R.subscribe("cut",l);R.subscribe("beforepaste",b);R.subscribe("paste",p);S&&S.initialize();R.setEditing(!0);oa.setModifier(qa?L.Meta:L.Ctrl);H.bind(M.Backspace,L.None,y(ea.removeTextByBackspaceKey),!0);H.bind(M.Delete,L.None,ea.removeTextByDeleteKey);H.bind(M.Tab,L.None,D(function(){ea.insertText("\t");return!0}));qa?(H.bind(M.Clear,L.None,ea.removeCurrentSelection),H.bind(M.B,L.Meta,D($.toggleBold)),H.bind(M.I,
L.Meta,D($.toggleItalic)),H.bind(M.U,L.Meta,D($.toggleUnderline)),H.bind(M.L,L.MetaShift,D($.alignParagraphLeft)),H.bind(M.E,L.MetaShift,D($.alignParagraphCenter)),H.bind(M.R,L.MetaShift,D($.alignParagraphRight)),H.bind(M.J,L.MetaShift,D($.alignParagraphJustified)),ha&&H.bind(M.C,L.MetaShift,X.addAnnotation),H.bind(M.Z,L.Meta,h),H.bind(M.Z,L.MetaShift,u)):(H.bind(M.B,L.Ctrl,D($.toggleBold)),H.bind(M.I,L.Ctrl,D($.toggleItalic)),H.bind(M.U,L.Ctrl,D($.toggleUnderline)),H.bind(M.L,L.CtrlShift,D($.alignParagraphLeft)),
H.bind(M.E,L.CtrlShift,D($.alignParagraphCenter)),H.bind(M.R,L.CtrlShift,D($.alignParagraphRight)),H.bind(M.J,L.CtrlShift,D($.alignParagraphJustified)),ha&&H.bind(M.C,L.CtrlAlt,X.addAnnotation),H.bind(M.Z,L.Ctrl,h),H.bind(M.Z,L.CtrlShift,u));Y.setDefault(D(function(b){var a;a=null===b.which||void 0===b.which?String.fromCharCode(b.keyCode):0!==b.which&&0!==b.charCode?String.fromCharCode(b.which):null;return!a||b.altKey||b.ctrlKey||b.metaKey?!1:(ea.insertText(a),!0)}));Y.bind(M.Enter,L.None,D(ea.enqueueParagraphSplittingOps))};
this.endEditing=function(){ja.unsubscribe(gui.InputMethodEditor.signalCompositionStart,ea.removeCurrentSelection);ja.unsubscribe(gui.InputMethodEditor.signalCompositionEnd,t);R.unsubscribe("cut",l);R.unsubscribe("beforecut",q);R.unsubscribe("paste",p);R.unsubscribe("beforepaste",b);R.setEditing(!1);oa.setModifier(L.None);H.bind(M.Backspace,L.None,function(){return!0},!0);H.unbind(M.Delete,L.None);H.unbind(M.Tab,L.None);qa?(H.unbind(M.Clear,L.None),H.unbind(M.B,L.Meta),H.unbind(M.I,L.Meta),H.unbind(M.U,
L.Meta),H.unbind(M.L,L.MetaShift),H.unbind(M.E,L.MetaShift),H.unbind(M.R,L.MetaShift),H.unbind(M.J,L.MetaShift),ha&&H.unbind(M.C,L.MetaShift),H.unbind(M.Z,L.Meta),H.unbind(M.Z,L.MetaShift)):(H.unbind(M.B,L.Ctrl),H.unbind(M.I,L.Ctrl),H.unbind(M.U,L.Ctrl),H.unbind(M.L,L.CtrlShift),H.unbind(M.E,L.CtrlShift),H.unbind(M.R,L.CtrlShift),H.unbind(M.J,L.CtrlShift),ha&&H.unbind(M.C,L.CtrlAlt),H.unbind(M.Z,L.Ctrl),H.unbind(M.Z,L.CtrlShift));Y.setDefault(null);Y.unbind(M.Enter,L.None)};this.getInputMemberId=
function(){return a};this.getSession=function(){return k};this.getSessionConstraints=function(){return O};this.setUndoManager=function(b){S&&S.unsubscribe(gui.UndoManager.signalUndoStackChanged,r);if(S=b)S.setDocument(C),S.setPlaybackFunction(k.enqueue),S.subscribe(gui.UndoManager.signalUndoStackChanged,r)};this.getUndoManager=function(){return S};this.getMetadataController=function(){return ua};this.getAnnotationController=function(){return X};this.getDirectFormattingController=function(){return $};
this.getHyperlinkClickHandler=function(){return oa};this.getHyperlinkController=function(){return sa};this.getImageController=function(){return pa};this.getSelectionController=function(){return V};this.getTextController=function(){return ea};this.getEventManager=function(){return R};this.getKeyboardHandlers=function(){return{keydown:H,keypress:Y}};this.destroy=function(b){var a=[la.destroy,ma.destroy,$.destroy,ja.destroy,R.destroy,oa.destroy,sa.destroy,ua.destroy,V.destroy,ea.destroy,U];ra&&a.unshift(ra.destroy);
runtime.clearTimeout(Q);core.Async.destroyAll(a,b)};la=core.Task.createRedrawTask(v);ma=core.Task.createRedrawTask(function(){var b=C.getCursor(a);if(b&&b.getSelectionType()===ops.OdtCursor.RegionSelection&&(b=ba.getImageElements(b.getSelectedRange())[0])){ka.select(b.parentNode);return}ka.clearSelection()});H.bind(M.Left,L.None,D(V.moveCursorToLeft));H.bind(M.Right,L.None,D(V.moveCursorToRight));H.bind(M.Up,L.None,D(V.moveCursorUp));H.bind(M.Down,L.None,D(V.moveCursorDown));H.bind(M.Left,L.Shift,
D(V.extendSelectionToLeft));H.bind(M.Right,L.Shift,D(V.extendSelectionToRight));H.bind(M.Up,L.Shift,D(V.extendSelectionUp));H.bind(M.Down,L.Shift,D(V.extendSelectionDown));H.bind(M.Home,L.None,D(V.moveCursorToLineStart));H.bind(M.End,L.None,D(V.moveCursorToLineEnd));H.bind(M.Home,L.Ctrl,D(V.moveCursorToDocumentStart));H.bind(M.End,L.Ctrl,D(V.moveCursorToDocumentEnd));H.bind(M.Home,L.Shift,D(V.extendSelectionToLineStart));H.bind(M.End,L.Shift,D(V.extendSelectionToLineEnd));H.bind(M.Up,L.CtrlShift,
D(V.extendSelectionToParagraphStart));H.bind(M.Down,L.CtrlShift,D(V.extendSelectionToParagraphEnd));H.bind(M.Home,L.CtrlShift,D(V.extendSelectionToDocumentStart));H.bind(M.End,L.CtrlShift,D(V.extendSelectionToDocumentEnd));qa?(H.bind(M.Left,L.Alt,D(V.moveCursorBeforeWord)),H.bind(M.Right,L.Alt,D(V.moveCursorPastWord)),H.bind(M.Left,L.Meta,D(V.moveCursorToLineStart)),H.bind(M.Right,L.Meta,D(V.moveCursorToLineEnd)),H.bind(M.Home,L.Meta,D(V.moveCursorToDocumentStart)),H.bind(M.End,L.Meta,D(V.moveCursorToDocumentEnd)),
H.bind(M.Left,L.AltShift,D(V.extendSelectionBeforeWord)),H.bind(M.Right,L.AltShift,D(V.extendSelectionPastWord)),H.bind(M.Left,L.MetaShift,D(V.extendSelectionToLineStart)),H.bind(M.Right,L.MetaShift,D(V.extendSelectionToLineEnd)),H.bind(M.Up,L.AltShift,D(V.extendSelectionToParagraphStart)),H.bind(M.Down,L.AltShift,D(V.extendSelectionToParagraphEnd)),H.bind(M.Up,L.MetaShift,D(V.extendSelectionToDocumentStart)),H.bind(M.Down,L.MetaShift,D(V.extendSelectionToDocumentEnd)),H.bind(M.A,L.Meta,D(V.extendSelectionToEntireDocument))):
(H.bind(M.Left,L.Ctrl,D(V.moveCursorBeforeWord)),H.bind(M.Right,L.Ctrl,D(V.moveCursorPastWord)),H.bind(M.Left,L.CtrlShift,D(V.extendSelectionBeforeWord)),H.bind(M.Right,L.CtrlShift,D(V.extendSelectionPastWord)),H.bind(M.A,L.Ctrl,D(V.extendSelectionToEntireDocument)));ta&&(ra=new gui.IOSSafariSupport(R));R.subscribe("keydown",H.handleEvent);R.subscribe("keypress",Y.handleEvent);R.subscribe("keyup",ga.handleEvent);R.subscribe("copy",m);R.subscribe("mousedown",s);R.subscribe("mousemove",la.trigger);
R.subscribe("mouseup",K);R.subscribe("contextmenu",F);R.subscribe("dragstart",I);R.subscribe("dragend",G);R.subscribe("click",oa.handleClick);R.subscribe("longpress",E);R.subscribe("drag",x);R.subscribe("dragstop",z);C.subscribe(ops.OdtDocument.signalOperationEnd,ma.trigger);C.subscribe(ops.Document.signalCursorAdded,ja.registerCursor);C.subscribe(ops.Document.signalCursorRemoved,ja.removeCursor);C.subscribe(ops.OdtDocument.signalOperationEnd,e)}})();
gui.CaretManager=function(f,k){function a(a){return g.hasOwnProperty(a)?g[a]:null}function d(){return Object.keys(g).map(function(a){return g[a]})}function c(a){var c=g[a];c&&(delete g[a],a===f.getInputMemberId()?(l.unsubscribe(ops.OdtDocument.signalProcessingBatchEnd,c.ensureVisible),l.unsubscribe(ops.Document.signalCursorMoved,c.refreshCursorBlinking),q.unsubscribe("compositionupdate",c.handleUpdate),q.unsubscribe("compositionend",c.handleUpdate),q.unsubscribe("focus",c.setFocus),q.unsubscribe("blur",
c.removeFocus),n.removeEventListener("focus",c.show,!1),n.removeEventListener("blur",c.hide,!1)):l.unsubscribe(ops.OdtDocument.signalProcessingBatchEnd,c.handleUpdate),c.destroy(function(){}))}var g={},n=runtime.getWindow(),l=f.getSession().getOdtDocument(),q=f.getEventManager();this.registerCursor=function(a,c,b){var e=a.getMemberId();a=new gui.Caret(a,k,c,b);g[e]=a;e===f.getInputMemberId()?(runtime.log("Starting to track input on new cursor of "+e),l.subscribe(ops.OdtDocument.signalProcessingBatchEnd,
a.ensureVisible),l.subscribe(ops.Document.signalCursorMoved,a.refreshCursorBlinking),q.subscribe("compositionupdate",a.handleUpdate),q.subscribe("compositionend",a.handleUpdate),q.subscribe("focus",a.setFocus),q.subscribe("blur",a.removeFocus),n.addEventListener("focus",a.show,!1),n.addEventListener("blur",a.hide,!1),a.setOverlayElement(q.getEventTrap())):l.subscribe(ops.OdtDocument.signalProcessingBatchEnd,a.handleUpdate);return a};this.getCaret=a;this.getCarets=d;this.destroy=function(a){var k=
d().map(function(b){return b.destroy});f.getSelectionController().setCaretXPositionLocator(null);l.unsubscribe(ops.Document.signalCursorRemoved,c);g={};core.Async.destroyAll(k,a)};f.getSelectionController().setCaretXPositionLocator(function(){var c=a(f.getInputMemberId()),d;c&&(d=c.getBoundingClientRect());return d?d.right:void 0});l.subscribe(ops.Document.signalCursorRemoved,c)};
gui.EditInfoHandle=function(f){var k=[],a,d=f.ownerDocument,c=d.documentElement.namespaceURI;this.setEdits=function(f){k=f;var n,l,q,m;a.innerHTML="";for(f=0;f<k.length;f+=1)n=d.createElementNS(c,"div"),n.className="editInfo",l=d.createElementNS(c,"span"),l.className="editInfoColor",l.setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",k[f].memberid),q=d.createElementNS(c,"span"),q.className="editInfoAuthor",q.setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",k[f].memberid),
m=d.createElementNS(c,"span"),m.className="editInfoTime",m.setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",k[f].memberid),m.innerHTML=k[f].time,n.appendChild(l),n.appendChild(q),n.appendChild(m),a.appendChild(n)};this.show=function(){a.style.display="block"};this.hide=function(){a.style.display="none"};this.destroy=function(c){f.removeChild(a);c()};a=d.createElementNS(c,"div");a.setAttribute("class","editInfoHandle");a.style.display="none";f.appendChild(a)};
ops.EditInfo=function(f,k){function a(){var a=[],d;for(d in c)c.hasOwnProperty(d)&&a.push({memberid:d,time:c[d].time});a.sort(function(a,c){return a.time-c.time});return a}var d,c={};this.getNode=function(){return d};this.getOdtDocument=function(){return k};this.getEdits=function(){return c};this.getSortedEdits=function(){return a()};this.addEdit=function(a,d){c[a]={time:d}};this.clearEdits=function(){c={}};this.destroy=function(a){f.parentNode&&f.removeChild(d);a()};d=k.getDOMDocument().createElementNS("urn:webodf:names:editinfo",
"editinfo");f.insertBefore(d,f.firstChild)};
gui.EditInfoMarker=function(f,k){function a(a,b){return runtime.setTimeout(function(){n.style.opacity=a},b)}var d=this,c,g,n,l,q,m;this.addEdit=function(c,b){var e=Date.now()-b;f.addEdit(c,b);g.setEdits(f.getSortedEdits());n.setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",c);runtime.clearTimeout(q);runtime.clearTimeout(m);1E4>e?(l=a(1,0),q=a(.5,1E4-e),m=a(.2,2E4-e)):1E4<=e&&2E4>e?(l=a(.5,0),m=a(.2,2E4-e)):l=a(.2,0)};this.getEdits=function(){return f.getEdits()};this.clearEdits=function(){f.clearEdits();
g.setEdits([]);n.hasAttributeNS("urn:webodf:names:editinfo","editinfo:memberid")&&n.removeAttributeNS("urn:webodf:names:editinfo","editinfo:memberid")};this.getEditInfo=function(){return f};this.show=function(){n.style.display="block"};this.hide=function(){d.hideHandle();n.style.display="none"};this.showHandle=function(){g.show()};this.hideHandle=function(){g.hide()};this.destroy=function(a){runtime.clearTimeout(l);runtime.clearTimeout(q);runtime.clearTimeout(m);c.removeChild(n);g.destroy(function(b){b?
a(b):f.destroy(a)})};(function(){var a=f.getOdtDocument().getDOMDocument();n=a.createElementNS(a.documentElement.namespaceURI,"div");n.setAttribute("class","editInfoMarker");n.onmouseover=function(){d.showHandle()};n.onmouseout=function(){d.hideHandle()};c=f.getNode();c.appendChild(n);g=new gui.EditInfoHandle(c);k||d.hide()})()};
gui.HyperlinkTooltipView=function(f,k){var a=core.DomUtils,d=odf.OdfUtils,c=runtime.getWindow(),g,n,l;runtime.assert(null!==c,"Expected to be run in an environment which has a global window, like a browser.");this.showTooltip=function(q){var m=q.target||q.srcElement,p=f.getSizer(),b=f.getZoomLevel(),e;a:{for(;m;){if(d.isHyperlink(m))break a;if(d.isParagraph(m)||d.isInlineRoot(m))break;m=m.parentNode}m=null}if(m){a.containsNode(p,l)||p.appendChild(l);e=n;var r;switch(k()){case gui.KeyboardHandler.Modifier.Ctrl:r=
runtime.tr("Ctrl-click to follow link");break;case gui.KeyboardHandler.Modifier.Meta:r=runtime.tr("\u2318-click to follow link");break;default:r=""}e.textContent=r;g.textContent=d.getHyperlinkTarget(m);l.style.display="block";e=c.innerWidth-l.offsetWidth-15;m=q.clientX>e?e:q.clientX+15;e=c.innerHeight-l.offsetHeight-10;q=q.clientY>e?e:q.clientY+10;p=p.getBoundingClientRect();m=(m-p.left)/b;q=(q-p.top)/b;l.style.left=m+"px";l.style.top=q+"px"}};this.hideTooltip=function(){l.style.display="none"};this.destroy=
function(a){l.parentNode&&l.parentNode.removeChild(l);a()};(function(){var a=f.getElement().ownerDocument;g=a.createElement("span");n=a.createElement("span");g.className="webodf-hyperlinkTooltipLink";n.className="webodf-hyperlinkTooltipText";l=a.createElement("div");l.className="webodf-hyperlinkTooltip";l.appendChild(g);l.appendChild(n);f.getElement().appendChild(l)})()};
gui.OdfFieldView=function(f){function k(){var a=odf.OdfSchema.getFields().map(function(a){return a.replace(":","|")}),d=a.join(",\n")+"\n{ background-color: #D0D0D0; }\n",a=a.map(function(a){return a+":empty::after"}).join(",\n")+"\n{ content:' '; white-space: pre; }\n";return d+"\n"+a}var a,d=f.getElement().ownerDocument;this.showFieldHighlight=function(){a.appendChild(d.createTextNode(k()))};this.hideFieldHighlight=function(){for(var c=a.sheet,d=c.cssRules;d.length;)c.deleteRule(d.length-1)};this.destroy=
function(c){a.parentNode&&a.parentNode.removeChild(a);c()};a=function(){var a=d.getElementsByTagName("head").item(0),f=d.createElement("style"),k="";f.type="text/css";f.media="screen, print, handheld, projection";odf.Namespaces.forEachPrefix(function(a,c){k+="@namespace "+a+" url("+c+");\n"});f.appendChild(d.createTextNode(k));a.appendChild(f);return f}()};
gui.ShadowCursor=function(f){var k=f.getDOMDocument().createRange(),a=!0;this.removeFromDocument=function(){};this.getMemberId=function(){return gui.ShadowCursor.ShadowCursorMemberId};this.getSelectedRange=function(){return k};this.setSelectedRange=function(d,c){k=d;a=!1!==c};this.hasForwardSelection=function(){return a};this.getDocument=function(){return f};this.getSelectionType=function(){return ops.OdtCursor.RangeSelection};k.setStart(f.getRootNode(),0)};gui.ShadowCursor.ShadowCursorMemberId="";
gui.SelectionView=function(f){};gui.SelectionView.prototype.rerender=function(){};gui.SelectionView.prototype.show=function(){};gui.SelectionView.prototype.hide=function(){};gui.SelectionView.prototype.destroy=function(f){};
gui.SelectionViewManager=function(f){function k(){return Object.keys(a).map(function(d){return a[d]})}var a={};this.getSelectionView=function(d){return a.hasOwnProperty(d)?a[d]:null};this.getSelectionViews=k;this.removeSelectionView=function(d){a.hasOwnProperty(d)&&(a[d].destroy(function(){}),delete a[d])};this.hideSelectionView=function(d){a.hasOwnProperty(d)&&a[d].hide()};this.showSelectionView=function(d){a.hasOwnProperty(d)&&a[d].show()};this.rerenderSelectionViews=function(){Object.keys(a).forEach(function(d){a[d].rerender()})};
this.registerCursor=function(d,c){var g=d.getMemberId(),k=new f(d);c?k.show():k.hide();return a[g]=k};this.destroy=function(a){function c(k,l){l?a(l):k<f.length?f[k].destroy(function(a){c(k+1,a)}):a()}var f=k();c(0,void 0)}};gui.SessionViewOptions=function(){this.caretBlinksOnRangeSelect=this.caretAvatarsInitiallyVisible=this.editInfoMarkersInitiallyVisible=!0};
(function(){function f(f,a){return void 0!==f?Boolean(f):a}gui.SessionView=function(k,a,d,c,g,n){function l(b){b.memberId===a&&N.getViewport().scrollIntoView(b.annotation.getBoundingClientRect())}function q(){var b=document.getElementsByTagName("head").item(0),a=document.createElement("style");a.type="text/css";a.media="screen, print, handheld, projection";b.appendChild(a);return a}function m(b,c,e){function d(a,c,e){c=a+'[editinfo|memberid="'+b+'"]'+e+c;a:{var f=s.firstChild;for(a=a+'[editinfo|memberid="'+
b+'"]'+e+"{";f;){if(f.nodeType===Node.TEXT_NODE&&0===f.data.indexOf(a)){a=f;break a}f=f.nextSibling}a=null}a?a.data=c:s.appendChild(document.createTextNode(c))}d("div.editInfoMarker","{ background-color: "+e+"; }","");d("span.editInfoColor","{ background-color: "+e+"; }","");d("span.editInfoAuthor",'{ content: "'+c+'"; }',":before");d("dc|creator","{ background-color: "+e+"; }","");d(".webodf-selectionOverlay","{ fill: "+e+"; stroke: "+e+";}","");b===a&&(d(".webodf-touchEnabled .webodf-selectionOverlay",
"{ display: block; }"," > .webodf-draggable"),b=gui.ShadowCursor.ShadowCursorMemberId,d(".webodf-selectionOverlay","{ fill: "+e+"; stroke: "+e+";}",""),d(".webodf-touchEnabled .webodf-selectionOverlay","{ display: block; }"," > .webodf-draggable"))}function p(b){var a,c;for(c in w)w.hasOwnProperty(c)&&(a=w[c],b?a.show():a.hide())}function b(b){g.getCarets().forEach(function(a){b?a.showHandle():a.hideHandle()})}function e(b){var a=b.getMemberId();b=b.getProperties();m(a,b.fullName,b.color)}function r(b){var a=
b.getMemberId(),c=d.getOdtDocument().getMember(a).getProperties();g.registerCursor(b,F,K);n.registerCursor(b,!0);if(b=g.getCaret(a))b.setAvatarImageUrl(c.imageUrl),b.setColor(c.color);runtime.log("+++ View here +++ eagerly created an Caret for '"+a+"'! +++")}function h(b){b=b.getMemberId();var c=n.getSelectionView(a),e=n.getSelectionView(gui.ShadowCursor.ShadowCursorMemberId),d=g.getCaret(a);b===a?(e.hide(),c&&c.show(),d&&d.show()):b===gui.ShadowCursor.ShadowCursorMemberId&&(e.show(),c&&c.hide(),
d&&d.hide())}function u(b){n.removeSelectionView(b)}function x(b){var a=b.paragraphElement,c=b.memberId;b=b.timeStamp;var e,f="",h=a.getElementsByTagNameNS("urn:webodf:names:editinfo","editinfo").item(0);h?(f=h.getAttributeNS("urn:webodf:names:editinfo","id"),e=w[f]):(f=Math.random().toString(),e=new ops.EditInfo(a,d.getOdtDocument()),e=new gui.EditInfoMarker(e,G),h=a.getElementsByTagNameNS("urn:webodf:names:editinfo","editinfo").item(0),h.setAttributeNS("urn:webodf:names:editinfo","id",f),w[f]=e);
e.addEdit(c,new Date(b));I.trigger()}function z(){var b;""!==A.innerHTML&&(A.innerHTML="");!0===c.getState(gui.CommonConstraints.EDIT.ANNOTATIONS.ONLY_DELETE_OWN)&&(b=d.getOdtDocument().getMember(a))&&(b=b.getProperties().fullName,A.appendChild(document.createTextNode(".annotationWrapper:not([creator = '"+b+"']) .annotationRemoveButton { display: none; }")))}function v(b){var a=Object.keys(w).map(function(b){return w[b]});E.unsubscribe(ops.Document.signalMemberAdded,e);E.unsubscribe(ops.Document.signalMemberUpdated,
e);E.unsubscribe(ops.Document.signalCursorAdded,r);E.unsubscribe(ops.Document.signalCursorRemoved,u);E.unsubscribe(ops.OdtDocument.signalParagraphChanged,x);E.unsubscribe(ops.Document.signalCursorMoved,h);E.unsubscribe(ops.OdtDocument.signalParagraphChanged,n.rerenderSelectionViews);E.unsubscribe(ops.OdtDocument.signalTableAdded,n.rerenderSelectionViews);E.unsubscribe(ops.OdtDocument.signalParagraphStyleModified,n.rerenderSelectionViews);c.unsubscribe(gui.CommonConstraints.EDIT.ANNOTATIONS.ONLY_DELETE_OWN,
z);E.unsubscribe(ops.Document.signalMemberAdded,z);E.unsubscribe(ops.Document.signalMemberUpdated,z);s.parentNode.removeChild(s);A.parentNode.removeChild(A);(function U(c,e){e?b(e):c<a.length?a[c].destroy(function(b){U(c+1,b)}):b()})(0,void 0)}var s,A,w={},E,N,I,G=f(k.editInfoMarkersInitiallyVisible,!0),F=f(k.caretAvatarsInitiallyVisible,!0),K=f(k.caretBlinksOnRangeSelect,!0);this.showEditInfoMarkers=function(){G||(G=!0,p(G))};this.hideEditInfoMarkers=function(){G&&(G=!1,p(G))};this.showCaretAvatars=
function(){F||(F=!0,b(F))};this.hideCaretAvatars=function(){F&&(F=!1,b(F))};this.getSession=function(){return d};this.getCaret=function(b){return g.getCaret(b)};this.destroy=function(b){var a=[I.destroy,v];E.unsubscribe(ops.OdtDocument.signalAnnotationAdded,l);core.Async.destroyAll(a,b)};E=d.getOdtDocument();N=E.getOdfCanvas();E.subscribe(ops.OdtDocument.signalAnnotationAdded,l);E.subscribe(ops.Document.signalMemberAdded,e);E.subscribe(ops.Document.signalMemberUpdated,e);E.subscribe(ops.Document.signalCursorAdded,
r);E.subscribe(ops.Document.signalCursorRemoved,u);E.subscribe(ops.OdtDocument.signalParagraphChanged,x);E.subscribe(ops.Document.signalCursorMoved,h);E.subscribe(ops.OdtDocument.signalParagraphChanged,n.rerenderSelectionViews);E.subscribe(ops.OdtDocument.signalTableAdded,n.rerenderSelectionViews);E.subscribe(ops.OdtDocument.signalParagraphStyleModified,n.rerenderSelectionViews);c.subscribe(gui.CommonConstraints.EDIT.ANNOTATIONS.ONLY_DELETE_OWN,z);E.subscribe(ops.Document.signalMemberAdded,z);E.subscribe(ops.Document.signalMemberUpdated,
z);s=q();s.appendChild(document.createTextNode("@namespace editinfo url(urn:webodf:names:editinfo);"));s.appendChild(document.createTextNode("@namespace dc url(http://purl.org/dc/elements/1.1/);"));A=q();z();I=core.Task.createRedrawTask(function(){var b=N.getAnnotationViewManager();b&&(b.rehighlightAnnotations(),E.fixCursorPositions())})}})();
gui.SvgSelectionView=function(f){function k(){var b=e.getRootNode();r!==b&&(r=b,h=e.getCanvas().getSizer(),h.appendChild(x),x.setAttribute("class","webodf-selectionOverlay"),v.setAttribute("class","webodf-draggable"),s.setAttribute("class","webodf-draggable"),v.setAttribute("end","left"),s.setAttribute("end","right"),v.setAttribute("r",8),s.setAttribute("r",8),x.appendChild(z),x.appendChild(v),x.appendChild(s))}function a(b){b=b.getBoundingClientRect();return Boolean(b&&0!==b.height)}function d(b){var c=
A.getTextElements(b,!0,!1),e=b.cloneRange(),d=b.cloneRange();b=b.cloneRange();if(!c.length)return null;var f;a:{f=0;var h=c[f],g=e.startContainer===h?e.startOffset:0,k=g;e.setStart(h,g);for(e.setEnd(h,k);!a(e);){if(h.nodeType===Node.ELEMENT_NODE&&k<h.childNodes.length)k=h.childNodes.length;else if(h.nodeType===Node.TEXT_NODE&&k<h.length)k+=1;else if(c[f])h=c[f],f+=1,g=k=0;else{f=!1;break a}e.setStart(h,g);e.setEnd(h,k)}f=!0}if(!f)return null;a:{f=c.length-1;h=c[f];k=g=d.endContainer===h?d.endOffset:
h.nodeType===Node.TEXT_NODE?h.length:h.childNodes.length;d.setStart(h,g);for(d.setEnd(h,k);!a(d);){if(h.nodeType===Node.ELEMENT_NODE&&0<g)g=0;else if(h.nodeType===Node.TEXT_NODE&&0<g)g-=1;else if(c[f])h=c[f],f-=1,g=k=h.length||h.childNodes.length;else{c=!1;break a}d.setStart(h,g);d.setEnd(h,k)}c=!0}if(!c)return null;b.setStart(e.startContainer,e.startOffset);b.setEnd(d.endContainer,d.endOffset);return{firstRange:e,lastRange:d,fillerRange:b}}function c(b,a){var c={};c.top=Math.min(b.top,a.top);c.left=
Math.min(b.left,a.left);c.right=Math.max(b.right,a.right);c.bottom=Math.max(b.bottom,a.bottom);c.width=c.right-c.left;c.height=c.bottom-c.top;return c}function g(b,a){a&&0<a.width&&0<a.height&&(b=b?c(b,a):a);return b}function n(b){function a(b){I.setUnfilteredPosition(b,0);return x.acceptNode(b)===G&&s.acceptPosition(I)===G?G:F}function c(b){var e=null;a(b)===G&&(e=w.getBoundingClientRect(b));return e}var d=b.commonAncestorContainer,f=b.startContainer,h=b.endContainer,k=b.startOffset,l=b.endOffset,
m,n,r=null,p,q=u.createRange(),s,x=new odf.OdfNodeFilter,v;if(f===d||h===d)return q=b.cloneRange(),r=q.getBoundingClientRect(),q.detach(),r;for(b=f;b.parentNode!==d;)b=b.parentNode;for(n=h;n.parentNode!==d;)n=n.parentNode;s=e.createRootFilter(f);for(d=b.nextSibling;d&&d!==n;)p=c(d),r=g(r,p),d=d.nextSibling;if(A.isParagraph(b))r=g(r,w.getBoundingClientRect(b));else if(b.nodeType===Node.TEXT_NODE)d=b,q.setStart(d,k),q.setEnd(d,d===n?l:d.length),p=q.getBoundingClientRect(),r=g(r,p);else for(v=u.createTreeWalker(b,
NodeFilter.SHOW_TEXT,a,!1),d=v.currentNode=f;d&&d!==h;)q.setStart(d,k),q.setEnd(d,d.length),p=q.getBoundingClientRect(),r=g(r,p),m=d,k=0,d=v.nextNode();m||(m=f);if(A.isParagraph(n))r=g(r,w.getBoundingClientRect(n));else if(n.nodeType===Node.TEXT_NODE)d=n,q.setStart(d,d===b?k:0),q.setEnd(d,l),p=q.getBoundingClientRect(),r=g(r,p);else for(v=u.createTreeWalker(n,NodeFilter.SHOW_TEXT,a,!1),d=v.currentNode=h;d&&d!==m;)if(q.setStart(d,0),q.setEnd(d,l),p=q.getBoundingClientRect(),r=g(r,p),d=v.previousNode())l=
d.length;return r}function l(b,a){var c=b.getBoundingClientRect(),e={width:0};e.top=c.top;e.bottom=c.bottom;e.height=c.height;e.left=e.right=a?c.right:c.left;return e}function q(){var b=f.getSelectedRange(),a;if(a=N&&f.getSelectionType()===ops.OdtCursor.RangeSelection&&!b.collapsed){k();var e=w.getBoundingClientRect(h),g=E.getZoomLevel(),b=d(b),m,r,p,q,u,A;if(b){a=b.firstRange;m=b.lastRange;r=b.fillerRange;p=w.translateRect(l(a,!1),e,g);u=w.translateRect(l(m,!0),e,g);q=(q=n(r))?w.translateRect(q,
e,g):c(p,u);A=q.left;q=p.left+Math.max(0,q.width-(p.left-q.left));e=Math.min(p.top,u.top);g=u.top+u.height;A=[{x:p.left,y:e+p.height},{x:p.left,y:e},{x:q,y:e},{x:q,y:g-u.height},{x:u.right,y:g-u.height},{x:u.right,y:g},{x:A,y:g},{x:A,y:e+p.height},{x:p.left,y:e+p.height}];q="";var I;for(I=0;I<A.length;I+=1)q+=A[I].x+","+A[I].y+" ";z.setAttribute("points",q);v.setAttribute("cx",p.left);v.setAttribute("cy",e+p.height/2);s.setAttribute("cx",u.right);s.setAttribute("cy",g-u.height/2);a.detach();m.detach();
r.detach()}a=Boolean(b)}x.style.display=a?"block":"none"}function m(b){N&&b===f&&K.trigger()}function p(b){b=8/b;v.setAttribute("r",b);s.setAttribute("r",b)}function b(b){h.removeChild(x);h.classList.remove("webodf-virtualSelections");f.getDocument().unsubscribe(ops.Document.signalCursorMoved,m);E.unsubscribe(gui.ZoomHelper.signalZoomChanged,p);b()}var e=f.getDocument(),r,h,u=e.getDOMDocument(),x=u.createElementNS("http://www.w3.org/2000/svg","svg"),z=u.createElementNS("http://www.w3.org/2000/svg",
"polygon"),v=u.createElementNS("http://www.w3.org/2000/svg","circle"),s=u.createElementNS("http://www.w3.org/2000/svg","circle"),A=odf.OdfUtils,w=core.DomUtils,E=e.getCanvas().getZoomHelper(),N=!0,I=f.getDocument().createPositionIterator(e.getRootNode()),G=NodeFilter.FILTER_ACCEPT,F=NodeFilter.FILTER_REJECT,K;this.rerender=function(){N&&K.trigger()};this.show=function(){N=!0;K.trigger()};this.hide=function(){N=!1;K.trigger()};this.destroy=function(a){core.Async.destroyAll([K.destroy,b],a)};(function(){var b=
f.getMemberId();K=core.Task.createRedrawTask(q);k();x.setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",b);h.classList.add("webodf-virtualSelections");f.getDocument().subscribe(ops.Document.signalCursorMoved,m);E.subscribe(gui.ZoomHelper.signalZoomChanged,p);p(E.getZoomLevel())})()};
gui.UndoStateRules=function(){function f(a,d){var f=a.length;this.previous=function(){for(f-=1;0<=f;f-=1)if(d(a[f]))return a[f];return null}}function k(a){a=a.spec();var d;a.hasOwnProperty("position")&&(d=a.position);return d}function a(a){return a.isEdit}function d(a,d,f){if(!f)return f=k(a)-k(d),0===f||1===Math.abs(f);a=k(a);d=k(d);f=k(f);return a-d===d-f}this.isEditOperation=a;this.isPartOfOperationSet=function(c,g){var k=void 0!==c.group,l;if(!c.isEdit||0===g.length)return!0;l=g[g.length-1];if(k&&
c.group===l.group)return!0;a:switch(c.spec().optype){case "RemoveText":case "InsertText":l=!0;break a;default:l=!1}if(l&&g.some(a)){if(k){var q;k=c.spec().optype;l=new f(g,a);var m=l.previous(),p=null,b,e;runtime.assert(Boolean(m),"No edit operations found in state");e=m.group;runtime.assert(void 0!==e,"Operation has no group");for(b=1;m&&m.group===e;){if(k===m.spec().optype){q=m;break}m=l.previous()}if(q){for(m=l.previous();m;){if(m.group!==e){if(2===b)break;e=m.group;b+=1}if(k===m.spec().optype){p=
m;break}m=l.previous()}q=d(c,q,p)}else q=!1;return q}q=c.spec().optype;k=new f(g,a);l=k.previous();runtime.assert(Boolean(l),"No edit operations found in state");q=q===l.spec().optype?d(c,l,k.previous()):!1;return q}return!1}};
gui.TrivialUndoManager=function(f){function k(b){0<b.length&&(s=!0,e(b),s=!1)}function a(){z.emit(gui.UndoManager.signalUndoStackChanged,{undoAvailable:q.hasUndoStates(),redoAvailable:q.hasRedoStates()})}function d(){h!==b&&h!==u[u.length-1]&&u.push(h)}function c(b){var a=b.previousSibling||b.nextSibling;b.parentNode.removeChild(b);m.normalizeTextNodes(a)}function g(b){return Object.keys(b).map(function(a){return b[a]})}function n(b){function a(b){var h=b.spec();if(d[h.memberid])switch(h.optype){case "AddCursor":c[h.memberid]||
(c[h.memberid]=b,delete d[h.memberid],f-=1);break;case "MoveCursor":e[h.memberid]||(e[h.memberid]=b)}}var c={},e={},d={},f,h=b.pop();r.getMemberIds().forEach(function(b){d[b]=!0});for(f=Object.keys(d).length;h&&0<f;)h.reverse(),h.forEach(a),h=b.pop();return g(c).concat(g(e))}function l(){var e=p=r.cloneDocumentElement();m.getElementsByTagNameNS(e,"urn:webodf:names:cursor","cursor").forEach(c);m.getElementsByTagNameNS(e,"urn:webodf:names:cursor","anchor").forEach(c);d();h=b=n([b].concat(u));u.length=
0;x.length=0;a()}var q=this,m=core.DomUtils,p,b=[],e,r,h=[],u=[],x=[],z=new core.EventNotifier([gui.UndoManager.signalUndoStackChanged,gui.UndoManager.signalUndoStateCreated,gui.UndoManager.signalUndoStateModified,gui.TrivialUndoManager.signalDocumentRootReplaced]),v=f||new gui.UndoStateRules,s=!1;this.subscribe=function(b,a){z.subscribe(b,a)};this.unsubscribe=function(b,a){z.unsubscribe(b,a)};this.hasUndoStates=function(){return 0<u.length};this.hasRedoStates=function(){return 0<x.length};this.setDocument=
function(b){r=b};this.purgeInitialState=function(){u.length=0;x.length=0;b.length=0;h.length=0;p=null;a()};this.setInitialState=l;this.initialize=function(){p||l()};this.setPlaybackFunction=function(b){e=b};this.onOperationExecuted=function(c){s||(v.isEditOperation(c)&&(h===b||0<x.length)||!v.isPartOfOperationSet(c,h)?(x.length=0,d(),h=[c],u.push(h),z.emit(gui.UndoManager.signalUndoStateCreated,{operations:h}),a()):(h.push(c),z.emit(gui.UndoManager.signalUndoStateModified,{operations:h})))};this.moveForward=
function(b){for(var c=0,e;b&&x.length;)e=x.pop(),u.push(e),k(e),b-=1,c+=1;c&&(h=u[u.length-1],a());return c};this.moveBackward=function(c){for(var e=0;c&&u.length;)x.push(u.pop()),c-=1,e+=1;e&&(r.getMemberIds().forEach(function(b){r.removeCursor(b)}),r.setDocumentElement(p.cloneNode(!0)),z.emit(gui.TrivialUndoManager.signalDocumentRootReplaced,{}),k(b),u.forEach(k),h=u[u.length-1]||b,a());return e}};gui.TrivialUndoManager.signalDocumentRootReplaced="documentRootReplaced";
odf.GraphicProperties=function(f,k,a){var d=this,c=odf.Namespaces.stylens,g=odf.Namespaces.svgns;this.verticalPos=function(){return d.data.value("verticalPos")};this.verticalRel=function(){return d.data.value("verticalRel")};this.horizontalPos=function(){return d.data.value("horizontalPos")};this.horizontalRel=function(){return d.data.value("horizontalRel")};this.strokeWidth=function(){return d.data.value("strokeWidth")};this.data;d.data=new odf.LazyStyleProperties(void 0===a?void 0:a.data,{verticalPos:function(){var a=
f.getAttributeNS(c,"vertical-pos");return""===a?void 0:a},verticalRel:function(){var a=f.getAttributeNS(c,"vertical-rel");return""===a?void 0:a},horizontalPos:function(){var a=f.getAttributeNS(c,"horizontal-pos");return""===a?void 0:a},horizontalRel:function(){var a=f.getAttributeNS(c,"horizontal-rel");return""===a?void 0:a},strokeWidth:function(){var a=f.getAttributeNS(g,"stroke-width");return k.parseLength(a)}})};
odf.ComputedGraphicProperties=function(){var f;this.setGraphicProperties=function(k){f=k};this.verticalPos=function(){return f&&f.verticalPos()||"from-top"};this.verticalRel=function(){return f&&f.verticalRel()||"page"};this.horizontalPos=function(){return f&&f.horizontalPos()||"from-left"};this.horizontalRel=function(){return f&&f.horizontalRel()||"page"}};
odf.PageLayoutProperties=function(f,k,a){var d=this,c=odf.Namespaces.fons;this.pageHeight=function(){return d.data.value("pageHeight")||1123};this.pageWidth=function(){return d.data.value("pageWidth")||794};this.data;d.data=new odf.LazyStyleProperties(void 0===a?void 0:a.data,{pageHeight:function(){var a;f&&(a=f.getAttributeNS(c,"page-height"),a=k.parseLength(a));return a},pageWidth:function(){var a;f&&(a=f.getAttributeNS(c,"page-width"),a=k.parseLength(a));return a}})};
odf.PageLayout=function(f,k,a){this.pageLayout;var d=null;f&&(d=k.getPropertiesElement("page-layout-properties",f));this.pageLayout=new odf.PageLayoutProperties(d,k,a&&a.pageLayout)};odf.PageLayoutCache=function(){};odf.PageLayoutCache.prototype.getPageLayout=function(f){};odf.PageLayoutCache.prototype.getDefaultPageLayout=function(){};
odf.ParagraphProperties=function(f,k,a){var d=this,c=odf.Namespaces.fons;this.marginTop=function(){return d.data.value("marginTop")};this.data;d.data=new odf.LazyStyleProperties(void 0===a?void 0:a.data,{marginTop:function(){var d=f.getAttributeNS(c,"margin-top");return k.parsePositiveLengthOrPercent(d,"marginTop",a&&a.data)}})};
odf.ComputedParagraphProperties=function(){var f={},k=[];this.setStyleChain=function(a){k=a;f={}};this.marginTop=function(){var a,d;if(f.hasOwnProperty("marginTop"))a=f.marginTop;else{for(d=0;void 0===a&&d<k.length;d+=1)a=k[d].marginTop();f.marginTop=a}return a||0}};
odf.TextProperties=function(f,k,a){var d=this,c=odf.Namespaces.fons;this.fontSize=function(){return d.data.value("fontSize")};this.data;d.data=new odf.LazyStyleProperties(void 0===a?void 0:a.data,{fontSize:function(){var d=f.getAttributeNS(c,"font-size");return k.parsePositiveLengthOrPercent(d,"fontSize",a&&a.data)}})};
odf.ComputedTextProperties=function(){var f={},k=[];this.setStyleChain=function(a){k=a;f={}};this.fontSize=function(){var a,d;if(f.hasOwnProperty("fontSize"))a=f.fontSize;else{for(d=0;void 0===a&&d<k.length;d+=1)a=k[d].fontSize();f.fontSize=a}return a||12}};odf.MasterPage=function(f,k){this.pageLayout;var a;f?(a=f.getAttributeNS(odf.Namespaces.stylens,"page-layout-name"),this.pageLayout=k.getPageLayout(a)):this.pageLayout=k.getDefaultPageLayout()};odf.MasterPageCache=function(){};
odf.MasterPageCache.prototype.getMasterPage=function(f){};
odf.StylePileEntry=function(f,k,a,d){this.text;this.paragraph;this.graphic;this.masterPage=function(){var c=f.getAttributeNS(odf.Namespaces.stylens,"master-page-name"),d=null;c&&(d=a.getMasterPage(c));return d};(function(a){var g=f.getAttributeNS(odf.Namespaces.stylens,"family"),n=null;if("graphic"===g||"chart"===g)a.graphic=void 0===d?void 0:d.graphic,n=k.getPropertiesElement("graphic-properties",f,n),null!==n&&(a.graphic=new odf.GraphicProperties(n,k,a.graphic));if("paragraph"===g||"table-cell"===
g||"graphic"===g||"presentation"===g||"chart"===g)a.paragraph=void 0===d?void 0:d.paragraph,n=k.getPropertiesElement("paragraph-properties",f,n),null!==n&&(a.paragraph=new odf.ParagraphProperties(n,k,a.paragraph));if("text"===g||"paragraph"===g||"table-cell"===g||"graphic"===g||"presentation"===g||"chart"===g)a.text=void 0===d?void 0:d.text,n=k.getPropertiesElement("text-properties",f,n),null!==n&&(a.text=new odf.TextProperties(n,k,a.text))})(this)};
odf.StylePile=function(f,k){function a(a,b){var c,g;a.hasAttributeNS(d,"parent-style-name")&&(g=a.getAttributeNS(d,"parent-style-name"),-1===b.indexOf(g)&&(c=m(g,b)));return new odf.StylePileEntry(a,f,k,c)}var d=odf.Namespaces.stylens,c={},g={},n,l={},q={},m;m=function(d,b){var e=l[d],f;!e&&(f=c[d])&&(b.push(d),e=a(f,b),l[d]=e);return e};this.getStyle=function(d){var b=q[d]||l[d],e,f=[];b||(e=g[d],e||(e=c[d])&&f.push(d),e&&(b=a(e,f)));return b};this.addCommonStyle=function(a){var b;a.hasAttributeNS(d,
"name")&&(b=a.getAttributeNS(d,"name"),c.hasOwnProperty(b)||(c[b]=a))};this.addAutomaticStyle=function(a){var b;a.hasAttributeNS(d,"name")&&(b=a.getAttributeNS(d,"name"),g.hasOwnProperty(b)||(g[b]=a))};this.setDefaultStyle=function(c){void 0===n&&(n=a(c,[]))};this.getDefaultStyle=function(){return n}};odf.ComputedGraphicStyle=function(){this.text=new odf.ComputedTextProperties;this.paragraph=new odf.ComputedParagraphProperties;this.graphic=new odf.ComputedGraphicProperties};
odf.ComputedParagraphStyle=function(){this.text=new odf.ComputedTextProperties;this.paragraph=new odf.ComputedParagraphProperties};odf.ComputedTextStyle=function(){this.text=new odf.ComputedTextProperties};
odf.StyleCache=function(f){function k(b,a,c,e){a=c.getAttributeNS(a,"class-names");var d;if(a)for(a=a.split(" "),d=0;d<a.length;d+=1)if(c=a[d])e.push(b),e.push(c)}function a(b,a){var c=x.getStyleName("paragraph",b);void 0!==c&&(a.push("paragraph"),a.push(c));b.namespaceURI!==h||"h"!==b.localName&&"p"!==b.localName||k("paragraph",h,b,a);return a}function d(b,a,c){var e=[],d,f,h,g;for(d=0;d<b.length;d+=2)h=b[d],g=b[d+1],h=l[h],g=h.getStyle(g),void 0!==g&&(g=g[a],void 0!==g&&g!==f&&(e.push(g),f=g));
h=l[c];if(g=h.getDefaultStyle())g=g[a],void 0!==g&&g!==f&&e.push(g);return e}function c(b,e){var d=x.getStyleName("text",b),g=b.parentNode;void 0!==d&&(e.push("text"),e.push(d));"span"===b.localName&&b.namespaceURI===h&&k("text",h,b,e);if(!g||g===f)return e;g.namespaceURI!==h||"p"!==g.localName&&"h"!==g.localName?c(g,e):a(g,e);return e}function g(b){b=b.getAttributeNS(u,"family");return l[b]}var n=this,l,q,m,p,b,e,r,h=odf.Namespaces.textns,u=odf.Namespaces.stylens,x=new odf.StyleInfo,z=new odf.StyleParseUtils,
v,s,A,w,E,N;this.getComputedGraphicStyle=function(b){var a=[];b=x.getStyleName("graphic",b);void 0!==b&&(a.push("graphic"),a.push(b));b=a.join("/");var c=p[b];runtime.assert(0===a.length%2,"Invalid style chain.");void 0===c&&(c=new odf.ComputedGraphicStyle,c.graphic.setGraphicProperties(d(a,"graphic","graphic")[0]),c.text.setStyleChain(d(a,"text","graphic")),c.paragraph.setStyleChain(d(a,"paragraph","graphic")),p[b]=c);return c};this.getComputedParagraphStyle=function(b){b=a(b,[]);var c=b.join("/"),
e=m[c];runtime.assert(0===b.length%2,"Invalid style chain.");void 0===e&&(e=new odf.ComputedParagraphStyle,e.text.setStyleChain(d(b,"text","paragraph")),e.paragraph.setStyleChain(d(b,"paragraph","paragraph")),m[c]=e);return e};this.getComputedTextStyle=function(b){b=c(b,[]);var a=b.join("/"),e=q[a];runtime.assert(0===b.length%2,"Invalid style chain.");void 0===e&&(e=new odf.ComputedTextStyle,e.text.setStyleChain(d(b,"text","text")),q[a]=e);return e};this.getPageLayout=function(b){var a=N[b];a||((a=
E[b])?(a=new odf.PageLayout(a,z,w),N[b]=a):a=w);return a};this.getDefaultPageLayout=function(){return w};this.getMasterPage=function(b){var a=s[b];void 0===a&&((a=v[b])?(a=new odf.MasterPage(a,n),s[b]=a):a=null);return a};this.getDefaultMasterPage=function(){return A};this.update=function(){var a,c,d=null,h=null;q={};m={};p={};v={};s={};N={};E={};b=new odf.StylePile(z,n);e=new odf.StylePile(z,n);r=new odf.StylePile(z,n);l={text:b,paragraph:e,graphic:r};for(a=f.styles.firstElementChild;a;)a.namespaceURI===
u&&((c=g(a))?"style"===a.localName?c.addCommonStyle(a):"default-style"===a.localName&&c.setDefaultStyle(a):"default-page-layout"===a.localName&&(d=a)),a=a.nextElementSibling;w=new odf.PageLayout(d,z);for(a=f.automaticStyles.firstElementChild;a;)a.namespaceURI===u&&((c=g(a))&&"style"===a.localName?c.addAutomaticStyle(a):"page-layout"===a.localName&&(E[a.getAttributeNS(u,"name")]=a)),a=a.nextElementSibling;for(a=f.masterStyles.firstElementChild;a;)a.namespaceURI===u&&"master-page"===a.localName&&(h=
h||a,c=a,d=c.getAttributeNS(u,"name"),0<d.length&&!v.hasOwnProperty(d)&&(v[d]=c)),a=a.nextElementSibling;A=new odf.MasterPage(h,n)}};
ops.OperationTransformMatrix=function(){function f(b){b.position+=b.length;b.length*=-1}function k(b){var a=0>b.length;a&&f(b);return a}function a(b,a){function c(f){b[f]===a&&d.push(f)}var d=[];b&&["style:parent-style-name","style:next-style-name"].forEach(c);return d}function d(b,a){function c(d){b[d]===a&&delete b[d]}b&&["style:parent-style-name","style:next-style-name"].forEach(c)}function c(b){var a={};Object.keys(b).forEach(function(d){a[d]="object"===typeof b[d]?c(b[d]):b[d]});return a}function g(b,
a,c,d){var f,g=!1,k=!1,l,m=[];d&&d.attributes&&(m=d.attributes.split(","));b&&(c||0<m.length)&&Object.keys(b).forEach(function(a){var e=b[a],d;"object"!==typeof e&&(c&&(d=c[a]),void 0!==d?(delete b[a],k=!0,d===e&&(delete c[a],g=!0)):-1!==m.indexOf(a)&&(delete b[a],k=!0))});if(a&&a.attributes&&(c||0<m.length)){l=a.attributes.split(",");for(d=0;d<l.length;d+=1)if(f=l[d],c&&void 0!==c[f]||m&&-1!==m.indexOf(f))l.splice(d,1),d-=1,k=!0;0<l.length?a.attributes=l.join(","):delete a.attributes}return{majorChanged:g,
minorChanged:k}}function n(b){for(var a in b)if(b.hasOwnProperty(a))return!0;return!1}function l(b){for(var a in b)if(b.hasOwnProperty(a)&&("attributes"!==a||0<b.attributes.length))return!0;return!1}function q(b,a,c,d,f){var k=b?b[f]:null,m=a?a[f]:null,q=c?c[f]:null,p=d?d[f]:null,A;A=g(k,m,q,p);k&&!n(k)&&delete b[f];m&&!l(m)&&delete a[f];q&&!n(q)&&delete c[f];p&&!l(p)&&delete d[f];return A}function m(b,a){return{opSpecsA:[b],opSpecsB:[a]}}var p;p={AddCursor:{AddCursor:m,AddMember:m,AddStyle:m,ApplyDirectStyling:m,
InsertText:m,MergeParagraph:m,MoveCursor:m,RemoveCursor:m,RemoveMember:m,RemoveStyle:m,RemoveText:m,SetParagraphStyle:m,SplitParagraph:m,UpdateMember:m,UpdateMetadata:m,UpdateParagraphStyle:m},AddMember:{AddStyle:m,ApplyDirectStyling:m,InsertText:m,MergeParagraph:m,MoveCursor:m,RemoveCursor:m,RemoveStyle:m,RemoveText:m,SetParagraphStyle:m,SplitParagraph:m,UpdateMetadata:m,UpdateParagraphStyle:m},AddStyle:{AddStyle:m,ApplyDirectStyling:m,InsertText:m,MergeParagraph:m,MoveCursor:m,RemoveCursor:m,RemoveMember:m,
RemoveStyle:function(b,c){var f,h=[b],g=[c];b.styleFamily===c.styleFamily&&(f=a(b.setProperties,c.styleName),0<f.length&&(f={optype:"UpdateParagraphStyle",memberid:c.memberid,timestamp:c.timestamp,styleName:b.styleName,removedProperties:{attributes:f.join(",")}},g.unshift(f)),d(b.setProperties,c.styleName));return{opSpecsA:h,opSpecsB:g}},RemoveText:m,SetParagraphStyle:m,SplitParagraph:m,UpdateMember:m,UpdateMetadata:m,UpdateParagraphStyle:m},ApplyDirectStyling:{ApplyDirectStyling:function(b,a,d){var f,
g,k,l,m,p,A,w;l=[b];k=[a];if(!(b.position+b.length<=a.position||b.position>=a.position+a.length)){f=d?b:a;g=d?a:b;if(b.position!==a.position||b.length!==a.length)p=c(f),A=c(g);a=q(g.setProperties,null,f.setProperties,null,"style:text-properties");if(a.majorChanged||a.minorChanged)k=[],b=[],l=f.position+f.length,m=g.position+g.length,g.position<f.position?a.minorChanged&&(w=c(A),w.length=f.position-g.position,b.push(w),g.position=f.position,g.length=m-g.position):f.position<g.position&&a.majorChanged&&
(w=c(p),w.length=g.position-f.position,k.push(w),f.position=g.position,f.length=l-f.position),m>l?a.minorChanged&&(p=A,p.position=l,p.length=m-l,b.push(p),g.length=l-g.position):l>m&&a.majorChanged&&(p.position=m,p.length=l-m,k.push(p),f.length=m-f.position),f.setProperties&&n(f.setProperties)&&k.push(f),g.setProperties&&n(g.setProperties)&&b.push(g),d?(l=k,k=b):l=b}return{opSpecsA:l,opSpecsB:k}},InsertText:function(b,a){a.position<=b.position?b.position+=a.text.length:a.position<=b.position+b.length&&
(b.length+=a.text.length);return{opSpecsA:[b],opSpecsB:[a]}},MergeParagraph:function(b,a){var c=b.position,d=b.position+b.length;c>=a.sourceStartPosition&&(c-=1);d>=a.sourceStartPosition&&(d-=1);b.position=c;b.length=d-c;return{opSpecsA:[b],opSpecsB:[a]}},MoveCursor:m,RemoveCursor:m,RemoveMember:m,RemoveStyle:m,RemoveText:function(b,a){var c=b.position+b.length,d=a.position+a.length,f=[b],g=[a];d<=b.position?b.position-=a.length:a.position<c&&(b.position<a.position?b.length=d<c?b.length-a.length:
a.position-b.position:(b.position=a.position,d<c?b.length=c-d:f=[]));return{opSpecsA:f,opSpecsB:g}},SetParagraphStyle:m,SplitParagraph:function(b,a){a.position<b.position?b.position+=1:a.position<b.position+b.length&&(b.length+=1);return{opSpecsA:[b],opSpecsB:[a]}},UpdateMember:m,UpdateMetadata:m,UpdateParagraphStyle:m},InsertText:{InsertText:function(b,a,c){b.position<a.position?a.position+=b.text.length:b.position>a.position?b.position+=a.text.length:c?a.position+=b.text.length:b.position+=a.text.length;
return{opSpecsA:[b],opSpecsB:[a]}},MergeParagraph:function(b,a){b.position>=a.sourceStartPosition?b.position-=1:(b.position<a.sourceStartPosition&&(a.sourceStartPosition+=b.text.length),b.position<a.destinationStartPosition&&(a.destinationStartPosition+=b.text.length));return{opSpecsA:[b],opSpecsB:[a]}},MoveCursor:function(b,a){var c=k(a);b.position<a.position?a.position+=b.text.length:b.position<a.position+a.length&&(a.length+=b.text.length);c&&f(a);return{opSpecsA:[b],opSpecsB:[a]}},RemoveCursor:m,
RemoveMember:m,RemoveStyle:m,RemoveText:function(b,a){var c;c=a.position+a.length;var d=[b],f=[a];c<=b.position?b.position-=a.length:b.position<=a.position?a.position+=b.text.length:(a.length=b.position-a.position,c={optype:"RemoveText",memberid:a.memberid,timestamp:a.timestamp,position:b.position+b.text.length,length:c-b.position},f.unshift(c),b.position=a.position);return{opSpecsA:d,opSpecsB:f}},SetParagraphStyle:function(b,a){a.position>b.position&&(a.position+=b.text.length);return{opSpecsA:[b],
opSpecsB:[a]}},SplitParagraph:function(b,a){b.position<a.sourceParagraphPosition&&(a.sourceParagraphPosition+=b.text.length);b.position<=a.position?a.position+=b.text.length:b.position+=1;return{opSpecsA:[b],opSpecsB:[a]}},UpdateMember:m,UpdateMetadata:m,UpdateParagraphStyle:m},MergeParagraph:{MergeParagraph:function(b,a,c){var d=[b],f=[a],g;b.destinationStartPosition===a.destinationStartPosition?(d=[],f=[],b.moveCursor&&(g={optype:"MoveCursor",memberid:b.memberid,timestamp:b.timestamp,position:b.sourceStartPosition-
1},d.push(g)),a.moveCursor&&(g={optype:"MoveCursor",memberid:a.memberid,timestamp:a.timestamp,position:a.sourceStartPosition-1},f.push(g)),b=c?b:a,b={optype:"SetParagraphStyle",memberid:b.memberid,timestamp:b.timestamp,position:b.destinationStartPosition,styleName:b.paragraphStyleName},c?d.push(b):f.push(b)):a.sourceStartPosition===b.destinationStartPosition?(b.destinationStartPosition=a.destinationStartPosition,b.sourceStartPosition-=1,b.paragraphStyleName=a.paragraphStyleName):b.sourceStartPosition===
a.destinationStartPosition?(a.destinationStartPosition=b.destinationStartPosition,a.sourceStartPosition-=1,a.paragraphStyleName=b.paragraphStyleName):b.destinationStartPosition<a.destinationStartPosition?(a.destinationStartPosition-=1,a.sourceStartPosition-=1):(b.destinationStartPosition-=1,b.sourceStartPosition-=1);return{opSpecsA:d,opSpecsB:f}},MoveCursor:function(b,a){var c=a.position,d=a.position+a.length,f=Math.min(c,d),c=Math.max(c,d);f>=b.sourceStartPosition&&(f-=1);c>=b.sourceStartPosition&&
(c-=1);0<=a.length?(a.position=f,a.length=c-f):(a.position=c,a.length=f-c);return{opSpecsA:[b],opSpecsB:[a]}},RemoveCursor:m,RemoveMember:m,RemoveStyle:m,RemoveText:function(b,a){a.position>=b.sourceStartPosition?a.position-=1:(a.position<b.destinationStartPosition&&(b.destinationStartPosition-=a.length),a.position<b.sourceStartPosition&&(b.sourceStartPosition-=a.length));return{opSpecsA:[b],opSpecsB:[a]}},SetParagraphStyle:function(b,a){var c=[b],d=[a];if(a.position>b.sourceStartPosition)a.position-=
1;else if(a.position===b.destinationStartPosition||a.position===b.sourceStartPosition)a.position=b.destinationStartPosition,b.paragraphStyleName=a.styleName;return{opSpecsA:c,opSpecsB:d}},SplitParagraph:function(b,a){var c,d=[b],f=[a];a.position<b.destinationStartPosition?(b.destinationStartPosition+=1,b.sourceStartPosition+=1):a.position>=b.destinationStartPosition&&a.position<b.sourceStartPosition?(a.paragraphStyleName=b.paragraphStyleName,c={optype:"SetParagraphStyle",memberid:b.memberid,timestamp:b.timestamp,
position:b.destinationStartPosition,styleName:b.paragraphStyleName},d.push(c),a.position===b.sourceStartPosition-1&&b.moveCursor&&(c={optype:"MoveCursor",memberid:b.memberid,timestamp:b.timestamp,position:a.position,length:0},d.push(c)),b.destinationStartPosition=a.position+1,b.sourceStartPosition+=1):a.position>=b.sourceStartPosition&&(a.position-=1,a.sourceParagraphPosition-=1);return{opSpecsA:d,opSpecsB:f}},UpdateMember:m,UpdateMetadata:m,UpdateParagraphStyle:m},MoveCursor:{MoveCursor:m,RemoveCursor:function(b,
a){return{opSpecsA:b.memberid===a.memberid?[]:[b],opSpecsB:[a]}},RemoveMember:m,RemoveStyle:m,RemoveText:function(b,a){var c=k(b),d=b.position+b.length,g=a.position+a.length;g<=b.position?b.position-=a.length:a.position<d&&(b.position<a.position?b.length=g<d?b.length-a.length:a.position-b.position:(b.position=a.position,b.length=g<d?d-g:0));c&&f(b);return{opSpecsA:[b],opSpecsB:[a]}},SetParagraphStyle:m,SplitParagraph:function(b,a){var c=k(b);a.position<b.position?b.position+=1:a.position<b.position+
b.length&&(b.length+=1);c&&f(b);return{opSpecsA:[b],opSpecsB:[a]}},UpdateMember:m,UpdateMetadata:m,UpdateParagraphStyle:m},RemoveCursor:{RemoveCursor:function(b,a){var c=b.memberid===a.memberid;return{opSpecsA:c?[]:[b],opSpecsB:c?[]:[a]}},RemoveMember:m,RemoveStyle:m,RemoveText:m,SetParagraphStyle:m,SplitParagraph:m,UpdateMember:m,UpdateMetadata:m,UpdateParagraphStyle:m},RemoveMember:{RemoveStyle:m,RemoveText:m,SetParagraphStyle:m,SplitParagraph:m,UpdateMetadata:m,UpdateParagraphStyle:m},RemoveStyle:{RemoveStyle:function(b,
a){var c=b.styleName===a.styleName&&b.styleFamily===a.styleFamily;return{opSpecsA:c?[]:[b],opSpecsB:c?[]:[a]}},RemoveText:m,SetParagraphStyle:function(b,a){var c,d=[b],f=[a];"paragraph"===b.styleFamily&&b.styleName===a.styleName&&(c={optype:"SetParagraphStyle",memberid:b.memberid,timestamp:b.timestamp,position:a.position,styleName:""},d.unshift(c),a.styleName="");return{opSpecsA:d,opSpecsB:f}},SplitParagraph:m,UpdateMember:m,UpdateMetadata:m,UpdateParagraphStyle:function(b,c){var f,h=[b],g=[c];"paragraph"===
b.styleFamily&&(f=a(c.setProperties,b.styleName),0<f.length&&(f={optype:"UpdateParagraphStyle",memberid:b.memberid,timestamp:b.timestamp,styleName:c.styleName,removedProperties:{attributes:f.join(",")}},h.unshift(f)),b.styleName===c.styleName?g=[]:d(c.setProperties,b.styleName));return{opSpecsA:h,opSpecsB:g}}},RemoveText:{RemoveText:function(b,a){var c=b.position+b.length,d=a.position+a.length,f=[b],g=[a];d<=b.position?b.position-=a.length:c<=a.position?a.position-=b.length:a.position<c&&(b.position<
a.position?(b.length=d<c?b.length-a.length:a.position-b.position,c<d?(a.position=b.position,a.length=d-c):g=[]):(c<d?a.length-=b.length:a.position<b.position?a.length=b.position-a.position:g=[],d<c?(b.position=a.position,b.length=c-d):f=[]));return{opSpecsA:f,opSpecsB:g}},SetParagraphStyle:function(b,a){b.position<a.position&&(a.position-=b.length);return{opSpecsA:[b],opSpecsB:[a]}},SplitParagraph:function(b,a){var c=b.position+b.length,d=[b],f=[a];a.position<=b.position?b.position+=1:a.position<
c&&(b.length=a.position-b.position,c={optype:"RemoveText",memberid:b.memberid,timestamp:b.timestamp,position:a.position+1,length:c-a.position},d.unshift(c));b.position+b.length<=a.position?a.position-=b.length:b.position<a.position&&(a.position=b.position);b.position+b.length<a.sourceParagraphPosition&&(a.sourceParagraphPosition-=b.length);return{opSpecsA:d,opSpecsB:f}},UpdateMember:m,UpdateMetadata:m,UpdateParagraphStyle:m},SetParagraphStyle:{SetParagraphStyle:function(a,c,d){a.position===c.position&&
(d?c.styleName=a.styleName:a.styleName=c.styleName);return{opSpecsA:[a],opSpecsB:[c]}},SplitParagraph:function(a,d){var f=[a],h=[d],g;a.position>d.position?a.position+=1:a.position===d.sourceParagraphPosition&&(d.paragraphStyleName=a.styleName,g=c(a),g.position=d.position+1,f.push(g));return{opSpecsA:f,opSpecsB:h}},UpdateMember:m,UpdateMetadata:m,UpdateParagraphStyle:m},SplitParagraph:{SplitParagraph:function(a,c,d){var f,g;a.position<c.position?f=!0:c.position<a.position?g=!0:a.position===c.position&&
(d?f=!0:g=!0);f?(c.position+=1,c.sourceParagraphPosition=a.position<c.sourceParagraphPosition?c.sourceParagraphPosition+1:a.position+1):g&&(a.position+=1,a.sourceParagraphPosition=c.position<c.sourceParagraphPosition?a.sourceParagraphPosition+1:c.position+1);return{opSpecsA:[a],opSpecsB:[c]}},UpdateMember:m,UpdateMetadata:m,UpdateParagraphStyle:m},UpdateMember:{UpdateMetadata:m,UpdateParagraphStyle:m},UpdateMetadata:{UpdateMetadata:function(a,c,d){var f,k=[a],m=[c];f=d?a:c;a=d?c:a;g(a.setProperties||
null,a.removedProperties||null,f.setProperties||null,f.removedProperties||null);f.setProperties&&n(f.setProperties)||f.removedProperties&&l(f.removedProperties)||(d?k=[]:m=[]);a.setProperties&&n(a.setProperties)||a.removedProperties&&l(a.removedProperties)||(d?m=[]:k=[]);return{opSpecsA:k,opSpecsB:m}},UpdateParagraphStyle:m},UpdateParagraphStyle:{UpdateParagraphStyle:function(a,c,d){var f,k=[a],m=[c];a.styleName===c.styleName&&(f=d?a:c,a=d?c:a,q(a.setProperties,a.removedProperties,f.setProperties,
f.removedProperties,"style:paragraph-properties"),q(a.setProperties,a.removedProperties,f.setProperties,f.removedProperties,"style:text-properties"),g(a.setProperties||null,a.removedProperties||null,f.setProperties||null,f.removedProperties||null),f.setProperties&&n(f.setProperties)||f.removedProperties&&l(f.removedProperties)||(d?k=[]:m=[]),a.setProperties&&n(a.setProperties)||a.removedProperties&&l(a.removedProperties)||(d?m=[]:k=[]));return{opSpecsA:k,opSpecsB:m}}}};this.passUnchanged=m;this.extendTransformations=
function(a){Object.keys(a).forEach(function(c){var d=a[c],f,g=p.hasOwnProperty(c);runtime.log((g?"Extending":"Adding")+" map for optypeA: "+c);g||(p[c]={});f=p[c];Object.keys(d).forEach(function(a){var b=f.hasOwnProperty(a);runtime.assert(c<=a,"Wrong order:"+c+", "+a);runtime.log("  "+(b?"Overwriting":"Adding")+" entry for optypeB: "+a);f[a]=d[a]})})};this.transformOpspecVsOpspec=function(a,c){var d=a.optype<=c.optype,f;runtime.log("Crosstransforming:");runtime.log(runtime.toJson(a));runtime.log(runtime.toJson(c));
d||(f=a,a=c,c=f);(f=(f=p[a.optype])&&f[c.optype])?(f=f(a,c,!d),d||null===f||(f={opSpecsA:f.opSpecsB,opSpecsB:f.opSpecsA})):f=null;runtime.log("result:");f?(runtime.log(runtime.toJson(f.opSpecsA)),runtime.log(runtime.toJson(f.opSpecsB))):runtime.log("null");return f}};
ops.OperationTransformer=function(){function f(a,d){for(var c,g,n=[],l=[];0<a.length&&d;){c=a.shift();c=k.transformOpspecVsOpspec(c,d);if(!c)return null;n=n.concat(c.opSpecsA);if(0===c.opSpecsB.length){n=n.concat(a);d=null;break}for(;1<c.opSpecsB.length;){g=f(a,c.opSpecsB.shift());if(!g)return null;l=l.concat(g.opSpecsB);a=g.opSpecsA}d=c.opSpecsB.pop()}d&&l.push(d);return{opSpecsA:n,opSpecsB:l}}var k=new ops.OperationTransformMatrix;this.getOperationTransformMatrix=function(){return k};this.transform=
function(a,d){for(var c,g=[];0<d.length;){c=f(a,d.shift());if(!c)return null;a=c.opSpecsA;g=g.concat(c.opSpecsB)}return{opSpecsA:a,opSpecsB:g}}};var webodf_css='@namespace draw url(urn:oasis:names:tc:opendocument:xmlns:drawing:1.0);@namespace fo url(urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0);@namespace office url(urn:oasis:names:tc:opendocument:xmlns:office:1.0);@namespace presentation url(urn:oasis:names:tc:opendocument:xmlns:presentation:1.0);@namespace style url(urn:oasis:names:tc:opendocument:xmlns:style:1.0);@namespace svg url(urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0);@namespace table url(urn:oasis:names:tc:opendocument:xmlns:table:1.0);@namespace text url(urn:oasis:names:tc:opendocument:xmlns:text:1.0);@namespace webodfhelper url(urn:webodf:names:helper);@namespace cursor url(urn:webodf:names:cursor);@namespace editinfo url(urn:webodf:names:editinfo);@namespace annotation url(urn:webodf:names:annotation);@namespace dc url(http://purl.org/dc/elements/1.1/);@namespace svgns url(http://www.w3.org/2000/svg);office|document > *, office|document-content > * {display: none;}office|body, office|document {display: inline-block;position: relative;}text|p, text|h {display: block;padding: 0;margin: 0;line-height: normal;position: relative;}text|p::after, text|h::after {content: "\\200B";white-space: pre;}*[webodfhelper|containsparagraphanchor] {position: relative;}text|s {white-space: pre;}text|tab {display: inline;white-space: pre;}text|tracked-changes {display: none;}office|binary-data {display: none;}office|text {display: block;text-align: left;overflow: visible;word-wrap: break-word;}office|text::selection {background: transparent;}.webodf-virtualSelections *::selection {background: transparent;}.webodf-virtualSelections *::-moz-selection {background: transparent;}office|text * draw|text-box {display: block;border: 1px solid #d3d3d3;}office|text draw|frame {z-index: 1;}office|spreadsheet {display: block;border-collapse: collapse;empty-cells: show;font-family: sans-serif;font-size: 10pt;text-align: left;page-break-inside: avoid;overflow: hidden;}office|presentation {display: inline-block;text-align: left;}#shadowContent {display: inline-block;text-align: left;}draw|page {display: block;position: relative;overflow: hidden;}presentation|notes, presentation|footer-decl, presentation|date-time-decl {display: none;}@media print {draw|page {border: 1pt solid black;page-break-inside: avoid;}presentation|notes {}}office|spreadsheet text|p {border: 0px;padding: 1px;margin: 0px;}office|spreadsheet table|table {margin: 3px;}office|spreadsheet table|table:after {}office|spreadsheet table|table-row {counter-increment: row;}office|spreadsheet table|table-row:before {width: 3em;background: #cccccc;border: 1px solid black;text-align: center;content: counter(row);display: table-cell;}office|spreadsheet table|table-cell {border: 1px solid #cccccc;}table|table {display: table;}draw|frame table|table {width: 100%;height: 100%;background: white;}table|table-header-rows {display: table-header-group;}table|table-row {display: table-row;}table|table-column {display: table-column;}table|table-cell {width: 0.889in;display: table-cell;word-break: break-all;}draw|frame {display: block;}draw|image {display: block;width: 100%;height: 100%;top: 0px;left: 0px;background-repeat: no-repeat;background-size: 100% 100%;-moz-background-size: 100% 100%;}draw|frame > draw|image:nth-of-type(n+2) {display: none;}text|list:before {display: none;content:"";}text|list {display: block;}text|list-item {display: block;}text|number {display:none;}text|a {color: blue;text-decoration: underline;cursor: pointer;}.webodf-inactiveLinks text|a {cursor: text;}text|note-citation {vertical-align: super;font-size: smaller;}text|note-body {display: none;}text|note:hover text|note-citation {background: #dddddd;}text|note:hover text|note-body {display: block;left:1em;max-width: 80%;position: absolute;background: #ffffaa;}text|bibliography-source {display: none;}svg|title, svg|desc {display: none;}video {width: 100%;height: 100%}cursor|anchor {display: none;}cursor|cursor {display: none;}.webodf-caretOverlay {position: absolute;top: 5%;height: 1em;z-index: 10;padding-left: 1px;pointer-events: none;}.webodf-caretOverlay .caret {position: absolute;border-left: 2px solid black;top: 0;bottom: 0;right: 0;}.webodf-caretOverlay .handle {position: absolute;margin-top: 5px;padding-top: 3px;margin-left: auto;margin-right: auto;width: 64px;height: 68px;border-radius: 5px;opacity: 0.3;text-align: center;background-color: black;box-shadow: 0px 0px 5px rgb(90, 90, 90);border: 1px solid black;top: -85px;right: -32px;}.webodf-caretOverlay .handle > img {box-shadow: 0px 0px 5px rgb(90, 90, 90) inset;background-color: rgb(200, 200, 200);border-radius: 5px;border: 2px solid;height: 60px;width: 60px;display: block;margin: auto;}.webodf-caretOverlay .handle.active {opacity: 0.8;}.webodf-caretOverlay .handle:after {content: " ";position: absolute;width: 0px;height: 0px;border-style: solid;border-width: 8.7px 5px 0 5px;border-color: black transparent transparent transparent;top: 100%;left: 43%;}.webodf-caretSizer {display: inline-block;width: 0;visibility: hidden;}#eventTrap {display: block;position: absolute;bottom: 0;left: 0;outline: none;opacity: 0;color: rgba(255, 255, 255, 0);pointer-events: none;white-space: pre;overflow: hidden;}cursor|cursor > #composer {text-decoration: underline;}cursor|cursor[cursor|caret-sizer-active="true"],cursor|cursor[cursor|composing="true"] {display: inline;}editinfo|editinfo {display: inline-block;}.editInfoMarker {position: absolute;width: 10px;height: 100%;left: -20px;opacity: 0.8;top: 0;border-radius: 5px;background-color: transparent;box-shadow: 0px 0px 5px rgba(50, 50, 50, 0.75);}.editInfoMarker:hover {box-shadow: 0px 0px 8px rgba(0, 0, 0, 1);}.editInfoHandle {position: absolute;background-color: black;padding: 5px;border-radius: 5px;opacity: 0.8;box-shadow: 0px 0px 5px rgba(50, 50, 50, 0.75);bottom: 100%;margin-bottom: 10px;z-index: 3;left: -25px;}.editInfoHandle:after {content: " ";position: absolute;width: 0px;height: 0px;border-style: solid;border-width: 8.7px 5px 0 5px;border-color: black transparent transparent transparent;top: 100%;left: 5px;}.editInfo {font-family: sans-serif;font-weight: normal;font-style: normal;text-decoration: none;color: white;width: 100%;height: 12pt;}.editInfoColor {float: left;width: 10pt;height: 10pt;border: 1px solid white;}.editInfoAuthor {float: left;margin-left: 5pt;font-size: 10pt;text-align: left;height: 12pt;line-height: 12pt;}.editInfoTime {float: right;margin-left: 30pt;font-size: 8pt;font-style: italic;color: yellow;height: 12pt;line-height: 12pt;}.annotationWrapper {display: inline;position: relative;}.annotationRemoveButton:before {content: "\u00d7";color: white;padding: 5px;line-height: 1em;}.annotationRemoveButton {width: 20px;height: 20px;border-radius: 10px;background-color: black;box-shadow: 0px 0px 5px rgba(50, 50, 50, 0.75);position: absolute;top: -10px;left: -10px;z-index: 3;text-align: center;font-family: sans-serif;font-style: normal;font-weight: normal;text-decoration: none;font-size: 15px;}.annotationRemoveButton:hover {cursor: pointer;box-shadow: 0px 0px 5px rgba(0, 0, 0, 1);}.annotationNote {width: 4cm;position: absolute;display: inline;z-index: 10;top: 0;}.annotationNote > office|annotation {display: block;text-align: left;}.annotationConnector {position: absolute;display: inline;top: 0;z-index: 2;border-top: 1px dashed brown;}.annotationConnector.angular {-moz-transform-origin: left top;-webkit-transform-origin: left top;-ms-transform-origin: left top;transform-origin: left top;}.annotationConnector.horizontal {left: 0;}.annotationConnector.horizontal:before {content: "";display: inline;position: absolute;width: 0px;height: 0px;border-style: solid;border-width: 8.7px 5px 0 5px;border-color: brown transparent transparent transparent;top: -1px;left: -5px;}office|annotation {width: 100%;height: 100%;display: none;background: rgb(198, 238, 184);background: -moz-linear-gradient(90deg, rgb(198, 238, 184) 30%, rgb(180, 196, 159) 100%);background: -webkit-linear-gradient(90deg, rgb(198, 238, 184) 30%, rgb(180, 196, 159) 100%);background: -o-linear-gradient(90deg, rgb(198, 238, 184) 30%, rgb(180, 196, 159) 100%);background: -ms-linear-gradient(90deg, rgb(198, 238, 184) 30%, rgb(180, 196, 159) 100%);background: linear-gradient(180deg, rgb(198, 238, 184) 30%, rgb(180, 196, 159) 100%);box-shadow: 0 3px 4px -3px #ccc;}office|annotation > dc|creator {display: block;font-size: 10pt;font-weight: normal;font-style: normal;font-family: sans-serif;color: white;background-color: brown;padding: 4px;}office|annotation > dc|date {display: block;font-size: 10pt;font-weight: normal;font-style: normal;font-family: sans-serif;border: 4px solid transparent;color: black;}office|annotation > text|list {display: block;padding: 5px;}office|annotation text|p {font-size: 10pt;color: black;font-weight: normal;font-style: normal;text-decoration: none;font-family: sans-serif;}#annotationsPane {background-color: #EAEAEA;width: 4cm;height: 100%;display: none;position: absolute;outline: 1px solid #ccc;}.webodf-annotationHighlight {background-color: yellow;position: relative;}.webodf-selectionOverlay {position: absolute;pointer-events: none;top: 0;left: 0;top: 0;left: 0;width: 100%;height: 100%;z-index: 15;}.webodf-selectionOverlay > polygon {fill-opacity: 0.3;stroke-opacity: 0.8;stroke-width: 1;fill-rule: evenodd;}.webodf-selectionOverlay > .webodf-draggable {fill-opacity: 0.8;stroke-opacity: 0;stroke-width: 8;pointer-events: all;display: none;-moz-transform-origin: center center;-webkit-transform-origin: center center;-ms-transform-origin: center center;transform-origin: center center;}#imageSelector {display: none;position: absolute;border-style: solid;border-color: black;}#imageSelector > div {width: 5px;height: 5px;display: block;position: absolute;border: 1px solid black;background-color: #ffffff;}#imageSelector > .topLeft {top: -4px;left: -4px;}#imageSelector > .topRight {top: -4px;right: -4px;}#imageSelector > .bottomRight {right: -4px;bottom: -4px;}#imageSelector > .bottomLeft {bottom: -4px;left: -4px;}#imageSelector > .topMiddle {top: -4px;left: 50%;margin-left: -2.5px;}#imageSelector > .rightMiddle {top: 50%;right: -4px;margin-top: -2.5px;}#imageSelector > .bottomMiddle {bottom: -4px;left: 50%;margin-left: -2.5px;}#imageSelector > .leftMiddle {top: 50%;left: -4px;margin-top: -2.5px;}div.webodf-customScrollbars::-webkit-scrollbar{width: 8px;height: 8px;background-color: transparent;}div.webodf-customScrollbars::-webkit-scrollbar-track{background-color: transparent;}div.webodf-customScrollbars::-webkit-scrollbar-thumb{background-color: #444;border-radius: 4px;}.webodf-hyperlinkTooltip {display: none;color: white;background-color: black;border-radius: 5px;box-shadow: 2px 2px 5px gray;padding: 3px;position: absolute;max-width: 210px;text-align: left;word-break: break-all;z-index: 16;}.webodf-hyperlinkTooltipText {display: block;font-weight: bold;}';
function number_format(f,k,a,d){f=(f+"").replace(/[^0-9+\-Ee.]/g,"");f=isFinite(+f)?+f:0;k=isFinite(+k)?Math.abs(k):0;d="undefined"===typeof d?",":d;a="undefined"===typeof a?".":a;var c="",c=function(a,c){var d=Math.pow(10,c);return""+Math.round(a*d)/d},c=(k?c(f,k):""+Math.round(f)).split(".");3<c[0].length&&(c[0]=c[0].replace(/\B(?=(?:\d{3})+(?!\d))/g,d));(c[1]||"").length<k&&(c[1]=c[1]||"",c[1]+=Array(k-c[1].length+1).join("0"));return c.join(a)};
